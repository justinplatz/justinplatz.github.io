(function(shared,scope,testing){var originalRequestAnimationFrame=window.requestAnimationFrame,rafCallbacks=[],rafId=0;window.requestAnimationFrame=function(f){var id=rafId++;if(0==rafCallbacks.length&&!WEB_ANIMATIONS_TESTING){originalRequestAnimationFrame(processRafCallbacks)}rafCallbacks.push([id,f]);return id};window.cancelAnimationFrame=function(id){rafCallbacks.forEach(function(entry){if(entry[0]==id){entry[1]=function(){}}})};function processRafCallbacks(t){var processing=rafCallbacks;rafCallbacks=[];if(t<timeline.currentTime)t=timeline.currentTime;timeline._animations.sort(compareAnimations);timeline._animations=tick(t,!0,timeline._animations)[0];processing.forEach(function(entry){entry[1](t)});applyPendingEffects();_now=void 0}function compareAnimations(leftAnimation,rightAnimation){return leftAnimation._sequenceNumber-rightAnimation._sequenceNumber}function InternalTimeline(){this._animations=[];this.currentTime=window.performance&&performance.now?performance.now():0};InternalTimeline.prototype={_play:function(effect){effect._timing=shared.normalizeTimingInput(effect.timing);var animation=new scope.Animation(effect);animation._idle=!1;animation._timeline=this;this._animations.push(animation);scope.restart();scope.applyDirtiedAnimation(animation);return animation}};var _now=void 0;if(WEB_ANIMATIONS_TESTING){var now=function(){return timeline.currentTime}}else{var now=function(){if(_now==void 0)_now=window.performance&&performance.now?performance.now():Date.now();return _now}}var ticking=!1,hasRestartedThisFrame=!1;scope.restart=function(){if(!ticking){ticking=!0;requestAnimationFrame(function(){});hasRestartedThisFrame=!0}return hasRestartedThisFrame};scope.applyDirtiedAnimation=function(animation){if(inTick){return}animation._markTarget();var animations=animation._targetAnimations();animations.sort(compareAnimations);var inactiveAnimations=tick(scope.timeline.currentTime,!1,animations.slice())[1];inactiveAnimations.forEach(function(animation){var index=timeline._animations.indexOf(animation);if(-1!==index){timeline._animations.splice(index,1)}});applyPendingEffects()};var pendingEffects=[];function applyPendingEffects(){pendingEffects.forEach(function(f){f()});pendingEffects.length=0}var t60hz=1e3/60,inTick=!1;function tick(t,isAnimationFrame,updatingAnimations){inTick=!0;hasRestartedThisFrame=!1;var timeline=scope.timeline;timeline.currentTime=t;ticking=!1;var newPendingClears=[],newPendingEffects=[],activeAnimations=[],inactiveAnimations=[];updatingAnimations.forEach(function(animation){animation._tick(t,isAnimationFrame);if(!animation._inEffect){newPendingClears.push(animation._effect);animation._unmarkTarget()}else{newPendingEffects.push(animation._effect);animation._markTarget()}if(animation._needsTick)ticking=!0;var alive=animation._inEffect||animation._needsTick;animation._inTimeline=alive;if(alive){activeAnimations.push(animation)}else{inactiveAnimations.push(animation)}});pendingEffects.push.apply(pendingEffects,newPendingClears);pendingEffects.push.apply(pendingEffects,newPendingEffects);if(ticking)requestAnimationFrame(function(){});inTick=!1;return[activeAnimations,inactiveAnimations]};if(WEB_ANIMATIONS_TESTING){testing.tick=function(t){timeline.currentTime=t;processRafCallbacks(t)};testing.isTicking=function(){return ticking};testing.setTicking=function(newVal){ticking=newVal}}var timeline=new InternalTimeline;scope.timeline=timeline})(webAnimationsShared,webAnimations1,webAnimationsTesting);