(function(root,factory){'use strict';if("function"===typeof define&&define.amd){define("sinon",[],function(){return root.sinon=factory()})}else if("object"===typeof exports){module.exports=factory()}else{root.sinon=factory()}})(this,function(){'use strict';var samsam,formatio,lolex;(function(){function define(mod,deps,fn){if("samsam"==mod){samsam=deps()}else if("function"===typeof deps&&0===mod.length){lolex=deps()}else if("function"===typeof fn){formatio=fn(samsam)}}define.amd={};("function"===typeof define&&define.amd&&function(m){define("samsam",m)}||"object"===typeof module&&function(m){module.exports=m()}||function(m){this.samsam=m()})(function(){var o=Object.prototype,div="undefined"!==typeof document&&document.createElement("div");function isNaN(value){var val=value;return"number"===typeof value&&value!==val}function getClass(value){return o.toString.call(value).split(/[ \]]/)[1]}function isArguments(object){if("Arguments"===getClass(object)){return!0}if("object"!==typeof object||"number"!==typeof object.length||"Array"===getClass(object)){return!1}if("function"==typeof object.callee){return!0}try{object[object.length]=6;delete object[object.length]}catch(e){return!0}return!1}function isElement(object){if(!object||1!==object.nodeType||!div){return!1}try{object.appendChild(div);object.removeChild(div)}catch(e){return!1}return!0}function keys(object){var ks=[],prop;for(prop in object){if(o.hasOwnProperty.call(object,prop)){ks.push(prop)}}return ks}function isDate(value){return"function"==typeof value.getTime&&value.getTime()==value.valueOf()}function isNegZero(value){return 0===value&&1/value===-Infinity}function identical(obj1,obj2){if(obj1===obj2||isNaN(obj1)&&isNaN(obj2)){return 0!==obj1||isNegZero(obj1)===isNegZero(obj2)}}function deepEqualCyclic(obj1,obj2){var objects1=[],objects2=[],paths1=[],paths2=[],compared={};function isObject(value){if("object"===typeof value&&null!==value&&!(value instanceof Boolean)&&!(value instanceof Date)&&!(value instanceof Number)&&!(value instanceof RegExp)&&!(value instanceof String)){return!0}return!1}function getIndex(objects,obj){var i;for(i=0;i<objects.length;i++){if(objects[i]===obj){return i}}return-1}return function deepEqual(obj1,obj2,path1,path2){var type1=typeof obj1,type2=typeof obj2;if(obj1===obj2||isNaN(obj1)||isNaN(obj2)||null==obj1||null==obj2||"object"!==type1||"object"!==type2){return identical(obj1,obj2)}if(isElement(obj1)||isElement(obj2)){return!1}var isDate1=isDate(obj1),isDate2=isDate(obj2);if(isDate1||isDate2){if(!isDate1||!isDate2||obj1.getTime()!==obj2.getTime()){return!1}}if(obj1 instanceof RegExp&&obj2 instanceof RegExp){if(obj1.toString()!==obj2.toString()){return!1}}var class1=getClass(obj1),class2=getClass(obj2),keys1=keys(obj1),keys2=keys(obj2);if(isArguments(obj1)||isArguments(obj2)){if(obj1.length!==obj2.length){return!1}}else{if(type1!==type2||class1!==class2||keys1.length!==keys2.length){return!1}}var key,i,l,value1,value2,isObject1,isObject2,index1,index2,newPath1,newPath2;for(i=0,l=keys1.length;i<l;i++){key=keys1[i];if(!o.hasOwnProperty.call(obj2,key)){return!1}value1=obj1[key];value2=obj2[key];isObject1=isObject(value1);isObject2=isObject(value2);index1=isObject1?getIndex(objects1,value1):-1;index2=isObject2?getIndex(objects2,value2):-1;newPath1=-1!==index1?paths1[index1]:path1+"["+JSON.stringify(key)+"]";newPath2=-1!==index2?paths2[index2]:path2+"["+JSON.stringify(key)+"]";if(compared[newPath1+newPath2]){return!0}if(-1===index1&&isObject1){objects1.push(value1);paths1.push(newPath1)}if(-1===index2&&isObject2){objects2.push(value2);paths2.push(newPath2)}if(isObject1&&isObject2){compared[newPath1+newPath2]=!0}if(!deepEqual(value1,value2,newPath1,newPath2)){return!1}}return!0}(obj1,obj2,"$1","$2")}var match;function arrayContains(array,subset){if(0===subset.length){return!0}var i,l,j,k;for(i=0,l=array.length;i<l;++i){if(match(array[i],subset[0])){for(j=0,k=subset.length;j<k;++j){if(!match(array[i+j],subset[j])){return!1}}return!0}}return!1}match=function match(object,matcher){if(matcher&&"function"===typeof matcher.test){return matcher.test(object)}if("function"===typeof matcher){return!0===matcher(object)}if("string"===typeof matcher){matcher=matcher.toLowerCase();var notNull="string"===typeof object||!!object;return notNull&&0<=(object+"").toLowerCase().indexOf(matcher)}if("number"===typeof matcher){return matcher===object}if("boolean"===typeof matcher){return matcher===object}if("undefined"===typeof matcher){return"undefined"===typeof object}if(null===matcher){return null===object}if("Array"===getClass(object)&&"Array"===getClass(matcher)){return arrayContains(object,matcher)}if(matcher&&"object"===typeof matcher){if(matcher===object){return!0}var prop;for(prop in matcher){var value=object[prop];if("undefined"===typeof value&&"function"===typeof object.getAttribute){value=object.getAttribute(prop)}if(null===matcher[prop]||"undefined"===typeof matcher[prop]){if(value!==matcher[prop]){return!1}}else if("undefined"===typeof value||!match(value,matcher[prop])){return!1}}return!0}throw new Error("Matcher was not a string, a number, a "+"function, a boolean or an object")};return{isArguments:isArguments,isElement:isElement,isDate:isDate,isNegZero:isNegZero,identical:identical,deepEqual:deepEqualCyclic,match:match,keys:keys}});("function"===typeof define&&define.amd&&function(m){define("formatio",["samsam"],m)}||"object"===typeof module&&function(m){module.exports=m(require("samsam"))}||function(m){this.formatio=m(this.samsam)})(function(samsam){var _Mathmin=Math.min,formatio={excludeConstructors:["Object",/^.$/],quoteStrings:!0,limitChildrenCount:0},hasOwn=Object.prototype.hasOwnProperty,specialObjects=[];if("undefined"!==typeof global){specialObjects.push({object:global,value:"[object global]"})}if("undefined"!==typeof document){specialObjects.push({object:document,value:"[object HTMLDocument]"})}if("undefined"!==typeof window){specialObjects.push({object:window,value:"[object Window]"})}function functionName(func){if(!func){return""}if(func.displayName){return func.displayName}if(func.name){return func.name}var matches=func.toString().match(/function\s+([^\(]+)/m);return matches&&matches[1]||""}function constructorName(f,object){var name=functionName(object&&object.constructor),excludes=f.excludeConstructors||formatio.excludeConstructors||[],i,l;for(i=0,l=excludes.length;i<l;++i){if("string"===typeof excludes[i]&&excludes[i]===name){return""}else if(excludes[i].test&&excludes[i].test(name)){return""}}return name}function isCircular(object,objects){if("object"!==typeof object){return!1}var i,l;for(i=0,l=objects.length;i<l;++i){if(objects[i]===object){return!0}}return!1}function ascii(f,object,processed,indent){if("string"===typeof object){var qs=f.quoteStrings,quote="boolean"!==typeof qs||qs;return processed||quote?"\""+object+"\"":object}if("function"===typeof object&&!(object instanceof RegExp)){return ascii.func(object)}processed=processed||[];if(isCircular(object,processed)){return"[Circular]"}if("[object Array]"===Object.prototype.toString.call(object)){return ascii.array.call(f,object,processed)}if(!object){return(1/object===-Infinity?"-0":object)+""}if(samsam.isElement(object)){return ascii.element(object)}if("function"===typeof object.toString&&object.toString!==Object.prototype.toString){return object.toString()}var i,l;for(i=0,l=specialObjects.length;i<l;i++){if(object===specialObjects[i].object){return specialObjects[i].value}}return ascii.object.call(f,object,processed,indent)}ascii.func=function(func){return"function "+functionName(func)+"() {}"};ascii.array=function(array,processed){processed=processed||[];processed.push(array);var pieces=[],i,l;l=0<this.limitChildrenCount?_Mathmin(this.limitChildrenCount,array.length):array.length;for(i=0;i<l;++i){pieces.push(ascii(this,array[i],processed))}if(l<array.length)pieces.push("[... "+(array.length-l)+" more elements]");return"["+pieces.join(", ")+"]"};ascii.object=function(object,processed,indent){processed=processed||[];processed.push(object);indent=indent||0;var pieces=[],properties=samsam.keys(object).sort(),length=3,prop,str,obj,i,k,l;l=0<this.limitChildrenCount?_Mathmin(this.limitChildrenCount,properties.length):properties.length;for(i=0;i<l;++i){prop=properties[i];obj=object[prop];if(isCircular(obj,processed)){str="[Circular]"}else{str=ascii(this,obj,processed,indent+2)}str=(/\s/.test(prop)?"\""+prop+"\"":prop)+": "+str;length+=str.length;pieces.push(str)}var cons=constructorName(this,object),prefix=cons?"["+cons+"] ":"",is="";for(i=0,k=indent;i<k;++i){is+=" "}if(l<properties.length)pieces.push("[... "+(properties.length-l)+" more elements]");if(80<length+indent){return prefix+"{\n  "+is+pieces.join(",\n  "+is)+"\n"+is+"}"}return prefix+"{ "+pieces.join(", ")+" }"};ascii.element=function(element){var tagName=element.tagName.toLowerCase(),attrs=element.attributes,attr,pairs=[],attrName,i,l,val;for(i=0,l=attrs.length;i<l;++i){attr=attrs.item(i);attrName=attr.nodeName.toLowerCase().replace("html:","");val=attr.nodeValue;if("contenteditable"!==attrName||"inherit"!==val){if(!!val){pairs.push(attrName+"=\""+val+"\"")}}}var formatted="<"+tagName+(0<pairs.length?" ":""),content=element.innerHTML;if(20<content.length){content=content.substr(0,20)+"[...]"}var res=formatted+pairs.join(" ")+">"+content+"</"+tagName+">";return res.replace(/ contentEditable="inherit"/,"")};function Formatio(options){for(var opt in options){this[opt]=options[opt]}}Formatio.prototype={functionName:functionName,configure:function(options){return new Formatio(options)},constructorName:function(object){return constructorName(this,object)},ascii:function(object,processed,indent){return ascii(this,object,processed,indent)}};return Formatio.prototype});!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.lolex=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){(function(global){var glbl=global;global.setTimeout=glbl.setTimeout;global.clearTimeout=glbl.clearTimeout;global.setInterval=glbl.setInterval;global.clearInterval=glbl.clearInterval;global.Date=glbl.Date;if("setImmediate"in global){global.setImmediate=glbl.setImmediate;global.clearImmediate=glbl.clearImmediate}var NOOP=function(){return},timeoutResult=setTimeout(NOOP,0),addTimerReturnsObject="object"===typeof timeoutResult;clearTimeout(timeoutResult);var NativeDate=Date,uniqueTimerId=1;function parseTime(str){if(!str){return 0}var strings=str.split(":"),l=strings.length,i=l,ms=0,parsed;if(3<l||!/^(\d\d:){0,2}\d\d?$/.test(str)){throw new Error("tick only understands numbers and 'h:m:s'")}while(i--){parsed=parseInt(strings[i],10);if(60<=parsed){throw new Error("Invalid time "+str)}ms+=parsed*Math.pow(60,l-i-1)}return 1e3*ms}function getEpoch(epoch){if(!epoch){return 0}if("function"===typeof epoch.getTime){return epoch.getTime()}if("number"===typeof epoch){return epoch}throw new TypeError("now should be milliseconds since UNIX epoch")}function inRange(from,to,timer){return timer&&timer.callAt>=from&&timer.callAt<=to}function mirrorDateProperties(target,source){var prop;for(prop in source){if(source.hasOwnProperty(prop)){target[prop]=source[prop]}}if(source.now){target.now=function now(){return target.clock.now}}else{delete target.now}if(source.toSource){target.toSource=function toSource(){return source.toSource()}}else{delete target.toSource}target.toString=function toString(){return source.toString()};target.prototype=source.prototype;target.parse=source.parse;target.UTC=source.UTC;target.prototype.toUTCString=source.prototype.toUTCString;return target}function createDate(){function ClockDate(year,month,date,hour,minute,second,ms){switch(arguments.length){case 0:return new NativeDate(ClockDate.clock.now);case 1:return new NativeDate(year);case 2:return new NativeDate(year,month);case 3:return new NativeDate(year,month,date);case 4:return new NativeDate(year,month,date,hour);case 5:return new NativeDate(year,month,date,hour,minute);case 6:return new NativeDate(year,month,date,hour,minute,second);default:return new NativeDate(year,month,date,hour,minute,second,ms);}}return mirrorDateProperties(ClockDate,NativeDate)}function addTimer(clock,timer){if(timer.func===void 0){throw new Error("Callback must be provided to timer calls")}if(!clock.timers){clock.timers={}}timer.id=uniqueTimerId++;timer.createdAt=clock.now;timer.callAt=clock.now+(timer.delay||(clock.duringTick?1:0));clock.timers[timer.id]=timer;if(addTimerReturnsObject){return{id:timer.id,ref:NOOP,unref:NOOP}}return timer.id}function compareTimers(a,b){if(a.callAt<b.callAt){return-1}if(a.callAt>b.callAt){return 1}if(a.immediate&&!b.immediate){return-1}if(!a.immediate&&b.immediate){return 1}if(a.createdAt<b.createdAt){return-1}if(a.createdAt>b.createdAt){return 1}if(a.id<b.id){return-1}if(a.id>b.id){return 1}}function firstTimerInRange(clock,from,to){var timers=clock.timers,timer=null,id,isInRange;for(id in timers){if(timers.hasOwnProperty(id)){isInRange=inRange(from,to,timers[id]);if(isInRange&&(!timer||1===compareTimers(timer,timers[id]))){timer=timers[id]}}}return timer}function callTimer(clock,timer){var exception;if("number"===typeof timer.interval){clock.timers[timer.id].callAt+=timer.interval}else{delete clock.timers[timer.id]}try{if("function"===typeof timer.func){timer.func.apply(null,timer.args)}else{eval(timer.func)}}catch(e){exception=e}if(!clock.timers[timer.id]){if(exception){throw exception}return}if(exception){throw exception}}function timerType(timer){if(timer.immediate){return"Immediate"}else if("undefined"!==typeof timer.interval){return"Interval"}else{return"Timeout"}}function clearTimer(clock,timerId,ttype){if(!timerId){return}if(!clock.timers){clock.timers=[]}if("object"===typeof timerId){timerId=timerId.id}if(clock.timers.hasOwnProperty(timerId)){var timer=clock.timers[timerId];if(timerType(timer)===ttype){delete clock.timers[timerId]}else{throw new Error("Cannot clear timer: timer created with set"+ttype+"() but cleared with clear"+timerType(timer)+"()")}}}function uninstall(clock,target){var method,i,l;for(i=0,l=clock.methods.length;i<l;i++){method=clock.methods[i];if(target[method].hadOwnProperty){target[method]=clock["_"+method]}else{try{delete target[method]}catch(ignore){}}}clock.methods=[]}function hijackMethod(target,method,clock){var prop;clock[method].hadOwnProperty=Object.prototype.hasOwnProperty.call(target,method);clock["_"+method]=target[method];if("Date"===method){var date=mirrorDateProperties(clock[method],target[method]);target[method]=date}else{target[method]=function(){return clock[method].apply(clock,arguments)};for(prop in clock[method]){if(clock[method].hasOwnProperty(prop)){target[method][prop]=clock[method][prop]}}}target[method].clock=clock}var timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setImmediate:global.setImmediate,clearImmediate:global.clearImmediate,setInterval:setInterval,clearInterval:clearInterval,Date:Date},keys=Object.keys||function(obj){var ks=[],key;for(key in obj){if(obj.hasOwnProperty(key)){ks.push(key)}}return ks};exports.timers=timers;function createClock(now){var clock={now:getEpoch(now),timeouts:{},Date:createDate()};clock.Date.clock=clock;clock.setTimeout=function setTimeout(func,timeout){return addTimer(clock,{func:func,args:Array.prototype.slice.call(arguments,2),delay:timeout})};clock.clearTimeout=function clearTimeout(timerId){return clearTimer(clock,timerId,"Timeout")};clock.setInterval=function setInterval(func,timeout){return addTimer(clock,{func:func,args:Array.prototype.slice.call(arguments,2),delay:timeout,interval:timeout})};clock.clearInterval=function clearInterval(timerId){return clearTimer(clock,timerId,"Interval")};clock.setImmediate=function setImmediate(func){return addTimer(clock,{func:func,args:Array.prototype.slice.call(arguments,1),immediate:!0})};clock.clearImmediate=function clearImmediate(timerId){return clearTimer(clock,timerId,"Immediate")};clock.tick=function tick(ms){ms="number"===typeof ms?ms:parseTime(ms);var tickFrom=clock.now,tickTo=clock.now+ms,previous=clock.now,timer=firstTimerInRange(clock,tickFrom,tickTo),oldNow;clock.duringTick=!0;var firstException;while(timer&&tickFrom<=tickTo){if(clock.timers[timer.id]){tickFrom=clock.now=timer.callAt;try{oldNow=clock.now;callTimer(clock,timer);if(oldNow!==clock.now){tickFrom+=clock.now-oldNow;tickTo+=clock.now-oldNow;previous+=clock.now-oldNow}}catch(e){firstException=firstException||e}}timer=firstTimerInRange(clock,previous,tickTo);previous=tickFrom}clock.duringTick=!1;clock.now=tickTo;if(firstException){throw firstException}return clock.now};clock.reset=function reset(){clock.timers={}};clock.setSystemTime=function setSystemTime(now){var newNow=getEpoch(now),difference=newNow-clock.now;clock.now=newNow;for(var id in clock.timers){if(clock.timers.hasOwnProperty(id)){var timer=clock.timers[id];timer.createdAt+=difference;timer.callAt+=difference}}};return clock}exports.createClock=createClock;exports.install=function install(target,now,toFake){var i,l;if("number"===typeof target){toFake=now;now=target;target=null}if(!target){target=global}var clock=createClock(now);clock.uninstall=function(){uninstall(clock,target)};clock.methods=toFake||[];if(0===clock.methods.length){clock.methods=keys(timers)}for(i=0,l=clock.methods.length;i<l;i++){hijackMethod(target,clock.methods[i],clock)}return clock}})(global||this)}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}]},{},[1])(1)})})();var define,sinon=function(){"use strict";var sinonModule,isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){sinonModule=module.exports=require("./sinon/util/core");require("./sinon/extend");require("./sinon/walk");require("./sinon/typeOf");require("./sinon/times_in_words");require("./sinon/spy");require("./sinon/call");require("./sinon/behavior");require("./sinon/stub");require("./sinon/mock");require("./sinon/collection");require("./sinon/assert");require("./sinon/sandbox");require("./sinon/test");require("./sinon/test_case");require("./sinon/match");require("./sinon/format");require("./sinon/log_error")}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require,module.exports,module);sinonModule=module.exports}else{sinonModule={}}return sinonModule}();(function(sinonGlobal){var div="undefined"!==typeof document&&document.createElement("div"),hasOwn=Object.prototype.hasOwnProperty;function isDOMNode(obj){var success=!1;try{obj.appendChild(div);success=div.parentNode===obj}catch(e){return!1}finally{try{obj.removeChild(div)}catch(e){}}return success}function isElement(obj){return div&&obj&&1===obj.nodeType&&isDOMNode(obj)}function isFunction(obj){return"function"===typeof obj||!!(obj&&obj.constructor&&obj.call&&obj.apply)}function isReallyNaN(val){return"number"===typeof val&&isNaN(val)}function mirrorProperties(target,source){for(var prop in source){if(!hasOwn.call(target,prop)){target[prop]=source[prop]}}}function isRestorable(obj){return"function"===typeof obj&&"function"===typeof obj.restore&&obj.restore.sinon}var hasES5Support="keys"in Object;function makeApi(sinon){sinon.wrapMethod=function wrapMethod(object,property,method){if(!object){throw new TypeError("Should wrap property of object")}if("function"!==typeof method&&"object"!==typeof method){throw new TypeError("Method wrapper should be a function or a property descriptor")}function checkWrappedMethod(wrappedMethod){var error;if(!isFunction(wrappedMethod)){error=new TypeError("Attempted to wrap "+typeof wrappedMethod+" property "+property+" as function")}else if(wrappedMethod.restore&&wrappedMethod.restore.sinon){error=new TypeError("Attempted to wrap "+property+" which is already wrapped")}else if(wrappedMethod.calledBefore){var verb=wrappedMethod.returns?"stubbed":"spied on";error=new TypeError("Attempted to wrap "+property+" which is already "+verb)}if(error){if(wrappedMethod&&wrappedMethod.stackTrace){error.stack+="\n--------------\n"+wrappedMethod.stackTrace}throw error}}var error,wrappedMethod,i,owned=object.hasOwnProperty?object.hasOwnProperty(property):hasOwn.call(object,property);if(hasES5Support){var methodDesc="function"===typeof method?{value:method}:method,wrappedMethodDesc=sinon.getPropertyDescriptor(object,property);if(!wrappedMethodDesc){error=new TypeError("Attempted to wrap "+typeof wrappedMethod+" property "+property+" as function")}else if(wrappedMethodDesc.restore&&wrappedMethodDesc.restore.sinon){error=new TypeError("Attempted to wrap "+property+" which is already wrapped")}if(error){if(wrappedMethodDesc&&wrappedMethodDesc.stackTrace){error.stack+="\n--------------\n"+wrappedMethodDesc.stackTrace}throw error}var types=sinon.objectKeys(methodDesc);for(i=0;i<types.length;i++){wrappedMethod=wrappedMethodDesc[types[i]];checkWrappedMethod(wrappedMethod)}mirrorProperties(methodDesc,wrappedMethodDesc);for(i=0;i<types.length;i++){mirrorProperties(methodDesc[types[i]],wrappedMethodDesc[types[i]])}Object.defineProperty(object,property,methodDesc)}else{wrappedMethod=object[property];checkWrappedMethod(wrappedMethod);object[property]=method;method.displayName=property}method.displayName=property;method.stackTrace=new Error("Stack Trace for original").stack;method.restore=function(){if(!owned){try{delete object[property]}catch(e){}}else if(hasES5Support){Object.defineProperty(object,property,wrappedMethodDesc)}if(object[property]===method){object[property]=wrappedMethod}};method.restore.sinon=!0;if(!hasES5Support){mirrorProperties(method,wrappedMethod)}return method};sinon.create=function create(proto){var F=function(){};F.prototype=proto;return new F};sinon.deepEqual=function deepEqual(a,b){if(sinon.match&&sinon.match.isMatcher(a)){return a.test(b)}if("object"!==typeof a||"object"!==typeof b){return isReallyNaN(a)&&isReallyNaN(b)||a===b}if(isElement(a)||isElement(b)){return a===b}if(a===b){return!0}if(null===a&&null!==b||null!==a&&null===b){return!1}if(a instanceof RegExp&&b instanceof RegExp){return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline}var aString=Object.prototype.toString.call(a);if(aString!==Object.prototype.toString.call(b)){return!1}if("[object Date]"===aString){return a.valueOf()===b.valueOf()}var prop,aLength=0,bLength=0;if("[object Array]"===aString&&a.length!==b.length){return!1}for(prop in a){if(a.hasOwnProperty(prop)){aLength+=1;if(!(prop in b)){return!1}if(!deepEqual(a[prop],b[prop])){return!1}}}for(prop in b){if(b.hasOwnProperty(prop)){bLength+=1}}return aLength===bLength};sinon.functionName=function functionName(func){var name=func.displayName||func.name;if(!name){var matches=func.toString().match(/function ([^\s\(]+)/);name=matches&&matches[1]}return name};sinon.functionToString=function toString(){if(this.getCall&&this.callCount){var thisValue,prop,i=this.callCount;while(i--){thisValue=this.getCall(i).thisValue;for(prop in thisValue){if(thisValue[prop]===this){return prop}}}}return this.displayName||"sinon fake"};sinon.objectKeys=function objectKeys(obj){if(obj!==Object(obj)){throw new TypeError("sinon.objectKeys called on a non-object")}var keys=[],key;for(key in obj){if(hasOwn.call(obj,key)){keys.push(key)}}return keys};sinon.getPropertyDescriptor=function getPropertyDescriptor(object,property){var proto=object,descriptor;while(proto&&!(descriptor=Object.getOwnPropertyDescriptor(proto,property))){proto=Object.getPrototypeOf(proto)}return descriptor};sinon.getConfig=function(custom){var config={};custom=custom||{};var defaults=sinon.defaultConfig;for(var prop in defaults){if(defaults.hasOwnProperty(prop)){config[prop]=custom.hasOwnProperty(prop)?custom[prop]:defaults[prop]}}return config};sinon.defaultConfig={injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0};sinon.timesInWords=function timesInWords(count){return 1===count&&"once"||2===count&&"twice"||3===count&&"thrice"||(count||0)+" times"};sinon.calledInOrder=function(spies){for(var i=1,l=spies.length;i<l;i++){if(!spies[i-1].calledBefore(spies[i])||!spies[i].called){return!1}}return!0};sinon.orderByFirstCall=function(spies){return spies.sort(function(a,b){var aCall=a.getCall(0),bCall=b.getCall(0),aId=aCall&&aCall.callId||-1,bId=bCall&&bCall.callId||-1;return aId<bId?-1:1})};sinon.createStubInstance=function(constructor){if("function"!==typeof constructor){throw new TypeError("The constructor should be a function.")}return sinon.stub(sinon.create(constructor.prototype))};sinon.restore=function(object){if(null!==object&&"object"===typeof object){for(var prop in object){if(isRestorable(object[prop])){object[prop].restore()}}}else if(isRestorable(object)){object.restore()}};return sinon}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports){makeApi(exports)}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(sinonGlobal){function makeApi(sinon){var hasDontEnumBug=function(){var obj={constructor:function(){return"0"},toString:function(){return"1"},valueOf:function(){return"2"},toLocaleString:function(){return"3"},prototype:function(){return"4"},isPrototypeOf:function(){return"5"},propertyIsEnumerable:function(){return"6"},hasOwnProperty:function(){return"7"},length:function(){return"8"},unique:function(){return"9"}},result=[];for(var prop in obj){if(obj.hasOwnProperty(prop)){result.push(obj[prop]())}}return"0123456789"!==result.join("")}();function extend(target){var sources=Array.prototype.slice.call(arguments,1),source,i,prop;for(i=0;i<sources.length;i++){source=sources[i];for(prop in source){if(source.hasOwnProperty(prop)){target[prop]=source[prop]}}if(hasDontEnumBug&&source.hasOwnProperty("toString")&&source.toString!==target.toString){target.toString=source.toString}}return target}sinon.extend=extend;return sinon.extend}function loadDependencies(require,exports,module){var sinon=require("./util/core");module.exports=makeApi(sinon)}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(sinonGlobal){function makeApi(sinon){function timesInWords(count){switch(count){case 1:return"once";case 2:return"twice";case 3:return"thrice";default:return(count||0)+" times";}}sinon.timesInWords=timesInWords;return sinon.timesInWords}function loadDependencies(require,exports,module){var core=require("./util/core");module.exports=makeApi(core)}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(sinonGlobal){function makeApi(sinon){function typeOf(value){if(null===value){return"null"}else if(value===void 0){return"undefined"}var string=Object.prototype.toString.call(value);return string.substring(8,string.length-1).toLowerCase()}sinon.typeOf=typeOf;return sinon.typeOf}function loadDependencies(require,exports,module){var core=require("./util/core");module.exports=makeApi(core)}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(sinonGlobal){function makeApi(sinon){function assertType(value,type,name){var actual=sinon.typeOf(value);if(actual!==type){throw new TypeError("Expected type of "+name+" to be "+type+", but was "+actual)}}var matcher={toString:function(){return this.message}};function isMatcher(object){return matcher.isPrototypeOf(object)}function matchObject(expectation,actual){if(null===actual||actual===void 0){return!1}for(var key in expectation){if(expectation.hasOwnProperty(key)){var exp=expectation[key],act=actual[key];if(isMatcher(exp)){if(!exp.test(act)){return!1}}else if("object"===sinon.typeOf(exp)){if(!matchObject(exp,act)){return!1}}else if(!sinon.deepEqual(exp,act)){return!1}}}return!0}function match(expectation,message){var m=sinon.create(matcher),type=sinon.typeOf(expectation);switch(type){case"object":if("function"===typeof expectation.test){m.test=function(actual){return!0===expectation.test(actual)};m.message="match("+sinon.functionName(expectation.test)+")";return m}var str=[];for(var key in expectation){if(expectation.hasOwnProperty(key)){str.push(key+": "+expectation[key])}}m.test=function(actual){return matchObject(expectation,actual)};m.message="match("+str.join(", ")+")";break;case"number":m.test=function(actual){return expectation==actual};break;case"string":m.test=function(actual){if("string"!==typeof actual){return!1}return-1!==actual.indexOf(expectation)};m.message="match(\""+expectation+"\")";break;case"regexp":m.test=function(actual){if("string"!==typeof actual){return!1}return expectation.test(actual)};break;case"function":m.test=expectation;if(message){m.message=message}else{m.message="match("+sinon.functionName(expectation)+")"}break;default:m.test=function(actual){return sinon.deepEqual(expectation,actual)};}if(!m.message){m.message="match("+expectation+")"}return m}matcher.or=function(m2){if(!arguments.length){throw new TypeError("Matcher expected")}else if(!isMatcher(m2)){m2=match(m2)}var m1=this,or=sinon.create(matcher);or.test=function(actual){return m1.test(actual)||m2.test(actual)};or.message=m1.message+".or("+m2.message+")";return or};matcher.and=function(m2){if(!arguments.length){throw new TypeError("Matcher expected")}else if(!isMatcher(m2)){m2=match(m2)}var m1=this,and=sinon.create(matcher);and.test=function(actual){return m1.test(actual)&&m2.test(actual)};and.message=m1.message+".and("+m2.message+")";return and};match.isMatcher=isMatcher;match.any=match(function(){return!0},"any");match.defined=match(function(actual){return null!==actual&&actual!==void 0},"defined");match.truthy=match(function(actual){return!!actual},"truthy");match.falsy=match(function(actual){return!actual},"falsy");match.same=function(expectation){return match(function(actual){return expectation===actual},"same("+expectation+")")};match.typeOf=function(type){assertType(type,"string","type");return match(function(actual){return sinon.typeOf(actual)===type},"typeOf(\""+type+"\")")};match.instanceOf=function(type){assertType(type,"function","type");return match(function(actual){return actual instanceof type},"instanceOf("+sinon.functionName(type)+")")};function createPropertyMatcher(propertyTest,messagePrefix){return function(property,value){assertType(property,"string","property");var onlyProperty=1===arguments.length,message=messagePrefix+"(\""+property+"\"";if(!onlyProperty){message+=", "+value}message+=")";return match(function(actual){if(actual===void 0||null===actual||!propertyTest(actual,property)){return!1}return onlyProperty||sinon.deepEqual(value,actual[property])},message)}}match.has=createPropertyMatcher(function(actual,property){if("object"===typeof actual){return property in actual}return actual[property]!==void 0},"has");match.hasOwn=createPropertyMatcher(function(actual,property){return actual.hasOwnProperty(property)},"hasOwn");match.bool=match.typeOf("boolean");match.number=match.typeOf("number");match.string=match.typeOf("string");match.object=match.typeOf("object");match.func=match.typeOf("function");match.array=match.typeOf("array");match.regexp=match.typeOf("regexp");match.date=match.typeOf("date");sinon.match=match;return match}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var sinon=require("./util/core");require("./typeOf");module.exports=makeApi(sinon)}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(sinonGlobal,formatio){function makeApi(sinon){function valueFormatter(value){return""+value}function getFormatioFormatter(){var formatter=formatio.configure({quoteStrings:!1,limitChildrenCount:250});function format(){return formatter.ascii.apply(formatter,arguments)}return format}function getNodeFormatter(){try{var util=require("util")}catch(e){}function format(v){var isObjectWithNativeToString="object"===typeof v&&v.toString===Object.prototype.toString;return isObjectWithNativeToString?util.inspect(v):v}return util?format:valueFormatter}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,formatter;if(isNode){try{formatio=require("formatio")}catch(e){}}if(formatio){formatter=getFormatioFormatter()}else if(isNode){formatter=getNodeFormatter()}else{formatter=valueFormatter}sinon.format=formatter;return sinon.format}function loadDependencies(require,exports,module){var sinon=require("./util/core");module.exports=makeApi(sinon)}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon,"object"===typeof formatio&&formatio);(function(sinonGlobal){var slice=Array.prototype.slice;function makeApi(sinon){function throwYieldError(proxy,text,args){var msg=sinon.functionName(proxy)+text;if(args.length){msg+=" Received ["+slice.call(args).join(", ")+"]"}throw new Error(msg)}var callProto={calledOn:function calledOn(thisValue){if(sinon.match&&sinon.match.isMatcher(thisValue)){return thisValue.test(this.thisValue)}return this.thisValue===thisValue},calledWith:function calledWith(){var l=arguments.length;if(l>this.args.length){return!1}for(var i=0;i<l;i+=1){if(!sinon.deepEqual(arguments[i],this.args[i])){return!1}}return!0},calledWithMatch:function calledWithMatch(){var l=arguments.length;if(l>this.args.length){return!1}for(var i=0;i<l;i+=1){var actual=this.args[i],expectation=arguments[i];if(!sinon.match||!sinon.match(expectation).test(actual)){return!1}}return!0},calledWithExactly:function calledWithExactly(){return arguments.length===this.args.length&&this.calledWith.apply(this,arguments)},notCalledWith:function notCalledWith(){return!this.calledWith.apply(this,arguments)},notCalledWithMatch:function notCalledWithMatch(){return!this.calledWithMatch.apply(this,arguments)},returned:function returned(value){return sinon.deepEqual(value,this.returnValue)},threw:function threw(error){if("undefined"===typeof error||!this.exception){return!!this.exception}return this.exception===error||this.exception.name===error},calledWithNew:function calledWithNew(){return this.proxy.prototype&&this.thisValue instanceof this.proxy},calledBefore:function(other){return this.callId<other.callId},calledAfter:function(other){return this.callId>other.callId},callArg:function(pos){this.args[pos]()},callArgOn:function(pos,thisValue){this.args[pos].apply(thisValue)},callArgWith:function(pos){this.callArgOnWith.apply(this,[pos,null].concat(slice.call(arguments,1)))},callArgOnWith:function(pos,thisValue){var args=slice.call(arguments,2);this.args[pos].apply(thisValue,args)},yield:function(){this.yieldOn.apply(this,[null].concat(slice.call(arguments,0)))},yieldOn:function(thisValue){for(var args=this.args,i=0,l=args.length;i<l;++i){if("function"===typeof args[i]){args[i].apply(thisValue,slice.call(arguments,1));return}}throwYieldError(this.proxy," cannot yield since no callback was passed.",args)},yieldTo:function(prop){this.yieldToOn.apply(this,[prop,null].concat(slice.call(arguments,1)))},yieldToOn:function(prop,thisValue){for(var args=this.args,i=0,l=args.length;i<l;++i){if(args[i]&&"function"===typeof args[i][prop]){args[i][prop].apply(thisValue,slice.call(arguments,2));return}}throwYieldError(this.proxy," cannot yield to '"+prop+"' since no callback was passed.",args)},getStackFrames:function(){return this.stack&&this.stack.split("\n").slice(3)},toString:function(){for(var callStr=this.proxy.toString()+"(",args=[],i=0,l=this.args.length;i<l;++i){args.push(sinon.format(this.args[i]))}callStr=callStr+args.join(", ")+")";if("undefined"!==typeof this.returnValue){callStr+=" => "+sinon.format(this.returnValue)}if(this.exception){callStr+=" !"+this.exception.name;if(this.exception.message){callStr+="("+this.exception.message+")"}}if(this.stack){callStr+=this.getStackFrames()[0].replace(/^\s*(?:at\s+|@)?/," at ")}return callStr}};callProto.invokeCallback=callProto.yield;function createSpyCall(spy,thisValue,args,returnValue,exception,id,stack){if("number"!==typeof id){throw new TypeError("Call id is not a number")}var proxyCall=sinon.create(callProto);proxyCall.proxy=spy;proxyCall.thisValue=thisValue;proxyCall.args=args;proxyCall.returnValue=returnValue;proxyCall.exception=exception;proxyCall.callId=id;proxyCall.stack=stack;return proxyCall}createSpyCall.toString=callProto.toString;sinon.spyCall=createSpyCall;return createSpyCall}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var sinon=require("./util/core");require("./match");require("./format");module.exports=makeApi(sinon)}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(sinonGlobal){function makeApi(sinon){var push=Array.prototype.push,slice=Array.prototype.slice,callId=0;function spy(object,property,types){if(!property&&"function"===typeof object){return spy.create(object)}if(!object&&!property){return spy.create(function(){})}if(types){for(var methodDesc=sinon.getPropertyDescriptor(object,property),i=0;i<types.length;i++){methodDesc[types[i]]=spy.create(methodDesc[types[i]])}return sinon.wrapMethod(object,property,methodDesc)}return sinon.wrapMethod(object,property,spy.create(object[property]))}function matchingFake(fakes,args,strict){if(!fakes){return}for(var i=0,l=fakes.length;i<l;i++){if(fakes[i].matches(args,strict)){return fakes[i]}}}function incrementCallCount(){this.called=!0;this.callCount+=1;this.notCalled=!1;this.calledOnce=1===this.callCount;this.calledTwice=2===this.callCount;this.calledThrice=3===this.callCount}function createCallProperties(){this.firstCall=this.getCall(0);this.secondCall=this.getCall(1);this.thirdCall=this.getCall(2);this.lastCall=this.getCall(this.callCount-1)}var vars="a,b,c,d,e,f,g,h,i,j,k,l";function createProxy(func,proxyLength){var p;if(proxyLength){eval("p = (function proxy("+vars.substring(0,2*proxyLength-1)+") { return p.invoke(func, this, slice.call(arguments)); });")}else{p=function proxy(){return p.invoke(func,this,slice.call(arguments))}}p.isSinonProxy=!0;return p}var uuid=0,spyApi={reset:function(){if(this.invoking){var err=new Error("Cannot reset Sinon function while invoking it. "+"Move the call to .reset outside of the callback.");err.name="InvalidResetException";throw err}this.called=!1;this.notCalled=!0;this.calledOnce=!1;this.calledTwice=!1;this.calledThrice=!1;this.callCount=0;this.firstCall=null;this.secondCall=null;this.thirdCall=null;this.lastCall=null;this.args=[];this.returnValues=[];this.thisValues=[];this.exceptions=[];this.callIds=[];this.stacks=[];if(this.fakes){for(var i=0;i<this.fakes.length;i++){this.fakes[i].reset()}}return this},create:function create(func,spyLength){var name;if("function"!==typeof func){func=function(){}}else{name=sinon.functionName(func)}if(!spyLength){spyLength=func.length}var proxy=createProxy(func,spyLength);sinon.extend(proxy,spy);delete proxy.create;sinon.extend(proxy,func);proxy.reset();proxy.prototype=func.prototype;proxy.displayName=name||"spy";proxy.toString=sinon.functionToString;proxy.instantiateFake=sinon.spy.create;proxy.id="spy#"+uuid++;return proxy},invoke:function invoke(func,thisValue,args){var matching=matchingFake(this.fakes,args),exception,returnValue;incrementCallCount.call(this);push.call(this.thisValues,thisValue);push.call(this.args,args);push.call(this.callIds,callId++);createCallProperties.call(this);try{this.invoking=!0;if(matching){returnValue=matching.invoke(func,thisValue,args)}else{returnValue=(this.func||func).apply(thisValue,args)}var thisCall=this.getCall(this.callCount-1);if(thisCall.calledWithNew()&&"object"!==typeof returnValue){returnValue=thisValue}}catch(e){exception=e}finally{delete this.invoking}push.call(this.exceptions,exception);push.call(this.returnValues,returnValue);push.call(this.stacks,new Error().stack);createCallProperties.call(this);if(exception!==void 0){throw exception}return returnValue},named:function named(name){this.displayName=name;return this},getCall:function getCall(i){if(0>i||i>=this.callCount){return null}return sinon.spyCall(this,this.thisValues[i],this.args[i],this.returnValues[i],this.exceptions[i],this.callIds[i],this.stacks[i])},getCalls:function(){var calls=[],i;for(i=0;i<this.callCount;i++){calls.push(this.getCall(i))}return calls},calledBefore:function calledBefore(spyFn){if(!this.called){return!1}if(!spyFn.called){return!0}return this.callIds[0]<spyFn.callIds[spyFn.callIds.length-1]},calledAfter:function calledAfter(spyFn){if(!this.called||!spyFn.called){return!1}return this.callIds[this.callCount-1]>spyFn.callIds[spyFn.callCount-1]},withArgs:function(){var args=slice.call(arguments);if(this.fakes){var match=matchingFake(this.fakes,args,!0);if(match){return match}}else{this.fakes=[]}var original=this,fake=this.instantiateFake();fake.matchingAguments=args;fake.parent=this;push.call(this.fakes,fake);fake.withArgs=function(){return original.withArgs.apply(original,arguments)};for(var i=0;i<this.args.length;i++){if(fake.matches(this.args[i])){incrementCallCount.call(fake);push.call(fake.thisValues,this.thisValues[i]);push.call(fake.args,this.args[i]);push.call(fake.returnValues,this.returnValues[i]);push.call(fake.exceptions,this.exceptions[i]);push.call(fake.callIds,this.callIds[i])}}createCallProperties.call(fake);return fake},matches:function(args,strict){var margs=this.matchingAguments;if(margs.length<=args.length&&sinon.deepEqual(margs,args.slice(0,margs.length))){return!strict||margs.length===args.length}},printf:function(format){var spyInstance=this,args=slice.call(arguments,1),formatter;return(format||"").replace(/%(.)/g,function(match,specifyer){formatter=spyApi.formatters[specifyer];if("function"===typeof formatter){return formatter.call(null,spyInstance,args)}else if(!isNaN(parseInt(specifyer,10))){return sinon.format(args[specifyer-1])}return"%"+specifyer})}};function delegateToCalls(method,matchAny,actual,notCalled){spyApi[method]=function(){if(!this.called){if(notCalled){return notCalled.apply(this,arguments)}return!1}for(var currentCall,matches=0,i=0,l=this.callCount;i<l;i+=1){currentCall=this.getCall(i);if(currentCall[actual||method].apply(currentCall,arguments)){matches+=1;if(matchAny){return!0}}}return matches===this.callCount}}delegateToCalls("calledOn",!0);delegateToCalls("alwaysCalledOn",!1,"calledOn");delegateToCalls("calledWith",!0);delegateToCalls("calledWithMatch",!0);delegateToCalls("alwaysCalledWith",!1,"calledWith");delegateToCalls("alwaysCalledWithMatch",!1,"calledWithMatch");delegateToCalls("calledWithExactly",!0);delegateToCalls("alwaysCalledWithExactly",!1,"calledWithExactly");delegateToCalls("neverCalledWith",!1,"notCalledWith",function(){return!0});delegateToCalls("neverCalledWithMatch",!1,"notCalledWithMatch",function(){return!0});delegateToCalls("threw",!0);delegateToCalls("alwaysThrew",!1,"threw");delegateToCalls("returned",!0);delegateToCalls("alwaysReturned",!1,"returned");delegateToCalls("calledWithNew",!0);delegateToCalls("alwaysCalledWithNew",!1,"calledWithNew");delegateToCalls("callArg",!1,"callArgWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")});spyApi.callArgWith=spyApi.callArg;delegateToCalls("callArgOn",!1,"callArgOnWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")});spyApi.callArgOnWith=spyApi.callArgOn;delegateToCalls("yield",!1,"yield",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")});spyApi.invokeCallback=spyApi.yield;delegateToCalls("yieldOn",!1,"yieldOn",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")});delegateToCalls("yieldTo",!1,"yieldTo",function(property){throw new Error(this.toString()+" cannot yield to '"+property+"' since it was not yet invoked.")});delegateToCalls("yieldToOn",!1,"yieldToOn",function(property){throw new Error(this.toString()+" cannot yield to '"+property+"' since it was not yet invoked.")});spyApi.formatters={c:function(spyInstance){return sinon.timesInWords(spyInstance.callCount)},n:function(spyInstance){return spyInstance.toString()},C:function(spyInstance){for(var calls=[],i=0,l=spyInstance.callCount,stringifiedCall;i<l;++i){stringifiedCall="    "+spyInstance.getCall(i).toString();if(/\n/.test(calls[i-1])){stringifiedCall="\n"+stringifiedCall}push.call(calls,stringifiedCall)}return 0<calls.length?"\n"+calls.join("\n"):""},t:function(spyInstance){for(var objects=[],i=0,l=spyInstance.callCount;i<l;++i){push.call(objects,sinon.format(spyInstance.thisValues[i]))}return objects.join(", ")},"*":function(spyInstance,args){for(var formatted=[],i=0,l=args.length;i<l;++i){push.call(formatted,sinon.format(args[i]))}return formatted.join(", ")}};sinon.extend(spy,spyApi);spy.spyCall=sinon.spyCall;sinon.spy=spy;return spy}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var core=require("./util/core");require("./call");require("./extend");require("./times_in_words");require("./format");module.exports=makeApi(core)}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(sinonGlobal){var slice=Array.prototype.slice,join=Array.prototype.join,useLeftMostCallback=-1,useRightMostCallback=-2,nextTick=function(){if("object"===typeof process&&"function"===typeof process.nextTick){return process.nextTick}if("function"===typeof setImmediate){return setImmediate}return function(callback){setTimeout(callback,0)}}();function throwsException(error,message){if("string"===typeof error){this.exception=new Error(message||"");this.exception.name=error}else if(!error){this.exception=new Error("Error")}else{this.exception=error}return this}function getCallback(behavior,args){var callArgAt=behavior.callArgAt;if(0<=callArgAt){return args[callArgAt]}var argumentList;if(callArgAt===useLeftMostCallback){argumentList=args}if(callArgAt===useRightMostCallback){argumentList=slice.call(args).reverse()}for(var callArgProp=behavior.callArgProp,i=0,l=argumentList.length;i<l;++i){if(!callArgProp&&"function"===typeof argumentList[i]){return argumentList[i]}if(callArgProp&&argumentList[i]&&"function"===typeof argumentList[i][callArgProp]){return argumentList[i][callArgProp]}}return null}function makeApi(sinon){function getCallbackError(behavior,func,args){if(0>behavior.callArgAt){var msg;if(behavior.callArgProp){msg=sinon.functionName(behavior.stub)+" expected to yield to '"+behavior.callArgProp+"', but no object with such a property was passed."}else{msg=sinon.functionName(behavior.stub)+" expected to yield, but no callback was passed."}if(0<args.length){msg+=" Received ["+join.call(args,", ")+"]"}return msg}return"argument at index "+behavior.callArgAt+" is not a function: "+func}function callCallback(behavior,args){if("number"===typeof behavior.callArgAt){var func=getCallback(behavior,args);if("function"!==typeof func){throw new TypeError(getCallbackError(behavior,func,args))}if(behavior.callbackAsync){nextTick(function(){func.apply(behavior.callbackContext,behavior.callbackArguments)})}else{func.apply(behavior.callbackContext,behavior.callbackArguments)}}}var proto={create:function create(stub){var behavior=sinon.extend({},sinon.behavior);delete behavior.create;behavior.stub=stub;return behavior},isPresent:function isPresent(){return"number"===typeof this.callArgAt||this.exception||"number"===typeof this.returnArgAt||this.returnThis||this.returnValueDefined},invoke:function invoke(context,args){callCallback(this,args);if(this.exception){throw this.exception}else if("number"===typeof this.returnArgAt){return args[this.returnArgAt]}else if(this.returnThis){return context}return this.returnValue},onCall:function onCall(index){return this.stub.onCall(index)},onFirstCall:function onFirstCall(){return this.stub.onFirstCall()},onSecondCall:function onSecondCall(){return this.stub.onSecondCall()},onThirdCall:function onThirdCall(){return this.stub.onThirdCall()},withArgs:function withArgs(){throw new Error("Defining a stub by invoking \"stub.onCall(...).withArgs(...)\" "+"is not supported. Use \"stub.withArgs(...).onCall(...)\" "+"to define sequential behavior for calls with certain arguments.")},callsArg:function callsArg(pos){if("number"!==typeof pos){throw new TypeError("argument index is not number")}this.callArgAt=pos;this.callbackArguments=[];this.callbackContext=void 0;this.callArgProp=void 0;this.callbackAsync=!1;return this},callsArgOn:function callsArgOn(pos,context){if("number"!==typeof pos){throw new TypeError("argument index is not number")}if("object"!==typeof context){throw new TypeError("argument context is not an object")}this.callArgAt=pos;this.callbackArguments=[];this.callbackContext=context;this.callArgProp=void 0;this.callbackAsync=!1;return this},callsArgWith:function callsArgWith(pos){if("number"!==typeof pos){throw new TypeError("argument index is not number")}this.callArgAt=pos;this.callbackArguments=slice.call(arguments,1);this.callbackContext=void 0;this.callArgProp=void 0;this.callbackAsync=!1;return this},callsArgOnWith:function callsArgWith(pos,context){if("number"!==typeof pos){throw new TypeError("argument index is not number")}if("object"!==typeof context){throw new TypeError("argument context is not an object")}this.callArgAt=pos;this.callbackArguments=slice.call(arguments,2);this.callbackContext=context;this.callArgProp=void 0;this.callbackAsync=!1;return this},yields:function(){this.callArgAt=useLeftMostCallback;this.callbackArguments=slice.call(arguments,0);this.callbackContext=void 0;this.callArgProp=void 0;this.callbackAsync=!1;return this},yieldsRight:function(){this.callArgAt=useRightMostCallback;this.callbackArguments=slice.call(arguments,0);this.callbackContext=void 0;this.callArgProp=void 0;this.callbackAsync=!1;return this},yieldsOn:function(context){if("object"!==typeof context){throw new TypeError("argument context is not an object")}this.callArgAt=useLeftMostCallback;this.callbackArguments=slice.call(arguments,1);this.callbackContext=context;this.callArgProp=void 0;this.callbackAsync=!1;return this},yieldsTo:function(prop){this.callArgAt=useLeftMostCallback;this.callbackArguments=slice.call(arguments,1);this.callbackContext=void 0;this.callArgProp=prop;this.callbackAsync=!1;return this},yieldsToOn:function(prop,context){if("object"!==typeof context){throw new TypeError("argument context is not an object")}this.callArgAt=useLeftMostCallback;this.callbackArguments=slice.call(arguments,2);this.callbackContext=context;this.callArgProp=prop;this.callbackAsync=!1;return this},throws:throwsException,throwsException:throwsException,returns:function returns(value){this.returnValue=value;this.returnValueDefined=!0;this.exception=void 0;return this},returnsArg:function returnsArg(pos){if("number"!==typeof pos){throw new TypeError("argument index is not number")}this.returnArgAt=pos;return this},returnsThis:function returnsThis(){this.returnThis=!0;return this}};function createAsyncVersion(syncFnName){return function(){var result=this[syncFnName].apply(this,arguments);this.callbackAsync=!0;return result}}for(var method in proto){if(proto.hasOwnProperty(method)&&method.match(/^(callsArg|yields)/)&&!method.match(/Async/)){proto[method+"Async"]=createAsyncVersion(method)}}sinon.behavior=proto;return proto}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var sinon=require("./util/core");require("./extend");module.exports=makeApi(sinon)}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(sinonGlobal){function makeApi(sinon){function walkInternal(obj,iterator,context,originalObj){var proto,prop;if("function"!==typeof Object.getOwnPropertyNames){for(prop in obj){iterator.call(context,obj[prop],prop,obj)}return}Object.getOwnPropertyNames(obj).forEach(function(k){var target="function"===typeof Object.getOwnPropertyDescriptor(obj,k).get?originalObj:obj;iterator.call(context,target[k],k,target)});proto=Object.getPrototypeOf(obj);if(proto){walkInternal(proto,iterator,context,originalObj)}}function walk(obj,iterator,context){return walkInternal(obj,iterator,context,obj)}sinon.walk=walk;return sinon.walk}function loadDependencies(require,exports,module){var sinon=require("./util/core");module.exports=makeApi(sinon)}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(sinonGlobal){function makeApi(sinon){function stub(object,property,func){if(!!func&&"function"!==typeof func&&"object"!==typeof func){throw new TypeError("Custom stub should be a function or a property descriptor")}var wrapper;if(func){if("function"===typeof func){wrapper=sinon.spy&&sinon.spy.create?sinon.spy.create(func):func}else{wrapper=func;if(sinon.spy&&sinon.spy.create){for(var types=sinon.objectKeys(wrapper),i=0;i<types.length;i++){wrapper[types[i]]=sinon.spy.create(wrapper[types[i]])}}}}else{var stubLength=0;if("object"===typeof object&&"function"===typeof object[property]){stubLength=object[property].length}wrapper=stub.create(stubLength)}if(!object&&"undefined"===typeof property){return sinon.stub.create()}if("undefined"===typeof property&&"object"===typeof object){sinon.walk(object||{},function(value,prop,propOwner){if(propOwner!==Object.prototype&&"constructor"!==prop&&"function"===typeof sinon.getPropertyDescriptor(propOwner,prop).value){stub(object,prop)}});return object}return sinon.wrapMethod(object,property,wrapper)}function getParentBehaviour(stubInstance){return stubInstance.parent&&getCurrentBehavior(stubInstance.parent)}function getDefaultBehavior(stubInstance){return stubInstance.defaultBehavior||getParentBehaviour(stubInstance)||sinon.behavior.create(stubInstance)}function getCurrentBehavior(stubInstance){var behavior=stubInstance.behaviors[stubInstance.callCount-1];return behavior&&behavior.isPresent()?behavior:getDefaultBehavior(stubInstance)}var uuid=0,proto={create:function create(stubLength){var functionStub=function(){return getCurrentBehavior(functionStub).invoke(this,arguments)};functionStub.id="stub#"+uuid++;var orig=functionStub;functionStub=sinon.spy.create(functionStub,stubLength);functionStub.func=orig;sinon.extend(functionStub,stub);functionStub.instantiateFake=sinon.stub.create;functionStub.displayName="stub";functionStub.toString=sinon.functionToString;functionStub.defaultBehavior=null;functionStub.behaviors=[];return functionStub},resetBehavior:function(){var i;this.defaultBehavior=null;this.behaviors=[];delete this.returnValue;delete this.returnArgAt;this.returnThis=!1;if(this.fakes){for(i=0;i<this.fakes.length;i++){this.fakes[i].resetBehavior()}}},onCall:function onCall(index){if(!this.behaviors[index]){this.behaviors[index]=sinon.behavior.create(this)}return this.behaviors[index]},onFirstCall:function onFirstCall(){return this.onCall(0)},onSecondCall:function onSecondCall(){return this.onCall(1)},onThirdCall:function onThirdCall(){return this.onCall(2)}};function createBehavior(behaviorMethod){return function(){this.defaultBehavior=this.defaultBehavior||sinon.behavior.create(this);this.defaultBehavior[behaviorMethod].apply(this.defaultBehavior,arguments);return this}}for(var method in sinon.behavior){if(sinon.behavior.hasOwnProperty(method)&&!proto.hasOwnProperty(method)&&"create"!==method&&"withArgs"!==method&&"invoke"!==method){proto[method]=createBehavior(method)}}sinon.extend(stub,proto);sinon.stub=stub;return stub}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var core=require("./util/core");require("./behavior");require("./spy");require("./extend");module.exports=makeApi(core)}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(sinonGlobal){function makeApi(sinon){var push=[].push,match=sinon.match;function mock(object){if(!object){return sinon.expectation.create("Anonymous mock")}return mock.create(object)}function each(collection,callback){if(!collection){return}for(var i=0,l=collection.length;i<l;i+=1){callback(collection[i])}}function arrayEquals(arr1,arr2,compareLength){if(compareLength&&arr1.length!==arr2.length){return!1}for(var i=0,l=arr1.length;i<l;i++){if(!sinon.deepEqual(arr1[i],arr2[i])){return!1}}return!0}sinon.extend(mock,{create:function create(object){if(!object){throw new TypeError("object is null")}var mockObject=sinon.extend({},mock);mockObject.object=object;delete mockObject.create;return mockObject},expects:function expects(method){if(!method){throw new TypeError("method is falsy")}if(!this.expectations){this.expectations={};this.proxies=[]}if(!this.expectations[method]){this.expectations[method]=[];var mockObject=this;sinon.wrapMethod(this.object,method,function(){return mockObject.invokeMethod(method,this,arguments)});push.call(this.proxies,method)}var expectation=sinon.expectation.create(method);push.call(this.expectations[method],expectation);return expectation},restore:function restore(){var object=this.object;each(this.proxies,function(proxy){if("function"===typeof object[proxy].restore){object[proxy].restore()}})},verify:function verify(){var expectations=this.expectations||{},messages=[],met=[];each(this.proxies,function(proxy){each(expectations[proxy],function(expectation){if(!expectation.met()){push.call(messages,expectation.toString())}else{push.call(met,expectation.toString())}})});this.restore();if(0<messages.length){sinon.expectation.fail(messages.concat(met).join("\n"))}else if(0<met.length){sinon.expectation.pass(messages.concat(met).join("\n"))}return!0},invokeMethod:function invokeMethod(method,thisValue,args){var expectations=this.expectations&&this.expectations[method]?this.expectations[method]:[],expectationsWithMatchingArgs=[],currentArgs=args||[],i,available;for(i=0;i<expectations.length;i+=1){var expectedArgs=expectations[i].expectedArguments||[];if(arrayEquals(expectedArgs,currentArgs,expectations[i].expectsExactArgCount)){expectationsWithMatchingArgs.push(expectations[i])}}for(i=0;i<expectationsWithMatchingArgs.length;i+=1){if(!expectationsWithMatchingArgs[i].met()&&expectationsWithMatchingArgs[i].allowsCall(thisValue,args)){return expectationsWithMatchingArgs[i].apply(thisValue,args)}}var messages=[],exhausted=0;for(i=0;i<expectationsWithMatchingArgs.length;i+=1){if(expectationsWithMatchingArgs[i].allowsCall(thisValue,args)){available=available||expectationsWithMatchingArgs[i]}else{exhausted+=1}}if(available&&0===exhausted){return available.apply(thisValue,args)}for(i=0;i<expectations.length;i+=1){push.call(messages,"    "+expectations[i].toString())}messages.unshift("Unexpected call: "+sinon.spyCall.toString.call({proxy:method,args:args}));sinon.expectation.fail(messages.join("\n"))}});var times=sinon.timesInWords,slice=Array.prototype.slice;function callCountInWords(callCount){if(0===callCount){return"never called"}return"called "+times(callCount)}function expectedCallCountInWords(expectation){var min=expectation.minCalls,max=expectation.maxCalls;if("number"===typeof min&&"number"===typeof max){var str=times(min);if(min!==max){str="at least "+str+" and at most "+times(max)}return str}if("number"===typeof min){return"at least "+times(min)}return"at most "+times(max)}function receivedMinCalls(expectation){var hasMinLimit="number"===typeof expectation.minCalls;return!hasMinLimit||expectation.callCount>=expectation.minCalls}function receivedMaxCalls(expectation){if("number"!==typeof expectation.maxCalls){return!1}return expectation.callCount===expectation.maxCalls}function verifyMatcher(possibleMatcher,arg){var isMatcher=match&&match.isMatcher(possibleMatcher);return isMatcher&&possibleMatcher.test(arg)||!0}sinon.expectation={minCalls:1,maxCalls:1,create:function create(methodName){var expectation=sinon.extend(sinon.stub.create(),sinon.expectation);delete expectation.create;expectation.method=methodName;return expectation},invoke:function invoke(func,thisValue,args){this.verifyCallAllowed(thisValue,args);return sinon.spy.invoke.apply(this,arguments)},atLeast:function atLeast(num){if("number"!==typeof num){throw new TypeError("'"+num+"' is not number")}if(!this.limitsSet){this.maxCalls=null;this.limitsSet=!0}this.minCalls=num;return this},atMost:function atMost(num){if("number"!==typeof num){throw new TypeError("'"+num+"' is not number")}if(!this.limitsSet){this.minCalls=null;this.limitsSet=!0}this.maxCalls=num;return this},never:function never(){return this.exactly(0)},once:function once(){return this.exactly(1)},twice:function twice(){return this.exactly(2)},thrice:function thrice(){return this.exactly(3)},exactly:function exactly(num){if("number"!==typeof num){throw new TypeError("'"+num+"' is not a number")}this.atLeast(num);return this.atMost(num)},met:function met(){return!this.failed&&receivedMinCalls(this)},verifyCallAllowed:function verifyCallAllowed(thisValue,args){if(receivedMaxCalls(this)){this.failed=!0;sinon.expectation.fail(this.method+" already called "+times(this.maxCalls))}if("expectedThis"in this&&this.expectedThis!==thisValue){sinon.expectation.fail(this.method+" called with "+thisValue+" as thisValue, expected "+this.expectedThis)}if(!("expectedArguments"in this)){return}if(!args){sinon.expectation.fail(this.method+" received no arguments, expected "+sinon.format(this.expectedArguments))}if(args.length<this.expectedArguments.length){sinon.expectation.fail(this.method+" received too few arguments ("+sinon.format(args)+"), expected "+sinon.format(this.expectedArguments))}if(this.expectsExactArgCount&&args.length!==this.expectedArguments.length){sinon.expectation.fail(this.method+" received too many arguments ("+sinon.format(args)+"), expected "+sinon.format(this.expectedArguments))}for(var i=0,l=this.expectedArguments.length;i<l;i+=1){if(!verifyMatcher(this.expectedArguments[i],args[i])){sinon.expectation.fail(this.method+" received wrong arguments "+sinon.format(args)+", didn't match "+this.expectedArguments.toString())}if(!sinon.deepEqual(this.expectedArguments[i],args[i])){sinon.expectation.fail(this.method+" received wrong arguments "+sinon.format(args)+", expected "+sinon.format(this.expectedArguments))}}},allowsCall:function allowsCall(thisValue,args){if(this.met()&&receivedMaxCalls(this)){return!1}if("expectedThis"in this&&this.expectedThis!==thisValue){return!1}if(!("expectedArguments"in this)){return!0}args=args||[];if(args.length<this.expectedArguments.length){return!1}if(this.expectsExactArgCount&&args.length!==this.expectedArguments.length){return!1}for(var i=0,l=this.expectedArguments.length;i<l;i+=1){if(!verifyMatcher(this.expectedArguments[i],args[i])){return!1}if(!sinon.deepEqual(this.expectedArguments[i],args[i])){return!1}}return!0},withArgs:function withArgs(){this.expectedArguments=slice.call(arguments);return this},withExactArgs:function withExactArgs(){this.withArgs.apply(this,arguments);this.expectsExactArgCount=!0;return this},on:function on(thisValue){this.expectedThis=thisValue;return this},toString:function(){var args=(this.expectedArguments||[]).slice();if(!this.expectsExactArgCount){push.call(args,"[...]")}var callStr=sinon.spyCall.toString.call({proxy:this.method||"anonymous mock expectation",args:args}),message=callStr.replace(", [...","[, ...")+" "+expectedCallCountInWords(this);if(this.met()){return"Expectation met: "+message}return"Expected "+message+" ("+callCountInWords(this.callCount)+")"},verify:function verify(){if(!this.met()){sinon.expectation.fail(this.toString())}else{sinon.expectation.pass(this.toString())}return!0},pass:function pass(message){sinon.assert.pass(message)},fail:function fail(message){var exception=new Error(message);exception.name="ExpectationError";throw exception}};sinon.mock=mock;return mock}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var sinon=require("./util/core");require("./times_in_words");require("./call");require("./extend");require("./match");require("./spy");require("./stub");require("./format");module.exports=makeApi(sinon)}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(sinonGlobal){var push=[].push,hasOwnProperty=Object.prototype.hasOwnProperty;function getFakes(fakeCollection){if(!fakeCollection.fakes){fakeCollection.fakes=[]}return fakeCollection.fakes}function each(fakeCollection,method){for(var fakes=getFakes(fakeCollection),i=0,l=fakes.length;i<l;i+=1){if("function"===typeof fakes[i][method]){fakes[i][method]()}}}function compact(fakeCollection){var fakes=getFakes(fakeCollection),i=0;while(i<fakes.length){fakes.splice(i,1)}}function makeApi(sinon){var collection={verify:function resolve(){each(this,"verify")},restore:function restore(){each(this,"restore");compact(this)},reset:function restore(){each(this,"reset")},verifyAndRestore:function verifyAndRestore(){var exception;try{this.verify()}catch(e){exception=e}this.restore();if(exception){throw exception}},add:function add(fake){push.call(getFakes(this),fake);return fake},spy:function spy(){return this.add(sinon.spy.apply(sinon,arguments))},stub:function stub(object,property,value){if(property){var original=object[property];if("function"!==typeof original){if(!hasOwnProperty.call(object,property)){throw new TypeError("Cannot stub non-existent own property "+property)}object[property]=value;return this.add({restore:function(){object[property]=original}})}}if(!property&&!!object&&"object"===typeof object){var stubbedObj=sinon.stub.apply(sinon,arguments);for(var prop in stubbedObj){if("function"===typeof stubbedObj[prop]){this.add(stubbedObj[prop])}}return stubbedObj}return this.add(sinon.stub.apply(sinon,arguments))},mock:function mock(){return this.add(sinon.mock.apply(sinon,arguments))},inject:function inject(obj){var col=this;obj.spy=function(){return col.spy.apply(col,arguments)};obj.stub=function(){return col.stub.apply(col,arguments)};obj.mock=function(){return col.mock.apply(col,arguments)};return obj}};sinon.collection=collection;return collection}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var sinon=require("./util/core");require("./mock");require("./spy");require("./stub");module.exports=makeApi(sinon)}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(){function makeApi(s,lol){var llx="undefined"!==typeof lolex?lolex:lol;s.useFakeTimers=function(){var now,methods=Array.prototype.slice.call(arguments);if("string"===typeof methods[0]){now=0}else{now=methods.shift()}var clock=llx.install(now||0,methods);clock.restore=clock.uninstall;return clock};s.clock={create:function(now){return llx.createClock(now)}};s.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setImmediate:"undefined"!==typeof setImmediate?setImmediate:void 0,clearImmediate:"undefined"!==typeof clearImmediate?clearImmediate:void 0,setInterval:setInterval,clearInterval:clearInterval,Date:Date}}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,epxorts,module,lolex){var core=require("./core");makeApi(core,lolex);module.exports=core}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require,module.exports,module,require("lolex"))}else{makeApi(sinon)}})();if("undefined"===typeof sinon){this.sinon={}}(function(){var push=[].push;function makeApi(sinon){sinon.Event=function Event(type,bubbles,cancelable,target){this.initEvent(type,bubbles,cancelable,target)};sinon.Event.prototype={initEvent:function(type,bubbles,cancelable,target){this.type=type;this.bubbles=bubbles;this.cancelable=cancelable;this.target=target},stopPropagation:function(){},preventDefault:function(){this.defaultPrevented=!0}};sinon.ProgressEvent=function ProgressEvent(type,progressEventRaw,target){this.initEvent(type,!1,!1,target);this.loaded=progressEventRaw.loaded||null;this.total=progressEventRaw.total||null;this.lengthComputable=!!progressEventRaw.total};sinon.ProgressEvent.prototype=new sinon.Event;sinon.ProgressEvent.prototype.constructor=sinon.ProgressEvent;sinon.CustomEvent=function CustomEvent(type,customData,target){this.initEvent(type,!1,!1,target);this.detail=customData.detail||null};sinon.CustomEvent.prototype=new sinon.Event;sinon.CustomEvent.prototype.constructor=sinon.CustomEvent;sinon.EventTarget={addEventListener:function addEventListener(event,listener){this.eventListeners=this.eventListeners||{};this.eventListeners[event]=this.eventListeners[event]||[];push.call(this.eventListeners[event],listener)},removeEventListener:function removeEventListener(event,listener){for(var listeners=this.eventListeners&&this.eventListeners[event]||[],i=0,l=listeners.length;i<l;++i){if(listeners[i]===listener){return listeners.splice(i,1)}}},dispatchEvent:function dispatchEvent(event){for(var type=event.type,listeners=this.eventListeners&&this.eventListeners[type]||[],i=0;i<listeners.length;i++){if("function"===typeof listeners[i]){listeners[i].call(this,event)}else{listeners[i].handleEvent(event)}}return!!event.defaultPrevented}}}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require){var sinon=require("./core");makeApi(sinon)}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require)}else{makeApi(sinon)}})();(function(sinonGlobal){var realSetTimeout=setTimeout;function makeApi(sinon){function log(){}function logError(label,err){var msg=label+" threw exception: ";function throwLoggedError(){err.message=msg+err.message;throw err}sinon.log(msg+"["+err.name+"] "+err.message);if(err.stack){sinon.log(err.stack)}if(logError.useImmediateExceptions){throwLoggedError()}else{logError.setTimeout(throwLoggedError,0)}}logError.useImmediateExceptions=!1;logError.setTimeout=function(func,timeout){realSetTimeout(func,timeout)};var exports={log:sinon.log=log,logError:sinon.logError=logError};return exports}function loadDependencies(require,exports,module){var sinon=require("./util/core");module.exports=makeApi(sinon)}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);if("undefined"===typeof sinon){this.sinon={}}(function(global){var xdr={XDomainRequest:global.XDomainRequest,GlobalXDomainRequest:global.XDomainRequest};xdr.supportsXDR="undefined"!==typeof xdr.GlobalXDomainRequest;xdr.workingXDR=xdr.supportsXDR?xdr.GlobalXDomainRequest:!1;function makeApi(sinon){sinon.xdr=xdr;function FakeXDomainRequest(){this.readyState=FakeXDomainRequest.UNSENT;this.requestBody=null;this.requestHeaders={};this.status=0;this.timeout=null;if("function"===typeof FakeXDomainRequest.onCreate){FakeXDomainRequest.onCreate(this)}}function verifyState(x){if(x.readyState!==FakeXDomainRequest.OPENED){throw new Error("INVALID_STATE_ERR")}if(x.sendFlag){throw new Error("INVALID_STATE_ERR")}}function verifyRequestSent(x){if(x.readyState===FakeXDomainRequest.UNSENT){throw new Error("Request not sent")}if(x.readyState===FakeXDomainRequest.DONE){throw new Error("Request done")}}function verifyResponseBodyType(body){if("string"!==typeof body){var error=new Error("Attempted to respond to fake XDomainRequest with "+body+", which is not a string.");error.name="InvalidBodyException";throw error}}sinon.extend(FakeXDomainRequest.prototype,sinon.EventTarget,{open:function open(method,url){this.method=method;this.url=url;this.responseText=null;this.sendFlag=!1;this.readyStateChange(FakeXDomainRequest.OPENED)},readyStateChange:function readyStateChange(state){this.readyState=state;var eventName="";switch(this.readyState){case FakeXDomainRequest.UNSENT:break;case FakeXDomainRequest.OPENED:break;case FakeXDomainRequest.LOADING:if(this.sendFlag){eventName="onprogress"}break;case FakeXDomainRequest.DONE:if(this.isTimeout){eventName="ontimeout"}else if(this.errorFlag||200>this.status||299<this.status){eventName="onerror"}else{eventName="onload"}break;}if(eventName){if("function"===typeof this[eventName]){try{this[eventName]()}catch(e){sinon.logError("Fake XHR "+eventName+" handler",e)}}}},send:function send(data){verifyState(this);if(!/^(get|head)$/i.test(this.method)){this.requestBody=data}this.requestHeaders["Content-Type"]="text/plain;charset=utf-8";this.errorFlag=!1;this.sendFlag=!0;this.readyStateChange(FakeXDomainRequest.OPENED);if("function"===typeof this.onSend){this.onSend(this)}},abort:function abort(){this.aborted=!0;this.responseText=null;this.errorFlag=!0;if(this.readyState>sinon.FakeXDomainRequest.UNSENT&&this.sendFlag){this.readyStateChange(sinon.FakeXDomainRequest.DONE);this.sendFlag=!1}},setResponseBody:function setResponseBody(body){verifyRequestSent(this);verifyResponseBodyType(body);var chunkSize=this.chunkSize||10,index=0;this.responseText="";do{this.readyStateChange(FakeXDomainRequest.LOADING);this.responseText+=body.substring(index,index+chunkSize);index+=chunkSize}while(index<body.length);this.readyStateChange(FakeXDomainRequest.DONE)},respond:function respond(status,contentType,body){this.status="number"===typeof status?status:200;this.setResponseBody(body||"")},simulatetimeout:function simulatetimeout(){this.status=0;this.isTimeout=!0;this.responseText=void 0;this.readyStateChange(FakeXDomainRequest.DONE)}});sinon.extend(FakeXDomainRequest,{UNSENT:0,OPENED:1,LOADING:3,DONE:4});sinon.useFakeXDomainRequest=function useFakeXDomainRequest(){sinon.FakeXDomainRequest.restore=function restore(keepOnCreate){if(xdr.supportsXDR){global.XDomainRequest=xdr.GlobalXDomainRequest}delete sinon.FakeXDomainRequest.restore;if(!0!==keepOnCreate){delete sinon.FakeXDomainRequest.onCreate}};if(xdr.supportsXDR){global.XDomainRequest=sinon.FakeXDomainRequest}return sinon.FakeXDomainRequest};sinon.FakeXDomainRequest=FakeXDomainRequest}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var sinon=require("./core");require("../extend");require("./event");require("../log_error");makeApi(sinon);module.exports=sinon}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require,module.exports,module)}else{makeApi(sinon)}})("undefined"!==typeof global?global:self);(function(sinonGlobal,global){function getWorkingXHR(globalScope){var supportsXHR="undefined"!==typeof globalScope.XMLHttpRequest;if(supportsXHR){return globalScope.XMLHttpRequest}var supportsActiveX="undefined"!==typeof globalScope.ActiveXObject;if(supportsActiveX){return function(){return new globalScope.ActiveXObject("MSXML2.XMLHTTP.3.0")}}return!1}var supportsProgress="undefined"!==typeof ProgressEvent,supportsCustomEvent="undefined"!==typeof CustomEvent,supportsFormData="undefined"!==typeof FormData,supportsArrayBuffer="undefined"!==typeof ArrayBuffer,supportsBlob="function"===typeof Blob,sinonXhr={XMLHttpRequest:global.XMLHttpRequest};sinonXhr.GlobalXMLHttpRequest=global.XMLHttpRequest;sinonXhr.GlobalActiveXObject=global.ActiveXObject;sinonXhr.supportsActiveX="undefined"!==typeof sinonXhr.GlobalActiveXObject;sinonXhr.supportsXHR="undefined"!==typeof sinonXhr.GlobalXMLHttpRequest;sinonXhr.workingXHR=getWorkingXHR(global);sinonXhr.supportsCORS=sinonXhr.supportsXHR&&"withCredentials"in new sinonXhr.GlobalXMLHttpRequest;var unsafeHeaders={"Accept-Charset":!0,"Accept-Encoding":!0,Connection:!0,"Content-Length":!0,Cookie:!0,Cookie2:!0,"Content-Transfer-Encoding":!0,Date:!0,Expect:!0,Host:!0,"Keep-Alive":!0,Referer:!0,TE:!0,Trailer:!0,"Transfer-Encoding":!0,Upgrade:!0,"User-Agent":!0,Via:!0};function UploadProgress(){this.eventListeners={progress:[],load:[],abort:[],error:[]}}UploadProgress.prototype.addEventListener=function addEventListener(event,listener){this.eventListeners[event].push(listener)};UploadProgress.prototype.removeEventListener=function removeEventListener(event,listener){for(var listeners=this.eventListeners[event]||[],i=0,l=listeners.length;i<l;++i){if(listeners[i]===listener){return listeners.splice(i,1)}}};UploadProgress.prototype.dispatchEvent=function dispatchEvent(event){for(var listeners=this.eventListeners[event.type]||[],i=0,listener;null!=(listener=listeners[i]);i++){listener(event)}};function FakeXMLHttpRequest(){this.readyState=FakeXMLHttpRequest.UNSENT;this.requestHeaders={};this.requestBody=null;this.status=0;this.statusText="";this.upload=new UploadProgress;this.responseType="";this.response="";if(sinonXhr.supportsCORS){this.withCredentials=!1}var xhr=this,events=["loadstart","load","abort","loadend"];function addEventListener(eventName){xhr.addEventListener(eventName,function(event){var listener=xhr["on"+eventName];if(listener&&"function"===typeof listener){listener.call(this,event)}})}for(var i=events.length-1;0<=i;i--){addEventListener(events[i])}if("function"===typeof FakeXMLHttpRequest.onCreate){FakeXMLHttpRequest.onCreate(this)}}function verifyState(xhr){if(xhr.readyState!==FakeXMLHttpRequest.OPENED){throw new Error("INVALID_STATE_ERR")}if(xhr.sendFlag){throw new Error("INVALID_STATE_ERR")}}function getHeader(headers,header){header=header.toLowerCase();for(var h in headers){if(h.toLowerCase()===header){return h}}return null}function each(collection,callback){if(!collection){return}for(var i=0,l=collection.length;i<l;i+=1){callback(collection[i])}}function some(collection,callback){for(var index=0;index<collection.length;index++){if(!0===callback(collection[index])){return!0}}return!1}var apply=function(obj,method,args){switch(args.length){case 0:return obj[method]();case 1:return obj[method](args[0]);case 2:return obj[method](args[0],args[1]);case 3:return obj[method](args[0],args[1],args[2]);case 4:return obj[method](args[0],args[1],args[2],args[3]);case 5:return obj[method](args[0],args[1],args[2],args[3],args[4]);}};FakeXMLHttpRequest.filters=[];FakeXMLHttpRequest.addFilter=function addFilter(fn){this.filters.push(fn)};var IE6Re=/MSIE 6/;FakeXMLHttpRequest.defake=function defake(fakeXhr,xhrArgs){var xhr=new sinonXhr.workingXHR;each(["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","addEventListener","overrideMimeType","removeEventListener"],function(method){fakeXhr[method]=function(){return apply(xhr,method,arguments)}});var copyAttrs=function(args){each(args,function(attr){try{fakeXhr[attr]=xhr[attr]}catch(e){if(!IE6Re.test(navigator.userAgent)){throw e}}})},stateChange=function stateChange(){fakeXhr.readyState=xhr.readyState;if(xhr.readyState>=FakeXMLHttpRequest.HEADERS_RECEIVED){copyAttrs(["status","statusText"])}if(xhr.readyState>=FakeXMLHttpRequest.LOADING){copyAttrs(["responseText","response"])}if(xhr.readyState===FakeXMLHttpRequest.DONE){copyAttrs(["responseXML"])}if(fakeXhr.onreadystatechange){fakeXhr.onreadystatechange.call(fakeXhr,{target:fakeXhr})}};if(xhr.addEventListener){for(var event in fakeXhr.eventListeners){if(fakeXhr.eventListeners.hasOwnProperty(event)){each(fakeXhr.eventListeners[event],function(handler){xhr.addEventListener(event,handler)})}}xhr.addEventListener("readystatechange",stateChange)}else{xhr.onreadystatechange=stateChange}apply(xhr,"open",xhrArgs)};FakeXMLHttpRequest.useFilters=!1;function verifyRequestOpened(xhr){if(xhr.readyState!==FakeXMLHttpRequest.OPENED){throw new Error("INVALID_STATE_ERR - "+xhr.readyState)}}function verifyRequestSent(xhr){if(xhr.readyState===FakeXMLHttpRequest.DONE){throw new Error("Request done")}}function verifyHeadersReceived(xhr){if(xhr.async&&xhr.readyState!==FakeXMLHttpRequest.HEADERS_RECEIVED){throw new Error("No headers received")}}function verifyResponseBodyType(body){if("string"!==typeof body){var error=new Error("Attempted to respond to fake XMLHttpRequest with "+body+", which is not a string.");error.name="InvalidBodyException";throw error}}function convertToArrayBuffer(body){for(var buffer=new ArrayBuffer(body.length),view=new Uint8Array(buffer),i=0,charCode;i<body.length;i++){charCode=body.charCodeAt(i);if(256<=charCode){throw new TypeError("arraybuffer or blob responseTypes require binary string, "+"invalid character "+body[i]+" found.")}view[i]=charCode}return buffer}function isXmlContentType(contentType){return!contentType||/(text\/xml)|(application\/xml)|(\+xml)/.test(contentType)}function convertResponseBody(responseType,contentType,body){if(""===responseType||"text"===responseType){return body}else if(supportsArrayBuffer&&"arraybuffer"===responseType){return convertToArrayBuffer(body)}else if("json"===responseType){try{return JSON.parse(body)}catch(e){return null}}else if(supportsBlob&&"blob"===responseType){var blobOptions={};if(contentType){blobOptions.type=contentType}return new Blob([convertToArrayBuffer(body)],blobOptions)}else if("document"===responseType){if(isXmlContentType(contentType)){return FakeXMLHttpRequest.parseXML(body)}return null}throw new Error("Invalid responseType "+responseType)}function clearResponse(xhr){if(""===xhr.responseType||"text"===xhr.responseType){xhr.response=xhr.responseText=""}else{xhr.response=xhr.responseText=null}xhr.responseXML=null}FakeXMLHttpRequest.parseXML=function parseXML(text){if(""!==text){try{if("undefined"!==typeof DOMParser){var parser=new DOMParser;return parser.parseFromString(text,"text/xml")}var xmlDoc=new window.ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(text);return xmlDoc}catch(e){}}return null};FakeXMLHttpRequest.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};function makeApi(sinon){sinon.xhr=sinonXhr;sinon.extend(FakeXMLHttpRequest.prototype,sinon.EventTarget,{async:!0,open:function open(method,url,async,username,password){this.method=method;this.url=url;this.async="boolean"===typeof async?async:!0;this.username=username;this.password=password;clearResponse(this);this.requestHeaders={};this.sendFlag=!1;if(!0===FakeXMLHttpRequest.useFilters){var xhrArgs=arguments,defake=some(FakeXMLHttpRequest.filters,function(filter){return filter.apply(this,xhrArgs)});if(defake){return FakeXMLHttpRequest.defake(this,arguments)}}this.readyStateChange(FakeXMLHttpRequest.OPENED)},readyStateChange:function readyStateChange(state){this.readyState=state;var readyStateChangeEvent=new sinon.Event("readystatechange",!1,!1,this);if("function"===typeof this.onreadystatechange){try{this.onreadystatechange(readyStateChangeEvent)}catch(e){sinon.logError("Fake XHR onreadystatechange handler",e)}}switch(this.readyState){case FakeXMLHttpRequest.DONE:if(supportsProgress){this.upload.dispatchEvent(new sinon.ProgressEvent("progress",{loaded:100,total:100}));this.dispatchEvent(new sinon.ProgressEvent("progress",{loaded:100,total:100}))}this.upload.dispatchEvent(new sinon.Event("load",!1,!1,this));this.dispatchEvent(new sinon.Event("load",!1,!1,this));this.dispatchEvent(new sinon.Event("loadend",!1,!1,this));break;}this.dispatchEvent(readyStateChangeEvent)},setRequestHeader:function setRequestHeader(header,value){verifyState(this);if(unsafeHeaders[header]||/^(Sec-|Proxy-)/.test(header)){throw new Error("Refused to set unsafe header \""+header+"\"")}if(this.requestHeaders[header]){this.requestHeaders[header]+=","+value}else{this.requestHeaders[header]=value}},setResponseHeaders:function setResponseHeaders(headers){verifyRequestOpened(this);this.responseHeaders={};for(var header in headers){if(headers.hasOwnProperty(header)){this.responseHeaders[header]=headers[header]}}if(this.async){this.readyStateChange(FakeXMLHttpRequest.HEADERS_RECEIVED)}else{this.readyState=FakeXMLHttpRequest.HEADERS_RECEIVED}},send:function send(data){verifyState(this);if(!/^(get|head)$/i.test(this.method)){var contentType=getHeader(this.requestHeaders,"Content-Type");if(this.requestHeaders[contentType]){var value=this.requestHeaders[contentType].split(";");this.requestHeaders[contentType]=value[0]+";charset=utf-8"}else if(supportsFormData&&!(data instanceof FormData)){this.requestHeaders["Content-Type"]="text/plain;charset=utf-8"}this.requestBody=data}this.errorFlag=!1;this.sendFlag=this.async;clearResponse(this);this.readyStateChange(FakeXMLHttpRequest.OPENED);if("function"===typeof this.onSend){this.onSend(this)}this.dispatchEvent(new sinon.Event("loadstart",!1,!1,this))},abort:function abort(){this.aborted=!0;clearResponse(this);this.errorFlag=!0;this.requestHeaders={};this.responseHeaders={};if(this.readyState>FakeXMLHttpRequest.UNSENT&&this.sendFlag){this.readyStateChange(FakeXMLHttpRequest.DONE);this.sendFlag=!1}this.readyState=FakeXMLHttpRequest.UNSENT;this.dispatchEvent(new sinon.Event("abort",!1,!1,this));this.upload.dispatchEvent(new sinon.Event("abort",!1,!1,this));if("function"===typeof this.onerror){this.onerror()}},getResponseHeader:function getResponseHeader(header){if(this.readyState<FakeXMLHttpRequest.HEADERS_RECEIVED){return null}if(/^Set-Cookie2?$/i.test(header)){return null}header=getHeader(this.responseHeaders,header);return this.responseHeaders[header]||null},getAllResponseHeaders:function getAllResponseHeaders(){if(this.readyState<FakeXMLHttpRequest.HEADERS_RECEIVED){return""}var headers="";for(var header in this.responseHeaders){if(this.responseHeaders.hasOwnProperty(header)&&!/^Set-Cookie2?$/i.test(header)){headers+=header+": "+this.responseHeaders[header]+"\r\n"}}return headers},setResponseBody:function setResponseBody(body){verifyRequestSent(this);verifyHeadersReceived(this);verifyResponseBodyType(body);var contentType=this.getResponseHeader("Content-Type"),isTextResponse=""===this.responseType||"text"===this.responseType;clearResponse(this);if(this.async){var chunkSize=this.chunkSize||10,index=0;do{this.readyStateChange(FakeXMLHttpRequest.LOADING);if(isTextResponse){this.responseText=this.response+=body.substring(index,index+chunkSize)}index+=chunkSize}while(index<body.length)}this.response=convertResponseBody(this.responseType,contentType,body);if(isTextResponse){this.responseText=this.response}if("document"===this.responseType){this.responseXML=this.response}else if(""===this.responseType&&isXmlContentType(contentType)){this.responseXML=FakeXMLHttpRequest.parseXML(this.responseText)}this.readyStateChange(FakeXMLHttpRequest.DONE)},respond:function respond(status,headers,body){this.status="number"===typeof status?status:200;this.statusText=FakeXMLHttpRequest.statusCodes[this.status];this.setResponseHeaders(headers||{});this.setResponseBody(body||"")},uploadProgress:function uploadProgress(progressEventRaw){if(supportsProgress){this.upload.dispatchEvent(new sinon.ProgressEvent("progress",progressEventRaw))}},downloadProgress:function downloadProgress(progressEventRaw){if(supportsProgress){this.dispatchEvent(new sinon.ProgressEvent("progress",progressEventRaw))}},uploadError:function uploadError(error){if(supportsCustomEvent){this.upload.dispatchEvent(new sinon.CustomEvent("error",{detail:error}))}}});sinon.extend(FakeXMLHttpRequest,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});sinon.useFakeXMLHttpRequest=function(){FakeXMLHttpRequest.restore=function restore(keepOnCreate){if(sinonXhr.supportsXHR){global.XMLHttpRequest=sinonXhr.GlobalXMLHttpRequest}if(sinonXhr.supportsActiveX){global.ActiveXObject=sinonXhr.GlobalActiveXObject}delete FakeXMLHttpRequest.restore;if(!0!==keepOnCreate){delete FakeXMLHttpRequest.onCreate}};if(sinonXhr.supportsXHR){global.XMLHttpRequest=FakeXMLHttpRequest}if(sinonXhr.supportsActiveX){global.ActiveXObject=function ActiveXObject(objId){if("Microsoft.XMLHTTP"===objId||/^Msxml2\.XMLHTTP/i.test(objId)){return new FakeXMLHttpRequest}return new sinonXhr.GlobalActiveXObject(objId)}}return FakeXMLHttpRequest};sinon.FakeXMLHttpRequest=FakeXMLHttpRequest}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var sinon=require("./core");require("../extend");require("./event");require("../log_error");makeApi(sinon);module.exports=sinon}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon,"undefined"!==typeof global?global:self);(function(){var push=[].push;function responseArray(handler){var response=handler;if("[object Array]"!==Object.prototype.toString.call(handler)){response=[200,{},handler]}if("string"!==typeof response[2]){throw new TypeError("Fake server response body should be string, but was "+typeof response[2])}return response}var wloc="undefined"!==typeof window?window.location:{},rCurrLoc=new RegExp("^"+wloc.protocol+"//"+wloc.host);function matchOne(response,reqMethod,reqUrl){var rmeth=response.method,matchMethod=!rmeth||rmeth.toLowerCase()===reqMethod.toLowerCase(),url=response.url,matchUrl=!url||url===reqUrl||"function"===typeof url.test&&url.test(reqUrl);return matchMethod&&matchUrl}function match(response,request){var requestUrl=request.url;if(!/^https?:\/\//.test(requestUrl)||rCurrLoc.test(requestUrl)){requestUrl=requestUrl.replace(rCurrLoc,"")}if(matchOne(response,this.getHTTPMethod(request),requestUrl)){if("function"===typeof response.response){var ru=response.url,args=[request].concat(ru&&"function"===typeof ru.exec?ru.exec(requestUrl).slice(1):[]);return response.response.apply(response,args)}return!0}return!1}function makeApi(sinon){sinon.fakeServer={create:function(config){var server=sinon.create(this);server.configure(config);if(!sinon.xhr.supportsCORS){this.xhr=sinon.useFakeXDomainRequest()}else{this.xhr=sinon.useFakeXMLHttpRequest()}server.requests=[];this.xhr.onCreate=function(xhrObj){server.addRequest(xhrObj)};return server},configure:function(config){var whitelist={autoRespond:!0,autoRespondAfter:!0,respondImmediately:!0,fakeHTTPMethods:!0},setting;config=config||{};for(setting in config){if(whitelist.hasOwnProperty(setting)&&config.hasOwnProperty(setting)){this[setting]=config[setting]}}},addRequest:function addRequest(xhrObj){var server=this;push.call(this.requests,xhrObj);xhrObj.onSend=function(){server.handleRequest(this);if(server.respondImmediately){server.respond()}else if(server.autoRespond&&!server.responding){setTimeout(function(){server.responding=!1;server.respond()},server.autoRespondAfter||10);server.responding=!0}}},getHTTPMethod:function getHTTPMethod(request){if(this.fakeHTTPMethods&&/post/i.test(request.method)){var matches=(request.requestBody||"").match(/_method=([^\b;]+)/);return matches?matches[1]:request.method}return request.method},handleRequest:function handleRequest(xhr){if(xhr.async){if(!this.queue){this.queue=[]}push.call(this.queue,xhr)}else{this.processRequest(xhr)}},log:function log(response,request){var str;str="Request:\n"+sinon.format(request)+"\n\n";str+="Response:\n"+sinon.format(response)+"\n\n";sinon.log(str)},respondWith:function respondWith(method,url,body){if(1===arguments.length&&"function"!==typeof method){this.response=responseArray(method);return}if(!this.responses){this.responses=[]}if(1===arguments.length){body=method;url=method=null}if(2===arguments.length){body=url;url=method;method=null}push.call(this.responses,{method:method,url:url,response:"function"===typeof body?body:responseArray(body)})},respond:function respond(){if(0<arguments.length){this.respondWith.apply(this,arguments)}for(var queue=this.queue||[],requests=queue.splice(0,queue.length),i=0;i<requests.length;i++){this.processRequest(requests[i])}},processRequest:function processRequest(request){try{if(request.aborted){return}var response=this.response||[404,{},""];if(this.responses){for(var l=this.responses.length,i=l-1;0<=i;i--){if(match.call(this,this.responses[i],request)){response=this.responses[i].response;break}}}if(4!==request.readyState){this.log(response,request);request.respond(response[0],response[1],response[2])}}catch(e){sinon.logError("Fake server request processing",e)}},restore:function restore(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)}}}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var sinon=require("./core");require("./fake_xdomain_request");require("./fake_xml_http_request");require("../format");makeApi(sinon);module.exports=sinon}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require,module.exports,module)}else{makeApi(sinon)}})();(function(){function makeApi(sinon){function Server(){}Server.prototype=sinon.fakeServer;sinon.fakeServerWithClock=new Server;sinon.fakeServerWithClock.addRequest=function addRequest(xhr){var _Mathmax=Math.max;if(xhr.async){if("object"===typeof setTimeout.clock){this.clock=setTimeout.clock}else{this.clock=sinon.useFakeTimers();this.resetClock=!0}if(!this.longestTimeout){var clockSetTimeout=this.clock.setTimeout,clockSetInterval=this.clock.setInterval,server=this;this.clock.setTimeout=function(fn,timeout){server.longestTimeout=_Mathmax(timeout,server.longestTimeout||0);return clockSetTimeout.apply(this,arguments)};this.clock.setInterval=function(fn,timeout){server.longestTimeout=_Mathmax(timeout,server.longestTimeout||0);return clockSetInterval.apply(this,arguments)}}}return sinon.fakeServer.addRequest.call(this,xhr)};sinon.fakeServerWithClock.respond=function respond(){var returnVal=sinon.fakeServer.respond.apply(this,arguments);if(this.clock){this.clock.tick(this.longestTimeout||0);this.longestTimeout=0;if(this.resetClock){this.clock.restore();this.resetClock=!1}}return returnVal};sinon.fakeServerWithClock.restore=function restore(){if(this.clock){this.clock.restore()}return sinon.fakeServer.restore.apply(this,arguments)}}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require){var sinon=require("./core");require("./fake_server");require("./fake_timers");makeApi(sinon)}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require)}else{makeApi(sinon)}})();(function(sinonGlobal){function makeApi(sinon){var push=[].push;function exposeValue(sandbox,config,key,value){if(!value){return}if(config.injectInto&&!(key in config.injectInto)){config.injectInto[key]=value;sandbox.injectedKeys.push(key)}else{push.call(sandbox.args,value)}}function prepareSandboxFromConfig(config){var sandbox=sinon.create(sinon.sandbox);if(config.useFakeServer){if("object"===typeof config.useFakeServer){sandbox.serverPrototype=config.useFakeServer}sandbox.useFakeServer()}if(config.useFakeTimers){if("object"===typeof config.useFakeTimers){sandbox.useFakeTimers.apply(sandbox,config.useFakeTimers)}else{sandbox.useFakeTimers()}}return sandbox}sinon.sandbox=sinon.extend(sinon.create(sinon.collection),{useFakeTimers:function useFakeTimers(){this.clock=sinon.useFakeTimers.apply(sinon,arguments);return this.add(this.clock)},serverPrototype:sinon.fakeServer,useFakeServer:function useFakeServer(){var proto=this.serverPrototype||sinon.fakeServer;if(!proto||!proto.create){return null}this.server=proto.create();return this.add(this.server)},inject:function(obj){sinon.collection.inject.call(this,obj);if(this.clock){obj.clock=this.clock}if(this.server){obj.server=this.server;obj.requests=this.server.requests}obj.match=sinon.match;return obj},restore:function(){sinon.collection.restore.apply(this,arguments);this.restoreContext()},restoreContext:function(){if(this.injectedKeys){for(var i=0,j=this.injectedKeys.length;i<j;i++){delete this.injectInto[this.injectedKeys[i]]}this.injectedKeys=[]}},create:function(config){if(!config){return sinon.create(sinon.sandbox)}var sandbox=prepareSandboxFromConfig(config);sandbox.args=sandbox.args||[];sandbox.injectedKeys=[];sandbox.injectInto=config.injectInto;var prop,value,exposed=sandbox.inject({});if(config.properties){for(var i=0,l=config.properties.length;i<l;i++){prop=config.properties[i];value=exposed[prop]||"sandbox"===prop&&sandbox;exposeValue(sandbox,config,prop,value)}}else{exposeValue(sandbox,config,"sandbox",value)}return sandbox},match:sinon.match});sinon.sandbox.useFakeXMLHttpRequest=sinon.sandbox.useFakeServer;return sinon.sandbox}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var sinon=require("./util/core");require("./extend");require("./util/fake_server_with_clock");require("./util/fake_timers");require("./collection");module.exports=makeApi(sinon)}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(sinonGlobal){function makeApi(sinon){var slice=Array.prototype.slice;function test(callback){var type=typeof callback;if("function"!==type){throw new TypeError("sinon.test needs to wrap a test function, got "+type)}function sinonSandboxedTest(){var config=sinon.getConfig(sinon.config);config.injectInto=config.injectIntoThis&&this||config.injectInto;var sandbox=sinon.sandbox.create(config),args=slice.call(arguments),oldDone=args.length&&args[args.length-1],exception,result;if("function"===typeof oldDone){args[args.length-1]=function sinonDone(res){if(res){sandbox.restore()}else{sandbox.verifyAndRestore()}oldDone(res)}}try{result=callback.apply(this,args.concat(sandbox.args))}catch(e){exception=e}if("function"!==typeof oldDone){if("undefined"!==typeof exception){sandbox.restore();throw exception}else{sandbox.verifyAndRestore()}}return result}if(callback.length){return function sinonAsyncSandboxedTest(done){return sinonSandboxedTest.apply(this,arguments)}}return sinonSandboxedTest}test.config={injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0};sinon.test=test;return test}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var core=require("./util/core");require("./sandbox");module.exports=makeApi(core)}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require,module.exports,module)}else if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon||null);(function(sinonGlobal){function createTest(property,setUp,tearDown){return function(){if(setUp){setUp.apply(this,arguments)}var exception,result;try{result=property.apply(this,arguments)}catch(e){exception=e}if(tearDown){tearDown.apply(this,arguments)}if(exception){throw exception}return result}}function makeApi(sinon){function testCase(tests,prefix){if(!tests||"object"!==typeof tests){throw new TypeError("sinon.testCase needs an object with test functions")}prefix=prefix||"test";var rPrefix=new RegExp("^"+prefix),methods={},setUp=tests.setUp,tearDown=tests.tearDown,testName,property,method;for(testName in tests){if(tests.hasOwnProperty(testName)&&!/^(setUp|tearDown)$/.test(testName)){property=tests[testName];if("function"===typeof property&&rPrefix.test(testName)){method=property;if(setUp||tearDown){method=createTest(property,setUp,tearDown)}methods[testName]=sinon.test(method)}else{methods[testName]=tests[testName]}}}return methods}sinon.testCase=testCase;return testCase}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var core=require("./util/core");require("./test");module.exports=makeApi(core)}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(sinonGlobal,global){var slice=Array.prototype.slice;function makeApi(sinon){var assert;function verifyIsStub(){for(var method,i=0,l=arguments.length;i<l;++i){method=arguments[i];if(!method){assert.fail("fake is not a spy")}if(method.proxy&&method.proxy.isSinonProxy){verifyIsStub(method.proxy)}else{if("function"!==typeof method){assert.fail(method+" is not a function")}if("function"!==typeof method.getCall){assert.fail(method+" is not stubbed")}}}}function failAssertion(object,msg){object=object||global;var failMethod=object.fail||assert.fail;failMethod.call(object,msg)}function mirrorPropAsAssertion(name,method,message){if(2===arguments.length){message=method;method=name}assert[name]=function(fake){verifyIsStub(fake);var args=slice.call(arguments,1),failed=!1;if("function"===typeof method){failed=!method(fake)}else{failed="function"===typeof fake[method]?!fake[method].apply(fake,args):!fake[method]}if(failed){failAssertion(this,(fake.printf||fake.proxy.printf).apply(fake,[message].concat(args)))}else{assert.pass(name)}}}function exposedName(prefix,prop){return!prefix||/^fail/.test(prop)?prop:prefix+prop.slice(0,1).toUpperCase()+prop.slice(1)}assert={failException:"AssertError",fail:function fail(message){var error=new Error(message);error.name=this.failException||assert.failException;throw error},pass:function pass(){},callOrder:function assertCallOrder(){verifyIsStub.apply(null,arguments);var expected="",actual="";if(!sinon.calledInOrder(arguments)){try{expected=[].join.call(arguments,", ");var calls=slice.call(arguments),i=calls.length;while(i){if(!calls[--i].called){calls.splice(i,1)}}actual=sinon.orderByFirstCall(calls).join(", ")}catch(e){}failAssertion(this,"expected "+expected+" to be "+"called in order but were called as "+actual)}else{assert.pass("callOrder")}},callCount:function assertCallCount(method,count){verifyIsStub(method);if(method.callCount!==count){var msg="expected %n to be called "+sinon.timesInWords(count)+" but was called %c%C";failAssertion(this,method.printf(msg))}else{assert.pass("callCount")}},expose:function expose(target,options){if(!target){throw new TypeError("target is null or undefined")}var o=options||{},prefix="undefined"===typeof o.prefix&&"assert"||o.prefix,includeFail="undefined"===typeof o.includeFail||!!o.includeFail;for(var method in this){if("expose"!==method&&(includeFail||!/^(fail)/.test(method))){target[exposedName(prefix,method)]=this[method]}}return target},match:function match(actual,expectation){var matcher=sinon.match(expectation);if(matcher.test(actual)){assert.pass("match")}else{var formatted=["expected value to match","    expected = "+sinon.format(expectation),"    actual = "+sinon.format(actual)];failAssertion(this,formatted.join("\n"))}}};mirrorPropAsAssertion("called","expected %n to have been called at least once but was never called");mirrorPropAsAssertion("notCalled",function(spy){return!spy.called},"expected %n to not have been called but was called %c%C");mirrorPropAsAssertion("calledOnce","expected %n to be called once but was called %c%C");mirrorPropAsAssertion("calledTwice","expected %n to be called twice but was called %c%C");mirrorPropAsAssertion("calledThrice","expected %n to be called thrice but was called %c%C");mirrorPropAsAssertion("calledOn","expected %n to be called with %1 as this but was called with %t");mirrorPropAsAssertion("alwaysCalledOn","expected %n to always be called with %1 as this but was called with %t");mirrorPropAsAssertion("calledWithNew","expected %n to be called with new");mirrorPropAsAssertion("alwaysCalledWithNew","expected %n to always be called with new");mirrorPropAsAssertion("calledWith","expected %n to be called with arguments %*%C");mirrorPropAsAssertion("calledWithMatch","expected %n to be called with match %*%C");mirrorPropAsAssertion("alwaysCalledWith","expected %n to always be called with arguments %*%C");mirrorPropAsAssertion("alwaysCalledWithMatch","expected %n to always be called with match %*%C");mirrorPropAsAssertion("calledWithExactly","expected %n to be called with exact arguments %*%C");mirrorPropAsAssertion("alwaysCalledWithExactly","expected %n to always be called with exact arguments %*%C");mirrorPropAsAssertion("neverCalledWith","expected %n to never be called with arguments %*%C");mirrorPropAsAssertion("neverCalledWithMatch","expected %n to never be called with match %*%C");mirrorPropAsAssertion("threw","%n did not throw exception%C");mirrorPropAsAssertion("alwaysThrew","%n did not always throw exception%C");sinon.assert=assert;return assert}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var sinon=require("./util/core");require("./match");require("./format");module.exports=makeApi(sinon)}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon,"undefined"!==typeof global?global:self);return sinon});