<!DOCTYPE html><html><head><meta charset="UTF-8"><title>iron-dropdown-scroll-manager tests</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="../../webcomponentsjs/webcomponents-lite.js"></script><script src="../../web-component-tester/browser.js"></script><script src="../../iron-test-helpers/mock-interactions.js"></script><link rel="import" href="../iron-scroll-manager.html"><link rel="import" href="x-scrollable-element.html"></head><body><test-fixture id="DOMSubtree"><template><x-scrollable-element id="Parent"></x-scrollable-element></template></test-fixture><script>var scrollEvents=["wheel","mousewheel","DOMMouseScroll","touchstart","touchmove"];suite("IronScrollManager",function(){var parent,childOne,childTwo,grandChildOne,grandChildTwo,ancestor;setup(function(){parent=fixture("DOMSubtree");childOne=parent.$$("#ChildOne");childTwo=parent.$$("#ChildTwo");grandChildOne=parent.$$("#GrandchildOne");grandChildTwo=parent.$$("#GrandchildTwo");ancestor=document.body});suite("constraining scroll in the DOM",function(){setup(function(){Polymer.IronScrollManager.pushScrollLock(childOne)});teardown(function(){Polymer.IronScrollManager.removeScrollLock(childOne)});test("recognizes sibling as locked",function(){expect(Polymer.IronScrollManager.elementIsScrollLocked(childTwo)).to.be.equal(!0)});test("recognizes neice as locked",function(){expect(Polymer.IronScrollManager.elementIsScrollLocked(grandChildTwo)).to.be.equal(!0)});test("recognizes parent as locked",function(){expect(Polymer.IronScrollManager.elementIsScrollLocked(parent)).to.be.equal(!0)});test("recognizes ancestor as locked",function(){expect(Polymer.IronScrollManager.elementIsScrollLocked(ancestor)).to.be.equal(!0)});test("recognizes locking child as unlocked",function(){expect(Polymer.IronScrollManager.elementIsScrollLocked(childOne)).to.be.equal(!1)});test("recognizes descendant of locking child as unlocked",function(){expect(Polymer.IronScrollManager.elementIsScrollLocked(grandChildOne)).to.be.equal(!1)});test("unlocks locked elements when there are no locking elements",function(){Polymer.IronScrollManager.removeScrollLock(childOne);expect(Polymer.IronScrollManager.elementIsScrollLocked(parent)).to.be.equal(!1)});suite("various scroll events",function(){var events;setup(function(){events=scrollEvents.map(function(scrollEvent){var event=new CustomEvent(scrollEvent,{bubbles:!0,cancelable:!0,composed:!0});event.deltaX=0;event.deltaY=10;return event})});test("prevents wheel events from locked elements",function(){events.forEach(function(event){childTwo.dispatchEvent(event);assert.isTrue(event.defaultPrevented,event.type+" ok")})});test("allows wheel events when there are no locking elements",function(){Polymer.IronScrollManager.removeScrollLock(childOne);events.forEach(function(event){childTwo.dispatchEvent(event);assert.isFalse(event.defaultPrevented,event.type+" ok")})});test("allows wheel events from unlocked elements",function(){events.forEach(function(event){childOne.dispatchEvent(event);assert.isFalse(event.defaultPrevented,event.type+" ok")})});test("touchstart is prevented if dispatched by an element outside the locking element",function(){var event=new CustomEvent("touchstart",{bubbles:!0,cancelable:!0,composed:!0});childTwo.dispatchEvent(event);assert.isTrue(event.defaultPrevented,event.type+" ok")});test("touchstart is not prevented if dispatched by an element inside the locking element",function(){var event=new CustomEvent("touchstart",{bubbles:!0,cancelable:!0,composed:!0});grandChildOne.dispatchEvent(event);assert.isFalse(event.defaultPrevented,event.type+" ok")});test("arrow keyboard events not prevented by manager",function(){var left=MockInteractions.keyboardEventFor("keydown",37),up=MockInteractions.keyboardEventFor("keydown",38),right=MockInteractions.keyboardEventFor("keydown",39),down=MockInteractions.keyboardEventFor("keydown",40);grandChildOne.dispatchEvent(left);grandChildOne.dispatchEvent(up);grandChildOne.dispatchEvent(right);grandChildOne.dispatchEvent(down);assert.isFalse(left.defaultPrevented,"left ok");assert.isFalse(up.defaultPrevented,"up ok");assert.isFalse(right.defaultPrevented,"right ok");assert.isFalse(down.defaultPrevented,"down ok")})})})});</script></body></html>