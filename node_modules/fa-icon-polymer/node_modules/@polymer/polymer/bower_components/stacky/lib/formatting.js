(function(scope){'use strict';var parse=scope.parse||require("./parsing").parse;scope.defaults={maxMethodPadding:40,indent:"",methodPlaceholder:"<unknown>",locationStrip:[],unimportantLocation:[],filter:function(){return!1},styles:{method:passthrough,location:passthrough,line:passthrough,column:passthrough,unimportant:passthrough}};var isNode=new Function("try {return this===global;}catch(e){return false;}");if(isNode()){var chalk=require("chalk");scope.defaults.styles={method:chalk.magenta,location:chalk.blue,line:chalk.cyan,column:chalk.cyan,unimportant:chalk.dim}}function pretty(stackOrParsed,options){options=mergeDefaults(options||{},scope.defaults);var lines=Array.isArray(stackOrParsed)?stackOrParsed:parse(stackOrParsed);lines=clean(lines,options);var padSize=methodPadding(lines,options),parts=lines.map(function(line){var method=line.method||options.methodPlaceholder,pad=options.indent+padding(padSize-method.length),locationBits=[options.styles.location(line.location),options.styles.line(line.line)];if("column"in line){locationBits.push(options.styles.column(line.column))}var location=locationBits.join(":"),text=pad+options.styles.method(method)+" at "+location;if(!line.important){text=options.styles.unimportant(text)}return text});return parts.join("\n")}function clean(lines,options){for(var result=[],i=0,line;line=lines[i];i++){if(options.filter(line))continue;line.location=cleanLocation(line.location,options);line.important=isImportant(line,options);result.push(line)}return result}function passthrough(string){return string}function mergeDefaults(options,defaults){var result=Object.create(defaults);Object.keys(options).forEach(function(key){var value=options[key];if("object"===typeof value&&!Array.isArray(value)){value=mergeDefaults(value,defaults[key])}result[key]=value});return result}function methodPadding(lines,options){for(var size=options.methodPlaceholder.length,i=0,line;line=lines[i];i++){size=Math.min(options.maxMethodPadding,Math.max(size,line.method.length))}return size}function padding(length){for(var result="",i=0;i<length;i++){result=result+" "}return result}function cleanLocation(location,options){if(options.locationStrip){for(var i=0,matcher;matcher=options.locationStrip[i];i++){location=location.replace(matcher,"")}}return location}function isImportant(line,options){if(options.unimportantLocation){for(var i=0,matcher;matcher=options.unimportantLocation[i];i++){if(line.location.match(matcher))return!1}}return!0}scope.clean=clean;scope.pretty=pretty})("undefined"!==typeof module?module.exports:this.Stacky=this.Stacky||{});