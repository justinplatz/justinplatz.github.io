<!DOCTYPE html><html><head><title>focused-state</title><script src="../../webcomponentsjs/webcomponents-lite.js"></script><script src="../../web-component-tester/browser.js"></script><script src="../../iron-test-helpers/mock-interactions.js"></script><link rel="import" href="test-elements.html"></head><body><test-fixture id="TrivialFocusedState"><template><test-control tabindex="-1"></test-control></template></test-fixture><test-fixture id="NestedFocusedState"><template><nested-focusable></nested-focusable></template></test-fixture><test-fixture id="LightDOM"><template><test-light-dom><input id="input"><nested-focusable></nested-focusable></test-light-dom></template></test-fixture><script>suite("focused-state",function(){var focusTarget;setup(function(){focusTarget=fixture("TrivialFocusedState")});suite("when is focused",function(){test("receives a focused attribute",function(){expect(focusTarget.hasAttribute("focused")).to.be.eql(!1);MockInteractions.focus(focusTarget);expect(focusTarget.hasAttribute("focused")).to.be.eql(!0)});test("focused property is true",function(){expect(focusTarget.focused).to.not.be.eql(!0);MockInteractions.focus(focusTarget);expect(focusTarget.focused).to.be.eql(!0)})});suite("when is blurred",function(){test("loses the focused attribute",function(){MockInteractions.focus(focusTarget);expect(focusTarget.hasAttribute("focused")).to.be.eql(!0);MockInteractions.blur(focusTarget);expect(focusTarget.hasAttribute("focused")).to.be.eql(!1)});test("focused property is false",function(){MockInteractions.focus(focusTarget);expect(focusTarget.focused).to.be.eql(!0);MockInteractions.blur(focusTarget);expect(focusTarget.focused).to.be.eql(!1)})});suite("when the focused state is disabled",function(){test("will not be focusable",function(){var blurSpy=sinon.spy(focusTarget,"blur");MockInteractions.focus(focusTarget);focusTarget.disabled=!0;expect(focusTarget.getAttribute("tabindex")).to.be.eql("-1");expect(blurSpy.called).to.be.eql(!0)})})});suite("nested focusable",function(){var focusable;setup(function(){focusable=fixture("NestedFocusedState")});test("focus/blur events fired on host element",function(){var nFocusEvents=0,nBlurEvents=0;focusable.addEventListener("focus",function(){nFocusEvents+=1;expect(focusable.focused).to.be.equal(!0);MockInteractions.blur(focusable.$.input)});focusable.addEventListener("blur",function(){expect(focusable.focused).to.be.equal(!1);nBlurEvents+=1});MockInteractions.focus(focusable.$.input);expect(nBlurEvents).to.be.greaterThan(0);expect(nFocusEvents).to.be.greaterThan(0)})});suite("elements in the light dom",function(){var lightDOM,input,lightDescendantShadowInput;setup(function(){lightDOM=fixture("LightDOM");input=Polymer.dom(lightDOM).querySelector("#input");lightDescendantShadowInput=Polymer.dom(lightDOM).querySelector("nested-focusable").$.input});test("should not fire the focus event",function(){var nFocusEvents=0;lightDOM.addEventListener("focus",function(event){nFocusEvents+=1});MockInteractions.focus(input);expect(nFocusEvents).to.be.equal(0)});test("should not fire the focus event from shadow descendants",function(){var nFocusEvents=0;lightDOM.addEventListener("focus",function(event){nFocusEvents+=1});MockInteractions.focus(lightDescendantShadowInput);expect(nFocusEvents).to.be.equal(0)})});</script></body></html>