var mkdirp=require("../").mkdirp,path=require("path"),fs=require("fs"),exists=fs.exists||path.exists,test=require("tap").test,_0777=parseInt("0777",8),_0755=parseInt("0755",8);test("race",function(t){t.plan(10);for(var ps=["","tmp"],i=0,dir;25>i;i++){dir=Math.floor(65536*Math.random()).toString(16);ps.push(dir)}var file=ps.join("/"),res=2;mk(file);mk(file);function mk(file,cb){mkdirp(file,_0755,function(err){t.ifError(err);exists(file,function(ex){t.ok(ex,"file created");fs.stat(file,function(err,stat){t.ifError(err);t.equal(stat.mode&_0777,_0755);t.ok(stat.isDirectory(),"target not a directory")})})})}});