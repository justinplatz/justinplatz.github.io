var sinon=function(){"use strict";var sinonModule,isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){sinonModule=module.exports=require("./sinon/util/core");require("./sinon/extend");require("./sinon/walk");require("./sinon/typeOf");require("./sinon/times_in_words");require("./sinon/spy");require("./sinon/call");require("./sinon/behavior");require("./sinon/stub");require("./sinon/mock");require("./sinon/collection");require("./sinon/assert");require("./sinon/sandbox");require("./sinon/test");require("./sinon/test_case");require("./sinon/match");require("./sinon/format");require("./sinon/log_error")}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require,module.exports,module);sinonModule=module.exports}else{sinonModule={}}return sinonModule}();(function(sinonGlobal){var div="undefined"!==typeof document&&document.createElement("div"),hasOwn=Object.prototype.hasOwnProperty;function isDOMNode(obj){var success=!1;try{obj.appendChild(div);success=div.parentNode===obj}catch(e){return!1}finally{try{obj.removeChild(div)}catch(e){}}return success}function isElement(obj){return div&&obj&&1===obj.nodeType&&isDOMNode(obj)}function isFunction(obj){return"function"===typeof obj||!!(obj&&obj.constructor&&obj.call&&obj.apply)}function isReallyNaN(val){return"number"===typeof val&&isNaN(val)}function mirrorProperties(target,source){for(var prop in source){if(!hasOwn.call(target,prop)){target[prop]=source[prop]}}}function isRestorable(obj){return"function"===typeof obj&&"function"===typeof obj.restore&&obj.restore.sinon}var hasES5Support="keys"in Object;function makeApi(sinon){sinon.wrapMethod=function wrapMethod(object,property,method){if(!object){throw new TypeError("Should wrap property of object")}if("function"!==typeof method&&"object"!==typeof method){throw new TypeError("Method wrapper should be a function or a property descriptor")}function checkWrappedMethod(wrappedMethod){var error;if(!isFunction(wrappedMethod)){error=new TypeError("Attempted to wrap "+typeof wrappedMethod+" property "+property+" as function")}else if(wrappedMethod.restore&&wrappedMethod.restore.sinon){error=new TypeError("Attempted to wrap "+property+" which is already wrapped")}else if(wrappedMethod.calledBefore){var verb=wrappedMethod.returns?"stubbed":"spied on";error=new TypeError("Attempted to wrap "+property+" which is already "+verb)}if(error){if(wrappedMethod&&wrappedMethod.stackTrace){error.stack+="\n--------------\n"+wrappedMethod.stackTrace}throw error}}var error,wrappedMethod,i;function simplePropertyAssignment(){wrappedMethod=object[property];checkWrappedMethod(wrappedMethod);object[property]=method;method.displayName=property}var owned=object.hasOwnProperty&&object.hasOwnProperty===hasOwn?object.hasOwnProperty(property):hasOwn.call(object,property);if(hasES5Support){var methodDesc="function"===typeof method?{value:method}:method,wrappedMethodDesc=sinon.getPropertyDescriptor(object,property);if(!wrappedMethodDesc){error=new TypeError("Attempted to wrap "+typeof wrappedMethod+" property "+property+" as function")}else if(wrappedMethodDesc.restore&&wrappedMethodDesc.restore.sinon){error=new TypeError("Attempted to wrap "+property+" which is already wrapped")}if(error){if(wrappedMethodDesc&&wrappedMethodDesc.stackTrace){error.stack+="\n--------------\n"+wrappedMethodDesc.stackTrace}throw error}var types=sinon.objectKeys(methodDesc);for(i=0;i<types.length;i++){wrappedMethod=wrappedMethodDesc[types[i]];checkWrappedMethod(wrappedMethod)}mirrorProperties(methodDesc,wrappedMethodDesc);for(i=0;i<types.length;i++){mirrorProperties(methodDesc[types[i]],wrappedMethodDesc[types[i]])}Object.defineProperty(object,property,methodDesc);if("function"===typeof method&&object[property]!==method){delete object[property];simplePropertyAssignment()}}else{simplePropertyAssignment()}method.displayName=property;method.stackTrace=new Error("Stack Trace for original").stack;method.restore=function(){if(!owned){try{delete object[property]}catch(e){}}else if(hasES5Support){Object.defineProperty(object,property,wrappedMethodDesc)}if(hasES5Support){var checkDesc=sinon.getPropertyDescriptor(object,property);if(checkDesc.value===method){object[property]=wrappedMethod}}else if(object[property]===method){object[property]=wrappedMethod}};method.restore.sinon=!0;if(!hasES5Support){mirrorProperties(method,wrappedMethod)}return method};sinon.create=function create(proto){var F=function(){};F.prototype=proto;return new F};sinon.deepEqual=function deepEqual(a,b){if(sinon.match&&sinon.match.isMatcher(a)){return a.test(b)}if("object"!==typeof a||"object"!==typeof b){return isReallyNaN(a)&&isReallyNaN(b)||a===b}if(isElement(a)||isElement(b)){return a===b}if(a===b){return!0}if(null===a&&null!==b||null!==a&&null===b){return!1}if(a instanceof RegExp&&b instanceof RegExp){return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline}var aString=Object.prototype.toString.call(a);if(aString!==Object.prototype.toString.call(b)){return!1}if("[object Date]"===aString){return a.valueOf()===b.valueOf()}var prop,aLength=0,bLength=0;if("[object Array]"===aString&&a.length!==b.length){return!1}for(prop in a){if(hasOwn.call(a,prop)){aLength+=1;if(!(prop in b)){return!1}if(!deepEqual(a[prop],b[prop])){return!1}}}for(prop in b){if(hasOwn.call(b,prop)){bLength+=1}}return aLength===bLength};sinon.functionName=function functionName(func){var name=func.displayName||func.name;if(!name){var matches=func.toString().match(/function ([^\s\(]+)/);name=matches&&matches[1]}return name};sinon.functionToString=function toString(){if(this.getCall&&this.callCount){var thisValue,prop,i=this.callCount;while(i--){thisValue=this.getCall(i).thisValue;for(prop in thisValue){if(thisValue[prop]===this){return prop}}}}return this.displayName||"sinon fake"};sinon.objectKeys=function objectKeys(obj){if(obj!==Object(obj)){throw new TypeError("sinon.objectKeys called on a non-object")}var keys=[],key;for(key in obj){if(hasOwn.call(obj,key)){keys.push(key)}}return keys};sinon.getPropertyDescriptor=function getPropertyDescriptor(object,property){var proto=object,descriptor;while(proto&&!(descriptor=Object.getOwnPropertyDescriptor(proto,property))){proto=Object.getPrototypeOf(proto)}return descriptor};sinon.getConfig=function(custom){var config={};custom=custom||{};var defaults=sinon.defaultConfig;for(var prop in defaults){if(defaults.hasOwnProperty(prop)){config[prop]=custom.hasOwnProperty(prop)?custom[prop]:defaults[prop]}}return config};sinon.defaultConfig={injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0};sinon.timesInWords=function timesInWords(count){return 1===count&&"once"||2===count&&"twice"||3===count&&"thrice"||(count||0)+" times"};sinon.calledInOrder=function(spies){for(var i=1,l=spies.length;i<l;i++){if(!spies[i-1].calledBefore(spies[i])||!spies[i].called){return!1}}return!0};sinon.orderByFirstCall=function(spies){return spies.sort(function(a,b){var aCall=a.getCall(0),bCall=b.getCall(0),aId=aCall&&aCall.callId||-1,bId=bCall&&bCall.callId||-1;return aId<bId?-1:1})};sinon.createStubInstance=function(constructor){if("function"!==typeof constructor){throw new TypeError("The constructor should be a function.")}return sinon.stub(sinon.create(constructor.prototype))};sinon.restore=function(object){if(null!==object&&"object"===typeof object){for(var prop in object){if(isRestorable(object[prop])){object[prop].restore()}}}else if(isRestorable(object)){object.restore()}};return sinon}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports){makeApi(exports)}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);(function(sinonGlobal){function makeApi(sinon){var hasDontEnumBug=function(){var obj={constructor:function(){return"0"},toString:function(){return"1"},valueOf:function(){return"2"},toLocaleString:function(){return"3"},prototype:function(){return"4"},isPrototypeOf:function(){return"5"},propertyIsEnumerable:function(){return"6"},hasOwnProperty:function(){return"7"},length:function(){return"8"},unique:function(){return"9"}},result=[];for(var prop in obj){if(obj.hasOwnProperty(prop)){result.push(obj[prop]())}}return"0123456789"!==result.join("")}();function extend(target){var sources=Array.prototype.slice.call(arguments,1),source,i,prop;for(i=0;i<sources.length;i++){source=sources[i];for(prop in source){if(source.hasOwnProperty(prop)){target[prop]=source[prop]}}if(hasDontEnumBug&&source.hasOwnProperty("toString")&&source.toString!==target.toString){target.toString=source.toString}}return target}sinon.extend=extend;return sinon.extend}function loadDependencies(require,exports,module){var sinon=require("./util/core");module.exports=makeApi(sinon)}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);if("undefined"===typeof sinon){this.sinon={}}(function(){var push=[].push;function makeApi(sinon){sinon.Event=function Event(type,bubbles,cancelable,target){this.initEvent(type,bubbles,cancelable,target)};sinon.Event.prototype={initEvent:function(type,bubbles,cancelable,target){this.type=type;this.bubbles=bubbles;this.cancelable=cancelable;this.target=target},stopPropagation:function(){},preventDefault:function(){this.defaultPrevented=!0}};sinon.ProgressEvent=function ProgressEvent(type,progressEventRaw,target){this.initEvent(type,!1,!1,target);this.loaded="number"===typeof progressEventRaw.loaded?progressEventRaw.loaded:null;this.total="number"===typeof progressEventRaw.total?progressEventRaw.total:null;this.lengthComputable=!!progressEventRaw.total};sinon.ProgressEvent.prototype=new sinon.Event;sinon.ProgressEvent.prototype.constructor=sinon.ProgressEvent;sinon.CustomEvent=function CustomEvent(type,customData,target){this.initEvent(type,!1,!1,target);this.detail=customData.detail||null};sinon.CustomEvent.prototype=new sinon.Event;sinon.CustomEvent.prototype.constructor=sinon.CustomEvent;sinon.EventTarget={addEventListener:function addEventListener(event,listener){this.eventListeners=this.eventListeners||{};this.eventListeners[event]=this.eventListeners[event]||[];push.call(this.eventListeners[event],listener)},removeEventListener:function removeEventListener(event,listener){for(var listeners=this.eventListeners&&this.eventListeners[event]||[],i=0,l=listeners.length;i<l;++i){if(listeners[i]===listener){return listeners.splice(i,1)}}},dispatchEvent:function dispatchEvent(event){for(var type=event.type,listeners=this.eventListeners&&this.eventListeners[type]||[],i=0;i<listeners.length;i++){if("function"===typeof listeners[i]){listeners[i].call(this,event)}else{listeners[i].handleEvent(event)}}return!!event.defaultPrevented}}}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require){var sinon=require("./core");makeApi(sinon)}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require)}else{makeApi(sinon)}})();(function(sinonGlobal){var realSetTimeout=setTimeout;function makeApi(sinon){function log(){}function logError(label,err){var msg=label+" threw exception: ";function throwLoggedError(){err.message=msg+err.message;throw err}sinon.log(msg+"["+err.name+"] "+err.message);if(err.stack){sinon.log(err.stack)}if(logError.useImmediateExceptions){throwLoggedError()}else{logError.setTimeout(throwLoggedError,0)}}logError.useImmediateExceptions=!1;logError.setTimeout=function(func,timeout){realSetTimeout(func,timeout)};var exports={log:sinon.log=log,logError:sinon.logError=logError};return exports}function loadDependencies(require,exports,module){var sinon=require("./util/core");module.exports=makeApi(sinon)}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);function getGlobal(){return"undefined"!==typeof window?window:global}if("undefined"===typeof sinon){if("undefined"===typeof this){getGlobal().sinon={}}else{this.sinon={}}}(function(global){var xdr={XDomainRequest:global.XDomainRequest,GlobalXDomainRequest:global.XDomainRequest};xdr.supportsXDR="undefined"!==typeof xdr.GlobalXDomainRequest;xdr.workingXDR=xdr.supportsXDR?xdr.GlobalXDomainRequest:!1;function makeApi(sinon){sinon.xdr=xdr;function FakeXDomainRequest(){this.readyState=FakeXDomainRequest.UNSENT;this.requestBody=null;this.requestHeaders={};this.status=0;this.timeout=null;if("function"===typeof FakeXDomainRequest.onCreate){FakeXDomainRequest.onCreate(this)}}function verifyState(x){if(x.readyState!==FakeXDomainRequest.OPENED){throw new Error("INVALID_STATE_ERR")}if(x.sendFlag){throw new Error("INVALID_STATE_ERR")}}function verifyRequestSent(x){if(x.readyState===FakeXDomainRequest.UNSENT){throw new Error("Request not sent")}if(x.readyState===FakeXDomainRequest.DONE){throw new Error("Request done")}}function verifyResponseBodyType(body){if("string"!==typeof body){var error=new Error("Attempted to respond to fake XDomainRequest with "+body+", which is not a string.");error.name="InvalidBodyException";throw error}}sinon.extend(FakeXDomainRequest.prototype,sinon.EventTarget,{open:function open(method,url){this.method=method;this.url=url;this.responseText=null;this.sendFlag=!1;this.readyStateChange(FakeXDomainRequest.OPENED)},readyStateChange:function readyStateChange(state){this.readyState=state;var eventName="";switch(this.readyState){case FakeXDomainRequest.UNSENT:break;case FakeXDomainRequest.OPENED:break;case FakeXDomainRequest.LOADING:if(this.sendFlag){eventName="onprogress"}break;case FakeXDomainRequest.DONE:if(this.isTimeout){eventName="ontimeout"}else if(this.errorFlag||200>this.status||299<this.status){eventName="onerror"}else{eventName="onload"}break;}if(eventName){if("function"===typeof this[eventName]){try{this[eventName]()}catch(e){sinon.logError("Fake XHR "+eventName+" handler",e)}}}},send:function send(data){verifyState(this);if(!/^(get|head)$/i.test(this.method)){this.requestBody=data}this.requestHeaders["Content-Type"]="text/plain;charset=utf-8";this.errorFlag=!1;this.sendFlag=!0;this.readyStateChange(FakeXDomainRequest.OPENED);if("function"===typeof this.onSend){this.onSend(this)}},abort:function abort(){this.aborted=!0;this.responseText=null;this.errorFlag=!0;if(this.readyState>sinon.FakeXDomainRequest.UNSENT&&this.sendFlag){this.readyStateChange(sinon.FakeXDomainRequest.DONE);this.sendFlag=!1}},setResponseBody:function setResponseBody(body){verifyRequestSent(this);verifyResponseBodyType(body);var chunkSize=this.chunkSize||10,index=0;this.responseText="";do{this.readyStateChange(FakeXDomainRequest.LOADING);this.responseText+=body.substring(index,index+chunkSize);index+=chunkSize}while(index<body.length);this.readyStateChange(FakeXDomainRequest.DONE)},respond:function respond(status,contentType,body){this.status="number"===typeof status?status:200;this.setResponseBody(body||"")},simulatetimeout:function simulatetimeout(){this.status=0;this.isTimeout=!0;this.responseText=void 0;this.readyStateChange(FakeXDomainRequest.DONE)}});sinon.extend(FakeXDomainRequest,{UNSENT:0,OPENED:1,LOADING:3,DONE:4});sinon.useFakeXDomainRequest=function useFakeXDomainRequest(){sinon.FakeXDomainRequest.restore=function restore(keepOnCreate){if(xdr.supportsXDR){global.XDomainRequest=xdr.GlobalXDomainRequest}delete sinon.FakeXDomainRequest.restore;if(!0!==keepOnCreate){delete sinon.FakeXDomainRequest.onCreate}};if(xdr.supportsXDR){global.XDomainRequest=sinon.FakeXDomainRequest}return sinon.FakeXDomainRequest};sinon.FakeXDomainRequest=FakeXDomainRequest}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var sinon=require("./core");require("../extend");require("./event");require("../log_error");makeApi(sinon);module.exports=sinon}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require,module.exports,module)}else{makeApi(sinon)}})("undefined"!==typeof global?global:self);(function(sinonGlobal,global){function getWorkingXHR(globalScope){var supportsXHR="undefined"!==typeof globalScope.XMLHttpRequest;if(supportsXHR){return globalScope.XMLHttpRequest}var supportsActiveX="undefined"!==typeof globalScope.ActiveXObject;if(supportsActiveX){return function(){return new globalScope.ActiveXObject("MSXML2.XMLHTTP.3.0")}}return!1}var supportsProgress="undefined"!==typeof ProgressEvent,supportsCustomEvent="undefined"!==typeof CustomEvent,supportsFormData="undefined"!==typeof FormData,supportsArrayBuffer="undefined"!==typeof ArrayBuffer,supportsBlob=function(){try{return!!new Blob}catch(e){return!1}}(),sinonXhr={XMLHttpRequest:global.XMLHttpRequest};sinonXhr.GlobalXMLHttpRequest=global.XMLHttpRequest;sinonXhr.GlobalActiveXObject=global.ActiveXObject;sinonXhr.supportsActiveX="undefined"!==typeof sinonXhr.GlobalActiveXObject;sinonXhr.supportsXHR="undefined"!==typeof sinonXhr.GlobalXMLHttpRequest;sinonXhr.workingXHR=getWorkingXHR(global);sinonXhr.supportsCORS=sinonXhr.supportsXHR&&"withCredentials"in new sinonXhr.GlobalXMLHttpRequest;var unsafeHeaders={"Accept-Charset":!0,"Accept-Encoding":!0,Connection:!0,"Content-Length":!0,Cookie:!0,Cookie2:!0,"Content-Transfer-Encoding":!0,Date:!0,Expect:!0,Host:!0,"Keep-Alive":!0,Referer:!0,TE:!0,Trailer:!0,"Transfer-Encoding":!0,Upgrade:!0,"User-Agent":!0,Via:!0};function UploadProgress(){this.eventListeners={abort:[],error:[],load:[],loadend:[],progress:[]}}UploadProgress.prototype.addEventListener=function addEventListener(event,listener){this.eventListeners[event].push(listener)};UploadProgress.prototype.removeEventListener=function removeEventListener(event,listener){for(var listeners=this.eventListeners[event]||[],i=0,l=listeners.length;i<l;++i){if(listeners[i]===listener){return listeners.splice(i,1)}}};UploadProgress.prototype.dispatchEvent=function dispatchEvent(event){for(var listeners=this.eventListeners[event.type]||[],i=0,listener;null!=(listener=listeners[i]);i++){listener(event)}};function FakeXMLHttpRequest(){this.readyState=FakeXMLHttpRequest.UNSENT;this.requestHeaders={};this.requestBody=null;this.status=0;this.statusText="";this.upload=new UploadProgress;this.responseType="";this.response="";if(sinonXhr.supportsCORS){this.withCredentials=!1}var xhr=this,events=["loadstart","load","abort","error","loadend"];function addEventListener(eventName){xhr.addEventListener(eventName,function(event){var listener=xhr["on"+eventName];if(listener&&"function"===typeof listener){listener.call(this,event)}})}for(var i=events.length-1;0<=i;i--){addEventListener(events[i])}if("function"===typeof FakeXMLHttpRequest.onCreate){FakeXMLHttpRequest.onCreate(this)}}function verifyState(xhr){if(xhr.readyState!==FakeXMLHttpRequest.OPENED){throw new Error("INVALID_STATE_ERR")}if(xhr.sendFlag){throw new Error("INVALID_STATE_ERR")}}function getHeader(headers,header){header=header.toLowerCase();for(var h in headers){if(h.toLowerCase()===header){return h}}return null}function each(collection,callback){if(!collection){return}for(var i=0,l=collection.length;i<l;i+=1){callback(collection[i])}}function some(collection,callback){for(var index=0;index<collection.length;index++){if(!0===callback(collection[index])){return!0}}return!1}var apply=function(obj,method,args){switch(args.length){case 0:return obj[method]();case 1:return obj[method](args[0]);case 2:return obj[method](args[0],args[1]);case 3:return obj[method](args[0],args[1],args[2]);case 4:return obj[method](args[0],args[1],args[2],args[3]);case 5:return obj[method](args[0],args[1],args[2],args[3],args[4]);}};FakeXMLHttpRequest.filters=[];FakeXMLHttpRequest.addFilter=function addFilter(fn){this.filters.push(fn)};var IE6Re=/MSIE 6/;FakeXMLHttpRequest.defake=function defake(fakeXhr,xhrArgs){var xhr=new sinonXhr.workingXHR;each(["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","addEventListener","overrideMimeType","removeEventListener"],function(method){fakeXhr[method]=function(){return apply(xhr,method,arguments)}});var copyAttrs=function(args){each(args,function(attr){try{fakeXhr[attr]=xhr[attr]}catch(e){if(!IE6Re.test(navigator.userAgent)){throw e}}})},stateChange=function stateChange(){fakeXhr.readyState=xhr.readyState;if(xhr.readyState>=FakeXMLHttpRequest.HEADERS_RECEIVED){copyAttrs(["status","statusText"])}if(xhr.readyState>=FakeXMLHttpRequest.LOADING){copyAttrs(["responseText","response"])}if(xhr.readyState===FakeXMLHttpRequest.DONE){copyAttrs(["responseXML"])}if(fakeXhr.onreadystatechange){fakeXhr.onreadystatechange.call(fakeXhr,{target:fakeXhr})}};if(xhr.addEventListener){for(var event in fakeXhr.eventListeners){if(fakeXhr.eventListeners.hasOwnProperty(event)){each(fakeXhr.eventListeners[event],function(handler){xhr.addEventListener(event,handler)})}}xhr.addEventListener("readystatechange",stateChange)}else{xhr.onreadystatechange=stateChange}apply(xhr,"open",xhrArgs)};FakeXMLHttpRequest.useFilters=!1;function verifyRequestOpened(xhr){if(xhr.readyState!==FakeXMLHttpRequest.OPENED){throw new Error("INVALID_STATE_ERR - "+xhr.readyState)}}function verifyRequestSent(xhr){if(xhr.readyState===FakeXMLHttpRequest.DONE){throw new Error("Request done")}}function verifyHeadersReceived(xhr){if(xhr.async&&xhr.readyState!==FakeXMLHttpRequest.HEADERS_RECEIVED){throw new Error("No headers received")}}function verifyResponseBodyType(body){if("string"!==typeof body){var error=new Error("Attempted to respond to fake XMLHttpRequest with "+body+", which is not a string.");error.name="InvalidBodyException";throw error}}function convertToArrayBuffer(body){for(var buffer=new ArrayBuffer(body.length),view=new Uint8Array(buffer),i=0,charCode;i<body.length;i++){charCode=body.charCodeAt(i);if(256<=charCode){throw new TypeError("arraybuffer or blob responseTypes require binary string, "+"invalid character "+body[i]+" found.")}view[i]=charCode}return buffer}function isXmlContentType(contentType){return!contentType||/(text\/xml)|(application\/xml)|(\+xml)/.test(contentType)}function convertResponseBody(responseType,contentType,body){if(""===responseType||"text"===responseType){return body}else if(supportsArrayBuffer&&"arraybuffer"===responseType){return convertToArrayBuffer(body)}else if("json"===responseType){try{return JSON.parse(body)}catch(e){return null}}else if(supportsBlob&&"blob"===responseType){var blobOptions={};if(contentType){blobOptions.type=contentType}return new Blob([convertToArrayBuffer(body)],blobOptions)}else if("document"===responseType){if(isXmlContentType(contentType)){return FakeXMLHttpRequest.parseXML(body)}return null}throw new Error("Invalid responseType "+responseType)}function clearResponse(xhr){if(""===xhr.responseType||"text"===xhr.responseType){xhr.response=xhr.responseText=""}else{xhr.response=xhr.responseText=null}xhr.responseXML=null}FakeXMLHttpRequest.parseXML=function parseXML(text){if(""!==text){try{if("undefined"!==typeof DOMParser){var parser=new DOMParser;return parser.parseFromString(text,"text/xml")}var xmlDoc=new window.ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(text);return xmlDoc}catch(e){}}return null};FakeXMLHttpRequest.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};function makeApi(sinon){sinon.xhr=sinonXhr;sinon.extend(FakeXMLHttpRequest.prototype,sinon.EventTarget,{async:!0,open:function open(method,url,async,username,password){this.method=method;this.url=url;this.async="boolean"===typeof async?async:!0;this.username=username;this.password=password;clearResponse(this);this.requestHeaders={};this.sendFlag=!1;if(!0===FakeXMLHttpRequest.useFilters){var xhrArgs=arguments,defake=some(FakeXMLHttpRequest.filters,function(filter){return filter.apply(this,xhrArgs)});if(defake){return FakeXMLHttpRequest.defake(this,arguments)}}this.readyStateChange(FakeXMLHttpRequest.OPENED)},readyStateChange:function readyStateChange(state){this.readyState=state;var readyStateChangeEvent=new sinon.Event("readystatechange",!1,!1,this),event,progress;if("function"===typeof this.onreadystatechange){try{this.onreadystatechange(readyStateChangeEvent)}catch(e){sinon.logError("Fake XHR onreadystatechange handler",e)}}if(this.readyState===FakeXMLHttpRequest.DONE){progress={loaded:this.progress||0,total:this.progress||0};if(0===this.status){event=this.aborted?"abort":"error"}else{event="load"}if(supportsProgress){this.upload.dispatchEvent(new sinon.ProgressEvent("progress",progress,this));this.upload.dispatchEvent(new sinon.ProgressEvent(event,progress,this));this.upload.dispatchEvent(new sinon.ProgressEvent("loadend",progress,this))}this.dispatchEvent(new sinon.ProgressEvent("progress",progress,this));this.dispatchEvent(new sinon.ProgressEvent(event,progress,this));this.dispatchEvent(new sinon.ProgressEvent("loadend",progress,this))}this.dispatchEvent(readyStateChangeEvent)},setRequestHeader:function setRequestHeader(header,value){verifyState(this);if(unsafeHeaders[header]||/^(Sec-|Proxy-)/.test(header)){throw new Error("Refused to set unsafe header \""+header+"\"")}if(this.requestHeaders[header]){this.requestHeaders[header]+=","+value}else{this.requestHeaders[header]=value}},setResponseHeaders:function setResponseHeaders(headers){verifyRequestOpened(this);this.responseHeaders={};for(var header in headers){if(headers.hasOwnProperty(header)){this.responseHeaders[header]=headers[header]}}if(this.async){this.readyStateChange(FakeXMLHttpRequest.HEADERS_RECEIVED)}else{this.readyState=FakeXMLHttpRequest.HEADERS_RECEIVED}},send:function send(data){verifyState(this);if(!/^(get|head)$/i.test(this.method)){var contentType=getHeader(this.requestHeaders,"Content-Type");if(this.requestHeaders[contentType]){var value=this.requestHeaders[contentType].split(";");this.requestHeaders[contentType]=value[0]+";charset=utf-8"}else if(supportsFormData&&!(data instanceof FormData)){this.requestHeaders["Content-Type"]="text/plain;charset=utf-8"}this.requestBody=data}this.errorFlag=!1;this.sendFlag=this.async;clearResponse(this);this.readyStateChange(FakeXMLHttpRequest.OPENED);if("function"===typeof this.onSend){this.onSend(this)}this.dispatchEvent(new sinon.Event("loadstart",!1,!1,this))},abort:function abort(){this.aborted=!0;clearResponse(this);this.errorFlag=!0;this.requestHeaders={};this.responseHeaders={};if(this.readyState>FakeXMLHttpRequest.UNSENT&&this.sendFlag){this.readyStateChange(FakeXMLHttpRequest.DONE);this.sendFlag=!1}this.readyState=FakeXMLHttpRequest.UNSENT},error:function error(){clearResponse(this);this.errorFlag=!0;this.requestHeaders={};this.responseHeaders={};this.readyStateChange(FakeXMLHttpRequest.DONE)},getResponseHeader:function getResponseHeader(header){if(this.readyState<FakeXMLHttpRequest.HEADERS_RECEIVED){return null}if(/^Set-Cookie2?$/i.test(header)){return null}header=getHeader(this.responseHeaders,header);return this.responseHeaders[header]||null},getAllResponseHeaders:function getAllResponseHeaders(){if(this.readyState<FakeXMLHttpRequest.HEADERS_RECEIVED){return""}var headers="";for(var header in this.responseHeaders){if(this.responseHeaders.hasOwnProperty(header)&&!/^Set-Cookie2?$/i.test(header)){headers+=header+": "+this.responseHeaders[header]+"\r\n"}}return headers},setResponseBody:function setResponseBody(body){verifyRequestSent(this);verifyHeadersReceived(this);verifyResponseBodyType(body);var contentType=this.getResponseHeader("Content-Type"),isTextResponse=""===this.responseType||"text"===this.responseType;clearResponse(this);if(this.async){var chunkSize=this.chunkSize||10,index=0;do{this.readyStateChange(FakeXMLHttpRequest.LOADING);if(isTextResponse){this.responseText=this.response+=body.substring(index,index+chunkSize)}index+=chunkSize}while(index<body.length)}this.response=convertResponseBody(this.responseType,contentType,body);if(isTextResponse){this.responseText=this.response}if("document"===this.responseType){this.responseXML=this.response}else if(""===this.responseType&&isXmlContentType(contentType)){this.responseXML=FakeXMLHttpRequest.parseXML(this.responseText)}this.progress=body.length;this.readyStateChange(FakeXMLHttpRequest.DONE)},respond:function respond(status,headers,body){this.status="number"===typeof status?status:200;this.statusText=FakeXMLHttpRequest.statusCodes[this.status];this.setResponseHeaders(headers||{});this.setResponseBody(body||"")},uploadProgress:function uploadProgress(progressEventRaw){if(supportsProgress){this.upload.dispatchEvent(new sinon.ProgressEvent("progress",progressEventRaw))}},downloadProgress:function downloadProgress(progressEventRaw){if(supportsProgress){this.dispatchEvent(new sinon.ProgressEvent("progress",progressEventRaw))}},uploadError:function uploadError(error){if(supportsCustomEvent){this.upload.dispatchEvent(new sinon.CustomEvent("error",{detail:error}))}}});sinon.extend(FakeXMLHttpRequest,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});sinon.useFakeXMLHttpRequest=function(){FakeXMLHttpRequest.restore=function restore(keepOnCreate){if(sinonXhr.supportsXHR){global.XMLHttpRequest=sinonXhr.GlobalXMLHttpRequest}if(sinonXhr.supportsActiveX){global.ActiveXObject=sinonXhr.GlobalActiveXObject}delete FakeXMLHttpRequest.restore;if(!0!==keepOnCreate){delete FakeXMLHttpRequest.onCreate}};if(sinonXhr.supportsXHR){global.XMLHttpRequest=FakeXMLHttpRequest}if(sinonXhr.supportsActiveX){global.ActiveXObject=function ActiveXObject(objId){if("Microsoft.XMLHTTP"===objId||/^Msxml2\.XMLHTTP/i.test(objId)){return new FakeXMLHttpRequest}return new sinonXhr.GlobalActiveXObject(objId)}}return FakeXMLHttpRequest};sinon.FakeXMLHttpRequest=FakeXMLHttpRequest}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var sinon=require("./core");require("../extend");require("./event");require("../log_error");makeApi(sinon);module.exports=sinon}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon,"undefined"!==typeof global?global:self);(function(sinonGlobal,formatio){function makeApi(sinon){function valueFormatter(value){return""+value}function getFormatioFormatter(){var formatter=formatio.configure({quoteStrings:!1,limitChildrenCount:250});function format(){return formatter.ascii.apply(formatter,arguments)}return format}function getNodeFormatter(){try{var util=require("util")}catch(e){}function format(v){var isObjectWithNativeToString="object"===typeof v&&v.toString===Object.prototype.toString;return isObjectWithNativeToString?util.inspect(v):v}return util?format:valueFormatter}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,formatter;if(isNode){try{formatio=require("formatio")}catch(e){}}if(formatio){formatter=getFormatioFormatter()}else if(isNode){formatter=getNodeFormatter()}else{formatter=valueFormatter}sinon.format=formatter;return sinon.format}function loadDependencies(require,exports,module){var sinon=require("./util/core");module.exports=makeApi(sinon)}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon,"object"===typeof formatio&&formatio);(function(){var push=[].push;function responseArray(handler){var response=handler;if("[object Array]"!==Object.prototype.toString.call(handler)){response=[200,{},handler]}if("string"!==typeof response[2]){throw new TypeError("Fake server response body should be string, but was "+typeof response[2])}return response}var wloc="undefined"!==typeof window?window.location:{},rCurrLoc=new RegExp("^"+wloc.protocol+"//"+wloc.host);function matchOne(response,reqMethod,reqUrl){var rmeth=response.method,matchMethod=!rmeth||rmeth.toLowerCase()===reqMethod.toLowerCase(),url=response.url,matchUrl=!url||url===reqUrl||"function"===typeof url.test&&url.test(reqUrl);return matchMethod&&matchUrl}function match(response,request){var requestUrl=request.url;if(!/^https?:\/\//.test(requestUrl)||rCurrLoc.test(requestUrl)){requestUrl=requestUrl.replace(rCurrLoc,"")}if(matchOne(response,this.getHTTPMethod(request),requestUrl)){if("function"===typeof response.response){var ru=response.url,args=[request].concat(ru&&"function"===typeof ru.exec?ru.exec(requestUrl).slice(1):[]);return response.response.apply(response,args)}return!0}return!1}function makeApi(sinon){sinon.fakeServer={create:function(config){var server=sinon.create(this);server.configure(config);if(!sinon.xhr.supportsCORS){this.xhr=sinon.useFakeXDomainRequest()}else{this.xhr=sinon.useFakeXMLHttpRequest()}server.requests=[];this.xhr.onCreate=function(xhrObj){server.addRequest(xhrObj)};return server},configure:function(config){var whitelist={autoRespond:!0,autoRespondAfter:!0,respondImmediately:!0,fakeHTTPMethods:!0},setting;config=config||{};for(setting in config){if(whitelist.hasOwnProperty(setting)&&config.hasOwnProperty(setting)){this[setting]=config[setting]}}},addRequest:function addRequest(xhrObj){var server=this;push.call(this.requests,xhrObj);xhrObj.onSend=function(){server.handleRequest(this);if(server.respondImmediately){server.respond()}else if(server.autoRespond&&!server.responding){setTimeout(function(){server.responding=!1;server.respond()},server.autoRespondAfter||10);server.responding=!0}}},getHTTPMethod:function getHTTPMethod(request){if(this.fakeHTTPMethods&&/post/i.test(request.method)){var matches=(request.requestBody||"").match(/_method=([^\b;]+)/);return matches?matches[1]:request.method}return request.method},handleRequest:function handleRequest(xhr){if(xhr.async){if(!this.queue){this.queue=[]}push.call(this.queue,xhr)}else{this.processRequest(xhr)}},log:function log(response,request){var str;str="Request:\n"+sinon.format(request)+"\n\n";str+="Response:\n"+sinon.format(response)+"\n\n";sinon.log(str)},respondWith:function respondWith(method,url,body){if(1===arguments.length&&"function"!==typeof method){this.response=responseArray(method);return}if(!this.responses){this.responses=[]}if(1===arguments.length){body=method;url=method=null}if(2===arguments.length){body=url;url=method;method=null}push.call(this.responses,{method:method,url:url,response:"function"===typeof body?body:responseArray(body)})},respond:function respond(){if(0<arguments.length){this.respondWith.apply(this,arguments)}for(var queue=this.queue||[],requests=queue.splice(0,queue.length),i=0;i<requests.length;i++){this.processRequest(requests[i])}},processRequest:function processRequest(request){try{if(request.aborted){return}var response=this.response||[404,{},""];if(this.responses){for(var l=this.responses.length,i=l-1;0<=i;i--){if(match.call(this,this.responses[i],request)){response=this.responses[i].response;break}}}if(4!==request.readyState){this.log(response,request);request.respond(response[0],response[1],response[2])}}catch(e){sinon.logError("Fake server request processing",e)}},restore:function restore(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)}}}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var sinon=require("./core");require("./fake_xdomain_request");require("./fake_xml_http_request");require("../format");makeApi(sinon);module.exports=sinon}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require,module.exports,module)}else{makeApi(sinon)}})();(function(){function makeApi(s,lol){var llx="undefined"!==typeof lolex?lolex:lol;s.useFakeTimers=function(){var now,methods=Array.prototype.slice.call(arguments);if("string"===typeof methods[0]){now=0}else{now=methods.shift()}var clock=llx.install(now||0,methods);clock.restore=clock.uninstall;return clock};s.clock={create:function(now){return llx.createClock(now)}};s.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setImmediate:"undefined"!==typeof setImmediate?setImmediate:void 0,clearImmediate:"undefined"!==typeof clearImmediate?clearImmediate:void 0,setInterval:setInterval,clearInterval:clearInterval,Date:Date}}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,epxorts,module,lolex){var core=require("./core");makeApi(core,lolex);module.exports=core}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require,module.exports,module,require("lolex"))}else{makeApi(sinon)}})();(function(){function makeApi(sinon){function Server(){}Server.prototype=sinon.fakeServer;sinon.fakeServerWithClock=new Server;sinon.fakeServerWithClock.addRequest=function addRequest(xhr){var _Mathmax=Math.max;if(xhr.async){if("object"===typeof setTimeout.clock){this.clock=setTimeout.clock}else{this.clock=sinon.useFakeTimers();this.resetClock=!0}if(!this.longestTimeout){var clockSetTimeout=this.clock.setTimeout,clockSetInterval=this.clock.setInterval,server=this;this.clock.setTimeout=function(fn,timeout){server.longestTimeout=_Mathmax(timeout,server.longestTimeout||0);return clockSetTimeout.apply(this,arguments)};this.clock.setInterval=function(fn,timeout){server.longestTimeout=_Mathmax(timeout,server.longestTimeout||0);return clockSetInterval.apply(this,arguments)}}}return sinon.fakeServer.addRequest.call(this,xhr)};sinon.fakeServerWithClock.respond=function respond(){var returnVal=sinon.fakeServer.respond.apply(this,arguments);if(this.clock){this.clock.tick(this.longestTimeout||0);this.longestTimeout=0;if(this.resetClock){this.clock.restore();this.resetClock=!1}}return returnVal};sinon.fakeServerWithClock.restore=function restore(){if(this.clock){this.clock.restore()}return sinon.fakeServer.restore.apply(this,arguments)}}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require){var sinon=require("./core");require("./fake_server");require("./fake_timers");makeApi(sinon)}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require)}else{makeApi(sinon)}})();