(function(sinonGlobal){"use strict";function makeApi(sinon){function stub(object,property,func){if(!!func&&"function"!==typeof func&&"object"!==typeof func){throw new TypeError("Custom stub should be a function or a property descriptor")}var wrapper;if(func){if("function"===typeof func){wrapper=sinon.spy&&sinon.spy.create?sinon.spy.create(func):func}else{wrapper=func;if(sinon.spy&&sinon.spy.create){for(var types=sinon.objectKeys(wrapper),i=0;i<types.length;i++){wrapper[types[i]]=sinon.spy.create(wrapper[types[i]])}}}}else{var stubLength=0;if("object"===typeof object&&"function"===typeof object[property]){stubLength=object[property].length}wrapper=stub.create(stubLength)}if(!object&&"undefined"===typeof property){return sinon.stub.create()}if("undefined"===typeof property&&"object"===typeof object){sinon.walk(object||{},function(value,prop,propOwner){if(propOwner!==Object.prototype&&"constructor"!==prop&&"function"===typeof sinon.getPropertyDescriptor(propOwner,prop).value){stub(object,prop)}});return object}return sinon.wrapMethod(object,property,wrapper)}function getParentBehaviour(stubInstance){return stubInstance.parent&&getCurrentBehavior(stubInstance.parent)}function getDefaultBehavior(stubInstance){return stubInstance.defaultBehavior||getParentBehaviour(stubInstance)||sinon.behavior.create(stubInstance)}function getCurrentBehavior(stubInstance){var behavior=stubInstance.behaviors[stubInstance.callCount-1];return behavior&&behavior.isPresent()?behavior:getDefaultBehavior(stubInstance)}var uuid=0,proto={create:function create(stubLength){var functionStub=function(){return getCurrentBehavior(functionStub).invoke(this,arguments)};functionStub.id="stub#"+uuid++;var orig=functionStub;functionStub=sinon.spy.create(functionStub,stubLength);functionStub.func=orig;sinon.extend(functionStub,stub);functionStub.instantiateFake=sinon.stub.create;functionStub.displayName="stub";functionStub.toString=sinon.functionToString;functionStub.defaultBehavior=null;functionStub.behaviors=[];return functionStub},resetBehavior:function(){var i;this.defaultBehavior=null;this.behaviors=[];delete this.returnValue;delete this.returnArgAt;this.returnThis=!1;if(this.fakes){for(i=0;i<this.fakes.length;i++){this.fakes[i].resetBehavior()}}},onCall:function onCall(index){if(!this.behaviors[index]){this.behaviors[index]=sinon.behavior.create(this)}return this.behaviors[index]},onFirstCall:function onFirstCall(){return this.onCall(0)},onSecondCall:function onSecondCall(){return this.onCall(1)},onThirdCall:function onThirdCall(){return this.onCall(2)}};function createBehavior(behaviorMethod){return function(){this.defaultBehavior=this.defaultBehavior||sinon.behavior.create(this);this.defaultBehavior[behaviorMethod].apply(this.defaultBehavior,arguments);return this}}for(var method in sinon.behavior){if(sinon.behavior.hasOwnProperty(method)&&!proto.hasOwnProperty(method)&&"create"!==method&&"withArgs"!==method&&"invoke"!==method){proto[method]=createBehavior(method)}}sinon.extend(stub,proto);sinon.stub=stub;return stub}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var core=require("./util/core");require("./behavior");require("./spy");require("./extend");module.exports=makeApi(core)}if(isAMD){define(loadDependencies);return}if(isNode){loadDependencies(require,module.exports,module);return}if(sinonGlobal){makeApi(sinonGlobal)}})("object"===typeof sinon&&sinon);