(function(){"use strict";function makeApi(sinon){function Server(){}Server.prototype=sinon.fakeServer;sinon.fakeServerWithClock=new Server;sinon.fakeServerWithClock.addRequest=function addRequest(xhr){var _Mathmax=Math.max;if(xhr.async){if("object"===typeof setTimeout.clock){this.clock=setTimeout.clock}else{this.clock=sinon.useFakeTimers();this.resetClock=!0}if(!this.longestTimeout){var clockSetTimeout=this.clock.setTimeout,clockSetInterval=this.clock.setInterval,server=this;this.clock.setTimeout=function(fn,timeout){server.longestTimeout=_Mathmax(timeout,server.longestTimeout||0);return clockSetTimeout.apply(this,arguments)};this.clock.setInterval=function(fn,timeout){server.longestTimeout=_Mathmax(timeout,server.longestTimeout||0);return clockSetInterval.apply(this,arguments)}}}return sinon.fakeServer.addRequest.call(this,xhr)};sinon.fakeServerWithClock.respond=function respond(){var returnVal=sinon.fakeServer.respond.apply(this,arguments);if(this.clock){this.clock.tick(this.longestTimeout||0);this.longestTimeout=0;if(this.resetClock){this.clock.restore();this.resetClock=!1}}return returnVal};sinon.fakeServerWithClock.restore=function restore(){if(this.clock){this.clock.restore()}return sinon.fakeServer.restore.apply(this,arguments)}}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require){var sinon=require("./core");require("./fake_server");require("./fake_timers");makeApi(sinon)}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require)}else{makeApi(sinon)}})();