function getGlobal(){"use strict";return"undefined"!==typeof window?window:global}if("undefined"===typeof sinon){if("undefined"===typeof this){getGlobal().sinon={}}else{this.sinon={}}}(function(global){"use strict";var xdr={XDomainRequest:global.XDomainRequest,GlobalXDomainRequest:global.XDomainRequest};xdr.supportsXDR="undefined"!==typeof xdr.GlobalXDomainRequest;xdr.workingXDR=xdr.supportsXDR?xdr.GlobalXDomainRequest:!1;function makeApi(sinon){sinon.xdr=xdr;function FakeXDomainRequest(){this.readyState=FakeXDomainRequest.UNSENT;this.requestBody=null;this.requestHeaders={};this.status=0;this.timeout=null;if("function"===typeof FakeXDomainRequest.onCreate){FakeXDomainRequest.onCreate(this)}}function verifyState(x){if(x.readyState!==FakeXDomainRequest.OPENED){throw new Error("INVALID_STATE_ERR")}if(x.sendFlag){throw new Error("INVALID_STATE_ERR")}}function verifyRequestSent(x){if(x.readyState===FakeXDomainRequest.UNSENT){throw new Error("Request not sent")}if(x.readyState===FakeXDomainRequest.DONE){throw new Error("Request done")}}function verifyResponseBodyType(body){if("string"!==typeof body){var error=new Error("Attempted to respond to fake XDomainRequest with "+body+", which is not a string.");error.name="InvalidBodyException";throw error}}sinon.extend(FakeXDomainRequest.prototype,sinon.EventTarget,{open:function open(method,url){this.method=method;this.url=url;this.responseText=null;this.sendFlag=!1;this.readyStateChange(FakeXDomainRequest.OPENED)},readyStateChange:function readyStateChange(state){this.readyState=state;var eventName="";switch(this.readyState){case FakeXDomainRequest.UNSENT:break;case FakeXDomainRequest.OPENED:break;case FakeXDomainRequest.LOADING:if(this.sendFlag){eventName="onprogress"}break;case FakeXDomainRequest.DONE:if(this.isTimeout){eventName="ontimeout"}else if(this.errorFlag||200>this.status||299<this.status){eventName="onerror"}else{eventName="onload"}break;}if(eventName){if("function"===typeof this[eventName]){try{this[eventName]()}catch(e){sinon.logError("Fake XHR "+eventName+" handler",e)}}}},send:function send(data){verifyState(this);if(!/^(get|head)$/i.test(this.method)){this.requestBody=data}this.requestHeaders["Content-Type"]="text/plain;charset=utf-8";this.errorFlag=!1;this.sendFlag=!0;this.readyStateChange(FakeXDomainRequest.OPENED);if("function"===typeof this.onSend){this.onSend(this)}},abort:function abort(){this.aborted=!0;this.responseText=null;this.errorFlag=!0;if(this.readyState>sinon.FakeXDomainRequest.UNSENT&&this.sendFlag){this.readyStateChange(sinon.FakeXDomainRequest.DONE);this.sendFlag=!1}},setResponseBody:function setResponseBody(body){verifyRequestSent(this);verifyResponseBodyType(body);var chunkSize=this.chunkSize||10,index=0;this.responseText="";do{this.readyStateChange(FakeXDomainRequest.LOADING);this.responseText+=body.substring(index,index+chunkSize);index+=chunkSize}while(index<body.length);this.readyStateChange(FakeXDomainRequest.DONE)},respond:function respond(status,contentType,body){this.status="number"===typeof status?status:200;this.setResponseBody(body||"")},simulatetimeout:function simulatetimeout(){this.status=0;this.isTimeout=!0;this.responseText=void 0;this.readyStateChange(FakeXDomainRequest.DONE)}});sinon.extend(FakeXDomainRequest,{UNSENT:0,OPENED:1,LOADING:3,DONE:4});sinon.useFakeXDomainRequest=function useFakeXDomainRequest(){sinon.FakeXDomainRequest.restore=function restore(keepOnCreate){if(xdr.supportsXDR){global.XDomainRequest=xdr.GlobalXDomainRequest}delete sinon.FakeXDomainRequest.restore;if(!0!==keepOnCreate){delete sinon.FakeXDomainRequest.onCreate}};if(xdr.supportsXDR){global.XDomainRequest=sinon.FakeXDomainRequest}return sinon.FakeXDomainRequest};sinon.FakeXDomainRequest=FakeXDomainRequest}var isNode="undefined"!==typeof module&&module.exports&&"function"===typeof require,isAMD="function"===typeof define&&"object"===typeof define.amd&&define.amd;function loadDependencies(require,exports,module){var sinon=require("./core");require("../extend");require("./event");require("../log_error");makeApi(sinon);module.exports=sinon}if(isAMD){define(loadDependencies)}else if(isNode){loadDependencies(require,module.exports,module)}else{makeApi(sinon)}})("undefined"!==typeof global?global:self);