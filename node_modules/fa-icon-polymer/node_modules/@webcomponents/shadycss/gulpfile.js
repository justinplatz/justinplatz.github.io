'use strict';const gulp=require("gulp"),sourcemaps=require("gulp-sourcemaps"),del=require("del"),rename=require("gulp-rename"),rollup=require("rollup-stream"),buffer=require("vinyl-buffer"),source=require("vinyl-source-stream"),closure=require("google-closure-compiler").gulp(),size=require("gulp-size"),runseq=require("run-sequence"),modules=["css-parse","custom-style-element","make-element","svg-in-shadow","style-util","style-transformer","style-settings"],moduleTasks=modules.map(m=>{gulp.task(`test-module-${m}`,()=>{return rollup({entry:`tests/module/${m}.js`,format:"iife",moduleName:m.replace(/-/g,"_")}).pipe(source(`${m}.js`,"tests/module")).pipe(gulp.dest("./tests/module/generated"))});return`test-module-${m}`});gulp.task("clean-test-modules",()=>del(["tests/module/generated"]));gulp.task("test-modules",cb=>{runseq("clean-test-modules",moduleTasks,cb)});function closurify(entry){gulp.task(`closure-${entry}`,()=>{return gulp.src(["src/*.js","entrypoints/*.js"],{base:"./"}).pipe(sourcemaps.init()).pipe(closure({new_type_inf:!0,compilation_level:"ADVANCED",language_in:"ES6_STRICT",language_out:"ES5_STRICT",isolation_mode:"IIFE",assume_function_wrapper:!0,js_output_file:`${entry}.min.js`,entry_point:`./entrypoints/${entry}.js`,dependency_mode:"STRICT",warning_level:"VERBOSE",rewrite_polyfills:!1,externs:"externs/shadycss-externs.js"})).pipe(size({showFiles:!0,showTotal:!1,gzip:!0})).pipe(sourcemaps.write(".")).pipe(gulp.dest("."))});return`closure-${entry}`}function debugify(entry){gulp.task(`debug-${entry}`,()=>{return rollup({entry:`entrypoints/${entry}.js`,format:"iife",moduleName:`${entry}`.replace(/-/g,"_")}).pipe(source(`${entry}.js`,"entrypoints")).pipe(buffer()).pipe(sourcemaps.init({loadMaps:!0})).pipe(rename(`${entry}.min.js`)).pipe(size({showFiles:!0,showTotal:!1,gzip:!0})).pipe(gulp.dest("./"))});return`debug-${entry}`}const entrypoints=["scoping-shim","apply-shim","custom-style-interface"];let closureTasks=entrypoints.map(e=>closurify(e)),debugTasks=entrypoints.map(e=>debugify(e));gulp.task("default",["closure","test-modules"]);gulp.task("closure",cb=>{runseq.apply(null,closureTasks.concat(cb))});gulp.task("debug",debugTasks);