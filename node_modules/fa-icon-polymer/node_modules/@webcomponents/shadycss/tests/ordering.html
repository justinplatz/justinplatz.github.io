<!DOCTYPE html><html><head><script>WCT={waitFor(cb){addEventListener("DOMContentLoaded",cb)}};</script><script src="test-flags.js"></script><script src="../../web-component-tester/browser.js"></script><script src="../../webcomponents-platform/webcomponents-platform.js"></script><script src="../../es6-promise/dist/es6-promise.auto.min.js"></script><script src="../../template/template.js"></script><script src="../../html-imports/html-imports.min.js"></script><script src="../../shadydom/shadydom.min.js"></script><script src="../../custom-elements/custom-elements.min.js"></script><script src="module/generated/make-element.js"></script></head><body><custom-style><style>html{--coloring:{color:rgb(0, 0, 255);background-color:rgb(255, 0, 0);};}</style></custom-style><custom-style><style>html{--border:2px solid black;}</style></custom-style><template id="x-inner"><style>:host{@apply --inner;@apply --coloring;}</style><slot></slot></template><template id="x-element"><style>:host{display:block;border:var(--border);@apply --coloring;}x-inner{--inner:{border:10px solid black;};}</style><div>What color?</div><x-inner>Inner</x-inner></template><template id="x-early"><style>:host{display:block;background:rgb(123, 123, 123);color:rgb(255, 165, 0);border:var(--border, 10px dotted blue);@apply --coloring;}</style><div>Early!</div></template><x-early></x-early><script>function loadScript(src){console.log(`loading ${src}`);let script=document.createElement("script");script.src=src;let p=new Promise((resolve,reject)=>{script.onload=()=>{console.log(`loaded ${src}`);resolve()};script.onerror=()=>{console.error(`error ${src}`);reject()}});document.head.appendChild(script);return p}function registerEarly(){makeElement("x-early")}function loadScopingShim(){return loadScript("../scoping-shim.min.js")}function loadCustomStyle(){return loadScript("../custom-style-interface.min.js").then(()=>{return loadScript("module/generated/custom-style-element.js")})}function loadApplyShim(){return loadScript("../apply-shim.min.js")}function register(){makeElement("x-inner");makeElement("x-element")}function assertComputed(element,property,expected){let value=(getComputedStyle(element).getPropertyValue(property)||"").trim();assert.equal(expected,value,`${property} on ${element.localName} incorrect`)}function chain(arr){let out=Promise.resolve();for(let i=0;i<arr.length;i++){out=out.then(arr[i])}return out}let orderSteps={scoping:loadScopingShim,early:registerEarly,apply:loadApplyShim,custom:loadCustomStyle};suite("Dynamic ordering of components",()=>{let flags=window.WebComponents.flags,order=decodeURIComponent(flags.order||"scoping,apply,custom").split(","),steps=chain(order.map(o=>orderSteps[o])),otherFlags=`${flags.ce?"ce":""} ${flags.shadydom?"shadydom":""} ${flags.shimcssproperties?"shimcssproperties":""}`,needsScopingShim=window.ShadyDOM&&window.ShadyDOM.inUse||flags.shimcssproperties;test(`${order.join(", ")} with ${otherFlags}`,function(){console.log(order,flags);if(-1===order.indexOf("scoping")&&needsScopingShim){this.skip()}return steps.then(register).then(()=>{let el=document.createElement("x-element");document.body.appendChild(el);assertComputed(el,"background-color","rgb(255, 0, 0)");assertComputed(el,"border-top-width","2px");assertComputed(el.shadowRoot.querySelector("div"),"color","rgb(0, 0, 255)");assertComputed(el.shadowRoot.querySelector("x-inner"),"border-top-width","10px")})})});</script></body></html>