module("AuditConfiguration",{setup:function(){this.auditRules_=axs.AuditRules.getRules().filter(function(auditRule){return!auditRule.requiresConsoleAPI}).map(function(auditRule){return auditRule.name})}});test("Basic AuditConfiguration with no customisation",function(){var fixtures=document.getElementById("qunit-fixture"),auditConfig=new axs.AuditConfiguration;auditConfig.scope=fixtures;auditConfig.walkDom=!1;var results=axs.Audit.run(auditConfig);equal(this.auditRules_.length,results.length);for(var sortedAuditRules=this.auditRules_.sort(),sortedResults=results.sort(function(r1,r2){var r1Name=r1.rule.name,r2Name=r2.rule.name;return r1Name.localeCompare(r2Name)}),i=0;i<sortedAuditRules.length;i++)equal(sortedAuditRules[i],sortedResults[i].rule.name)});test("Configure severity of an audit rule",function(){var fixtures=document.getElementById("qunit-fixture"),div=document.createElement("div");div.setAttribute("role","not-an-aria-role");fixtures.appendChild(div);var auditConfig=new axs.AuditConfiguration;auditConfig.scope=fixtures;auditConfig.walkDom=!1;auditConfig.setSeverity("badAriaRole",axs.constants.Severity.WARNING);for(var results=axs.Audit.run(auditConfig),i=0;i<results.length;i++){if("badAriaRole"!=results[i].rule.name)continue;var result=results[i];equal(result.rule.severity,axs.constants.Severity.WARNING);notEqual(result.rule.severity,axs.AuditRules.getRule("badAriaRole").severity);return}});test("Specify configuration as an object",function(){var fixtures=document.getElementById("qunit-fixture"),configPayload={auditRulesToRun:["badAriaRole"],scope:fixtures,maxResults:1},auditConfig=new axs.AuditConfiguration(configPayload);for(var k in configPayload){equal(auditConfig[k],configPayload[k])}});test("Configure the number of results returned",function(){var fixture=document.getElementById("qunit-fixture"),div=document.createElement("div");div.setAttribute("role","not-an-aria-role");fixture.appendChild(div);var div2=document.createElement("div");div2.setAttribute("role","also-not-an-aria-role");fixture.appendChild(div2);var auditConfig=new axs.AuditConfiguration;auditConfig.auditRulesToRun=["badAriaRole"];auditConfig.scope=fixture;auditConfig.walkDom=!1;var results=axs.Audit.run(auditConfig);equal(results.length,1);equal(results[0].elements.length,2);auditConfig.maxResults=1;results=axs.Audit.run(auditConfig);equal(results.length,1);equal(results[0].elements.length,1)});test("Configure audit rules to ignore",function(){var fixture=document.getElementById("qunit-fixture"),div=document.createElement("div");div.setAttribute("role","not-an-aria-role");fixture.appendChild(div);var auditConfig=new axs.AuditConfiguration;auditConfig.scope=fixture;auditConfig.walkDom=!1;var results=axs.Audit.run(auditConfig);equal(!0,results.some(function(result){return"badAriaRole"==result.rule.name&&"FAIL"==result.result}));auditConfig.auditRulesToIgnore=["badAriaRole"];var results=axs.Audit.run(auditConfig);equal(!1,results.some(function(result){return"badAriaRole"==result.rule.name}))});var __warnings=[];console.warn=function(msg){__warnings.push(msg)};test("Unsupported Rules Warning shown first and only first time audit ran",function(){var auditConfig=new axs.AuditConfiguration;auditConfig.walkDom=!1;axs.Audit.unsupportedRulesWarningShown=!1;__warnings=[];axs.Audit.run(auditConfig);equal(2,__warnings.length);axs.Audit.run(auditConfig);equal(2,__warnings.length)});test("Unsupported Rules Warning not shown if showUnsupportedRulesWarning set to false on configuration",function(){var auditConfig=new axs.AuditConfiguration;auditConfig.showUnsupportedRulesWarning=!1;axs.Audit.unsupportedRulesWarningShown=!1;auditConfig.walkDom=!1;__warnings=[];axs.Audit.run(auditConfig);equal(0,__warnings.length);axs.Audit.run(auditConfig);equal(0,__warnings.length)});test("Unsupported Rules Warning not shown if with console API on configuration set",function(){var auditConfig=new axs.AuditConfiguration;auditConfig.walkDom=!1;auditConfig.withConsoleApi=!0;axs.Audit.unsupportedRulesWarningShown=!1;__warnings=[];getEventListeners=function(){return{click:function(){}}};axs.Audit.run(auditConfig);equal(0,__warnings.length);axs.Audit.run(auditConfig);equal(0,__warnings.length)});test("Configure LinkWithUnclearPurpose: blacklist phrase",function(){var fixture=document.getElementById("qunit-fixture"),a=document.createElement("a");a.href="#main";a.textContent="Generic text.";fixture.appendChild(a);var auditConfig=new axs.AuditConfiguration;auditConfig.scope=fixture;auditConfig.walkDom=!1;var results=axs.Audit.run(auditConfig);equal(results.some(function(result){return"linkWithUnclearPurpose"==result.rule.name&&"PASS"==result.result}),!0,"Before configuration, \"Generic text.\" is acceptable.");a.textContent="Click here.";var results=axs.Audit.run(auditConfig);equal(results.some(function(result){return"linkWithUnclearPurpose"==result.rule.name&&"FAIL"==result.result}),!0,"\"Click here.\" should be blocked before configuration");auditConfig.setRuleConfig("linkWithUnclearPurpose",{blacklistPhrases:["generic text"]});a.textContent="Generic text.";var results=axs.Audit.run(auditConfig);equal(results.some(function(result){return"linkWithUnclearPurpose"==result.rule.name&&"FAIL"==result.result}),!0,"\"Generic text.\" matches blacklist phrase and should fail");a.textContent="Phrase containing generic text";var results=axs.Audit.run(auditConfig);equal(results.some(function(result){return"linkWithUnclearPurpose"==result.rule.name&&"PASS"==result.result}),!0,"\"Phrase containing generic text\" should pass");a.textContent="Generic generic text";var results=axs.Audit.run(auditConfig);equal(results.some(function(result){return"linkWithUnclearPurpose"==result.rule.name&&"PASS"==result.result}),!0,"\"Generic generic text\" does not match blacklist phrase and should pass");a.textContent="Click here.";var results=axs.Audit.run(auditConfig);equal(results.some(function(result){return"linkWithUnclearPurpose"==result.rule.name&&"FAIL"==result.result}),!0,"\"Click here\" should still be blocked.")});test("Configure LinkWithUnclearPurpose: stopwords",function(){var fixture=document.getElementById("qunit-fixture"),a=document.createElement("a");a.href="#main";a.textContent="Generic text.";fixture.appendChild(a);var auditConfig=new axs.AuditConfiguration;auditConfig.scope=fixture;auditConfig.walkDom=!1;var results=axs.Audit.run(auditConfig);equal(results.some(function(result){return"linkWithUnclearPurpose"==result.rule.name&&"PASS"==result.result}),!0,"Before configuration, \"Generic text.\" is acceptable.");a.textContent="Click here.";var results=axs.Audit.run(auditConfig);equal(results.some(function(result){return"linkWithUnclearPurpose"==result.rule.name&&"FAIL"==result.result}),!0,"Before configuration, \"Click here.\" is blocked by stop words.");auditConfig.setRuleConfig("linkWithUnclearPurpose",{stopwords:["generic","text"]});a.textContent="Generic text.";var results=axs.Audit.run(auditConfig);equal(results.some(function(result){return"linkWithUnclearPurpose"==result.rule.name&&"FAIL"==result.result}),!0,"\"Generic text.\" should be blocked by stopwords.");a.textContent="Phrase containing generic text";var results=axs.Audit.run(auditConfig);equal(results.some(function(result){return"linkWithUnclearPurpose"==result.rule.name&&"PASS"==result.result}),!0,"\"Phrase containing generic text\" should not be blocked.");a.textContent="Generic generic text";var results=axs.Audit.run(auditConfig);equal(results.some(function(result){return"linkWithUnclearPurpose"==result.rule.name&&"FAIL"==result.result}),!0,"\"Generic generic text\" should be blocked.");a.textContent="Click here.";var results=axs.Audit.run(auditConfig);equal(results.some(function(result){return"linkWithUnclearPurpose"==result.rule.name&&"PASS"==result.result}),!0,"\"Click here\" should no longer be blocked.")});