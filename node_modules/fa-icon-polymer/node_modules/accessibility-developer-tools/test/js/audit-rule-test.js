(function(){module("collectMatchingElements",{setup:function(){dummyRule=new axs.AuditRule({name:"badFishingHole",heading:"Tests if this is a good place to go fishing",url:"http://www.example.com/troutfishing",severity:axs.constants.Severity.SEVERE,relevantElementMatcher:function(element){var tagName=element.tagName;if(!tagName)return!1;return"div"===tagName.toLowerCase()&&element.classList.contains("test")},test:function(element){return!1},code:"AX_TROUT_01"});dummyConfig=new axs.AuditConfiguration}});var dummyRule,dummyConfig,DIV_COUNT=10;function buildTestDom(){var result=document.createDocumentFragment();result=result.appendChild(document.createElement("div"));for(var i=0,element;i<DIV_COUNT;i++){element=document.createElement("div");element.className="test";element.id="test-"+i;result.appendChild(element)}return result}test("Simple DOM",function(){var container=document.getElementById("qunit-fixture");container.appendChild(buildTestDom());dummyConfig.scope=container;axs.Audit.collectMatchingElements(dummyConfig,[dummyRule]);equal(dummyRule.relevantElements.length,DIV_COUNT)});test("Simple DOM with an ignored selector",function(){var container=document.getElementById("qunit-fixture");container.appendChild(buildTestDom());var fooElement=document.createElement("div");fooElement.className="foo";container.appendChild(fooElement);var fooTest=document.createElement("div");fooTest.className="test";fooElement.appendChild(fooTest);dummyConfig.scope=container;dummyConfig.getIgnoreSelectors=function(){return[".foo"]};axs.Audit.collectMatchingElements(dummyConfig,[dummyRule]);equal(dummyRule.relevantElements.length,DIV_COUNT)});test("With shadow DOM with no content insertion point",function(){var container=document.getElementById("qunit-fixture");container.appendChild(buildTestDom());var wrapper=container.firstElementChild;if(wrapper.createShadowRoot){wrapper.createShadowRoot();dummyConfig.scope=container;axs.Audit.collectMatchingElements(dummyConfig,[dummyRule]);equal(dummyRule.relevantElements.length,0)}else{console.warn("Test platform does not support shadow DOM");ok(!0)}});test("With shadow DOM with content element",function(){var container=document.getElementById("qunit-fixture");container.appendChild(buildTestDom());var wrapper=container.firstElementChild;if(wrapper.createShadowRoot){var root=wrapper.createShadowRoot(),content=document.createElement("content");root.appendChild(content);dummyConfig.scope=container;axs.Audit.collectMatchingElements(dummyConfig,[dummyRule]);equal(dummyRule.relevantElements.length,DIV_COUNT)}else{console.warn("Test platform does not support shadow DOM");ok(!0)}});test("Nodes within shadow DOM",function(){var container=document.getElementById("qunit-fixture"),wrapper=container.appendChild(document.createElement("div"));if(wrapper.createShadowRoot){var root=wrapper.createShadowRoot();root.appendChild(buildTestDom());dummyConfig.scope=container;axs.Audit.collectMatchingElements(dummyConfig,[dummyRule]);equal(dummyRule.relevantElements.length,DIV_COUNT)}else{console.warn("Test platform does not support shadow DOM");ok(!0)}});test("Nodes within DOM and shadow DOM - no content distribution point",function(){var container=document.getElementById("qunit-fixture"),wrapper=container.appendChild(document.createElement("div"));if(wrapper.createShadowRoot){var root=wrapper.createShadowRoot(),rootContent=document.createElement("div");rootContent.className="test";root.appendChild(rootContent);wrapper.appendChild(buildTestDom());dummyConfig.scope=container;axs.Audit.collectMatchingElements(dummyConfig,[dummyRule]);equal(dummyRule.relevantElements.length,1)}else{console.warn("Test platform does not support shadow DOM");ok(!0)}});test("Nodes within DOM and shadow DOM with content element",function(){var container=document.getElementById("qunit-fixture"),wrapper=container.appendChild(document.createElement("div"));wrapper.appendChild(buildTestDom());if(wrapper.createShadowRoot){var root=wrapper.createShadowRoot(),rootContent=document.createElement("div");rootContent.className="test";root.appendChild(rootContent);var content=document.createElement("content");root.appendChild(content);dummyConfig.scope=container;axs.Audit.collectMatchingElements(dummyConfig,[dummyRule]);equal(dummyRule.relevantElements.length,DIV_COUNT+1)}else{console.warn("Test platform does not support shadow DOM");ok(!0)}})})();