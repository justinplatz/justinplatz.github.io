goog.provide("goog.ui.MenuTest");goog.setTestOnly("goog.ui.MenuTest");goog.require("goog.dom");goog.require("goog.events");goog.require("goog.math.Coordinate");goog.require("goog.testing.events");goog.require("goog.testing.jsunit");goog.require("goog.ui.Component");goog.require("goog.ui.Menu");var menu,clonedMenuDom;function setUp(){clonedMenuDom=goog.dom.getElement("demoMenu").cloneNode(!0);menu=new goog.ui.Menu}function tearDown(){menu.dispose();var element=goog.dom.getElement("demoMenu");element.parentNode.replaceChild(clonedMenuDom,element)}function testMouseupDoesntActivateMenuItemImmediately(){menu.decorate(goog.dom.getElement("demoMenu"));var fakeEvent={clientX:42,clientY:42},itemElem=goog.dom.getElement("menuItem2"),coords=new goog.math.Coordinate(42,42),menuItem=menu.getChildAt(1),actionDispatched=!1;goog.events.listen(menuItem,goog.ui.Component.EventType.ACTION,function(e){actionDispatched=!0});menu.setVisible(!0,!1,fakeEvent);menuItem.setActive(!0);goog.testing.events.fireMouseUpEvent(itemElem,void 0,coords);assertFalse("ACTION should not be dispatched after the initial mouseup",actionDispatched);goog.testing.events.fireMouseUpEvent(itemElem,void 0,coords);assertTrue("ACTION should be dispatched after the second mouseup",actionDispatched)}function testHoverBehavior(){menu.decorate(goog.dom.getElement("demoMenu"));goog.testing.events.fireMouseOverEvent(goog.dom.getElement("menuItem2"),document.body);assertEquals(1,menu.getHighlightedIndex());menu.exitDocument();assertEquals(-1,menu.getHighlightedIndex())}function testIndirectionDecoration(){menu.decorate(goog.dom.getElement("complexMenu"));goog.testing.events.fireMouseOverEvent(goog.dom.getElement("complexItem3"),document.body);assertEquals(2,menu.getHighlightedIndex());menu.exitDocument();assertEquals(-1,menu.getHighlightedIndex())}function testSetHighlightedIndex(){menu.decorate(goog.dom.getElement("scrollableMenu"));assertEquals(0,menu.getElement().scrollTop);var element=goog.dom.getElement("scrollableMenuItem4");menu.setHighlightedIndex(3);assertTrue(element.offsetTop>=menu.getElement().scrollTop);assertTrue(element.offsetTop<=menu.getElement().scrollTop+menu.getElement().offsetHeight);element=goog.dom.getElement("scrollableMenuItem3");menu.setHighlightedIndex(2);assertTrue(element.offsetTop>=menu.getElement().scrollTop);assertTrue(element.offsetTop<=menu.getElement().scrollTop+menu.getElement().offsetHeight);menu.exitDocument();assertEquals(-1,menu.getHighlightedIndex())}