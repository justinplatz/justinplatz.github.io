goog.provide("goog.ui.SliderBaseTest");goog.setTestOnly("goog.ui.SliderBaseTest");goog.require("goog.a11y.aria");goog.require("goog.a11y.aria.State");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.dom.classlist");goog.require("goog.events");goog.require("goog.events.EventType");goog.require("goog.events.KeyCodes");goog.require("goog.fx.Animation");goog.require("goog.math.Coordinate");goog.require("goog.style");goog.require("goog.style.bidi");goog.require("goog.testing.MockClock");goog.require("goog.testing.MockControl");goog.require("goog.testing.events");goog.require("goog.testing.jsunit");goog.require("goog.testing.mockmatchers");goog.require("goog.testing.recordFunction");goog.require("goog.ui.Component");goog.require("goog.ui.SliderBase");goog.require("goog.userAgent");var oneThumbSlider,oneThumbSliderRtl,oneChangeEventCount,twoThumbSlider,twoThumbSliderRtl,twoChangeEventCount,mockClock,mockAnimation;function OneThumbSlider(){goog.ui.SliderBase.call(this,void 0,function(value){return 5<value?"A big value.":"A small value."})}goog.inherits(OneThumbSlider,goog.ui.SliderBase);OneThumbSlider.prototype.createThumbs=function(){this.valueThumb=this.extentThumb=goog.dom.getElement("thumb")};OneThumbSlider.prototype.getCssClass=function(orientation){return goog.getCssName("test-slider",orientation)};function TwoThumbSlider(){goog.ui.SliderBase.call(this)}goog.inherits(TwoThumbSlider,goog.ui.SliderBase);TwoThumbSlider.prototype.createThumbs=function(){this.valueThumb=goog.dom.getElement("valueThumb");this.extentThumb=goog.dom.getElement("extentThumb");this.rangeHighlight=goog.dom.getElement("rangeHighlight")};TwoThumbSlider.prototype.getCssClass=function(orientation){return goog.getCssName("test-slider",orientation)};function AnimationFactory(testAnimations){this.testAnimations=testAnimations}AnimationFactory.prototype.createAnimations=function(){return this.testAnimations};function setUp(){var sandBox=goog.dom.getElement("sandbox");mockClock=new goog.testing.MockClock(!0);var oneThumbElem=goog.dom.createDom(goog.dom.TagName.DIV,{id:"oneThumbSlider"},goog.dom.createDom(goog.dom.TagName.SPAN,{id:"thumb"}));sandBox.appendChild(oneThumbElem);oneThumbSlider=new OneThumbSlider;oneThumbSlider.decorate(oneThumbElem);oneChangeEventCount=0;goog.events.listen(oneThumbSlider,goog.ui.Component.EventType.CHANGE,function(){oneChangeEventCount++});var twoThumbElem=goog.dom.createDom(goog.dom.TagName.DIV,{id:"twoThumbSlider"},goog.dom.createDom(goog.dom.TagName.DIV,{id:"rangeHighlight"}),goog.dom.createDom(goog.dom.TagName.SPAN,{id:"valueThumb"}),goog.dom.createDom(goog.dom.TagName.SPAN,{id:"extentThumb"}));sandBox.appendChild(twoThumbElem);twoThumbSlider=new TwoThumbSlider;twoThumbSlider.decorate(twoThumbElem);twoChangeEventCount=0;goog.events.listen(twoThumbSlider,goog.ui.Component.EventType.CHANGE,function(){twoChangeEventCount++});var sandBoxRtl=goog.dom.createDom(goog.dom.TagName.DIV,{dir:"rtl",style:"position:absolute;"});sandBox.appendChild(sandBoxRtl);var oneThumbElemRtl=goog.dom.createDom(goog.dom.TagName.DIV,{id:"oneThumbSliderRtl"},goog.dom.createDom(goog.dom.TagName.SPAN,{id:"thumbRtl"}));sandBoxRtl.appendChild(oneThumbElemRtl);oneThumbSliderRtl=new OneThumbSlider;oneThumbSliderRtl.enableFlipForRtl(!0);oneThumbSliderRtl.decorate(oneThumbElemRtl);goog.events.listen(oneThumbSliderRtl,goog.ui.Component.EventType.CHANGE,function(){oneChangeEventCount++});var twoThumbElemRtl=goog.dom.createDom(goog.dom.TagName.DIV,{id:"twoThumbSliderRtl"},goog.dom.createDom(goog.dom.TagName.DIV,{id:"rangeHighlightRtl"}),goog.dom.createDom(goog.dom.TagName.SPAN,{id:"valueThumbRtl"}),goog.dom.createDom(goog.dom.TagName.SPAN,{id:"extentThumbRtl"}));sandBoxRtl.appendChild(twoThumbElemRtl);twoThumbSliderRtl=new TwoThumbSlider;twoThumbSliderRtl.enableFlipForRtl(!0);twoThumbSliderRtl.decorate(twoThumbElemRtl);twoChangeEventCount=0;goog.events.listen(twoThumbSliderRtl,goog.ui.Component.EventType.CHANGE,function(){twoChangeEventCount++})}function tearDown(){oneThumbSlider.dispose();twoThumbSlider.dispose();oneThumbSliderRtl.dispose();twoThumbSliderRtl.dispose();mockClock.dispose();goog.dom.removeChildren(goog.dom.getElement("sandbox"))}function testGetAndSetValue(){oneThumbSlider.setValue(30);assertEquals(30,oneThumbSlider.getValue());assertEquals("Setting valid value must dispatch only a single change event.",1,oneChangeEventCount);oneThumbSlider.setValue(30);assertEquals(30,oneThumbSlider.getValue());assertEquals("Setting to same value must not dispatch change event.",1,oneChangeEventCount);oneThumbSlider.setValue(-30);assertEquals("Setting invalid value must not change value.",30,oneThumbSlider.getValue());assertEquals("Setting invalid value must not dispatch change event.",1,oneChangeEventCount);twoThumbSlider.setExtent(70);twoChangeEventCount=0;twoThumbSlider.setValue(60);assertEquals(60,twoThumbSlider.getValue());assertEquals("Setting valid value must dispatch only a single change event.",1,twoChangeEventCount);twoThumbSlider.setValue(60);assertEquals(60,twoThumbSlider.getValue());assertEquals("Setting to same value must not dispatch change event.",1,twoChangeEventCount);twoThumbSlider.setValue(-60);assertEquals("Setting invalid value must not change value.",60,twoThumbSlider.getValue());assertEquals("Setting invalid value must not dispatch change event.",1,twoChangeEventCount)}function testGetAndSetValueRtl(){var thumbElement=goog.dom.getElement("thumbRtl");assertEquals(0,goog.style.bidi.getOffsetStart(thumbElement));assertEquals("",thumbElement.style.left);assertTrue(0<=thumbElement.style.right);oneThumbSliderRtl.setValue(30);assertEquals(30,oneThumbSliderRtl.getValue());assertEquals("Setting valid value must dispatch only a single change event.",1,oneChangeEventCount);assertEquals("",thumbElement.style.left);assertTrue(0<=thumbElement.style.right);oneThumbSliderRtl.setValue(30);assertEquals(30,oneThumbSliderRtl.getValue());assertEquals("Setting to same value must not dispatch change event.",1,oneChangeEventCount);oneThumbSliderRtl.setValue(-30);assertEquals("Setting invalid value must not change value.",30,oneThumbSliderRtl.getValue());assertEquals("Setting invalid value must not dispatch change event.",1,oneChangeEventCount);var valueThumbElement=goog.dom.getElement("valueThumbRtl"),extentThumbElement=goog.dom.getElement("extentThumbRtl");assertEquals(0,goog.style.bidi.getOffsetStart(valueThumbElement));assertEquals(0,goog.style.bidi.getOffsetStart(extentThumbElement));assertEquals("",valueThumbElement.style.left);assertTrue(0<=valueThumbElement.style.right);assertEquals("",extentThumbElement.style.left);assertTrue(0<=extentThumbElement.style.right);twoThumbSliderRtl.setExtent(70);twoChangeEventCount=0;twoThumbSliderRtl.setValue(60);assertEquals(60,twoThumbSliderRtl.getValue());assertEquals("Setting valid value must dispatch only a single change event.",1,twoChangeEventCount);twoThumbSliderRtl.setValue(60);assertEquals(60,twoThumbSliderRtl.getValue());assertEquals("Setting to same value must not dispatch change event.",1,twoChangeEventCount);assertEquals("",valueThumbElement.style.left);assertTrue(0<=valueThumbElement.style.right);assertEquals("",extentThumbElement.style.left);assertTrue(0<=extentThumbElement.style.right);twoThumbSliderRtl.setValue(-60);assertEquals("Setting invalid value must not change value.",60,twoThumbSliderRtl.getValue());assertEquals("Setting invalid value must not dispatch change event.",1,twoChangeEventCount)}function testGetAndSetExtent(){twoThumbSlider.setExtent(7);assertEquals(7,twoThumbSlider.getExtent());assertEquals("Setting valid value must dispatch only a single change event.",1,twoChangeEventCount);twoThumbSlider.setExtent(7);assertEquals(7,twoThumbSlider.getExtent());assertEquals("Setting to same value must not dispatch change event.",1,twoChangeEventCount);twoThumbSlider.setExtent(-7);assertEquals("Setting invalid value must not change value.",7,twoThumbSlider.getExtent());assertEquals("Setting invalid value must not dispatch change event.",1,twoChangeEventCount)}function testUpdateValueExtent(){twoThumbSlider.setValueAndExtent(30,50);assertNotNull(twoThumbSlider.getElement());assertEquals("Setting value results in updating aria-valuenow","30",goog.a11y.aria.getState(twoThumbSlider.getElement(),goog.a11y.aria.State.VALUENOW));assertEquals(30,twoThumbSlider.getValue());assertEquals(50,twoThumbSlider.getExtent())}function testValueText(){oneThumbSlider.setValue(10);assertEquals("Setting value results in correct aria-valuetext","A big value.",goog.a11y.aria.getState(oneThumbSlider.getElement(),goog.a11y.aria.State.VALUETEXT));oneThumbSlider.setValue(2);assertEquals("Updating value results in updated aria-valuetext","A small value.",goog.a11y.aria.getState(oneThumbSlider.getElement(),goog.a11y.aria.State.VALUETEXT))}function testGetValueText(){oneThumbSlider.setValue(10);assertEquals("Getting the text value gets the correct description","A big value.",oneThumbSlider.getTextValue());oneThumbSlider.setValue(2);assertEquals("Getting the updated text value gets the correct updated description","A small value.",oneThumbSlider.getTextValue())}function testRangeListener(){var slider=new goog.ui.SliderBase;slider.updateUi_=slider.updateAriaStates=function(){};slider.rangeModel.setValue(0);var f=goog.testing.recordFunction();goog.events.listen(slider,goog.ui.Component.EventType.CHANGE,f);slider.rangeModel.setValue(50);assertEquals(1,f.getCallCount());slider.exitDocument();slider.rangeModel.setValue(0);assertEquals("The range model listener should not have been removed so we "+"should have gotten a second event dispatch",2,f.getCallCount())}function assertHighlightedRange(rangeHighlight,startValue,endValue){var rangeStr="["+startValue+", "+endValue+"]",rangeStart=10+10*startValue;assertEquals("Range highlight for "+rangeStr+" should start at "+rangeStart+"px.",rangeStart,rangeHighlight.offsetLeft);var rangeSize=10*(endValue-startValue);assertEquals("Range highlight for "+rangeStr+" should have size "+rangeSize+"px.",rangeSize,rangeHighlight.offsetWidth)}function testKeyHandlingTests(){twoThumbSlider.setValue(0);twoThumbSlider.setExtent(100);assertEquals(0,twoThumbSlider.getValue());assertEquals(100,twoThumbSlider.getExtent());goog.testing.events.fireKeySequence(twoThumbSlider.getElement(),goog.events.KeyCodes.RIGHT);assertEquals(1,twoThumbSlider.getValue());assertEquals(99,twoThumbSlider.getExtent());goog.testing.events.fireKeySequence(twoThumbSlider.getElement(),goog.events.KeyCodes.RIGHT);assertEquals(2,twoThumbSlider.getValue());assertEquals(98,twoThumbSlider.getExtent());goog.testing.events.fireKeySequence(twoThumbSlider.getElement(),goog.events.KeyCodes.LEFT);assertEquals(1,twoThumbSlider.getValue());assertEquals(98,twoThumbSlider.getExtent());goog.testing.events.fireKeySequence(twoThumbSlider.getElement(),goog.events.KeyCodes.LEFT);assertEquals(0,twoThumbSlider.getValue());assertEquals(98,twoThumbSlider.getExtent());goog.testing.events.fireKeySequence(twoThumbSlider.getElement(),goog.events.KeyCodes.RIGHT,{shiftKey:!0});assertEquals(10,twoThumbSlider.getValue());assertEquals(90,twoThumbSlider.getExtent());goog.testing.events.fireKeySequence(twoThumbSlider.getElement(),goog.events.KeyCodes.RIGHT,{shiftKey:!0});assertEquals(20,twoThumbSlider.getValue());assertEquals(80,twoThumbSlider.getExtent());goog.testing.events.fireKeySequence(twoThumbSlider.getElement(),goog.events.KeyCodes.LEFT,{shiftKey:!0});assertEquals(10,twoThumbSlider.getValue());assertEquals(80,twoThumbSlider.getExtent());goog.testing.events.fireKeySequence(twoThumbSlider.getElement(),goog.events.KeyCodes.LEFT,{shiftKey:!0});assertEquals(0,twoThumbSlider.getValue());assertEquals(80,twoThumbSlider.getExtent())}function testKeyHandlingLargeStepSize(){twoThumbSlider.setValue(0);twoThumbSlider.setExtent(100);twoThumbSlider.setStep(5);assertEquals(0,twoThumbSlider.getValue());assertEquals(100,twoThumbSlider.getExtent());goog.testing.events.fireKeySequence(twoThumbSlider.getElement(),goog.events.KeyCodes.RIGHT);assertEquals(5,twoThumbSlider.getValue());assertEquals(95,twoThumbSlider.getExtent());goog.testing.events.fireKeySequence(twoThumbSlider.getElement(),goog.events.KeyCodes.RIGHT);assertEquals(10,twoThumbSlider.getValue());assertEquals(90,twoThumbSlider.getExtent());goog.testing.events.fireKeySequence(twoThumbSlider.getElement(),goog.events.KeyCodes.LEFT);assertEquals(5,twoThumbSlider.getValue());assertEquals(90,twoThumbSlider.getExtent());goog.testing.events.fireKeySequence(twoThumbSlider.getElement(),goog.events.KeyCodes.LEFT);assertEquals(0,twoThumbSlider.getValue());assertEquals(90,twoThumbSlider.getExtent())}function testKeyHandlingRtl(){twoThumbSliderRtl.setValue(0);twoThumbSliderRtl.setExtent(100);assertEquals(0,twoThumbSliderRtl.getValue());assertEquals(100,twoThumbSliderRtl.getExtent());goog.testing.events.fireKeySequence(twoThumbSliderRtl.getElement(),goog.events.KeyCodes.RIGHT);assertEquals(0,twoThumbSliderRtl.getValue());assertEquals(99,twoThumbSliderRtl.getExtent());goog.testing.events.fireKeySequence(twoThumbSliderRtl.getElement(),goog.events.KeyCodes.RIGHT);assertEquals(0,twoThumbSliderRtl.getValue());assertEquals(98,twoThumbSliderRtl.getExtent());goog.testing.events.fireKeySequence(twoThumbSliderRtl.getElement(),goog.events.KeyCodes.LEFT);assertEquals(1,twoThumbSliderRtl.getValue());assertEquals(98,twoThumbSliderRtl.getExtent());goog.testing.events.fireKeySequence(twoThumbSliderRtl.getElement(),goog.events.KeyCodes.LEFT);assertEquals(2,twoThumbSliderRtl.getValue());assertEquals(98,twoThumbSliderRtl.getExtent());goog.testing.events.fireKeySequence(twoThumbSliderRtl.getElement(),goog.events.KeyCodes.RIGHT,{shiftKey:!0});assertEquals(0,twoThumbSliderRtl.getValue());assertEquals(90,twoThumbSliderRtl.getExtent());goog.testing.events.fireKeySequence(twoThumbSliderRtl.getElement(),goog.events.KeyCodes.RIGHT,{shiftKey:!0});assertEquals(0,twoThumbSliderRtl.getValue());assertEquals(80,twoThumbSliderRtl.getExtent());goog.testing.events.fireKeySequence(twoThumbSliderRtl.getElement(),goog.events.KeyCodes.LEFT,{shiftKey:!0});assertEquals(10,twoThumbSliderRtl.getValue());assertEquals(80,twoThumbSliderRtl.getExtent());goog.testing.events.fireKeySequence(twoThumbSliderRtl.getElement(),goog.events.KeyCodes.LEFT,{shiftKey:!0});assertEquals(20,twoThumbSliderRtl.getValue());assertEquals(80,twoThumbSliderRtl.getExtent())}function testRangeHighlight(){var rangeHighlight=goog.dom.getElement("rangeHighlight");twoThumbSlider.setValue(0);twoThumbSlider.setExtent(100);assertHighlightedRange(rangeHighlight,0,100);twoThumbSlider.setValue(25);twoThumbSlider.setExtent(50);assertHighlightedRange(rangeHighlight,25,75);twoThumbSlider.setValue(50);twoThumbSlider.setExtent(0);assertHighlightedRange(rangeHighlight,50,50)}function testRangeHighlightAnimation(){var animationDelay=160;if(goog.userAgent.IE){animationDelay=250}var rangeHighlight=goog.dom.getElement("rangeHighlight");twoThumbSlider.setValue(0);twoThumbSlider.setExtent(100);twoThumbSlider.animatedSetValue(75);assertHighlightedRange(rangeHighlight,0,100);mockClock.tick(animationDelay);assertHighlightedRange(rangeHighlight,0,75);twoThumbSlider.animatedSetValue(25);assertHighlightedRange(rangeHighlight,0,75);mockClock.tick(animationDelay);assertHighlightedRange(rangeHighlight,25,75)}function testRangeHighlightForZeroSizeSlider(){twoThumbSlider.setExtent(100);twoThumbSlider.getElement().style.width=0;twoThumbSlider.setVisible(!0);assertEquals("Range highlight size should be 0 when slider size is 0",0,goog.dom.getElement("rangeHighlight").offsetWidth)}function testAnimatedSetValueAnimatesFactoryCreatedAnimations(){var ignore=goog.testing.mockmatchers.ignoreArgument,mockControl=new goog.testing.MockControl,mockAnimation1=mockControl.createLooseMock(goog.fx.Animation),mockAnimation2=mockControl.createLooseMock(goog.fx.Animation),testAnimations=[mockAnimation1,mockAnimation2];oneThumbSlider.setAdditionalAnimations(new AnimationFactory(testAnimations));mockAnimation1.play(!1);mockAnimation2.play(!1);mockAnimation1.addEventListener(ignore,ignore,ignore);mockAnimation2.addEventListener(ignore,ignore,ignore);mockControl.$replayAll();oneThumbSlider.animatedSetValue(50);mockControl.$verifyAll();mockControl.$resetAll();mockControl.$tearDown()}function testMouseWheelEventHandlerEnable(){assertTrue(oneThumbSlider.isHandleMouseWheel());oneThumbSlider.setHandleMouseWheel(!1);assertFalse(oneThumbSlider.isHandleMouseWheel());oneThumbSlider.setHandleMouseWheel(!0);assertTrue(oneThumbSlider.isHandleMouseWheel());var wheelDisabledElem=goog.dom.createDom(goog.dom.TagName.DIV,{},goog.dom.createDom(goog.dom.TagName.SPAN)),wheelDisabledSlider=new OneThumbSlider;wheelDisabledSlider.setHandleMouseWheel(!1);wheelDisabledSlider.decorate(wheelDisabledElem);assertFalse(wheelDisabledSlider.isHandleMouseWheel())}function testDisabledAndEnabledSlider(){assertTrue(oneThumbSlider.isEnabled());var listenerCount=oneThumbSlider.getHandler().getListenerCount();oneThumbSlider.setEnabled(!1);assertFalse(oneThumbSlider.isEnabled());assertTrue(goog.dom.classlist.contains(oneThumbSlider.getElement(),"goog-slider-disabled"));assertEquals(0,oneThumbSlider.getHandler().getListenerCount());oneThumbSlider.setValue(30);assertEquals(30,oneThumbSlider.getValue());assertEquals("Setting valid value must dispatch a change event "+"even when slider is disabled.",1,oneChangeEventCount);oneThumbSlider.setEnabled(!0);assertTrue(oneThumbSlider.isEnabled());assertFalse(goog.dom.classlist.contains(oneThumbSlider.getElement(),"goog-slider-disabled"));assertTrue(listenerCount==oneThumbSlider.getHandler().getListenerCount())}function testBlockIncrementingWithEnableAndDisabled(){var doc=goog.dom.getOwnerDocument(oneThumbSlider.getElement());goog.testing.events.fireMouseDownEvent(oneThumbSlider.getElement());assertEquals(1,goog.events.getListeners(oneThumbSlider.getElement(),goog.events.EventType.MOUSEMOVE,!1).length);assertEquals(1,goog.events.getListeners(doc,goog.events.EventType.MOUSEUP,!0).length);goog.testing.events.fireMouseUpEvent(oneThumbSlider.getElement());assertEquals(0,goog.events.getListeners(oneThumbSlider.getElement(),goog.events.EventType.MOUSEMOVE,!1).length);assertEquals(0,goog.events.getListeners(doc,goog.events.EventType.MOUSEUP,!0).length);goog.testing.events.fireMouseDownEvent(oneThumbSlider.getElement());assertEquals(1,goog.events.getListeners(oneThumbSlider.getElement(),goog.events.EventType.MOUSEMOVE,!1).length);assertEquals(1,goog.events.getListeners(doc,goog.events.EventType.MOUSEUP,!0).length);oneThumbSlider.setEnabled(!1);assertEquals(0,goog.events.getListeners(oneThumbSlider.getElement(),goog.events.EventType.MOUSEMOVE,!1).length);assertEquals(0,goog.events.getListeners(doc,goog.events.EventType.MOUSEUP,!0).length);assertEquals(1,oneThumbSlider.getHandler().getListenerCount());goog.testing.events.fireMouseUpEvent(oneThumbSlider.getElement());assertEquals(0,goog.events.getListeners(oneThumbSlider.getElement(),goog.events.EventType.MOUSEMOVE,!1).length);assertEquals(0,goog.events.getListeners(doc,goog.events.EventType.MOUSEUP,!0).length)}function testMouseClickWithMoveToPointEnabled(){var _Mathround=Math.round,stepSize=20;oneThumbSlider.setStep(stepSize);oneThumbSlider.setMoveToPointEnabled(!0);var initialValue=oneThumbSlider.getValue(),numSteps=_Mathround((oneThumbSlider.getMaximum()-oneThumbSlider.getMinimum())/stepSize),size=goog.style.getSize(oneThumbSlider.getElement()),pixelsPerStep=_Mathround(size.width/numSteps),coords=goog.style.getClientPosition(oneThumbSlider.getElement());coords.x+=pixelsPerStep/2;goog.testing.events.fireClickSequence(oneThumbSlider.getElement(),void 0,coords);assertEquals(oneThumbSlider.getValue(),initialValue+stepSize);goog.testing.events.fireClickSequence(oneThumbSlider.getElement(),void 0,coords);assertEquals(oneThumbSlider.getValue(),initialValue);goog.testing.events.fireClickSequence(oneThumbSlider.getElement());assertEquals(oneThumbSlider.getValue(),initialValue)}function testNonIntegerStepSize(){var stepSize=.02;oneThumbSlider.setStep(stepSize);oneThumbSlider.setMinimum(-1);oneThumbSlider.setMaximum(1);oneThumbSlider.setValue(.7);assertRoughlyEquals(.7,oneThumbSlider.getValue(),1e-6);oneThumbSlider.setValue(.3);assertRoughlyEquals(.3,oneThumbSlider.getValue(),1e-6)}function testSingleThumbSliderHasZeroExtent(){var stepSize=.02;oneThumbSlider.setStep(stepSize);oneThumbSlider.setMinimum(-1);oneThumbSlider.setMaximum(1);oneThumbSlider.setValue(.7);assertEquals(0,oneThumbSlider.getExtent());oneThumbSlider.setValue(.3);assertEquals(0,oneThumbSlider.getExtent())}function testThumbCoordinateForValueWithHorizontalSlider(){var originalY=goog.style.getPosition(oneThumbSlider.valueThumb).y,width=oneThumbSlider.getElement().clientWidth-oneThumbSlider.valueThumb.offsetWidth,range=oneThumbSlider.getMaximum()-oneThumbSlider.getMinimum(),value=20,expectedX=Math.round(value/range*width),expectedCoord=new goog.math.Coordinate(expectedX,originalY),coord=oneThumbSlider.getThumbCoordinateForValue(value);assertObjectEquals(expectedCoord,coord);oneThumbSlider.setValue(value/2);coord=oneThumbSlider.getThumbCoordinateForValue(value);assertObjectEquals(expectedCoord,coord)}function testThumbCoordinateForValueWithVerticalSlider(){oneThumbSlider.setOrientation(goog.ui.SliderBase.Orientation.VERTICAL);var originalX=goog.style.getPosition(oneThumbSlider.valueThumb).x,height=oneThumbSlider.getElement().clientHeight-oneThumbSlider.valueThumb.offsetHeight,range=oneThumbSlider.getMaximum()-oneThumbSlider.getMinimum(),value=20,expectedY=height-Math.round(value/range*height),expectedCoord=new goog.math.Coordinate(originalX,expectedY),coord=oneThumbSlider.getThumbCoordinateForValue(value);assertObjectEquals(expectedCoord,coord);oneThumbSlider.setValue(value/2);coord=oneThumbSlider.getThumbCoordinateForValue(value);assertObjectEquals(expectedCoord,coord)}function testValueFromMousePosition(){var _Mathround2=Math.round,value=30;oneThumbSlider.setValue(value);var offset=goog.style.getPageOffset(oneThumbSlider.valueThumb),size=goog.style.getSize(oneThumbSlider.valueThumb);offset.x+=size.width/2;offset.y+=size.height/2;var e=null;goog.events.listen(oneThumbSlider,goog.events.EventType.MOUSEMOVE,function(evt){e=evt});goog.testing.events.fireMouseMoveEvent(oneThumbSlider,offset);assertNotEquals(e,null);assertRoughlyEquals(value,_Mathround2(oneThumbSlider.getValueFromMousePosition(e)),1);oneThumbSlider.setValue(value/2);assertRoughlyEquals(value,_Mathround2(oneThumbSlider.getValueFromMousePosition(e)),1)}function testClickAfterMousedown(){var _Mathround3=Math.round;oneThumbSlider.setValue(0);var offset=goog.style.getPageOffset(oneThumbSlider.valueThumb),size=goog.style.getSize(oneThumbSlider.valueThumb);offset.x+=size.width/2;offset.y+=size.height/2;var sliderElement=oneThumbSlider.getElement(),width=sliderElement.clientWidth-size.width,range=oneThumbSlider.getMaximum()-oneThumbSlider.getMinimum(),offsetXAtZero=offset.x,theTime=goog.now(),saveGoogNow=goog.now;goog.now=function(){return theTime};var valueOne=10;offset.x=offsetXAtZero+_Mathround3(valueOne/range*width);goog.testing.events.fireMouseDownEvent(sliderElement,null,offset);assertEquals(valueOne,oneThumbSlider.getValue());theTime+=oneThumbSlider.MOUSE_DOWN_DELAY_/2;var valueTwo=20;offset.x=offsetXAtZero+_Mathround3(valueTwo/range*width);goog.testing.events.fireClickEvent(sliderElement,null,offset);assertEquals(valueOne,oneThumbSlider.getValue());theTime+=oneThumbSlider.MOUSE_DOWN_DELAY_;goog.testing.events.fireClickEvent(sliderElement,null,offset);assertEquals(valueTwo,oneThumbSlider.getValue());goog.now=saveGoogNow}function testDragEvents(){var offset=goog.style.getPageOffset(oneThumbSlider.valueThumb),size=goog.style.getSize(oneThumbSlider.valueThumb);offset.x+=size.width/2;offset.y+=size.height/2;var event_types=[],handler=function(evt){event_types.push(evt.type)};goog.events.listen(oneThumbSlider,[goog.ui.SliderBase.EventType.DRAG_START,goog.ui.SliderBase.EventType.DRAG_END,goog.ui.SliderBase.EventType.DRAG_VALUE_START,goog.ui.SliderBase.EventType.DRAG_VALUE_END,goog.ui.SliderBase.EventType.DRAG_EXTENT_START,goog.ui.SliderBase.EventType.DRAG_EXTENT_END,goog.ui.Component.EventType.CHANGE],handler);function isValueOrExtentDragStart(type){return type==goog.ui.SliderBase.EventType.DRAG_VALUE_START||type==goog.ui.SliderBase.EventType.DRAG_EXTENT_START}function isValueOrExtentDragEnd(type){return type==goog.ui.SliderBase.EventType.DRAG_VALUE_END||type==goog.ui.SliderBase.EventType.DRAG_EXTENT_END}goog.testing.events.fireMouseDownEvent(oneThumbSlider.valueThumb);offset.x+=100;goog.testing.events.fireMouseMoveEvent(oneThumbSlider.valueThumb,offset);goog.testing.events.fireMouseUpEvent(oneThumbSlider.valueThumb);assertEquals(9,event_types.length);assertEquals(goog.ui.SliderBase.EventType.DRAG_START,event_types[0]);assertTrue(isValueOrExtentDragStart(event_types[1]));assertEquals(goog.ui.SliderBase.EventType.DRAG_START,event_types[2]);assertTrue(isValueOrExtentDragStart(event_types[3]));assertEquals(goog.ui.Component.EventType.CHANGE,event_types[4]);assertEquals(goog.ui.SliderBase.EventType.DRAG_END,event_types[5]);assertTrue(isValueOrExtentDragEnd(event_types[6]));assertEquals(goog.ui.SliderBase.EventType.DRAG_END,event_types[7]);assertTrue(isValueOrExtentDragEnd(event_types[8]));assertFalse(event_types[1]==event_types[3]);assertFalse(event_types[6]==event_types[8]);event_types=[];goog.testing.events.fireMouseDownEvent(oneThumbSlider.valueThumb);goog.testing.events.fireMouseUpEvent(oneThumbSlider.valueThumb);assertEquals(8,event_types.length);assertEquals(goog.ui.SliderBase.EventType.DRAG_START,event_types[0]);assertTrue(isValueOrExtentDragStart(event_types[1]));assertEquals(goog.ui.SliderBase.EventType.DRAG_START,event_types[2]);assertTrue(isValueOrExtentDragStart(event_types[3]));assertEquals(goog.ui.SliderBase.EventType.DRAG_END,event_types[4]);assertTrue(isValueOrExtentDragEnd(event_types[5]));assertEquals(goog.ui.SliderBase.EventType.DRAG_END,event_types[6]);assertTrue(isValueOrExtentDragEnd(event_types[7]));assertFalse(event_types[1]==event_types[3]);assertFalse(event_types[5]==event_types[7]);goog.events.removeAll(oneThumbSlider)}function testAnimationEndEventAfterClick(){var offset=goog.style.getPageOffset(oneThumbSlider.valueThumb),size=goog.style.getSize(oneThumbSlider.valueThumb);offset.x+=size.width/2;offset.y+=size.height/2;var event_types=[],handler=function(evt){event_types.push(evt.type)},animationDelay=160;if(goog.userAgent.IE){animationDelay=250}oneThumbSlider.setMoveToPointEnabled(!0);goog.events.listen(oneThumbSlider,goog.ui.SliderBase.EventType.ANIMATION_END,handler);function isAnimationEndType(type){return type==goog.ui.SliderBase.EventType.ANIMATION_END}offset.x+=100;goog.testing.events.fireClickSequence(oneThumbSlider.getElement(),void 0,offset);mockClock.tick(animationDelay);assertEquals(1,event_types.length);assertTrue(isAnimationEndType(event_types[0]));goog.events.removeAll(oneThumbSlider)}