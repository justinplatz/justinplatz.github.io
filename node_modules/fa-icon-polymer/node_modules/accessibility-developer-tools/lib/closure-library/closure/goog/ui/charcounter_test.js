goog.provide("goog.ui.CharCounterTest");goog.setTestOnly("goog.ui.CharCounterTest");goog.require("goog.dom");goog.require("goog.testing.asserts");goog.require("goog.testing.jsunit");goog.require("goog.ui.CharCounter");goog.require("goog.userAgent");var countElement,charCounter,inputElement,incremental=goog.ui.CharCounter.Display.INCREMENTAL,remaining=goog.ui.CharCounter.Display.REMAINING,maxLength=25;function setUp(){inputElement=goog.dom.getElement("test-textarea-id");inputElement.value="";countElement=goog.dom.getElementByClass("char-count");goog.dom.setTextContent(countElement,"");charCounter=new goog.ui.CharCounter(inputElement,countElement,maxLength)}function tearDown(){charCounter.dispose()}function setupCheckLength(content,mode){inputElement.value=content;charCounter.setDisplayMode(mode);charCounter.checkLength()}function testConstructor(){assertNotNull("Character counter can not be null",charCounter);assertEquals(maxLength.toString(),goog.dom.getTextContent(countElement))}function testSetMaxLength(){charCounter.setMaxLength(10);assertEquals("10",goog.dom.getTextContent(countElement));var tooLongContent="This is too long text content";inputElement.value=tooLongContent;charCounter.setMaxLength(10);assertEquals("0",goog.dom.getTextContent(countElement));assertEquals("This is to",inputElement.value)}function testGetMaxLength(){assertEquals(maxLength,charCounter.getMaxLength())}function testSetDisplayMode(){charCounter.setDisplayMode(incremental);assertEquals("0",goog.dom.getTextContent(countElement));charCounter.setDisplayMode(remaining);assertEquals(maxLength.toString(),goog.dom.getTextContent(countElement))}function testGetDisplayMode(){assertEquals(remaining,charCounter.getDisplayMode());var incrementalCharCounter=new goog.ui.CharCounter(inputElement,countElement,maxLength,incremental);assertEquals(incremental,incrementalCharCounter.getDisplayMode())}function testCheckLength(){setupCheckLength("",remaining);assertEquals(maxLength.toString(),goog.dom.getTextContent(countElement));setupCheckLength("",incremental);assertEquals("0",goog.dom.getTextContent(countElement))}function testCheckLength_limitedContent(){var limitedContent="Limited text content",limitedContentLength=limitedContent.length,remainingLimitedContentLength=maxLength-limitedContentLength;setupCheckLength(limitedContent,remaining);assertEquals(limitedContent,inputElement.value);assertEquals(remainingLimitedContentLength.toString(),goog.dom.getTextContent(countElement));charCounter.setDisplayMode(incremental);charCounter.checkLength();assertEquals(limitedContent,inputElement.value);assertEquals(limitedContentLength.toString(),goog.dom.getTextContent(countElement))}function testCheckLength_overflowContent(){var tooLongContent="This is too long text content",truncatedContent="This is too long text con";setupCheckLength(tooLongContent,remaining);assertEquals(truncatedContent,inputElement.value);assertEquals("0",goog.dom.getTextContent(countElement));setupCheckLength(tooLongContent,incremental);assertEquals(truncatedContent,inputElement.value);assertEquals(maxLength.toString(),goog.dom.getTextContent(countElement))}function testCheckLength_newLineContent(){var newLineContent="New\nline",newLineContentLength=newLineContent.length,remainingNewLineContentLength=maxLength-newLineContentLength,carriageReturnContent="New\r\nline",carriageReturnContentLength=carriageReturnContent.length,remainingCarriageReturnContentLength=maxLength-carriageReturnContentLength;setupCheckLength(newLineContent,remaining);if(goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9.0")){assertEquals(carriageReturnContent,inputElement.value);assertEquals(remainingCarriageReturnContentLength.toString(),goog.dom.getTextContent(countElement))}else{assertEquals(newLineContent,inputElement.value);assertEquals(remainingNewLineContentLength.toString(),goog.dom.getTextContent(countElement))}setupCheckLength(newLineContent,incremental);if(goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9.0")){assertEquals(carriageReturnContent,inputElement.value);assertEquals(carriageReturnContentLength.toString(),goog.dom.getTextContent(countElement))}else{assertEquals(newLineContent,inputElement.value);assertEquals(newLineContentLength.toString(),goog.dom.getTextContent(countElement))}}function testCheckLength_carriageReturnContent(){var newLineContent="New\nline",newLineContentLength=newLineContent.length,remainingNewLineContentLength=maxLength-newLineContentLength,carriageReturnContent="New\r\nline",carriageReturnContentLength=carriageReturnContent.length,remainingCarriageReturnContentLength=maxLength-carriageReturnContentLength;setupCheckLength(carriageReturnContent,remaining);if(goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9.0")){assertEquals(carriageReturnContent,inputElement.value);assertEquals(remainingCarriageReturnContentLength.toString(),goog.dom.getTextContent(countElement))}else{assertEquals(newLineContent,inputElement.value);assertEquals(remainingNewLineContentLength.toString(),goog.dom.getTextContent(countElement))}setupCheckLength(carriageReturnContent,incremental);if(goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9.0")){assertEquals(carriageReturnContent,inputElement.value);assertEquals(carriageReturnContentLength.toString(),goog.dom.getTextContent(countElement))}else{assertEquals(newLineContent,inputElement.value);assertEquals(newLineContentLength.toString(),goog.dom.getTextContent(countElement))}}