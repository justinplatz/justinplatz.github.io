goog.provide("goog.ui.media.FlickrSetTest");goog.setTestOnly("goog.ui.media.FlickrSetTest");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.html.testing");goog.require("goog.testing.jsunit");goog.require("goog.ui.media.FlashObject");goog.require("goog.ui.media.FlickrSet");goog.require("goog.ui.media.FlickrSetModel");goog.require("goog.ui.media.Media");var flickr,control,FLICKR_USER="ingawalker",FLICKR_SET="72057594102831547",FLICKRSET_URL="http://flickr.com/photos/"+FLICKR_USER+"/sets/"+FLICKR_SET,parent=goog.dom.createElement(goog.dom.TagName.DIV);function setUp(){flickr=new goog.ui.media.FlickrSet;var set=new goog.ui.media.FlickrSetModel(FLICKR_USER,FLICKR_SET,"caption");control=new goog.ui.media.Media(set,flickr)}function tearDown(){control.dispose()}function testBasicRendering(){control.render(parent);var el=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.DIV,goog.ui.media.FlickrSet.CSS_CLASS,parent);assertEquals(1,el.length);assertEquals(FLICKRSET_URL,control.getDataModel().getUrl())}function testParsingUrl(){assertExtractsCorrectly(FLICKR_USER,FLICKR_SET,FLICKRSET_URL);assertExtractsCorrectly("30441750@N06","7215760789302468","http://flickr.com/photos/30441750@N06/sets/7215760789302468/");assertExtractsCorrectly("30441750-N06","7215760789302468","http://flickr.com/photos/30441750-N06/sets/7215760789302468/");var invalidUrl="http://invalidUrl/filename.doc",e=assertThrows("",function(){goog.ui.media.FlickrSetModel.newInstance(invalidUrl)});assertEquals("failed to parse flickr url: "+invalidUrl,e.message)}function testBuildingUrl(){assertEquals(FLICKRSET_URL,goog.ui.media.FlickrSetModel.buildUrl(FLICKR_USER,FLICKR_SET,FLICKRSET_URL))}function testCreatingModel(){var model=new goog.ui.media.FlickrSetModel(FLICKR_USER,FLICKR_SET);assertEquals(FLICKR_USER,model.getUserId());assertEquals(FLICKR_SET,model.getSetId());assertEquals(FLICKRSET_URL,model.getUrl());assertUndefined(model.getCaption())}function testSettingWhichFlashUrlToUse(){goog.ui.media.FlickrSet.setFlashUrl(goog.html.testing.newTrustedResourceUrlForTest("http://foo"));assertEquals("http://foo",goog.ui.media.FlickrSet.flashUrl_.getTypedStringValue())}function testCreatingDomOnInitialState(){control.render(parent);var caption=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.DIV,goog.ui.media.FlickrSet.CSS_CLASS+"-caption",parent);assertEquals(1,caption.length);var flash=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.DIV,goog.ui.media.FlashObject.CSS_CLASS,parent);assertEquals(1,flash.length)}function assertExtractsCorrectly(expectedUserId,expectedSetId,url){var flickr=goog.ui.media.FlickrSetModel.newInstance(url);assertEquals("userId for "+url,expectedUserId,flickr.getUserId());assertEquals("setId for "+url,expectedSetId,flickr.getSetId())}