goog.provide("goog.html.sanitizer.CssSanitizer");goog.require("goog.array");goog.require("goog.html.SafeStyle");goog.require("goog.html.uncheckedconversions");goog.require("goog.object");goog.require("goog.string");goog.html.sanitizer.CssSanitizer.NORM_URL_REGEXP_=/[\n\f\r\"\'()*<>]/g;goog.html.sanitizer.CssSanitizer.NORM_URL_REPLACEMENTS_={"\n":"%0a","":"%0c","\r":"%0d",'"':"%22","'":"%27","(":"%28",")":"%29","*":"%2a","<":"%3c",">":"%3e"};goog.html.sanitizer.CssSanitizer.normalizeUrlChar_=function(ch){return goog.html.sanitizer.CssSanitizer.NORM_URL_REPLACEMENTS_[ch]||null};goog.html.sanitizer.CssSanitizer.getSafeUri_=function(uri,propName,uriRewriter){if(!uriRewriter){return null}var safeUri=uriRewriter(uri,propName);if(safeUri){return"url(\""+safeUri.replace(goog.html.sanitizer.CssSanitizer.NORM_URL_REGEXP_,goog.html.sanitizer.CssSanitizer.normalizeUrlChar_)+"\")"}return null};goog.html.sanitizer.CssSanitizer.ALLOWED_FUNCTIONS_=["rgb","rgba","alpha","rect","image","linear-gradient","radial-gradient","repeating-linear-gradient","repeating-radial-gradient","cubic-bezier","matrix","perspective","rotate","rotate3d","rotatex","rotatey","steps","rotatez","scale","scale3d","scalex","scaley","scalez","skew","skewx","skewy","translate","translate3d","translatex","translatey","translatez"];goog.html.sanitizer.CssSanitizer.withoutVendorPrefix_=function(propName){return propName.replace(/^-(?:apple|css|epub|khtml|moz|mso?|o|rim|wap|webkit|xv)-(?=[a-z])/i,"")};goog.html.sanitizer.CssSanitizer.sanitizeProperty_=function(propName,propValue,opt_uriRewriter){var propertyValue=goog.string.trim(propValue).toLowerCase();if(""===propertyValue){return null}if(goog.string.startsWith(propertyValue,"url(")){if(opt_uriRewriter){propertyValue=goog.string.trim(propValue);var uri=goog.string.stripQuotes(propertyValue.substring(4,propertyValue.length-1),"\"'");propertyValue=goog.html.sanitizer.CssSanitizer.getSafeUri_(uri,propName,opt_uriRewriter)}else{propertyValue=null}}else if(0<propertyValue.indexOf("(")){if(1<goog.string.countOf(propertyValue,"(")||!(goog.array.contains(goog.html.sanitizer.CssSanitizer.ALLOWED_FUNCTIONS_,propertyValue.substring(0,propertyValue.indexOf("(")))&&goog.string.endsWith(propertyValue,")"))){propertyValue=null}}return propertyValue};goog.html.sanitizer.CssSanitizer.sanitizeInlineStyle=function(cssStyle,opt_uriRewriter){if(!cssStyle){return goog.html.SafeStyle.EMPTY}for(var cleanCssStyle=document.createElement("div").style,cssPropNames=goog.html.sanitizer.CssSanitizer.getCssPropNames_(cssStyle),i=0,propName;i<cssPropNames.length;i++){propName=goog.html.sanitizer.CssSanitizer.withoutVendorPrefix_(cssPropNames[i]);if(!goog.html.sanitizer.CssSanitizer.isDisallowedPropertyName_(propName)){var propValue=goog.html.sanitizer.CssSanitizer.getCssValue_(cssStyle,propName),sanitizedValue=goog.html.sanitizer.CssSanitizer.sanitizeProperty_(propName,propValue,opt_uriRewriter);goog.html.sanitizer.CssSanitizer.setCssValue_(cleanCssStyle,propName,sanitizedValue)}}return goog.html.uncheckedconversions.safeStyleFromStringKnownToSatisfyTypeContract(goog.string.Const.from("Output of CSS sanitizer"),cleanCssStyle.cssText||"")};goog.html.sanitizer.CssSanitizer.sanitizeInlineStyleString=function(cssText,opt_uriRewriter){if(goog.userAgent.IE&&10>document.documentMode){return new goog.html.SafeStyle}var div=goog.html.sanitizer.CssSanitizer.createInertDocument_().createElement("DIV");div.style.cssText=cssText;return goog.html.sanitizer.CssSanitizer.sanitizeInlineStyle(div.style,opt_uriRewriter)};goog.html.sanitizer.CssSanitizer.createInertDocument_=function(){var doc=document;if("function"===typeof HTMLTemplateElement){doc=document.createElement("template").content.ownerDocument}return doc.implementation.createHTMLDocument("")};goog.html.sanitizer.CssSanitizer.getCssPropNames_=function(cssStyle){var propNames=[];if(goog.isArrayLike(cssStyle)){propNames=Array.prototype.slice.call(cssStyle)}else{propNames=goog.object.getKeys(cssStyle)}return propNames};goog.html.sanitizer.CssSanitizer.getCssValue_=function(cssStyle,propName){var getPropDescriptor=Object.getOwnPropertyDescriptor(CSSStyleDeclaration.prototype,"getPropertyValue");if(getPropDescriptor&&cssStyle.getPropertyValue){return getPropDescriptor.value.call(cssStyle,propName)||""}else if(cssStyle.getAttribute){return cssStyle.getAttribute(propName)+""}else{return""}};goog.html.sanitizer.CssSanitizer.setCssValue_=function(cssStyle,propName,sanitizedValue){if(sanitizedValue){var setPropDescriptor=Object.getOwnPropertyDescriptor(CSSStyleDeclaration.prototype,"setProperty");if(setPropDescriptor&&cssStyle.setProperty){setPropDescriptor.value.call(cssStyle,propName,sanitizedValue)}else if(cssStyle.setAttribute){cssStyle.setAttribute(propName,sanitizedValue)}}};goog.html.sanitizer.CssSanitizer.isDisallowedPropertyName_=function(propName){return goog.string.startsWith(propName,"--")||goog.string.startsWith(propName,"var")};