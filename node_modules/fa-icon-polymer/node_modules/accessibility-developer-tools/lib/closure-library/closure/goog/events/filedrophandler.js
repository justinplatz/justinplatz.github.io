goog.provide("goog.events.FileDropHandler");goog.provide("goog.events.FileDropHandler.EventType");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.events.BrowserEvent");goog.require("goog.events.EventHandler");goog.require("goog.events.EventTarget");goog.require("goog.events.EventType");goog.require("goog.log");goog.require("goog.log.Level");goog.events.FileDropHandler=function(element,opt_preventDropOutside){goog.events.EventTarget.call(this);this.eventHandler_=new goog.events.EventHandler(this);var doc=element;if(opt_preventDropOutside){doc=goog.dom.getOwnerDocument(element)}this.eventHandler_.listen(doc,goog.events.EventType.DRAGENTER,this.onDocDragEnter_);if(doc!=element){this.eventHandler_.listen(doc,goog.events.EventType.DRAGOVER,this.onDocDragOver_)}this.eventHandler_.listen(element,goog.events.EventType.DRAGOVER,this.onElemDragOver_);this.eventHandler_.listen(element,goog.events.EventType.DROP,this.onElemDrop_)};goog.inherits(goog.events.FileDropHandler,goog.events.EventTarget);goog.events.FileDropHandler.prototype.dndContainsFiles_=!1;goog.events.FileDropHandler.prototype.logger_=goog.log.getLogger("goog.events.FileDropHandler");goog.events.FileDropHandler.EventType={DROP:goog.events.EventType.DROP};goog.events.FileDropHandler.prototype.disposeInternal=function(){goog.events.FileDropHandler.superClass_.disposeInternal.call(this);this.eventHandler_.dispose()};goog.events.FileDropHandler.prototype.dispatch_=function(e){goog.log.fine(this.logger_,"Firing DROP event...");var event=new goog.events.BrowserEvent(e.getBrowserEvent());event.type=goog.events.FileDropHandler.EventType.DROP;this.dispatchEvent(event)};goog.events.FileDropHandler.prototype.onDocDragEnter_=function(e){goog.log.log(this.logger_,goog.log.Level.FINER,"\""+e.target.id+"\" ("+e.target+") dispatched: "+e.type);var dt=e.getBrowserEvent().dataTransfer;this.dndContainsFiles_=!!(dt&&(dt.types&&(goog.array.contains(dt.types,"Files")||goog.array.contains(dt.types,"public.file-url"))||dt.files&&0<dt.files.length));if(this.dndContainsFiles_){e.preventDefault()}goog.log.log(this.logger_,goog.log.Level.FINER,"dndContainsFiles_: "+this.dndContainsFiles_)};goog.events.FileDropHandler.prototype.onDocDragOver_=function(e){goog.log.log(this.logger_,goog.log.Level.FINEST,"\""+e.target.id+"\" ("+e.target+") dispatched: "+e.type);if(this.dndContainsFiles_){e.preventDefault();var dt=e.getBrowserEvent().dataTransfer;dt.dropEffect="none"}};goog.events.FileDropHandler.prototype.onElemDragOver_=function(e){goog.log.log(this.logger_,goog.log.Level.FINEST,"\""+e.target.id+"\" ("+e.target+") dispatched: "+e.type);if(this.dndContainsFiles_){e.preventDefault();e.stopPropagation();var dt=e.getBrowserEvent().dataTransfer;try{dt.effectAllowed="all"}catch(err){}dt.dropEffect="copy"}};goog.events.FileDropHandler.prototype.onElemDrop_=function(e){goog.log.log(this.logger_,goog.log.Level.FINER,"\""+e.target.id+"\" ("+e.target+") dispatched: "+e.type);if(this.dndContainsFiles_){e.preventDefault();e.stopPropagation();this.dispatch_(e)}};