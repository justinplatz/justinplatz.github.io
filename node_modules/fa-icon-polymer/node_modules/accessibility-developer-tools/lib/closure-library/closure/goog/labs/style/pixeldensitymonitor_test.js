goog.provide("goog.labs.style.PixelDensityMonitorTest");goog.setTestOnly("goog.labs.style.PixelDensityMonitorTest");goog.require("goog.array");goog.require("goog.dom.DomHelper");goog.require("goog.events");goog.require("goog.labs.style.PixelDensityMonitor");goog.require("goog.testing.MockControl");goog.require("goog.testing.jsunit");goog.require("goog.testing.recordFunction");var fakeWindow,recordFunction,monitor,mockControl,mediaQueryLists;function setUp(){recordFunction=goog.testing.recordFunction();mediaQueryLists=[];mockControl=new goog.testing.MockControl}function tearDown(){mockControl.$verifyAll();goog.dispose(monitor);goog.dispose(recordFunction)}function setUpMonitor(initialRatio,hasMatchMedia){fakeWindow={devicePixelRatio:initialRatio};if(hasMatchMedia){fakeWindow.matchMedia=function(query){var listeners=[],newList={addListener:function(listener){listeners.push(listener)},removeListener:function(listener){goog.array.remove(listeners,listener)},callListeners:function(){for(var i=0;i<listeners.length;i++){listeners[i]()}},getListenerCount:function(){return listeners.length}};mediaQueryLists.push(newList);return newList}}var domHelper=mockControl.createStrictMock(goog.dom.DomHelper);domHelper.getWindow().$returns(fakeWindow);mockControl.$replayAll();monitor=new goog.labs.style.PixelDensityMonitor(domHelper);goog.events.listen(monitor,goog.labs.style.PixelDensityMonitor.EventType.CHANGE,recordFunction)}function setNewRatio(newRatio){fakeWindow.devicePixelRatio=newRatio;for(var i=0;i<mediaQueryLists.length;i++){mediaQueryLists[i].callListeners()}}function testNormalDensity(){setUpMonitor(1,!1);assertEquals(goog.labs.style.PixelDensityMonitor.Density.NORMAL,monitor.getDensity())}function testHighDensity(){setUpMonitor(1.5,!1);assertEquals(goog.labs.style.PixelDensityMonitor.Density.HIGH,monitor.getDensity())}function testNormalDensityIfUndefined(){setUpMonitor(void 0,!1);assertEquals(goog.labs.style.PixelDensityMonitor.Density.NORMAL,monitor.getDensity())}function testChangeEvent(){setUpMonitor(1,!0);assertEquals(goog.labs.style.PixelDensityMonitor.Density.NORMAL,monitor.getDensity());monitor.start();setNewRatio(2);var call=recordFunction.popLastCall();assertEquals(goog.labs.style.PixelDensityMonitor.Density.HIGH,call.getArgument(0).target.getDensity());assertEquals(goog.labs.style.PixelDensityMonitor.Density.HIGH,monitor.getDensity());setNewRatio(1);call=recordFunction.popLastCall();assertEquals(goog.labs.style.PixelDensityMonitor.Density.NORMAL,call.getArgument(0).target.getDensity());assertEquals(goog.labs.style.PixelDensityMonitor.Density.NORMAL,monitor.getDensity())}function testListenerIsDisposed(){setUpMonitor(1,!0);monitor.start();assertEquals(1,mediaQueryLists.length);assertEquals(1,mediaQueryLists[0].getListenerCount());goog.dispose(monitor);assertEquals(1,mediaQueryLists.length);assertEquals(0,mediaQueryLists[0].getListenerCount())}