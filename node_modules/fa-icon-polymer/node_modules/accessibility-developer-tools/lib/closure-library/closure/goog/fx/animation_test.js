goog.provide("goog.fx.AnimationTest");goog.setTestOnly("goog.fx.AnimationTest");goog.require("goog.events");goog.require("goog.fx.Animation");goog.require("goog.testing.MockClock");goog.require("goog.testing.jsunit");var clock;function setUpPage(){clock=new goog.testing.MockClock(!0)}function tearDownPage(){clock.dispose()}function testPauseLogic(){var anim=new goog.fx.Animation([],[],3e3),nFrames=0;goog.events.listen(anim,goog.fx.Animation.EventType.ANIMATE,function(e){assertRoughlyEquals(e.progress,progress,1e-6);nFrames++});goog.events.listen(anim,goog.fx.Animation.EventType.END,function(e){nFrames++});for(var nSteps=10,i=0;i<nSteps;i++){progress=i/(nSteps-1);anim.setProgress(progress);anim.play();anim.pause()}assertEquals(nSteps,nFrames)}function testPauseOffset(){var anim=new goog.fx.Animation([0],[1e3],1e3);anim.play();assertEquals(0,anim.coords[0]);assertRoughlyEquals(0,anim.progress,1e-4);clock.tick(300);assertEquals(300,anim.coords[0]);assertRoughlyEquals(.3,anim.progress,1e-4);anim.pause();clock.tick(400);assertEquals(300,anim.coords[0]);assertRoughlyEquals(.3,anim.progress,1e-4);anim.play();assertEquals(300,anim.coords[0]);assertRoughlyEquals(.3,anim.progress,1e-4);clock.tick(400);assertEquals(700,anim.coords[0]);assertRoughlyEquals(.7,anim.progress,1e-4);anim.pause();clock.tick(300);assertEquals(700,anim.coords[0]);assertRoughlyEquals(.7,anim.progress,1e-4);anim.play();var lastPlay=goog.now();assertEquals(700,anim.coords[0]);assertRoughlyEquals(.7,anim.progress,1e-4);clock.tick(300);assertEquals(1e3,anim.coords[0]);assertRoughlyEquals(1,anim.progress,1e-4);assertEquals(goog.fx.Animation.State.STOPPED,anim.getStateInternal())}function testClockReset(){var anim=new goog.fx.Animation([0],[1e3],1e3);anim.play();assertEquals(0,anim.coords[0]);assertRoughlyEquals(0,anim.progress,1e-4);clock.tick(-2e5);anim.pause();anim.play();assertEquals(0,anim.coords[0]);assertRoughlyEquals(0,anim.progress,1e-4);clock.tick(900);anim.pause();anim.play();assertEquals(900,anim.coords[0]);assertRoughlyEquals(.9,anim.progress,1e-4)}function testSetProgress(){var anim=new goog.fx.Animation([0],[1e3],3e3),nFrames=0;anim.play();anim.setProgress(.5);goog.events.listen(anim,goog.fx.Animation.EventType.ANIMATE,function(e){assertEquals(500,e.coords[0]);assertRoughlyEquals(.5,e.progress,1e-4);nFrames++});anim.cycle(goog.now());anim.stop();assertEquals(1,nFrames)}