goog.provide("goog.dom.SavedCaretRange");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.dom.SavedRange");goog.require("goog.dom.TagName");goog.require("goog.string");goog.dom.SavedCaretRange=function(range){goog.dom.SavedRange.call(this);this.startCaretId_=goog.string.createUniqueString();this.endCaretId_=goog.string.createUniqueString();this.reversed_=range.isReversed();this.dom_=goog.dom.getDomHelper(range.getDocument());range.surroundWithNodes(this.createCaret_(!0),this.createCaret_(!1))};goog.inherits(goog.dom.SavedCaretRange,goog.dom.SavedRange);goog.dom.SavedCaretRange.prototype.toAbstractRange=function(){var range=null,startCaret=this.getCaret(!0),endCaret=this.getCaret(!1);if(startCaret&&endCaret){range=goog.dom.Range.createFromNodes(startCaret,0,endCaret,0)}return range};goog.dom.SavedCaretRange.prototype.getCaret=function(start){return this.dom_.getElement(start?this.startCaretId_:this.endCaretId_)};goog.dom.SavedCaretRange.prototype.removeCarets=function(opt_range){goog.dom.removeNode(this.getCaret(!0));goog.dom.removeNode(this.getCaret(!1));return opt_range};goog.dom.SavedCaretRange.prototype.setRestorationDocument=function(doc){this.dom_.setDocument(doc)};goog.dom.SavedCaretRange.prototype.restoreInternal=function(){var range=null,anchorCaret=this.getCaret(!this.reversed_),focusCaret=this.getCaret(this.reversed_);if(anchorCaret&&focusCaret){var anchorNode=anchorCaret.parentNode,anchorOffset=goog.array.indexOf(anchorNode.childNodes,anchorCaret),focusNode=focusCaret.parentNode,focusOffset=goog.array.indexOf(focusNode.childNodes,focusCaret);if(focusNode==anchorNode){if(this.reversed_){anchorOffset--}else{focusOffset--}}range=goog.dom.Range.createFromNodes(anchorNode,anchorOffset,focusNode,focusOffset);range=this.removeCarets(range);range.select()}else{this.removeCarets()}return range};goog.dom.SavedCaretRange.prototype.disposeInternal=function(){this.removeCarets();this.dom_=null};goog.dom.SavedCaretRange.prototype.createCaret_=function(start){return this.dom_.createDom(goog.dom.TagName.SPAN,{id:start?this.startCaretId_:this.endCaretId_})};goog.dom.SavedCaretRange.CARET_REGEX=/<span\s+id="?goog_\d+"?><\/span>/ig;goog.dom.SavedCaretRange.htmlEqual=function(str1,str2){return str1==str2||str1.replace(goog.dom.SavedCaretRange.CARET_REGEX,"")==str2.replace(goog.dom.SavedCaretRange.CARET_REGEX,"")};