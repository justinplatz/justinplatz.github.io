goog.provide("goog.ui.PaletteRenderer");goog.require("goog.a11y.aria");goog.require("goog.a11y.aria.Role");goog.require("goog.a11y.aria.State");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.NodeIterator");goog.require("goog.dom.NodeType");goog.require("goog.dom.TagName");goog.require("goog.dom.classlist");goog.require("goog.iter");goog.require("goog.style");goog.require("goog.ui.ControlRenderer");goog.require("goog.userAgent");goog.ui.PaletteRenderer=function(){goog.ui.ControlRenderer.call(this)};goog.inherits(goog.ui.PaletteRenderer,goog.ui.ControlRenderer);goog.addSingletonGetter(goog.ui.PaletteRenderer);goog.ui.PaletteRenderer.cellId_=0;goog.ui.PaletteRenderer.CSS_CLASS=goog.getCssName("goog-palette");goog.ui.PaletteRenderer.prototype.createDom=function(palette){var classNames=this.getClassNames(palette),element=palette.getDomHelper().createDom(goog.dom.TagName.DIV,classNames?classNames.join(" "):null,this.createGrid(palette.getContent(),palette.getSize(),palette.getDomHelper()));goog.a11y.aria.setRole(element,goog.a11y.aria.Role.GRID);return element};goog.ui.PaletteRenderer.prototype.createGrid=function(items,size,dom){for(var rows=[],row=0,index=0,cells;row<size.height;row++){cells=[];for(var column=0,item;column<size.width;column++){item=items&&items[index++];cells.push(this.createCell(item,dom))}rows.push(this.createRow(cells,dom))}return this.createTable(rows,dom)};goog.ui.PaletteRenderer.prototype.createTable=function(rows,dom){var table=dom.createDom(goog.dom.TagName.TABLE,goog.getCssName(this.getCssClass(),"table"),dom.createDom(goog.dom.TagName.TBODY,goog.getCssName(this.getCssClass(),"body"),rows));table.cellSpacing="0";table.cellPadding="0";return table};goog.ui.PaletteRenderer.prototype.createRow=function(cells,dom){var row=dom.createDom(goog.dom.TagName.TR,goog.getCssName(this.getCssClass(),"row"),cells);goog.a11y.aria.setRole(row,goog.a11y.aria.Role.ROW);return row};goog.ui.PaletteRenderer.prototype.createCell=function(node,dom){var cell=dom.createDom(goog.dom.TagName.TD,{class:goog.getCssName(this.getCssClass(),"cell"),id:goog.getCssName(this.getCssClass(),"cell-")+goog.ui.PaletteRenderer.cellId_++},node);goog.a11y.aria.setRole(cell,goog.a11y.aria.Role.GRIDCELL);goog.a11y.aria.setState(cell,goog.a11y.aria.State.SELECTED,!1);if(!goog.dom.getTextContent(cell)&&!goog.a11y.aria.getLabel(cell)){var ariaLabelForCell=this.findAriaLabelForCell_(cell);if(ariaLabelForCell){goog.a11y.aria.setLabel(cell,ariaLabelForCell)}}return cell};goog.ui.PaletteRenderer.prototype.findAriaLabelForCell_=function(cell){var iter=new goog.dom.NodeIterator(cell),label="",node;while(!label&&(node=goog.iter.nextOrValue(iter,null))){if(node.nodeType==goog.dom.NodeType.ELEMENT){label=goog.a11y.aria.getLabel(node)||node.title}}return label};goog.ui.PaletteRenderer.prototype.canDecorate=function(element){return!1};goog.ui.PaletteRenderer.prototype.decorate=function(palette,element){return null};goog.ui.PaletteRenderer.prototype.setContent=function(element,content){var items=content;if(element){var tbody=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.TBODY,goog.getCssName(this.getCssClass(),"body"),element)[0];if(tbody){var index=0;goog.array.forEach(tbody.rows,function(row){goog.array.forEach(row.cells,function(cell){goog.dom.removeChildren(cell);if(items){var item=items[index++];if(item){goog.dom.appendChild(cell,item)}}})});if(index<items.length){var cells=[],dom=goog.dom.getDomHelper(element),width=tbody.rows[0].cells.length;while(index<items.length){var item=items[index++];cells.push(this.createCell(item,dom));if(cells.length==width){var row=this.createRow(cells,dom);goog.dom.appendChild(tbody,row);cells.length=0}}if(0<cells.length){while(cells.length<width){cells.push(this.createCell("",dom))}var row=this.createRow(cells,dom);goog.dom.appendChild(tbody,row)}}}goog.style.setUnselectable(element,!0,goog.userAgent.GECKO)}};goog.ui.PaletteRenderer.prototype.getContainingItem=function(palette,node){var root=palette.getElement();while(node&&node.nodeType==goog.dom.NodeType.ELEMENT&&node!=root){if(node.tagName==goog.dom.TagName.TD&&goog.dom.classlist.contains(node,goog.getCssName(this.getCssClass(),"cell"))){return node.firstChild}node=node.parentNode}return null};goog.ui.PaletteRenderer.prototype.highlightCell=function(palette,node,highlight){if(node){var cell=this.getCellForItem(node);goog.asserts.assert(cell);goog.dom.classlist.enable(cell,goog.getCssName(this.getCssClass(),"cell-hover"),highlight);if(highlight){goog.a11y.aria.setState(palette.getElementStrict(),goog.a11y.aria.State.ACTIVEDESCENDANT,cell.id)}else if(cell.id==goog.a11y.aria.getState(palette.getElementStrict(),goog.a11y.aria.State.ACTIVEDESCENDANT)){goog.a11y.aria.removeState(palette.getElementStrict(),goog.a11y.aria.State.ACTIVEDESCENDANT)}}};goog.ui.PaletteRenderer.prototype.getCellForItem=function(node){return node?node.parentNode:null};goog.ui.PaletteRenderer.prototype.selectCell=function(palette,node,select){if(node){var cell=node.parentNode;goog.dom.classlist.enable(cell,goog.getCssName(this.getCssClass(),"cell-selected"),select);goog.a11y.aria.setState(cell,goog.a11y.aria.State.SELECTED,select)}};goog.ui.PaletteRenderer.prototype.getCssClass=function(){return goog.ui.PaletteRenderer.CSS_CLASS};