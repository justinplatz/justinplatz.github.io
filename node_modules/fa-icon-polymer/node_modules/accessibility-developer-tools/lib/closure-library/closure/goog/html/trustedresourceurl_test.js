goog.provide("goog.html.trustedResourceUrlTest");goog.require("goog.html.TrustedResourceUrl");goog.require("goog.i18n.bidi.Dir");goog.require("goog.object");goog.require("goog.string.Const");goog.require("goog.testing.jsunit");goog.setTestOnly("goog.html.trustedResourceUrlTest");function testTrustedResourceUrl(){var url="javascript:trusted();",trustedResourceUrl=goog.html.TrustedResourceUrl.fromConstant(goog.string.Const.from(url)),extracted=goog.html.TrustedResourceUrl.unwrap(trustedResourceUrl);assertEquals(url,extracted);assertEquals(url,trustedResourceUrl.getTypedStringValue());assertEquals("TrustedResourceUrl{javascript:trusted();}",trustedResourceUrl+"");assertEquals(goog.i18n.bidi.Dir.LTR,trustedResourceUrl.getDirection());assertTrue(trustedResourceUrl.implementsGoogStringTypedString);assertTrue(trustedResourceUrl.implementsGoogI18nBidiDirectionalString)}function testFormat_validFormatString(){assertValidFormat(goog.string.Const.from("https://www.google.com/path"));assertValidFormat(goog.string.Const.from("//www.google.com/path"));assertValidFormat(goog.string.Const.from("//ww-w.google.com:1000/path"));assertValidFormat(goog.string.Const.from("//[::1]/path"));assertValidFormat(goog.string.Const.from("/path"));assertValidFormat(goog.string.Const.from("/path/x"));assertValidFormat(goog.string.Const.from("/path#x"));assertValidFormat(goog.string.Const.from("/path?x"));assertValidFormat(goog.string.Const.from("httpS://www.google.cOm/pAth"));assertValidFormat(goog.string.Const.from("/path/@!%."))}function assertValidFormat(format){var url=goog.html.TrustedResourceUrl.format(format,{});assertEquals(goog.string.Const.unwrap(format),goog.html.TrustedResourceUrl.unwrap(url))}function testFormat_args(){var url=goog.html.TrustedResourceUrl.format(goog.string.Const.from("/path/%{dir1}/%{dir2}?n1=v1%{opt_param}"),{dir1:"d%/?#=",dir2:2,opt_param:goog.string.Const.from("n2=v2%/?#=")});assertEquals("/path/d%25%2F%3F%23%3D/2?n1=v1n2=v2%/?#=",goog.html.TrustedResourceUrl.unwrap(url));var url=goog.html.TrustedResourceUrl.format(goog.string.Const.from("/path/%{!%{label}}%{foo"),{label:"value"});assertEquals("/path/%{!value}%{foo",goog.html.TrustedResourceUrl.unwrap(url))}function testFormat_missingArgs(){var exception=assertThrows(function(){goog.html.TrustedResourceUrl.format(goog.string.Const.from("https://www.google.com/path/%{arg1}"),{arg2:"irrelevant"})});assertContains("no valid label mapping found",exception.message)}function testFormat_invalidFormatString(){assertInvalidFormat(goog.string.Const.from("ftp://"));assertInvalidFormat(goog.string.Const.from("https://"));assertInvalidFormat(goog.string.Const.from("https:///"));assertInvalidFormat(goog.string.Const.from("//"));assertInvalidFormat(goog.string.Const.from("///"));assertInvalidFormat(goog.string.Const.from("https://google.com"));assertInvalidFormat(goog.string.Const.from("https://www.google%.com/"));assertInvalidFormat(goog.string.Const.from("https://www.google\\.com/"));assertInvalidFormat(goog.string.Const.from("https://user:password@www.google.com/"));assertInvalidFormat(goog.string.Const.from("https://google.com/"));assertInvalidFormat(goog.string.Const.from("https://google.com//"));assertInvalidFormat(goog.string.Const.from("/@"));assertInvalidFormat(goog.string.Const.from("/%"))}function assertInvalidFormat(format){var exception=assertThrows(goog.string.Const.unwrap(format),function(){goog.html.TrustedResourceUrl.format(format,{})});assertContains("Invalid TrustedResourceUrl format",exception.message)}function testFromConstants(){assertEquals("",goog.html.TrustedResourceUrl.unwrap(goog.html.TrustedResourceUrl.fromConstants([])));assertEquals("foo",goog.html.TrustedResourceUrl.unwrap(goog.html.TrustedResourceUrl.fromConstants([goog.string.Const.from("foo")])));assertEquals("foobar",goog.html.TrustedResourceUrl.unwrap(goog.html.TrustedResourceUrl.fromConstants([goog.string.Const.from("foo"),goog.string.Const.from("bar")])))}function testUnwrap(){var privateFieldName="privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_",markerFieldName="TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_",propNames=goog.object.getKeys(goog.html.TrustedResourceUrl.fromConstant(goog.string.Const.from("")));assertContains(privateFieldName,propNames);assertContains(markerFieldName,propNames);var evil={};evil[privateFieldName]="http://example.com/evil.js";evil[markerFieldName]={};var exception=assertThrows(function(){goog.html.TrustedResourceUrl.unwrap(evil)});assertContains("expected object of type TrustedResourceUrl",exception.message)}