goog.provide("goog.labs.structs.Map");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.object");goog.labs.structs.Map=function(){this.clear()};goog.labs.structs.Map.objectPropertyIsEnumerable_=Object.prototype.propertyIsEnumerable;goog.labs.structs.Map.objectHasOwnProperty_=Object.prototype.hasOwnProperty;goog.labs.structs.Map.prototype.map_;goog.labs.structs.Map.prototype.secondaryStoreKeys_;goog.labs.structs.Map.prototype.secondaryStoreValues_;goog.labs.structs.Map.prototype.count_;goog.labs.structs.Map.prototype.set=function(key,value){this.assertKeyIsString_(key);var newKey=!this.hasKeyInPrimaryStore_(key);this.map_[key]=value;if("__proto__"==key||!goog.labs.structs.Map.BrowserFeature.OBJECT_CREATE_SUPPORTED&&!goog.labs.structs.Map.objectPropertyIsEnumerable_.call(this.map_,key)){delete this.map_[key];var index=goog.array.indexOf(this.secondaryStoreKeys_,key);if(newKey=0>index){index=this.secondaryStoreKeys_.length}this.secondaryStoreKeys_[index]=key;this.secondaryStoreValues_[index]=value}if(newKey)this.count_++};goog.labs.structs.Map.prototype.get=function(key,opt_default){this.assertKeyIsString_(key);if(this.hasKeyInPrimaryStore_(key)){return this.map_[key]}var index=goog.array.indexOf(this.secondaryStoreKeys_,key);return 0<=index?this.secondaryStoreValues_[index]:opt_default};goog.labs.structs.Map.prototype.remove=function(key){this.assertKeyIsString_(key);if(this.hasKeyInPrimaryStore_(key)){this.count_--;delete this.map_[key];return!0}else{var index=goog.array.indexOf(this.secondaryStoreKeys_,key);if(0<=index){this.count_--;goog.array.removeAt(this.secondaryStoreKeys_,index);goog.array.removeAt(this.secondaryStoreValues_,index);return!0}}return!1};goog.labs.structs.Map.prototype.addAll=function(map){goog.array.forEach(map.getKeys(),function(key){this.set(key,map.get(key))},this)};goog.labs.structs.Map.prototype.isEmpty=function(){return!this.count_};goog.labs.structs.Map.prototype.getCount=function(){return this.count_};goog.labs.structs.Map.prototype.containsKey=function(key){this.assertKeyIsString_(key);return this.hasKeyInPrimaryStore_(key)||goog.array.contains(this.secondaryStoreKeys_,key)};goog.labs.structs.Map.prototype.containsValue=function(value){var found=goog.object.some(this.map_,function(v,k){return this.hasKeyInPrimaryStore_(k)&&goog.object.is(v,value)},this);return found||goog.array.contains(this.secondaryStoreValues_,value)};goog.labs.structs.Map.prototype.getKeys=function(){var keys;if(goog.labs.structs.Map.BrowserFeature.OBJECT_KEYS_SUPPORTED){keys=goog.array.clone(Object.keys(this.map_))}else{keys=[];for(var key in this.map_){if(goog.labs.structs.Map.objectHasOwnProperty_.call(this.map_,key)){keys.push(key)}}}goog.array.extend(keys,this.secondaryStoreKeys_);return keys};goog.labs.structs.Map.prototype.getValues=function(){for(var values=[],keys=this.getKeys(),i=0;i<keys.length;i++){values.push(this.get(keys[i]))}return values};goog.labs.structs.Map.prototype.getEntries=function(){for(var entries=[],keys=this.getKeys(),i=0,key;i<keys.length;i++){key=keys[i];entries.push([key,this.get(key)])}return entries};goog.labs.structs.Map.prototype.clear=function(){this.map_=goog.labs.structs.Map.BrowserFeature.OBJECT_CREATE_SUPPORTED?Object.create(null):{};this.secondaryStoreKeys_=[];this.secondaryStoreValues_=[];this.count_=0};goog.labs.structs.Map.prototype.clone=function(){var map=new goog.labs.structs.Map;map.addAll(this);return map};goog.labs.structs.Map.prototype.hasKeyInPrimaryStore_=function(key){if("__proto__"==key){return!1}if(goog.labs.structs.Map.BrowserFeature.OBJECT_CREATE_SUPPORTED){return key in this.map_}return goog.labs.structs.Map.objectHasOwnProperty_.call(this.map_,key)};goog.labs.structs.Map.prototype.assertKeyIsString_=function(key){goog.asserts.assert(goog.isString(key),"key must be a string.")};goog.labs.structs.Map.BrowserFeature={OBJECT_CREATE_SUPPORTED:!!Object.create,OBJECT_KEYS_SUPPORTED:!!Object.keys};