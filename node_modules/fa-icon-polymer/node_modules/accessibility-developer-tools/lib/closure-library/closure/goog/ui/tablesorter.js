goog.provide("goog.ui.TableSorter");goog.provide("goog.ui.TableSorter.EventType");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.dom.classlist");goog.require("goog.events.EventType");goog.require("goog.functions");goog.require("goog.ui.Component");goog.ui.TableSorter=function(opt_domHelper){goog.ui.Component.call(this,opt_domHelper);this.header_=null;this.reversed_=!1;this.defaultSortFunction_=goog.ui.TableSorter.numericSort;this.sortFunctions_=[]};goog.inherits(goog.ui.TableSorter,goog.ui.Component);goog.tagUnsealableClass(goog.ui.TableSorter);goog.ui.TableSorter.prototype.sortableHeaderRowIndex_=0;goog.ui.TableSorter.prototype.setSortableHeaderRowIndex=function(index){if(this.isInDocument()){throw Error(goog.ui.Component.Error.ALREADY_RENDERED)}this.sortableHeaderRowIndex_=index};goog.ui.TableSorter.EventType={BEFORESORT:"beforesort",SORT:"sort"};goog.ui.TableSorter.prototype.canDecorate=function(element){return element.tagName==goog.dom.TagName.TABLE};goog.ui.TableSorter.prototype.enterDocument=function(){goog.ui.TableSorter.superClass_.enterDocument.call(this);var table=this.getElement(),headerRow=table.tHead.rows[this.sortableHeaderRowIndex_];this.getHandler().listen(headerRow,goog.events.EventType.CLICK,this.sort_)};goog.ui.TableSorter.prototype.getSortColumn=function(){return this.header_?this.header_.cellIndex:-1};goog.ui.TableSorter.prototype.isSortReversed=function(){return this.reversed_};goog.ui.TableSorter.prototype.getDefaultSortFunction=function(){return this.defaultSortFunction_};goog.ui.TableSorter.prototype.setDefaultSortFunction=function(sortFunction){this.defaultSortFunction_=sortFunction};goog.ui.TableSorter.prototype.getSortFunction=function(column){return this.sortFunctions_[column]||this.defaultSortFunction_};goog.ui.TableSorter.prototype.setSortFunction=function(column,sortFunction){this.sortFunctions_[column]=sortFunction};goog.ui.TableSorter.prototype.sort_=function(e){var target=e.target,th=goog.dom.getAncestorByTagNameAndClass(target,goog.dom.TagName.TH),reverse=th==this.header_?!this.reversed_:!1;if(this.dispatchEvent(goog.ui.TableSorter.EventType.BEFORESORT)){if(this.sort(th.cellIndex,reverse)){this.dispatchEvent(goog.ui.TableSorter.EventType.SORT)}}};goog.ui.TableSorter.prototype.sort=function(column,opt_reverse){var sortFunction=this.getSortFunction(column);if(sortFunction===goog.ui.TableSorter.noSort){return!1}if(this.header_){goog.dom.classlist.remove(this.header_,this.reversed_?goog.getCssName("goog-tablesorter-sorted-reverse"):goog.getCssName("goog-tablesorter-sorted"))}this.reversed_=!!opt_reverse;var multiplier=this.reversed_?-1:1,cmpFn=function(a,b){return multiplier*sortFunction(a[0],b[0])||a[1]-b[1]},table=this.getElement();goog.array.forEach(table.tBodies,function(tBody){var values=goog.array.map(tBody.rows,function(row,rowIndex){return[goog.dom.getTextContent(row.cells[column]),rowIndex,row]});goog.array.sort(values,cmpFn);var nextSibling=tBody.nextSibling;table.removeChild(tBody);goog.array.forEach(values,function(row){tBody.appendChild(row[2])});table.insertBefore(tBody,nextSibling)});this.header_=table.tHead.rows[this.sortableHeaderRowIndex_].cells[column];goog.dom.classlist.add(this.header_,this.reversed_?goog.getCssName("goog-tablesorter-sorted-reverse"):goog.getCssName("goog-tablesorter-sorted"));return!0};goog.ui.TableSorter.noSort=goog.functions.error("no sort");goog.ui.TableSorter.numericSort=function(a,b){a=parseFloat(a);b=parseFloat(b);if(a==a){return b==b?a-b:-1}else{return b==b?1:0}};goog.ui.TableSorter.alphaSort=goog.array.defaultCompare;goog.ui.TableSorter.createReverseSort=function(sortFunction){return function(a,b){return-1*sortFunction(a,b)}};