goog.provide("goog.ui.PopupTest");goog.setTestOnly("goog.ui.PopupTest");goog.require("goog.positioning.AnchoredPosition");goog.require("goog.positioning.Corner");goog.require("goog.style");goog.require("goog.testing.jsunit");goog.require("goog.ui.Popup");goog.require("goog.userAgent");function assertRoundedEquals(a,b,c){function round(x){return goog.userAgent.GECKO&&(goog.userAgent.MAC||goog.userAgent.X11)&&goog.userAgent.isVersionOrHigher("1.9")?Math.round(x):x}if(3==arguments.length){assertEquals(a,round(b),round(c))}else{assertEquals(round(a),round(b))}}function testCreateAndReposition(){var anchorEl=document.getElementById("anchor"),popupEl=document.getElementById("popup"),corner=goog.positioning.Corner,pos=new goog.positioning.AnchoredPosition(anchorEl,corner.BOTTOM_START),popup=new goog.ui.Popup(popupEl,pos);popup.setVisible(!0);var anchorRect=goog.style.getBounds(anchorEl),popupRect=goog.style.getBounds(popupEl);assertRoundedEquals("Left edge of popup should line up with left edge "+"of anchor.",anchorRect.left,popupRect.left);assertRoundedEquals("Popup should be positioned just below the anchor.",anchorRect.top+anchorRect.height,popupRect.top);anchorEl.style.marginTop="7px";popup.reposition();anchorRect=goog.style.getBounds(anchorEl);popupRect=goog.style.getBounds(popupEl);assertRoundedEquals("Popup should be positioned just below the anchor.",anchorRect.top+anchorRect.height,popupRect.top)}function testSetPinnedCorner(){var anchorEl=document.getElementById("anchor"),popupEl=document.getElementById("popup"),corner=goog.positioning.Corner,pos=new goog.positioning.AnchoredPosition(anchorEl,corner.BOTTOM_START),popup=new goog.ui.Popup(popupEl,pos);popup.setVisible(!0);var anchorRect=goog.style.getBounds(anchorEl),popupRect=goog.style.getBounds(popupEl);assertRoundedEquals("Left edge of popup should line up with left edge "+"of anchor.",anchorRect.left,popupRect.left);assertRoundedEquals("Popup should be positioned just below the anchor.",anchorRect.top+anchorRect.height,popupRect.top);popup.setPinnedCorner(corner.BOTTOM_END);anchorRect=goog.style.getBounds(anchorEl);popupRect=goog.style.getBounds(popupEl);assertRoundedEquals("Right edge of popup should line up with left edge "+"of anchor.",anchorRect.left,popupRect.left+popupRect.width);assertRoundedEquals("Bottom edge of popup should line up with bottom "+"of anchor.",anchorRect.top+anchorRect.height,popupRect.top+popupRect.height);anchorEl.style.marginLeft="0";popup.reposition();anchorRect=goog.style.getBounds(anchorEl);popupRect=goog.style.getBounds(popupEl);assertRoundedEquals("Right edge of popup should line up with left edge "+"of anchor.",anchorRect.left,popupRect.left+popupRect.width);anchorEl.style.marginLeft=""}