goog.provide("goog.crypt.Sha2");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.crypt.Hash");goog.crypt.Sha2=function(numHashBlocks,initHashBlocks){goog.crypt.Sha2.base(this,"constructor");this.blockSize=goog.crypt.Sha2.BLOCKSIZE_;this.chunk_=goog.global.Uint8Array?new Uint8Array(this.blockSize):Array(this.blockSize);this.inChunk_=0;this.total_=0;this.hash_=[];this.numHashBlocks_=numHashBlocks;this.initHashBlocks_=initHashBlocks;this.w_=goog.global.Int32Array?new Int32Array(64):Array(64);if(!goog.isDef(goog.crypt.Sha2.Kx_)){if(goog.global.Int32Array){goog.crypt.Sha2.Kx_=new Int32Array(goog.crypt.Sha2.K_)}else{goog.crypt.Sha2.Kx_=goog.crypt.Sha2.K_}}this.reset()};goog.inherits(goog.crypt.Sha2,goog.crypt.Hash);goog.crypt.Sha2.BLOCKSIZE_=512/8;goog.crypt.Sha2.PADDING_=goog.array.concat(128,goog.array.repeat(0,goog.crypt.Sha2.BLOCKSIZE_-1));goog.crypt.Sha2.prototype.reset=function(){this.inChunk_=0;this.total_=0;this.hash_=goog.global.Int32Array?new Int32Array(this.initHashBlocks_):goog.array.clone(this.initHashBlocks_)};goog.crypt.Sha2.prototype.computeChunk_=function(){var chunk=this.chunk_;goog.asserts.assert(chunk.length==this.blockSize);var rounds=64,w=this.w_,index=0,offset=0;while(offset<chunk.length){w[index++]=chunk[offset]<<24|chunk[offset+1]<<16|chunk[offset+2]<<8|chunk[offset+3];offset=4*index}for(var i=16;i<rounds;i++){var w_15=0|w[i-15],s0=(w_15>>>7|w_15<<25)^(w_15>>>18|w_15<<14)^w_15>>>3,w_2=0|w[i-2],s1=(w_2>>>17|w_2<<15)^(w_2>>>19|w_2<<13)^w_2>>>10,partialSum1=0|(0|w[i-16])+s0,partialSum2=0|(0|w[i-7])+s1;w[i]=0|partialSum1+partialSum2}for(var a=0|this.hash_[0],b=0|this.hash_[1],c=0|this.hash_[2],d=0|this.hash_[3],e=0|this.hash_[4],f=0|this.hash_[5],g=0|this.hash_[6],h=0|this.hash_[7],i=0;i<rounds;i++){var S0=(a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10),maj=a&b^a&c^b&c,t2=0|S0+maj,S1=(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7),ch=e&f^~e&g,partialSum1=0|h+S1,partialSum2=0|ch+(0|goog.crypt.Sha2.Kx_[i]),partialSum3=0|partialSum2+(0|w[i]),t1=0|partialSum1+partialSum3;h=g;g=f;f=e;e=0|d+t1;d=c;c=b;b=a;a=0|t1+t2}this.hash_[0]=0|this.hash_[0]+a;this.hash_[1]=0|this.hash_[1]+b;this.hash_[2]=0|this.hash_[2]+c;this.hash_[3]=0|this.hash_[3]+d;this.hash_[4]=0|this.hash_[4]+e;this.hash_[5]=0|this.hash_[5]+f;this.hash_[6]=0|this.hash_[6]+g;this.hash_[7]=0|this.hash_[7]+h};goog.crypt.Sha2.prototype.update=function(message,opt_length){if(!goog.isDef(opt_length)){opt_length=message.length}var n=0,inChunk=this.inChunk_;if(goog.isString(message)){while(n<opt_length){this.chunk_[inChunk++]=message.charCodeAt(n++);if(inChunk==this.blockSize){this.computeChunk_();inChunk=0}}}else if(goog.isArrayLike(message)){while(n<opt_length){var b=message[n++];if(!("number"==typeof b&&0<=b&&255>=b&&b==(0|b))){throw Error("message must be a byte array")}this.chunk_[inChunk++]=b;if(inChunk==this.blockSize){this.computeChunk_();inChunk=0}}}else{throw Error("message must be string or array")}this.inChunk_=inChunk;this.total_+=opt_length};goog.crypt.Sha2.prototype.digest=function(){var digest=[],totalBits=8*this.total_;if(56>this.inChunk_){this.update(goog.crypt.Sha2.PADDING_,56-this.inChunk_)}else{this.update(goog.crypt.Sha2.PADDING_,this.blockSize-(this.inChunk_-56))}for(var i=63;56<=i;i--){this.chunk_[i]=255&totalBits;totalBits/=256}this.computeChunk_();for(var n=0,i=0;i<this.numHashBlocks_;i++){for(var j=24;0<=j;j-=8){digest[n++]=255&this.hash_[i]>>j}}return digest};goog.crypt.Sha2.K_=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];goog.crypt.Sha2.Kx_;