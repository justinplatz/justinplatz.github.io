goog.provide("goog.events.MouseWheelHandlerTest");goog.setTestOnly("goog.events.MouseWheelHandlerTest");goog.require("goog.dom");goog.require("goog.events");goog.require("goog.events.BrowserEvent");goog.require("goog.events.MouseWheelEvent");goog.require("goog.events.MouseWheelHandler");goog.require("goog.functions");goog.require("goog.string");goog.require("goog.testing.PropertyReplacer");goog.require("goog.testing.events");goog.require("goog.testing.jsunit");goog.require("goog.userAgent");var log,stubs=new goog.testing.PropertyReplacer,DEFAULT_TYPE="mousewheel",GECKO_TYPE="DOMMouseScroll",HORIZONTAL="h",VERTICAL="v",mouseWheelEvent,mouseWheelEventRtl,mouseWheelHandler,mouseWheelHandlerRtl;function setUpPage(){log=goog.dom.getElement("log")}function setUp(){stubs.remove(goog,"userAgent")}function tearDown(){stubs.reset();goog.dispose(mouseWheelHandler);goog.dispose(mouseWheelHandlerRtl);mouseWheelHandlerRtl=null;mouseWheelHandler=null;mouseWheelEvent=null;mouseWheelEventRtl=null}function tearDownPage(){mouseWheelHandler=new goog.events.MouseWheelHandler(document.body);goog.events.listen(mouseWheelHandler,goog.events.MouseWheelHandler.EventType.MOUSEWHEEL,function(e){log.innerHTML+=goog.string.subs("<br />(deltaX, deltaY): (%s, %s)",e.deltaX,e.deltaY)})}function testIeStyleMouseWheel(){goog.userAgent={OPERA:!1,EDGE_OR_IE:!0,GECKO:!1,WEBKIT:!1};createHandlerAndListen();handleEvent(createFakeMouseWheelEvent(DEFAULT_TYPE,120));assertMouseWheelEvent(-3,0,-3);handleEvent(createFakeMouseWheelEvent(DEFAULT_TYPE,-120));assertMouseWheelEvent(3,0,3);handleEvent(createFakeMouseWheelEvent(DEFAULT_TYPE,1200));assertMouseWheelEvent(-30,0,-30)}function testNullBody(){goog.userAgent={OPERA:!1,IE:!0,GECKO:!1,WEBKIT:!1};var documentObjectWithNoBody={};goog.testing.events.mixinListenable(documentObjectWithNoBody);mouseWheelHandler=new goog.events.MouseWheelHandler(documentObjectWithNoBody)}function testGeckoStyleMouseWheel(){goog.userAgent={OPERA:!1,IE:!1,GECKO:!0,WEBKIT:!1};createHandlerAndListen();handleEvent(createFakeMouseWheelEvent(GECKO_TYPE,null,3));assertMouseWheelEvent(3,0,3);handleEvent(createFakeMouseWheelEvent(GECKO_TYPE,null,-12));assertMouseWheelEvent(-12,0,-12);handleEvent(createFakeMouseWheelEvent(GECKO_TYPE,null,1200));assertMouseWheelEvent(3,0,3);handleEvent(createFakeMouseWheelEvent(GECKO_TYPE,null,-1200));assertMouseWheelEvent(-3,0,-3);handleEvent(createFakeMouseWheelEvent(GECKO_TYPE,null,3,VERTICAL));assertMouseWheelEvent(3,0,3);handleEvent(createFakeMouseWheelEvent(GECKO_TYPE,null,3,HORIZONTAL));assertMouseWheelEvent(3,3,0);handleEvent(createFakeMouseWheelEvent(GECKO_TYPE,null,-3,HORIZONTAL));assertMouseWheelEvent(-3,-3,0)}function testWebkitStyleMouseWheel_ieStyle(){goog.userAgent={OPERA:!1,IE:!1,GECKO:!1,WEBKIT:!0,WINDOWS:!0};createHandlerAndListen();handleEvent(createFakeWebkitMouseWheelEvent(-40,0));assertMouseWheelEvent(1,1,0);handleEvent(createFakeWebkitMouseWheelEvent(120,0));assertMouseWheelEvent(-3,-3,0);handleEvent(createFakeWebkitMouseWheelEvent(0,120));assertMouseWheelEvent(-3,0,-3);handleEvent(createFakeWebkitMouseWheelEvent(0,-40));assertMouseWheelEvent(1,0,1);handleEvent(createFakeWebkitMouseWheelEvent(80,-40));assertMouseWheelEvent(-2,-2,1)}function testWebkitStyleMouseWheel_ieStyleOnLinux(){goog.userAgent={OPERA:!1,IE:!1,GECKO:!1,WEBKIT:!0,WINDOWS:!1,LINUX:!0};runWebKitContinuousAndDiscreteEventsTest()}function testWebkitStyleMouseWheel_ieStyleOnMac(){goog.userAgent={OPERA:!1,IE:!1,GECKO:!1,WEBKIT:!0,WINDOWS:!1,MAC:!0};runWebKitContinuousAndDiscreteEventsTest()}function runWebKitContinuousAndDiscreteEventsTest(){goog.userAgent.isVersionOrHigher=goog.functions.TRUE;createHandlerAndListen();handleEvent(createFakeWebkitMouseWheelEvent(0,-40));assertMouseWheelEvent(1,0,1);handleEvent(createFakeWebkitMouseWheelEvent(80,-40));assertMouseWheelEvent(-2,-2,1);handleEvent(createFakeWebkitMouseWheelEvent(-3,5));assertMouseWheelEvent(-5,3,-5);handleEvent(createFakeWebkitMouseWheelEvent(4,-7));assertMouseWheelEvent(7,-4,7)}function testWebkitStyleMouseWheel_nonIeStyle(){goog.userAgent={OPERA:!1,IE:!1,GECKO:!1,WEBKIT:!0,WINDOWS:!1};goog.userAgent.isVersionOrHigher=goog.functions.FALSE;createHandlerAndListen();handleEvent(createFakeWebkitMouseWheelEvent(-40,0));assertMouseWheelEvent(1,1,0);handleEvent(createFakeWebkitMouseWheelEvent(120,0));assertMouseWheelEvent(-3,-3,0);handleEvent(createFakeWebkitMouseWheelEvent(0,120));assertMouseWheelEvent(-3,0,-3);handleEvent(createFakeWebkitMouseWheelEvent(0,-40));assertMouseWheelEvent(1,0,1);handleEvent(createFakeWebkitMouseWheelEvent(80,-40));assertMouseWheelEvent(-2,-2,1)}function testMaxDeltaX(){goog.userAgent={OPERA:!1,IE:!1,GECKO:!1,WEBKIT:!0,WINDOWS:!0};createHandlerAndListen();handleEvent(createFakeWebkitMouseWheelEvent(-120,0));assertMouseWheelEvent(3,3,0);mouseWheelHandler.setMaxDeltaX(3);mouseWheelHandlerRtl.setMaxDeltaX(3);handleEvent(createFakeWebkitMouseWheelEvent(-120,0));assertMouseWheelEvent(3,3,0);mouseWheelHandler.setMaxDeltaX(2);mouseWheelHandlerRtl.setMaxDeltaX(2);handleEvent(createFakeWebkitMouseWheelEvent(-120,0));assertMouseWheelEvent(3,2,0);handleEvent(createFakeWebkitMouseWheelEvent(0,-120));assertMouseWheelEvent(3,0,3)}function testMaxDeltaY(){goog.userAgent={OPERA:!1,IE:!1,GECKO:!1,WEBKIT:!0,WINDOWS:!0};createHandlerAndListen();handleEvent(createFakeWebkitMouseWheelEvent(0,-120));assertMouseWheelEvent(3,0,3);mouseWheelHandler.setMaxDeltaY(3);mouseWheelHandlerRtl.setMaxDeltaY(3);handleEvent(createFakeWebkitMouseWheelEvent(0,-120));assertMouseWheelEvent(3,0,3);mouseWheelHandler.setMaxDeltaY(2);mouseWheelHandlerRtl.setMaxDeltaY(2);handleEvent(createFakeWebkitMouseWheelEvent(0,-120));assertMouseWheelEvent(3,0,2);handleEvent(createFakeWebkitMouseWheelEvent(-120,0));assertMouseWheelEvent(3,3,0)}function createHandlerAndListen(){mouseWheelHandler=new goog.events.MouseWheelHandler(goog.dom.getElement("foo"));goog.events.listen(mouseWheelHandler,goog.events.MouseWheelHandler.EventType.MOUSEWHEEL,function(e){mouseWheelEvent=e});mouseWheelHandlerRtl=new goog.events.MouseWheelHandler(goog.dom.getElement("fooRtl"));goog.events.listen(mouseWheelHandlerRtl,goog.events.MouseWheelHandler.EventType.MOUSEWHEEL,function(e){mouseWheelEventRtl=e})}function handleEvent(event){mouseWheelHandler.handleEvent(event);mouseWheelHandlerRtl.handleEvent(event)}function assertMouseWheelEvent(expectedDetail,expectedDeltaX,expectedDeltaY){assertTrue("event should be non-null",!!mouseWheelEvent);assertTrue("event should have correct JS type",mouseWheelEvent instanceof goog.events.MouseWheelEvent);assertEquals("event should have correct detail property",expectedDetail,mouseWheelEvent.detail);assertEquals("event should have correct deltaX property",expectedDeltaX,mouseWheelEvent.deltaX);assertEquals("event should have correct deltaY property",expectedDeltaY,mouseWheelEvent.deltaY);assertTrue("event should be non-null",!!mouseWheelEventRtl);assertTrue("event should have correct JS type",mouseWheelEventRtl instanceof goog.events.MouseWheelEvent);assertEquals("event should have correct detail property",expectedDetail,mouseWheelEventRtl.detail);assertEquals("event should have correct deltaX property",-expectedDeltaX,mouseWheelEventRtl.deltaX);assertEquals("event should have correct deltaY property",expectedDeltaY,mouseWheelEventRtl.deltaY)}function createFakeMouseWheelEvent(type,opt_wheelDelta,opt_detail,opt_axis,opt_wheelDeltaX,opt_wheelDeltaY){var event={type:type,wheelDelta:goog.isDef(opt_wheelDelta)?opt_wheelDelta:void 0,detail:goog.isDef(opt_detail)?opt_detail:void 0,axis:opt_axis||void 0,wheelDeltaX:goog.isDef(opt_wheelDeltaX)?opt_wheelDeltaX:void 0,wheelDeltaY:goog.isDef(opt_wheelDeltaY)?opt_wheelDeltaY:void 0,HORIZONTAL_AXIS:HORIZONTAL,VERTICAL_AXIS:VERTICAL};return new goog.events.BrowserEvent(event)}function createFakeWebkitMouseWheelEvent(wheelDeltaX,wheelDeltaY){var _Mathabs=Math.abs;return createFakeMouseWheelEvent(DEFAULT_TYPE,_Mathabs(wheelDeltaX)>_Mathabs(wheelDeltaY)?wheelDeltaX:wheelDeltaY,void 0,void 0,wheelDeltaX,wheelDeltaY)}