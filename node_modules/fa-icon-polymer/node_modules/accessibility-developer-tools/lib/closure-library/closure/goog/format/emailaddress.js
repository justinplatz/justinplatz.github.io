goog.provide("goog.format.EmailAddress");goog.require("goog.string");goog.format.EmailAddress=function(opt_address,opt_name){this.name_=opt_name||"";this.address=opt_address||""};goog.format.EmailAddress.OPENERS_="\"<([";goog.format.EmailAddress.CLOSERS_="\">)]";goog.format.EmailAddress.SPECIAL_CHARS="()<>@:\\\".[]";goog.format.EmailAddress.ADDRESS_SEPARATORS_=",;";goog.format.EmailAddress.CHARS_REQUIRE_QUOTES_=goog.format.EmailAddress.SPECIAL_CHARS+goog.format.EmailAddress.ADDRESS_SEPARATORS_;goog.format.EmailAddress.ALL_DOUBLE_QUOTES_=/\"/g;goog.format.EmailAddress.ESCAPED_DOUBLE_QUOTES_=/\\\"/g;goog.format.EmailAddress.ALL_BACKSLASHES_=/\\/g;goog.format.EmailAddress.ESCAPED_BACKSLASHES_=/\\\\/g;goog.format.EmailAddress.LOCAL_PART_REGEXP_STR_="[+a-zA-Z0-9_.!#$%&'*\\/=?^`{|}~-]+";goog.format.EmailAddress.DOMAIN_PART_REGEXP_STR_="([a-zA-Z0-9-]+\\.)+[a-zA-Z0-9]{2,63}";goog.format.EmailAddress.LOCAL_PART_=new RegExp("^"+goog.format.EmailAddress.LOCAL_PART_REGEXP_STR_+"$");goog.format.EmailAddress.DOMAIN_PART_=new RegExp("^"+goog.format.EmailAddress.DOMAIN_PART_REGEXP_STR_+"$");goog.format.EmailAddress.EMAIL_ADDRESS_=new RegExp("^"+goog.format.EmailAddress.LOCAL_PART_REGEXP_STR_+"@"+goog.format.EmailAddress.DOMAIN_PART_REGEXP_STR_+"$");goog.format.EmailAddress.prototype.getName=function(){return this.name_};goog.format.EmailAddress.prototype.getAddress=function(){return this.address};goog.format.EmailAddress.prototype.setName=function(name){this.name_=name};goog.format.EmailAddress.prototype.setAddress=function(address){this.address=address};goog.format.EmailAddress.prototype.toString=function(){return this.toStringInternal(goog.format.EmailAddress.CHARS_REQUIRE_QUOTES_)};goog.format.EmailAddress.isQuoteNeeded_=function(name,specialChars){for(var i=0,specialChar;i<specialChars.length;i++){specialChar=specialChars[i];if(goog.string.contains(name,specialChar)){return!0}}return!1};goog.format.EmailAddress.prototype.toStringInternal=function(specialChars){var name=this.getName();name=name.replace(goog.format.EmailAddress.ALL_DOUBLE_QUOTES_,"");if(goog.format.EmailAddress.isQuoteNeeded_(name,specialChars)){name="\""+name.replace(goog.format.EmailAddress.ALL_BACKSLASHES_,"\\\\")+"\""}if(""==name){return this.address}if(""==this.address){return name}return name+" <"+this.address+">"};goog.format.EmailAddress.prototype.isValid=function(){return goog.format.EmailAddress.isValidAddrSpec(this.address)};goog.format.EmailAddress.isValidAddress=function(str){return goog.format.EmailAddress.parse(str).isValid()};goog.format.EmailAddress.isValidAddrSpec=function(str){return goog.format.EmailAddress.EMAIL_ADDRESS_.test(str)};goog.format.EmailAddress.isValidLocalPartSpec=function(str){return goog.format.EmailAddress.LOCAL_PART_.test(str)};goog.format.EmailAddress.isValidDomainPartSpec=function(str){return goog.format.EmailAddress.DOMAIN_PART_.test(str)};goog.format.EmailAddress.parseInternal=function(addr,ctor){for(var name="",address="",i=0,token;i<addr.length;){token=goog.format.EmailAddress.getToken_(addr,i);if("<"==token.charAt(0)&&-1!=token.indexOf(">")){var end=token.indexOf(">");address=token.substring(1,end)}else if(""==address){name+=token}i+=token.length}if(""==address&&-1!=name.indexOf("@")){address=name;name=""}name=goog.string.collapseWhitespace(name);name=goog.string.stripQuotes(name,"'");name=goog.string.stripQuotes(name,"\"");name=name.replace(goog.format.EmailAddress.ESCAPED_DOUBLE_QUOTES_,"\"");name=name.replace(goog.format.EmailAddress.ESCAPED_BACKSLASHES_,"\\");address=goog.string.collapseWhitespace(address);return new ctor(address,name)};goog.format.EmailAddress.parse=function(addr){return goog.format.EmailAddress.parseInternal(addr,goog.format.EmailAddress)};goog.format.EmailAddress.parseListInternal=function(str,parser,separatorChecker){var result=[],email="",token;str=goog.string.collapseWhitespace(str);for(var i=0;i<str.length;){token=goog.format.EmailAddress.getToken_(str,i);if(separatorChecker(token)||" "==token&&parser(email).isValid()){if(!goog.string.isEmptyOrWhitespace(email)){result.push(parser(email))}email="";i++;continue}email+=token;i+=token.length}if(!goog.string.isEmptyOrWhitespace(email)){result.push(parser(email))}return result};goog.format.EmailAddress.parseList=function(str){return goog.format.EmailAddress.parseListInternal(str,goog.format.EmailAddress.parse,goog.format.EmailAddress.isAddressSeparator)};goog.format.EmailAddress.getToken_=function(str,pos){var ch=str.charAt(pos),p=goog.format.EmailAddress.OPENERS_.indexOf(ch);if(-1==p){return ch}if(goog.format.EmailAddress.isEscapedDlQuote_(str,pos)){return ch}var closerChar=goog.format.EmailAddress.CLOSERS_.charAt(p),endPos=str.indexOf(closerChar,pos+1);while(0<=endPos&&goog.format.EmailAddress.isEscapedDlQuote_(str,endPos)){endPos=str.indexOf(closerChar,endPos+1)}var token=0<=endPos?str.substring(pos,endPos+1):ch;return token};goog.format.EmailAddress.isEscapedDlQuote_=function(str,pos){if("\""!=str.charAt(pos)){return!1}for(var slashCount=0,idx=pos-1;0<=idx&&"\\"==str.charAt(idx);idx--){slashCount++}return 0!=slashCount%2};goog.format.EmailAddress.isAddressSeparator=function(ch){return goog.string.contains(goog.format.EmailAddress.ADDRESS_SEPARATORS_,ch)};