goog.provide("goog.ui.ac.ArrayMatcher");goog.require("goog.string");goog.ui.ac.ArrayMatcher=function(rows,opt_noSimilar){this.rows_=rows||[];this.useSimilar_=!opt_noSimilar};goog.ui.ac.ArrayMatcher.prototype.setRows=function(rows){this.rows_=rows||[]};goog.ui.ac.ArrayMatcher.prototype.requestMatchingRows=function(token,maxMatches,matchHandler,opt_fullString){var matches=this.useSimilar_?goog.ui.ac.ArrayMatcher.getMatchesForRows(token,maxMatches,this.rows_):this.getPrefixMatches(token,maxMatches);matchHandler(token,matches)};goog.ui.ac.ArrayMatcher.getMatchesForRows=function(token,maxMatches,rows){var matches=goog.ui.ac.ArrayMatcher.getPrefixMatchesForRows(token,maxMatches,rows);if(0==matches.length){matches=goog.ui.ac.ArrayMatcher.getSimilarMatchesForRows(token,maxMatches,rows)}return matches};goog.ui.ac.ArrayMatcher.prototype.getPrefixMatches=function(token,maxMatches){return goog.ui.ac.ArrayMatcher.getPrefixMatchesForRows(token,maxMatches,this.rows_)};goog.ui.ac.ArrayMatcher.getPrefixMatchesForRows=function(token,maxMatches,rows){var matches=[];if(""!=token){for(var escapedToken=goog.string.regExpEscape(token),matcher=new RegExp("(^|\\W+)"+escapedToken,"i"),i=0,row;i<rows.length&&matches.length<maxMatches;i++){row=rows[i];if((row+"").match(matcher)){matches.push(row)}}}return matches};goog.ui.ac.ArrayMatcher.prototype.getSimilarRows=function(token,maxMatches){return goog.ui.ac.ArrayMatcher.getSimilarMatchesForRows(token,maxMatches,this.rows_)};goog.ui.ac.ArrayMatcher.getSimilarMatchesForRows=function(token,maxMatches,rows){for(var results=[],index=0;index<rows.length;index++){var row=rows[index],str=token.toLowerCase(),txt=(row+"").toLowerCase(),score=0;if(-1!=txt.indexOf(str)){score=parseInt((txt.indexOf(str)/4).toString(),10)}else{for(var arr=str.split(""),lastPos=-1,penalty=10,i=0,c,pos;c=arr[i];i++){pos=txt.indexOf(c);if(pos>lastPos){var diff=pos-lastPos-1;if(diff>penalty-5){diff=penalty-5}score+=diff;lastPos=pos}else{score+=penalty;penalty+=5}}}if(score<6*str.length){results.push({str:row,score:score,index:index})}}results.sort(function(a,b){var diff=a.score-b.score;if(0!=diff){return diff}return a.index-b.index});for(var matches=[],i=0;i<maxMatches&&i<results.length;i++){matches.push(results[i].str)}return matches};