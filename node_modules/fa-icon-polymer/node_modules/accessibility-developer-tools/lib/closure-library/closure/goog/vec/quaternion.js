goog.provide("goog.vec.Quaternion");goog.provide("goog.vec.Quaternion.AnyType");goog.require("goog.vec");goog.require("goog.vec.Vec3");goog.require("goog.vec.Vec4");goog.vec.Quaternion.Float32;goog.vec.Quaternion.Float64;goog.vec.Quaternion.Number;goog.vec.Quaternion.AnyType;goog.vec.Quaternion.createFloat32=goog.vec.Vec4.createFloat32;goog.vec.Quaternion.createFloat64=goog.vec.Vec4.createFloat64;goog.vec.Quaternion.createNumber=goog.vec.Vec4.createNumber;goog.vec.Quaternion.createFloat32FromArray=goog.vec.Vec4.createFloat32FromArray;goog.vec.Quaternion.createFloat64FromArray=goog.vec.Vec4.createFloat64FromArray;goog.vec.Quaternion.createFloat32FromValues=goog.vec.Vec4.createFloat32FromValues;goog.vec.Quaternion.createFloat64FromValues=goog.vec.Vec4.createFloat64FromValues;goog.vec.Quaternion.cloneFloat32=goog.vec.Vec4.cloneFloat32;goog.vec.Quaternion.cloneFloat64=goog.vec.Vec4.cloneFloat64;goog.vec.Quaternion.createIdentityFloat32=function(){var quat=goog.vec.Quaternion.createFloat32();goog.vec.Quaternion.makeIdentity(quat);return quat};goog.vec.Quaternion.createIdentityFloat64=function(){var quat=goog.vec.Quaternion.createFloat64();goog.vec.Quaternion.makeIdentity(quat);return quat};goog.vec.Quaternion.setFromValues=goog.vec.Vec4.setFromValues;goog.vec.Quaternion.setFromArray=goog.vec.Vec4.setFromArray;goog.vec.Quaternion.add=goog.vec.Vec4.add;goog.vec.Quaternion.negate=goog.vec.Vec4.negate;goog.vec.Quaternion.scale=goog.vec.Vec4.scale;goog.vec.Quaternion.magnitudeSquared=goog.vec.Vec4.magnitudeSquared;goog.vec.Quaternion.magnitude=goog.vec.Vec4.magnitude;goog.vec.Quaternion.normalize=goog.vec.Vec4.normalize;goog.vec.Quaternion.dot=goog.vec.Vec4.dot;goog.vec.Quaternion.invert=function(quat,resultQuat){var a0=quat[0],a1=quat[1],a2=quat[2],a3=quat[3],dot=a0*a0+a1*a1+a2*a2+a3*a3,invDot=dot?1/dot:0;resultQuat[0]=-a0*invDot;resultQuat[1]=-a1*invDot;resultQuat[2]=-a2*invDot;resultQuat[3]=a3*invDot;return resultQuat};goog.vec.Quaternion.conjugate=function(quat,resultQuat){resultQuat[0]=-quat[0];resultQuat[1]=-quat[1];resultQuat[2]=-quat[2];resultQuat[3]=quat[3];return resultQuat};goog.vec.Quaternion.concat=function(quat0,quat1,resultQuat){var x0=quat0[0],y0=quat0[1],z0=quat0[2],w0=quat0[3],x1=quat1[0],y1=quat1[1],z1=quat1[2],w1=quat1[3];resultQuat[0]=w0*x1+x0*w1+y0*z1-z0*y1;resultQuat[1]=w0*y1-x0*z1+y0*w1+z0*x1;resultQuat[2]=w0*z1+x0*y1-y0*x1+z0*w1;resultQuat[3]=w0*w1-x0*x1-y0*y1-z0*z1;return resultQuat};goog.vec.Quaternion.makeIdentity=function(quat){quat[0]=0;quat[1]=0;quat[2]=0;quat[3]=1;return quat};goog.vec.Quaternion.fromAngleAxis=function(angle,axis,quat){goog.vec.Vec3.normalize(axis,axis);var halfAngle=.5*angle,sin=Math.sin(halfAngle);goog.vec.Quaternion.setFromValues(quat,sin*axis[0],sin*axis[1],sin*axis[2],Math.cos(halfAngle));goog.vec.Quaternion.normalize(quat,quat);return quat};goog.vec.Quaternion.toAngleAxis=function(quat,axis){var _MathPI=Math.PI,angle=2*Math.acos(quat[3]),magnitude=Math.min(Math.max(1-quat[3]*quat[3],0),1);if(magnitude<goog.vec.EPSILON){goog.vec.Vec3.setFromValues(axis,1,0,0)}else{goog.vec.Vec3.setFromValues(axis,quat[0],quat[1],quat[2]);goog.vec.Vec3.normalize(axis,axis)}if(angle>_MathPI){angle-=2*_MathPI}return angle};goog.vec.Quaternion.fromRotationMatrix3=function(matrix,quat){var _Mathsqrt=Math.sqrt,fTrace=matrix[0]+matrix[4]+matrix[8],fRoot;if(0<fTrace){fRoot=_Mathsqrt(fTrace+1);quat[3]=.5*fRoot;fRoot=.5/fRoot;quat[0]=(matrix[5]-matrix[7])*fRoot;quat[1]=(matrix[6]-matrix[2])*fRoot;quat[2]=(matrix[1]-matrix[3])*fRoot}else{var i=0;if(matrix[4]>matrix[0])i=1;if(matrix[8]>matrix[3*i+i])i=2;var j=(i+1)%3,k=(i+2)%3;fRoot=_Mathsqrt(matrix[3*i+i]-matrix[3*j+j]-matrix[3*k+k]+1);quat[i]=.5*fRoot;fRoot=.5/fRoot;quat[3]=(matrix[3*j+k]-matrix[3*k+j])*fRoot;quat[j]=(matrix[3*j+i]+matrix[3*i+j])*fRoot;quat[k]=(matrix[3*k+i]+matrix[3*i+k])*fRoot;if(0>quat[3]){quat[0]=-quat[0];quat[1]=-quat[1];quat[2]=-quat[2];quat[3]=-quat[3]}}return quat};goog.vec.Quaternion.fromRotationMatrix4=function(matrix,quat){var _Mathsqrt2=Math.sqrt,fTrace=matrix[0]+matrix[5]+matrix[10],fRoot;if(0<fTrace){fRoot=_Mathsqrt2(fTrace+1);quat[3]=.5*fRoot;fRoot=.5/fRoot;quat[0]=(matrix[6]-matrix[9])*fRoot;quat[1]=(matrix[8]-matrix[2])*fRoot;quat[2]=(matrix[1]-matrix[4])*fRoot}else{var i=0;if(matrix[8]>matrix[0])i=1;if(matrix[10]>matrix[4*i+i])i=2;var j=(i+1)%3,k=(i+2)%3;fRoot=_Mathsqrt2(matrix[4*i+i]-matrix[4*j+j]-matrix[4*k+k]+1);quat[i]=.5*fRoot;fRoot=.5/fRoot;quat[3]=(matrix[4*j+k]-matrix[4*k+j])*fRoot;quat[j]=(matrix[4*j+i]+matrix[4*i+j])*fRoot;quat[k]=(matrix[4*k+i]+matrix[4*i+k])*fRoot;if(0>quat[3]){quat[0]=-quat[0];quat[1]=-quat[1];quat[2]=-quat[2];quat[3]=-quat[3]}}return quat};goog.vec.Quaternion.toRotationMatrix3=function(quat,matrix){var x=quat[0],y=quat[1],z=quat[2],w=quat[3],x2=2*x,y2=2*y,z2=2*z,wx=x2*w,wy=y2*w,wz=z2*w,xx=x2*x,xy=y2*x,xz=z2*x,yy=y2*y,yz=z2*y,zz=z2*z;matrix[0]=1-(yy+zz);matrix[1]=xy+wz;matrix[2]=xz-wy;matrix[3]=xy-wz;matrix[4]=1-(xx+zz);matrix[5]=yz+wx;matrix[6]=xz+wy;matrix[7]=yz-wx;matrix[8]=1-(xx+yy);return matrix};goog.vec.Quaternion.toRotationMatrix4=function(quat,matrix){var x=quat[0],y=quat[1],z=quat[2],w=quat[3],x2=2*x,y2=2*y,z2=2*z,wx=x2*w,wy=y2*w,wz=z2*w,xx=x2*x,xy=y2*x,xz=z2*x,yy=y2*y,yz=z2*y,zz=z2*z;matrix[0]=1-(yy+zz);matrix[1]=xy+wz;matrix[2]=xz-wy;matrix[3]=0;matrix[4]=xy-wz;matrix[5]=1-(xx+zz);matrix[6]=yz+wx;matrix[7]=0;matrix[8]=xz+wy;matrix[9]=yz-wx;matrix[10]=1-(xx+yy);matrix[11]=0;matrix[12]=0;matrix[13]=0;matrix[14]=0;matrix[15]=1;return matrix};goog.vec.Quaternion.rotateX=function(quat,angle,resultQuat){angle*=.5;var ax=quat[0],ay=quat[1],az=quat[2],aw=quat[3],bx=Math.sin(angle),bw=Math.cos(angle);resultQuat[0]=ax*bw+aw*bx;resultQuat[1]=ay*bw+az*bx;resultQuat[2]=az*bw-ay*bx;resultQuat[3]=aw*bw-ax*bx;return resultQuat};goog.vec.Quaternion.rotateY=function(quat,angle,resultQuat){angle*=.5;var ax=quat[0],ay=quat[1],az=quat[2],aw=quat[3],by=Math.sin(angle),bw=Math.cos(angle);resultQuat[0]=ax*bw-az*by;resultQuat[1]=ay*bw+aw*by;resultQuat[2]=az*bw+ax*by;resultQuat[3]=aw*bw-ay*by;return resultQuat};goog.vec.Quaternion.rotateZ=function(quat,angle,resultQuat){angle*=.5;var ax=quat[0],ay=quat[1],az=quat[2],aw=quat[3],bz=Math.sin(angle),bw=Math.cos(angle);resultQuat[0]=ax*bw+ay*bz;resultQuat[1]=ay*bw-ax*bz;resultQuat[2]=az*bw+aw*bz;resultQuat[3]=aw*bw-az*bz;return resultQuat};goog.vec.Quaternion.transformVec=function(vec,quat,resultVec){var x=vec[0],y=vec[1],z=vec[2],qx=quat[0],qy=quat[1],qz=quat[2],qw=quat[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;resultVec[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;resultVec[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;resultVec[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;return resultVec};goog.vec.Quaternion.slerp=function(q0,q1,t,resultQuat){var _Mathsin=Math.sin,cosVal=goog.vec.Quaternion.dot(q0,q1);if(1<cosVal||-1>cosVal){goog.vec.Vec4.setFromArray(resultQuat,q1);return resultQuat}var factor=1;if(0>cosVal){factor=-1;cosVal=-cosVal}var angle=Math.acos(cosVal);if(angle<=goog.vec.EPSILON){goog.vec.Vec4.setFromArray(resultQuat,q1);return resultQuat}var invSinVal=1/_Mathsin(angle),c0=_Mathsin((1-t)*angle)*invSinVal,c1=factor*_Mathsin(t*angle)*invSinVal;resultQuat[0]=q0[0]*c0+q1[0]*c1;resultQuat[1]=q0[1]*c0+q1[1]*c1;resultQuat[2]=q0[2]*c0+q1[2]*c1;resultQuat[3]=q0[3]*c0+q1[3]*c1;return resultQuat};goog.vec.Quaternion.nlerp=goog.vec.Vec4.lerp;