goog.provide("goog.fx.css3.TransitionTest");goog.setTestOnly("goog.fx.css3.TransitionTest");goog.require("goog.dispose");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.events");goog.require("goog.fx.Transition");goog.require("goog.fx.css3.Transition");goog.require("goog.style.transition");goog.require("goog.testing.MockClock");goog.require("goog.testing.jsunit");goog.require("goog.testing.recordFunction");var transition,element,mockClock;function createTransition(element,duration){return new goog.fx.css3.Transition(element,duration,{opacity:0},{opacity:1},{property:"opacity",duration:duration,timing:"ease-in",delay:0})}function setUp(){mockClock=new goog.testing.MockClock(!0);element=goog.dom.createElement(goog.dom.TagName.DIV);document.body.appendChild(element)}function tearDown(){goog.dispose(transition);goog.dispose(mockClock);goog.dom.removeNode(element)}function testPlayEventFiredOnPlay(){if(!goog.style.transition.isSupported())return;transition=createTransition(element,10);var handlerCalled=!1;goog.events.listen(transition,goog.fx.Transition.EventType.PLAY,function(){handlerCalled=!0});transition.play();assertTrue(handlerCalled)}function testBeginEventFiredOnPlay(){if(!goog.style.transition.isSupported())return;transition=createTransition(element,10);var handlerCalled=!1;goog.events.listen(transition,goog.fx.Transition.EventType.BEGIN,function(){handlerCalled=!0});transition.play();assertTrue(handlerCalled)}function testFinishEventsFiredAfterFinish(){if(!goog.style.transition.isSupported())return;transition=createTransition(element,10);var finishHandlerCalled=!1,endHandlerCalled=!1;goog.events.listen(transition,goog.fx.Transition.EventType.FINISH,function(){finishHandlerCalled=!0});goog.events.listen(transition,goog.fx.Transition.EventType.END,function(){endHandlerCalled=!0});transition.play();mockClock.tick(1e4);assertTrue(finishHandlerCalled);assertTrue(endHandlerCalled)}function testEventsWhenTransitionIsUnsupported(){if(goog.style.transition.isSupported())return;transition=createTransition(element,10);var stopHandlerCalled=!1,finishHandlerCalled=!1,endHandlerCalled=!1,beginHandlerCalled=!1,playHandlerCalled=!1;goog.events.listen(transition,goog.fx.Transition.EventType.BEGIN,function(){beginHandlerCalled=!0});goog.events.listen(transition,goog.fx.Transition.EventType.PLAY,function(){playHandlerCalled=!0});goog.events.listen(transition,goog.fx.Transition.EventType.FINISH,function(){finishHandlerCalled=!0});goog.events.listen(transition,goog.fx.Transition.EventType.END,function(){endHandlerCalled=!0});goog.events.listen(transition,goog.fx.Transition.EventType.STOP,function(){stopHandlerCalled=!0});assertFalse(transition.play());assertTrue(beginHandlerCalled);assertTrue(playHandlerCalled);assertTrue(endHandlerCalled);assertTrue(finishHandlerCalled);transition.stop();assertFalse(stopHandlerCalled)}function testCallingStopDuringAnimationWorks(){if(!goog.style.transition.isSupported())return;transition=createTransition(element,10);var stopHandler=goog.testing.recordFunction(),endHandler=goog.testing.recordFunction(),finishHandler=goog.testing.recordFunction();goog.events.listen(transition,goog.fx.Transition.EventType.STOP,stopHandler);goog.events.listen(transition,goog.fx.Transition.EventType.END,endHandler);goog.events.listen(transition,goog.fx.Transition.EventType.FINISH,finishHandler);transition.play();mockClock.tick(1);transition.stop();assertEquals(1,stopHandler.getCallCount());assertEquals(1,endHandler.getCallCount());mockClock.tick(1e4);assertEquals(0,finishHandler.getCallCount())}function testCallingStopImmediatelyWorks(){if(!goog.style.transition.isSupported())return;transition=createTransition(element,10);var stopHandler=goog.testing.recordFunction(),endHandler=goog.testing.recordFunction(),finishHandler=goog.testing.recordFunction();goog.events.listen(transition,goog.fx.Transition.EventType.STOP,stopHandler);goog.events.listen(transition,goog.fx.Transition.EventType.END,endHandler);goog.events.listen(transition,goog.fx.Transition.EventType.FINISH,finishHandler);transition.play();transition.stop();assertEquals(1,stopHandler.getCallCount());assertEquals(1,endHandler.getCallCount());mockClock.tick(1e4);assertEquals(0,finishHandler.getCallCount())}function testCallingStopAfterAnimationDoesNothing(){if(!goog.style.transition.isSupported())return;transition=createTransition(element,10);var stopHandler=goog.testing.recordFunction(),endHandler=goog.testing.recordFunction(),finishHandler=goog.testing.recordFunction();goog.events.listen(transition,goog.fx.Transition.EventType.STOP,stopHandler);goog.events.listen(transition,goog.fx.Transition.EventType.END,endHandler);goog.events.listen(transition,goog.fx.Transition.EventType.FINISH,finishHandler);transition.play();mockClock.tick(1e4);transition.stop();assertEquals(0,stopHandler.getCallCount());assertEquals(1,endHandler.getCallCount());assertEquals(1,finishHandler.getCallCount())}