goog.module("goog.net.IframeLoadMonitorTest");goog.setTestOnly("goog.net.IframeLoadMonitorTest");var Promise=goog.require("goog.Promise"),Timer=goog.require("goog.Timer"),dom=goog.require("goog.dom"),TagName=goog.require("goog.dom.TagName"),events=goog.require("goog.events"),IframeLoadMonitor=goog.require("goog.net.IframeLoadMonitor"),jsunit=goog.require("goog.testing.jsunit"),testSuite=goog.require("goog.testing.testSuite"),TEST_FRAME_SRC="iframeloadmonitor_test_frame.html",frameParent;testSuite({setUpPage:function(){frameParent=dom.getElement("frame_parent")},tearDown:function(){dom.removeChildren(frameParent)},testIframeLoadMonitor:function(){var frame=dom.createDom(TagName.IFRAME),monitor=new IframeLoadMonitor(frame),monitorPromise=new Promise(function(resolve,reject){events.listen(monitor,IframeLoadMonitor.LOAD_EVENT,resolve)});assertFalse(monitor.isLoaded());frameParent.appendChild(frame);return monitorPromise.then(function(e){assertEquals(IframeLoadMonitor.LOAD_EVENT,e.type);assertTrue(monitor.isLoaded())})},testIframeLoadMonitor_withContentCheck:function(){var frame=dom.createDom(TagName.IFRAME),monitor=new IframeLoadMonitor(frame,!0),monitorPromise=new Promise(function(resolve,reject){events.listen(monitor,IframeLoadMonitor.LOAD_EVENT,resolve)});assertFalse(monitor.isLoaded());frameParent.appendChild(frame);return Timer.promise(10).then(function(){assertFalse("Monitor should not fire before content has loaded.",monitor.isLoaded());frame.src=TEST_FRAME_SRC;return monitorPromise}).then(function(e){assertEquals(IframeLoadMonitor.LOAD_EVENT,e.type);assertTrue(monitor.isLoaded())})}});