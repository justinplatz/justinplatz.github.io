goog.provide("goog.i18n.BidiFormatter");goog.require("goog.html.SafeHtml");goog.require("goog.i18n.bidi");goog.require("goog.i18n.bidi.Dir");goog.require("goog.i18n.bidi.Format");goog.i18n.BidiFormatter=function(contextDir,opt_alwaysSpan){this.contextDir_=goog.i18n.bidi.toDir(contextDir,!0);this.alwaysSpan_=!!opt_alwaysSpan};goog.i18n.BidiFormatter.prototype.getContextDir=function(){return this.contextDir_};goog.i18n.BidiFormatter.prototype.getAlwaysSpan=function(){return this.alwaysSpan_};goog.i18n.BidiFormatter.prototype.setContextDir=function(contextDir){this.contextDir_=goog.i18n.bidi.toDir(contextDir,!0)};goog.i18n.BidiFormatter.prototype.setAlwaysSpan=function(alwaysSpan){this.alwaysSpan_=alwaysSpan};goog.i18n.BidiFormatter.prototype.estimateDirection=goog.i18n.bidi.estimateDirection;goog.i18n.BidiFormatter.prototype.areDirectionalitiesOpposite_=function(dir1,dir2){return 0>+dir1*+dir2};goog.i18n.BidiFormatter.prototype.dirResetIfNeeded_=function(str,dir,opt_isHtml,opt_dirReset){if(opt_dirReset&&(this.areDirectionalitiesOpposite_(dir,this.contextDir_)||this.contextDir_==goog.i18n.bidi.Dir.LTR&&goog.i18n.bidi.endsWithRtl(str,opt_isHtml)||this.contextDir_==goog.i18n.bidi.Dir.RTL&&goog.i18n.bidi.endsWithLtr(str,opt_isHtml))){return this.contextDir_==goog.i18n.bidi.Dir.LTR?goog.i18n.bidi.Format.LRM:goog.i18n.bidi.Format.RLM}else{return""}};goog.i18n.BidiFormatter.prototype.dirAttrValue=function(str,opt_isHtml){return this.knownDirAttrValue(this.estimateDirection(str,opt_isHtml))};goog.i18n.BidiFormatter.prototype.knownDirAttrValue=function(dir){var resolvedDir=dir==goog.i18n.bidi.Dir.NEUTRAL?this.contextDir_:dir;return resolvedDir==goog.i18n.bidi.Dir.RTL?"rtl":"ltr"};goog.i18n.BidiFormatter.prototype.dirAttr=function(str,opt_isHtml){return this.knownDirAttr(this.estimateDirection(str,opt_isHtml))};goog.i18n.BidiFormatter.prototype.knownDirAttr=function(dir){if(dir!=this.contextDir_){return dir==goog.i18n.bidi.Dir.RTL?"dir=\"rtl\"":dir==goog.i18n.bidi.Dir.LTR?"dir=\"ltr\"":""}return""};goog.i18n.BidiFormatter.prototype.spanWrapSafeHtml=function(html,opt_dirReset){return this.spanWrapSafeHtmlWithKnownDir(null,html,opt_dirReset)};goog.i18n.BidiFormatter.prototype.spanWrapSafeHtmlWithKnownDir=function(dir,html,opt_dirReset){if(null==dir){dir=this.estimateDirection(goog.html.SafeHtml.unwrap(html),!0)}return this.spanWrapWithKnownDir_(dir,html,opt_dirReset)};goog.i18n.BidiFormatter.prototype.spanWrapWithKnownDir_=function(dir,html,opt_dirReset){opt_dirReset=opt_dirReset||opt_dirReset==void 0;var result,dirCondition=dir!=goog.i18n.bidi.Dir.NEUTRAL&&dir!=this.contextDir_;if(this.alwaysSpan_||dirCondition){var dirAttribute;if(dirCondition){dirAttribute=dir==goog.i18n.bidi.Dir.RTL?"rtl":"ltr"}result=goog.html.SafeHtml.create("span",{dir:dirAttribute},html)}else{result=html}var str=goog.html.SafeHtml.unwrap(html);result=goog.html.SafeHtml.concatWithDir(goog.i18n.bidi.Dir.NEUTRAL,result,this.dirResetIfNeeded_(str,dir,!0,opt_dirReset));return result};goog.i18n.BidiFormatter.prototype.unicodeWrap=function(str,opt_isHtml,opt_dirReset){return this.unicodeWrapWithKnownDir(null,str,opt_isHtml,opt_dirReset)};goog.i18n.BidiFormatter.prototype.unicodeWrapWithKnownDir=function(dir,str,opt_isHtml,opt_dirReset){if(null==dir){dir=this.estimateDirection(str,opt_isHtml)}return this.unicodeWrapWithKnownDir_(dir,str,opt_isHtml,opt_dirReset)};goog.i18n.BidiFormatter.prototype.unicodeWrapWithKnownDir_=function(dir,str,opt_isHtml,opt_dirReset){opt_dirReset=opt_dirReset||opt_dirReset==void 0;var result=[];if(dir!=goog.i18n.bidi.Dir.NEUTRAL&&dir!=this.contextDir_){result.push(dir==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.Format.RLE:goog.i18n.bidi.Format.LRE);result.push(str);result.push(goog.i18n.bidi.Format.PDF)}else{result.push(str)}result.push(this.dirResetIfNeeded_(str,dir,opt_isHtml,opt_dirReset));return result.join("")};goog.i18n.BidiFormatter.prototype.markAfter=function(str,opt_isHtml){return this.markAfterKnownDir(null,str,opt_isHtml)};goog.i18n.BidiFormatter.prototype.markAfterKnownDir=function(dir,str,opt_isHtml){if(null==dir){dir=this.estimateDirection(str,opt_isHtml)}return this.dirResetIfNeeded_(str,dir,opt_isHtml,!0)};goog.i18n.BidiFormatter.prototype.mark=function(){switch(this.contextDir_){case goog.i18n.bidi.Dir.LTR:return goog.i18n.bidi.Format.LRM;case goog.i18n.bidi.Dir.RTL:return goog.i18n.bidi.Format.RLM;default:return"";}};goog.i18n.BidiFormatter.prototype.startEdge=function(){return this.contextDir_==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT};goog.i18n.BidiFormatter.prototype.endEdge=function(){return this.contextDir_==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.LEFT:goog.i18n.bidi.RIGHT};