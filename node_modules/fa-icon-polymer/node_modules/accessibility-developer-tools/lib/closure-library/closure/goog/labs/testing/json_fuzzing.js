goog.provide("goog.labs.testing.JsonFuzzing");goog.require("goog.string");goog.require("goog.testing.PseudoRandom");goog.labs.testing.JsonFuzzing=function(opt_options,opt_seed){this.options_=opt_options||{jsonSize:10,numFields:5,arraySize:5,maxDepth:5};this.random_=new goog.testing.PseudoRandom(opt_seed);this.maxDepth_=this.options_.maxDepth};goog.labs.testing.JsonFuzzing.Options;goog.labs.testing.JsonFuzzing.prototype.newArray=function(){for(var result=[],depth=0,maxSize=this.options_.jsonSize,size=this.nextInt(1,maxSize),i=0;i<size;i++){result.push(this.nextElm_(depth))}return result};goog.labs.testing.JsonFuzzing.prototype.nextInt=function(min,max){var random=this.random_.random();return Math.floor(random*(max-min))+min};goog.labs.testing.JsonFuzzing.prototype.nextElmType_=function(){var random=this.random_.random();if(.5>random){return 0}else{return 1}};goog.labs.testing.JsonFuzzing.FieldType_={MESSAGE:0,ARRAY:1,STRING:2,NUMBER:3,BOOLEAN:4,NULL:5};goog.labs.testing.JsonFuzzing.prototype.nextFieldType_=function(){var FieldType=goog.labs.testing.JsonFuzzing.FieldType_,random=this.random_.random();if(.5>random){return FieldType.MESSAGE}else if(.6>random){return FieldType.ARRAY}else if(.7>random){return FieldType.STRING}else if(.8>random){return FieldType.NUMBER}else if(.9>random){return FieldType.BOOLEAN}else{return FieldType.NULL}};goog.labs.testing.JsonFuzzing.prototype.nextElm_=function(depth){switch(this.nextElmType_()){case 0:return this.nextMessage_(depth);case 1:return this.nextArray_(depth);default:throw Error("invalid elm type encounted.");}};goog.labs.testing.JsonFuzzing.prototype.nextMessage_=function(depth){if(depth>this.maxDepth_){return{}}for(var numFields=this.options_.numFields,random_num=this.nextInt(0,numFields),result={},i=0;i<random_num;i++){switch(this.nextFieldType_()){case 0:result["f"+i]=this.nextMessage_(depth++);continue;case 1:result["f"+i]=this.nextArray_(depth++);continue;case 2:result["f"+i]=goog.string.getRandomString();continue;case 3:result["f"+i]=this.nextNumber_();continue;case 4:result["f"+i]=this.nextBoolean_();continue;case 5:result["f"+i]=null;continue;default:throw Error("invalid field type encounted.");}}return result};goog.labs.testing.JsonFuzzing.prototype.nextArray_=function(depth){if(depth>this.maxDepth_){return[]}for(var size=this.options_.arraySize,random_size=this.nextInt(0,size),result=[],i=0;i<random_size;i++){switch(this.nextFieldType_()){case 0:result.push(this.nextMessage_(depth++));continue;case 1:result.push(this.nextArray_(depth++));continue;case 2:result.push(goog.string.getRandomString());continue;case 3:result.push(this.nextNumber_());continue;case 4:result.push(this.nextBoolean_());continue;case 5:result.push(null);continue;default:throw Error("invalid field type encounted.");}}return result};goog.labs.testing.JsonFuzzing.prototype.nextBoolean_=function(){var random=this.random_.random();return .5>random};goog.labs.testing.JsonFuzzing.prototype.nextNumber_=function(){var result=this.random_.random(),random=this.random_.random();if(.5>random){result*=1e3}random=this.random_.random();if(.5>random){result=Math.floor(result)}random=this.random_.random();if(.5>random){result*=-1}return result};