goog.provide("goog.uri.utils");goog.provide("goog.uri.utils.ComponentIndex");goog.provide("goog.uri.utils.QueryArray");goog.provide("goog.uri.utils.QueryValue");goog.provide("goog.uri.utils.StandardQueryParam");goog.require("goog.asserts");goog.require("goog.string");goog.uri.utils.CharCode_={AMPERSAND:38,EQUAL:61,HASH:35,QUESTION:63};goog.uri.utils.buildFromEncodedParts=function(opt_scheme,opt_userInfo,opt_domain,opt_port,opt_path,opt_queryData,opt_fragment){var out="";if(opt_scheme){out+=opt_scheme+":"}if(opt_domain){out+="//";if(opt_userInfo){out+=opt_userInfo+"@"}out+=opt_domain;if(opt_port){out+=":"+opt_port}}if(opt_path){out+=opt_path}if(opt_queryData){out+="?"+opt_queryData}if(opt_fragment){out+="#"+opt_fragment}return out};goog.uri.utils.splitRe_=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;goog.uri.utils.ComponentIndex={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7};goog.uri.utils.split=function(uri){return uri.match(goog.uri.utils.splitRe_)};goog.uri.utils.decodeIfPossible_=function(uri,opt_preserveReserved){if(!uri){return uri}return opt_preserveReserved?decodeURI(uri):decodeURIComponent(uri)};goog.uri.utils.getComponentByIndex_=function(componentIndex,uri){return goog.uri.utils.split(uri)[componentIndex]||null};goog.uri.utils.getScheme=function(uri){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.SCHEME,uri)};goog.uri.utils.getEffectiveScheme=function(uri){var scheme=goog.uri.utils.getScheme(uri);if(!scheme&&goog.global.self&&goog.global.self.location){var protocol=goog.global.self.location.protocol;scheme=protocol.substr(0,protocol.length-1)}return scheme?scheme.toLowerCase():""};goog.uri.utils.getUserInfoEncoded=function(uri){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.USER_INFO,uri)};goog.uri.utils.getUserInfo=function(uri){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getUserInfoEncoded(uri))};goog.uri.utils.getDomainEncoded=function(uri){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.DOMAIN,uri)};goog.uri.utils.getDomain=function(uri){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getDomainEncoded(uri),!0)};goog.uri.utils.getPort=function(uri){return+goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.PORT,uri)||null};goog.uri.utils.getPathEncoded=function(uri){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.PATH,uri)};goog.uri.utils.getPath=function(uri){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getPathEncoded(uri),!0)};goog.uri.utils.getQueryData=function(uri){return goog.uri.utils.getComponentByIndex_(goog.uri.utils.ComponentIndex.QUERY_DATA,uri)};goog.uri.utils.getFragmentEncoded=function(uri){var hashIndex=uri.indexOf("#");return 0>hashIndex?null:uri.substr(hashIndex+1)};goog.uri.utils.setFragmentEncoded=function(uri,fragment){return goog.uri.utils.removeFragment(uri)+(fragment?"#"+fragment:"")};goog.uri.utils.getFragment=function(uri){return goog.uri.utils.decodeIfPossible_(goog.uri.utils.getFragmentEncoded(uri))};goog.uri.utils.getHost=function(uri){var pieces=goog.uri.utils.split(uri);return goog.uri.utils.buildFromEncodedParts(pieces[goog.uri.utils.ComponentIndex.SCHEME],pieces[goog.uri.utils.ComponentIndex.USER_INFO],pieces[goog.uri.utils.ComponentIndex.DOMAIN],pieces[goog.uri.utils.ComponentIndex.PORT])};goog.uri.utils.getOrigin=function(uri){var pieces=goog.uri.utils.split(uri);return goog.uri.utils.buildFromEncodedParts(pieces[goog.uri.utils.ComponentIndex.SCHEME],null,pieces[goog.uri.utils.ComponentIndex.DOMAIN],pieces[goog.uri.utils.ComponentIndex.PORT])};goog.uri.utils.getPathAndAfter=function(uri){var pieces=goog.uri.utils.split(uri);return goog.uri.utils.buildFromEncodedParts(null,null,null,null,pieces[goog.uri.utils.ComponentIndex.PATH],pieces[goog.uri.utils.ComponentIndex.QUERY_DATA],pieces[goog.uri.utils.ComponentIndex.FRAGMENT])};goog.uri.utils.removeFragment=function(uri){var hashIndex=uri.indexOf("#");return 0>hashIndex?uri:uri.substr(0,hashIndex)};goog.uri.utils.haveSameDomain=function(uri1,uri2){var pieces1=goog.uri.utils.split(uri1),pieces2=goog.uri.utils.split(uri2);return pieces1[goog.uri.utils.ComponentIndex.DOMAIN]==pieces2[goog.uri.utils.ComponentIndex.DOMAIN]&&pieces1[goog.uri.utils.ComponentIndex.SCHEME]==pieces2[goog.uri.utils.ComponentIndex.SCHEME]&&pieces1[goog.uri.utils.ComponentIndex.PORT]==pieces2[goog.uri.utils.ComponentIndex.PORT]};goog.uri.utils.assertNoFragmentsOrQueries_=function(uri){if(goog.DEBUG&&(0<=uri.indexOf("#")||0<=uri.indexOf("?"))){throw Error("goog.uri.utils: Fragment or query identifiers are not "+"supported: ["+uri+"]")}};goog.uri.utils.QueryValue;goog.uri.utils.QueryArray;goog.uri.utils.parseQueryData=function(encodedQuery,callback){if(!encodedQuery){return}for(var pairs=encodedQuery.split("&"),i=0;i<pairs.length;i++){var indexOfEquals=pairs[i].indexOf("="),name=null,value=null;if(0<=indexOfEquals){name=pairs[i].substring(0,indexOfEquals);value=pairs[i].substring(indexOfEquals+1)}else{name=pairs[i]}callback(name,value?goog.string.urlDecode(value):"")}};goog.uri.utils.appendQueryData_=function(buffer){if(buffer[1]){var baseUri=buffer[0],hashIndex=baseUri.indexOf("#");if(0<=hashIndex){buffer.push(baseUri.substr(hashIndex));buffer[0]=baseUri=baseUri.substr(0,hashIndex)}var questionIndex=baseUri.indexOf("?");if(0>questionIndex){buffer[1]="?"}else if(questionIndex==baseUri.length-1){buffer[1]=void 0}}return buffer.join("")};goog.uri.utils.appendKeyValuePairs_=function(key,value,pairs){if(goog.isArray(value)){goog.asserts.assertArray(value);for(var j=0;j<value.length;j++){goog.uri.utils.appendKeyValuePairs_(key,value[j]+"",pairs)}}else if(null!=value){pairs.push("&",key,""===value?"":"=",goog.string.urlEncode(value))}};goog.uri.utils.buildQueryDataBuffer_=function(buffer,keysAndValues,opt_startIndex){goog.asserts.assert(0==Math.max(keysAndValues.length-(opt_startIndex||0),0)%2,"goog.uri.utils: Key/value lists must be even in length.");for(var i=opt_startIndex||0;i<keysAndValues.length;i+=2){goog.uri.utils.appendKeyValuePairs_(keysAndValues[i],keysAndValues[i+1],buffer)}return buffer};goog.uri.utils.buildQueryData=function(keysAndValues,opt_startIndex){var buffer=goog.uri.utils.buildQueryDataBuffer_([],keysAndValues,opt_startIndex);buffer[0]="";return buffer.join("")};goog.uri.utils.buildQueryDataBufferFromMap_=function(buffer,map){for(var key in map){goog.uri.utils.appendKeyValuePairs_(key,map[key],buffer)}return buffer};goog.uri.utils.buildQueryDataFromMap=function(map){var buffer=goog.uri.utils.buildQueryDataBufferFromMap_([],map);buffer[0]="";return buffer.join("")};goog.uri.utils.appendParams=function(uri,var_args){return goog.uri.utils.appendQueryData_(2==arguments.length?goog.uri.utils.buildQueryDataBuffer_([uri],arguments[1],0):goog.uri.utils.buildQueryDataBuffer_([uri],arguments,1))};goog.uri.utils.appendParamsFromMap=function(uri,map){return goog.uri.utils.appendQueryData_(goog.uri.utils.buildQueryDataBufferFromMap_([uri],map))};goog.uri.utils.appendParam=function(uri,key,opt_value){var paramArr=[uri,"&",key];if(goog.isDefAndNotNull(opt_value)){paramArr.push("=",goog.string.urlEncode(opt_value))}return goog.uri.utils.appendQueryData_(paramArr)};goog.uri.utils.findParam_=function(uri,startIndex,keyEncoded,hashOrEndIndex){var index=startIndex,keyLength=keyEncoded.length;while(0<=(index=uri.indexOf(keyEncoded,index))&&index<hashOrEndIndex){var precedingChar=uri.charCodeAt(index-1);if(precedingChar==goog.uri.utils.CharCode_.AMPERSAND||precedingChar==goog.uri.utils.CharCode_.QUESTION){var followingChar=uri.charCodeAt(index+keyLength);if(!followingChar||followingChar==goog.uri.utils.CharCode_.EQUAL||followingChar==goog.uri.utils.CharCode_.AMPERSAND||followingChar==goog.uri.utils.CharCode_.HASH){return index}}index+=keyLength+1}return-1};goog.uri.utils.hashOrEndRe_=/#|$/;goog.uri.utils.hasParam=function(uri,keyEncoded){return 0<=goog.uri.utils.findParam_(uri,0,keyEncoded,uri.search(goog.uri.utils.hashOrEndRe_))};goog.uri.utils.getParamValue=function(uri,keyEncoded){var hashOrEndIndex=uri.search(goog.uri.utils.hashOrEndRe_),foundIndex=goog.uri.utils.findParam_(uri,0,keyEncoded,hashOrEndIndex);if(0>foundIndex){return null}else{var endPosition=uri.indexOf("&",foundIndex);if(0>endPosition||endPosition>hashOrEndIndex){endPosition=hashOrEndIndex}foundIndex+=keyEncoded.length+1;return goog.string.urlDecode(uri.substr(foundIndex,endPosition-foundIndex))}};goog.uri.utils.getParamValues=function(uri,keyEncoded){var hashOrEndIndex=uri.search(goog.uri.utils.hashOrEndRe_),position=0,foundIndex,result=[];while(0<=(foundIndex=goog.uri.utils.findParam_(uri,position,keyEncoded,hashOrEndIndex))){position=uri.indexOf("&",foundIndex);if(0>position||position>hashOrEndIndex){position=hashOrEndIndex}foundIndex+=keyEncoded.length+1;result.push(goog.string.urlDecode(uri.substr(foundIndex,position-foundIndex)))}return result};goog.uri.utils.trailingQueryPunctuationRe_=/[?&]($|#)/;goog.uri.utils.removeParam=function(uri,keyEncoded){var hashOrEndIndex=uri.search(goog.uri.utils.hashOrEndRe_),position=0,foundIndex,buffer=[];while(0<=(foundIndex=goog.uri.utils.findParam_(uri,position,keyEncoded,hashOrEndIndex))){buffer.push(uri.substring(position,foundIndex));position=Math.min(uri.indexOf("&",foundIndex)+1||hashOrEndIndex,hashOrEndIndex)}buffer.push(uri.substr(position));return buffer.join("").replace(goog.uri.utils.trailingQueryPunctuationRe_,"$1")};goog.uri.utils.setParam=function(uri,keyEncoded,value){return goog.uri.utils.appendParam(goog.uri.utils.removeParam(uri,keyEncoded),keyEncoded,value)};goog.uri.utils.appendPath=function(baseUri,path){goog.uri.utils.assertNoFragmentsOrQueries_(baseUri);if(goog.string.endsWith(baseUri,"/")){baseUri=baseUri.substr(0,baseUri.length-1)}if(goog.string.startsWith(path,"/")){path=path.substr(1)}return goog.string.buildString(baseUri,"/",path)};goog.uri.utils.setPath=function(uri,path){if(!goog.string.startsWith(path,"/")){path="/"+path}var parts=goog.uri.utils.split(uri);return goog.uri.utils.buildFromEncodedParts(parts[goog.uri.utils.ComponentIndex.SCHEME],parts[goog.uri.utils.ComponentIndex.USER_INFO],parts[goog.uri.utils.ComponentIndex.DOMAIN],parts[goog.uri.utils.ComponentIndex.PORT],path,parts[goog.uri.utils.ComponentIndex.QUERY_DATA],parts[goog.uri.utils.ComponentIndex.FRAGMENT])};goog.uri.utils.StandardQueryParam={RANDOM:"zx"};goog.uri.utils.makeUnique=function(uri){return goog.uri.utils.setParam(uri,goog.uri.utils.StandardQueryParam.RANDOM,goog.string.getRandomString())};