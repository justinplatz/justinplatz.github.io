goog.provide("goog.soyTest");goog.setTestOnly("goog.soyTest");goog.require("goog.dom");goog.require("goog.dom.NodeType");goog.require("goog.dom.TagName");goog.require("goog.functions");goog.require("goog.soy");goog.require("goog.soy.testHelper");goog.require("goog.testing.PropertyReplacer");goog.require("goog.testing.jsunit");var stubs;function setUp(){stubs=new goog.testing.PropertyReplacer}function tearDown(){stubs.reset()}function testRenderHtml(){var testDiv=goog.dom.createElement(goog.dom.TagName.DIV);goog.soy.renderHtml(testDiv,example.sanitizedHtmlTemplate());assertEquals("hello <b>world</b>",testDiv.innerHTML.toLowerCase())}function testRenderElement(){var testDiv=goog.dom.createElement(goog.dom.TagName.DIV);goog.soy.renderElement(testDiv,example.multiRootTemplate,{name:"Boo"});assertEquals("<div>Hello</div><div>Boo</div>",elementToInnerHtml(testDiv))}function testRenderElementWithNoTemplateData(){var testDiv=goog.dom.createElement(goog.dom.TagName.DIV);goog.soy.renderElement(testDiv,example.noDataTemplate);assertEquals("<div>Hello</div>",elementToInnerHtml(testDiv))}function testRenderAsFragmentTextNode(){var fragment=goog.soy.renderAsFragment(example.textNodeTemplate,{name:"Boo"});assertEquals(goog.dom.NodeType.TEXT,fragment.nodeType);assertEquals("Boo",fragmentToHtml(fragment))}function testRenderAsFragmentInjectedData(){var fragment=goog.soy.renderAsFragment(example.injectedDataTemplate,{name:"Boo"},{name:"ijBoo"});assertEquals(goog.dom.NodeType.TEXT,fragment.nodeType);assertEquals("BooijBoo",fragmentToHtml(fragment))}function testRenderAsFragmentSingleRoot(){var fragment=goog.soy.renderAsFragment(example.singleRootTemplate,{name:"Boo"});assertEquals(goog.dom.NodeType.ELEMENT,fragment.nodeType);assertEquals(goog.dom.TagName.SPAN+"",fragment.tagName);assertEquals("Boo",fragment.innerHTML)}function testRenderAsFragmentMultiRoot(){var fragment=goog.soy.renderAsFragment(example.multiRootTemplate,{name:"Boo"});assertEquals(goog.dom.NodeType.DOCUMENT_FRAGMENT,fragment.nodeType);assertEquals("<div>Hello</div><div>Boo</div>",fragmentToHtml(fragment))}function testRenderAsFragmentNoData(){var fragment=goog.soy.renderAsFragment(example.noDataTemplate);assertEquals(goog.dom.NodeType.ELEMENT,fragment.nodeType);assertEquals("<div>Hello</div>",fragmentToHtml(fragment))}function testRenderAsElementTextNode(){var elem=goog.soy.renderAsElement(example.textNodeTemplate,{name:"Boo"});assertEquals(goog.dom.NodeType.ELEMENT,elem.nodeType);assertEquals(goog.dom.TagName.DIV+"",elem.tagName);assertEquals("Boo",elementToInnerHtml(elem))}function testRenderAsElementInjectedData(){var elem=goog.soy.renderAsElement(example.injectedDataTemplate,{name:"Boo"},{name:"ijBoo"});assertEquals(goog.dom.NodeType.ELEMENT,elem.nodeType);assertEquals(goog.dom.TagName.DIV+"",elem.tagName);assertEquals("BooijBoo",elementToInnerHtml(elem))}function testRenderAsElementSingleRoot(){var elem=goog.soy.renderAsElement(example.singleRootTemplate,{name:"Boo"});assertEquals(goog.dom.NodeType.ELEMENT,elem.nodeType);assertEquals(goog.dom.TagName.SPAN+"",elem.tagName);assertEquals("Boo",elementToInnerHtml(elem))}function testRenderAsElementMultiRoot(){var elem=goog.soy.renderAsElement(example.multiRootTemplate,{name:"Boo"});assertEquals(goog.dom.NodeType.ELEMENT,elem.nodeType);assertEquals(goog.dom.TagName.DIV+"",elem.tagName);assertEquals("<div>Hello</div><div>Boo</div>",elementToInnerHtml(elem))}function testRenderAsElementWithNoData(){var elem=goog.soy.renderAsElement(example.noDataTemplate);assertEquals("Hello",elementToInnerHtml(elem))}function testConvertToElement(){var elem=goog.soy.convertToElement(example.sanitizedHtmlTemplate());assertEquals(goog.dom.NodeType.ELEMENT,elem.nodeType);assertEquals(goog.dom.TagName.DIV+"",elem.tagName);assertEquals("hello <b>world</b>",elem.innerHTML.toLowerCase())}function assertUnsafeTemplateOutputErrorThrown(func){stubs.set(goog.asserts,"ENABLE_ASSERTS",!0);assertContains("Soy template output is unsafe for use as HTML",assertThrows(func).message);stubs.set(goog.asserts,"ENABLE_ASSERTS",!1);assertEquals("zSoyz",func())}function testAllowButEscapeUnsanitizedText(){var div=goog.dom.createElement(goog.dom.TagName.DIV);goog.soy.renderElement(div,example.unsanitizedTextTemplate);assertEquals("I &lt;3 Puppies &amp; Kittens",div.innerHTML);var fragment=goog.soy.renderAsFragment(example.unsanitizedTextTemplate);assertEquals("I <3 Puppies & Kittens",fragment.nodeValue);assertEquals("I &lt;3 Puppies &amp; Kittens",goog.soy.renderAsElement(example.unsanitizedTextTemplate).innerHTML)}function testRejectSanitizedCss(){assertUnsafeTemplateOutputErrorThrown(function(){goog.soy.renderAsElement(example.sanitizedCssTemplate)})}function testRejectSanitizedCss(){assertUnsafeTemplateOutputErrorThrown(function(){return goog.soy.renderAsElement(example.templateSpoofingSanitizedContentString).innerHTML})}function testRejectStringTemplatesWhenModeIsSet(){stubs.set(goog.soy,"REQUIRE_STRICT_AUTOESCAPE",!0);assertUnsafeTemplateOutputErrorThrown(function(){return goog.soy.renderAsElement(example.noDataTemplate).innerHTML})}function testAcceptSanitizedHtml(){assertEquals("Hello World",goog.dom.getTextContent(goog.soy.renderAsElement(example.sanitizedHtmlTemplate)))}function testRejectSanitizedHtmlAttributes(){assertUnsafeTemplateOutputErrorThrown(function(){return goog.dom.getTextContent(goog.soy.renderAsElement(example.sanitizedHtmlAttributesTemplate))})}function testAcceptNonObject(){assertEquals("null",goog.dom.getTextContent(goog.soy.renderAsElement(goog.functions.constant(null))))}function testDebugAssertionWithBadFirstTag(){try{goog.soy.renderAsElement(example.tableRowTemplate);assert(!goog.DEBUG)}catch(e){assert(goog.DEBUG);assertContains("<tr>",e.message)}try{goog.soy.renderAsFragment(example.tableRowTemplate);assert(!goog.DEBUG)}catch(e){assert(goog.DEBUG);assertContains("<tr>",e.message)}try{goog.soy.renderAsElement(example.colGroupTemplateCaps);assert(!goog.DEBUG)}catch(e){assert(goog.DEBUG);assertContains("<COLGROUP>",e.message)}}