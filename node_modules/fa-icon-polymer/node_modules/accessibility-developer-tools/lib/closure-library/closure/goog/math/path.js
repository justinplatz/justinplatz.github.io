goog.provide("goog.math.Path");goog.provide("goog.math.Path.Segment");goog.require("goog.array");goog.require("goog.math");goog.math.Path=function(){this.segments_=[];this.count_=[];this.arguments_=[];this.closePoint_=null;this.currentPoint_=null;this.simple_=!0};goog.math.Path.Segment={MOVETO:0,LINETO:1,CURVETO:2,ARCTO:3,CLOSE:4};goog.math.Path.segmentArgCounts_=function(){var counts=[];counts[goog.math.Path.Segment.MOVETO]=2;counts[goog.math.Path.Segment.LINETO]=2;counts[goog.math.Path.Segment.CURVETO]=6;counts[goog.math.Path.Segment.ARCTO]=6;counts[goog.math.Path.Segment.CLOSE]=0;return counts}();goog.math.Path.prototype.getSegmentTypes=function(){return this.segments_.concat()};goog.math.Path.prototype.getSegmentCounts=function(){return this.count_.concat()};goog.math.Path.prototype.getSegmentArgs=function(){return this.arguments_.concat()};goog.math.Path.getSegmentCount=function(segment){return goog.math.Path.segmentArgCounts_[segment]};goog.math.Path.prototype.appendPath=function(path){if(path.currentPoint_){Array.prototype.push.apply(this.segments_,path.segments_);Array.prototype.push.apply(this.count_,path.count_);Array.prototype.push.apply(this.arguments_,path.arguments_);this.currentPoint_=path.currentPoint_.concat();this.closePoint_=path.closePoint_.concat();this.simple_=this.simple_&&path.simple_}return this};goog.math.Path.prototype.clear=function(){this.segments_.length=0;this.count_.length=0;this.arguments_.length=0;this.closePoint_=null;this.currentPoint_=null;this.simple_=!0;return this};goog.math.Path.prototype.moveTo=function(x,y){if(goog.array.peek(this.segments_)==goog.math.Path.Segment.MOVETO){this.arguments_.length-=2}else{this.segments_.push(goog.math.Path.Segment.MOVETO);this.count_.push(1)}this.arguments_.push(x,y);this.currentPoint_=this.closePoint_=[x,y];return this};goog.math.Path.prototype.lineTo=function(var_args){return this.lineTo_(arguments)};goog.math.Path.prototype.lineToFromArray=function(coordinates){return this.lineTo_(coordinates)};goog.math.Path.prototype.lineTo_=function(coordinates){var lastSegment=goog.array.peek(this.segments_);if(null==lastSegment){throw Error("Path cannot start with lineTo")}if(lastSegment!=goog.math.Path.Segment.LINETO){this.segments_.push(goog.math.Path.Segment.LINETO);this.count_.push(0)}for(var i=0;i<coordinates.length;i+=2){var x=coordinates[i],y=coordinates[i+1];this.arguments_.push(x,y)}this.count_[this.count_.length-1]+=i/2;this.currentPoint_=[x,y];return this};goog.math.Path.prototype.curveTo=function(var_args){return this.curveTo_(arguments)};goog.math.Path.prototype.curveToFromArray=function(coordinates){return this.curveTo_(coordinates)};goog.math.Path.prototype.curveTo_=function(coordinates){var lastSegment=goog.array.peek(this.segments_);if(null==lastSegment){throw Error("Path cannot start with curve")}if(lastSegment!=goog.math.Path.Segment.CURVETO){this.segments_.push(goog.math.Path.Segment.CURVETO);this.count_.push(0)}for(var i=0;i<coordinates.length;i+=6){var x=coordinates[i+4],y=coordinates[i+5];this.arguments_.push(coordinates[i],coordinates[i+1],coordinates[i+2],coordinates[i+3],x,y)}this.count_[this.count_.length-1]+=i/6;this.currentPoint_=[x,y];return this};goog.math.Path.prototype.close=function(){var lastSegment=goog.array.peek(this.segments_);if(null==lastSegment){throw Error("Path cannot start with close")}if(lastSegment!=goog.math.Path.Segment.CLOSE){this.segments_.push(goog.math.Path.Segment.CLOSE);this.count_.push(1);this.currentPoint_=this.closePoint_}return this};goog.math.Path.prototype.arc=function(cx,cy,rx,ry,fromAngle,extent,connect){var startX=cx+goog.math.angleDx(fromAngle,rx),startY=cy+goog.math.angleDy(fromAngle,ry);if(connect){if(!this.currentPoint_||startX!=this.currentPoint_[0]||startY!=this.currentPoint_[1]){this.lineTo(startX,startY)}}else{this.moveTo(startX,startY)}return this.arcTo(rx,ry,fromAngle,extent)};goog.math.Path.prototype.arcTo=function(rx,ry,fromAngle,extent){var cx=this.currentPoint_[0]-goog.math.angleDx(fromAngle,rx),cy=this.currentPoint_[1]-goog.math.angleDy(fromAngle,ry),ex=cx+goog.math.angleDx(fromAngle+extent,rx),ey=cy+goog.math.angleDy(fromAngle+extent,ry);this.segments_.push(goog.math.Path.Segment.ARCTO);this.count_.push(1);this.arguments_.push(rx,ry,fromAngle,extent,ex,ey);this.simple_=!1;this.currentPoint_=[ex,ey];return this};goog.math.Path.prototype.arcToAsCurves=function(rx,ry,fromAngle,extent){for(var _Mathsin=Math.sin,_Mathcos=Math.cos,cx=this.currentPoint_[0]-goog.math.angleDx(fromAngle,rx),cy=this.currentPoint_[1]-goog.math.angleDy(fromAngle,ry),extentRad=goog.math.toRadians(extent),arcSegs=Math.ceil(2*(Math.abs(extentRad)/Math.PI)),inc=extentRad/arcSegs,angle=goog.math.toRadians(fromAngle),j=0;j<arcSegs;j++){var relX=_Mathcos(angle),relY=_Mathsin(angle),z=4/3*_Mathsin(inc/2)/(1+_Mathcos(inc/2)),c0=cx+(relX-z*relY)*rx,c1=cy+(relY+z*relX)*ry;angle+=inc;relX=_Mathcos(angle);relY=_Mathsin(angle);this.curveTo(c0,c1,cx+(relX+z*relY)*rx,cy+(relY-z*relX)*ry,cx+relX*rx,cy+relY*ry)}return this};goog.math.Path.prototype.forEachSegment=function(callback){for(var points=this.arguments_,index=0,i=0,length=this.segments_.length;i<length;i++){var seg=this.segments_[i],n=goog.math.Path.segmentArgCounts_[seg]*this.count_[i];callback(seg,points.slice(index,index+n));index+=n}};goog.math.Path.prototype.getCurrentPoint=function(){return this.currentPoint_&&this.currentPoint_.concat()};goog.math.Path.prototype.clone=function(){var path=new goog.math.Path;path.segments_=this.segments_.concat();path.count_=this.count_.concat();path.arguments_=this.arguments_.concat();path.closePoint_=this.closePoint_&&this.closePoint_.concat();path.currentPoint_=this.currentPoint_&&this.currentPoint_.concat();path.simple_=this.simple_;return path};goog.math.Path.prototype.isSimple=function(){return this.simple_};goog.math.Path.simplifySegmentMap_=function(){var map={};map[goog.math.Path.Segment.MOVETO]=goog.math.Path.prototype.moveTo;map[goog.math.Path.Segment.LINETO]=goog.math.Path.prototype.lineTo;map[goog.math.Path.Segment.CLOSE]=goog.math.Path.prototype.close;map[goog.math.Path.Segment.CURVETO]=goog.math.Path.prototype.curveTo;map[goog.math.Path.Segment.ARCTO]=goog.math.Path.prototype.arcToAsCurves;return map}();goog.math.Path.createSimplifiedPath=function(src){if(src.isSimple()){return src.clone()}var path=new goog.math.Path;src.forEachSegment(function(segment,args){goog.math.Path.simplifySegmentMap_[segment].apply(path,args)});return path};goog.math.Path.prototype.createTransformedPath=function(tx){var path=goog.math.Path.createSimplifiedPath(this);path.transform(tx);return path};goog.math.Path.prototype.transform=function(tx){if(!this.isSimple()){throw Error("Non-simple path")}tx.transform(this.arguments_,0,this.arguments_,0,this.arguments_.length/2);if(this.closePoint_){tx.transform(this.closePoint_,0,this.closePoint_,0,1)}if(this.currentPoint_&&this.closePoint_!=this.currentPoint_){tx.transform(this.currentPoint_,0,this.currentPoint_,0,1)}return this};goog.math.Path.prototype.isEmpty=function(){return 0==this.segments_.length};