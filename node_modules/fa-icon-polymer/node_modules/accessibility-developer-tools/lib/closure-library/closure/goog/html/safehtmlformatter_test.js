goog.provide("goog.html.safeHtmlFormatterTest");goog.setTestOnly("goog.html.safeHtmlFormatterTest");goog.require("goog.html.SafeHtml");goog.require("goog.html.SafeHtmlFormatter");goog.require("goog.string");goog.require("goog.testing.jsunit");function testFormat(){var formatter=new goog.html.SafeHtmlFormatter;assertSameHtml("a <b class=\"bold\">&lt;bold&gt;</b> statement",formatter.format(goog.string.subs("a %s<bold>%s %s",formatter.startTag("b",{class:"bold"}),formatter.endTag("b"),formatter.text("statement"))))}function testFormatWithGetMsg(){var formatter=new goog.html.SafeHtmlFormatter;assertSameHtml("a <b class=\"bold\">&lt;bold&gt;</b> statement",formatter.format(goog.getMsg("a {$startBold}<bold>{$endBold} {$type}",{startBold:formatter.startTag("b",{class:"bold"}),endBold:formatter.endTag("b"),type:formatter.text("statement")})))}function testFormatWithText(){var formatter=new goog.html.SafeHtmlFormatter;assertSameHtml("dinner &lt;3",formatter.format("dinner <3"));assertSameHtml("dinner &lt;3",formatter.format(formatter.text("dinner <3")))}function testFormatWithSafeHtml(){var formatter=new goog.html.SafeHtmlFormatter;assertSameHtml("User input: <b>abc</b>",formatter.format("User input: "+formatter.safeHtml(goog.html.SafeHtml.create("b",{},"abc"))))}function testFormatWithInternalMarkers(){var formatter=new goog.html.SafeHtmlFormatter;assertSameHtml("{SafeHtmlFormatter:abc}",formatter.format("{SafeHtmlFormatter:abc}"));assertSameHtml("{SafeHtmlFormatter:<br>}",formatter.format("{SafeHtmlFormatter:"+formatter.startTag("br")+"}"));var br=formatter.startTag("br"),attackerInput=br;assertSameHtml(goog.string.htmlEscape(attackerInput)+"<br>",formatter.format(formatter.text(attackerInput)+br))}function testInvalidTag(){assertThrows(function(){formatter.startTag("a onclick=\"alert(1);\"")});assertThrows(function(){formatter.startTag("a",{onclick:"alert(1);"})});assertThrows(function(){formatter.startTag("script")});assertThrows(function(){formatter.endTag("script")})}function testFormatBalancingTags(){var formatter=new goog.html.SafeHtmlFormatter;formatter.format(formatter.startTag("br"));formatter.format(formatter.startTag("b")+formatter.endTag("b"));var endTag=formatter.endTag("b"),startTag=formatter.startTag("b");formatter.format(startTag+endTag);assertThrows(function(){formatter.format(formatter.endTag("b")+formatter.startTag("b"))});assertThrows(function(){formatter.format(formatter.startTag("b"))});assertThrows(function(){formatter.format(formatter.endTag("b"))})}function assertSameHtml(expected,html){assertEquals(expected,goog.html.SafeHtml.unwrap(html))}