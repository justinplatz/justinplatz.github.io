goog.provide("goog.storage.mechanism.mechanismTester");goog.require("goog.storage.mechanism.ErrorCode");goog.require("goog.testing.asserts");goog.require("goog.userAgent");goog.require("goog.userAgent.product");goog.require("goog.userAgent.product.isVersion");goog.setTestOnly("goog.storage.mechanism.mechanismTester");var mechanism=null,minimumQuota=0;function testSetGet(){if(!mechanism){return}mechanism.set("first","one");assertEquals("one",mechanism.get("first"))}function testChange(){if(!mechanism){return}mechanism.set("first","one");mechanism.set("first","two");assertEquals("two",mechanism.get("first"))}function testRemove(){if(!mechanism){return}mechanism.set("first","one");mechanism.remove("first");assertNull(mechanism.get("first"))}function testSetRemoveSet(){if(!mechanism){return}mechanism.set("first","one");mechanism.remove("first");mechanism.set("first","one");assertEquals("one",mechanism.get("first"))}function testRemoveRemove(){if(!mechanism){return}mechanism.remove("first");mechanism.remove("first");assertNull(mechanism.get("first"))}function testSetTwo(){if(!mechanism){return}mechanism.set("first","one");mechanism.set("second","two");assertEquals("one",mechanism.get("first"));assertEquals("two",mechanism.get("second"))}function testChangeTwo(){if(!mechanism){return}mechanism.set("first","one");mechanism.set("second","two");mechanism.set("second","three");mechanism.set("first","four");assertEquals("four",mechanism.get("first"));assertEquals("three",mechanism.get("second"))}function testSetRemoveThree(){if(!mechanism){return}mechanism.set("first","one");mechanism.set("second","two");mechanism.set("third","three");mechanism.remove("second");assertNull(mechanism.get("second"));assertEquals("one",mechanism.get("first"));assertEquals("three",mechanism.get("third"));mechanism.remove("first");assertNull(mechanism.get("first"));assertEquals("three",mechanism.get("third"));mechanism.remove("third");assertNull(mechanism.get("third"))}function testEmptyValue(){if(!mechanism){return}mechanism.set("third","");assertEquals("",mechanism.get("third"))}function testWeirdKeys(){if(!mechanism){return}mechanism.set(" ","space");mechanism.set("=+!@#$%^&*()-_\\|;:'\",./<>?[]{}~`","control");mechanism.set("\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D\u5341","ten");mechanism.set("\0","null");mechanism.set("\0\0","double null");mechanism.set("\0A","null A");mechanism.set("","zero");assertEquals("space",mechanism.get(" "));assertEquals("control",mechanism.get("=+!@#$%^&*()-_\\|;:'\",./<>?[]{}~`"));assertEquals("ten",mechanism.get("\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D\u5341"));if(!goog.userAgent.IE){assertEquals("null",mechanism.get("\0"));assertEquals("double null",mechanism.get("\0\0"));assertEquals("null A",mechanism.get("\0A"))}if(!goog.userAgent.GECKO){assertEquals("zero",mechanism.get(""))}}function testQuota(){if(!mechanism){return}if(goog.userAgent.product.SAFARI&&goog.userAgent.product.isVersion(4)&&!goog.userAgent.product.isVersion(5)){return}var buffer="\u03FF",savedBytes=0;try{while(buffer.length<minimumQuota){buffer=buffer+buffer;mechanism.set("foo",buffer);savedBytes=buffer.length}}catch(ex){if(ex!=goog.storage.mechanism.ErrorCode.QUOTA_EXCEEDED){throw ex}}mechanism.remove("foo");assertTrue(savedBytes>=minimumQuota)}