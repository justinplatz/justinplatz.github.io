goog.provide("goog.structs.AvlTree");goog.provide("goog.structs.AvlTree.Node");goog.require("goog.structs.Collection");goog.structs.AvlTree=function(opt_comparator){this.comparator_=opt_comparator||goog.structs.AvlTree.DEFAULT_COMPARATOR_};goog.structs.AvlTree.DEFAULT_COMPARATOR_=function(a,b){if(a+""<b+""){return-1}else if(a+"">b+""){return 1}return 0};goog.structs.AvlTree.prototype.root_=null;goog.structs.AvlTree.prototype.comparator_=null;goog.structs.AvlTree.prototype.minNode_=null;goog.structs.AvlTree.prototype.maxNode_=null;goog.structs.AvlTree.prototype.add=function(value){if(null==this.root_){this.root_=new goog.structs.AvlTree.Node(value);this.minNode_=this.root_;this.maxNode_=this.root_;return!0}var newNode=null;this.traverse_(function(node){var retNode=null,comparison=this.comparator_(node.value,value);if(0<comparison){retNode=node.left;if(null==node.left){newNode=new goog.structs.AvlTree.Node(value,node);node.left=newNode;if(node==this.minNode_){this.minNode_=newNode}}}else if(0>comparison){retNode=node.right;if(null==node.right){newNode=new goog.structs.AvlTree.Node(value,node);node.right=newNode;if(node==this.maxNode_){this.maxNode_=newNode}}}return retNode});if(newNode){this.traverse_(function(node){node.count++;return node.parent},newNode.parent);this.balance_(newNode.parent)}return!!newNode};goog.structs.AvlTree.prototype.remove=function(value){var retValue=null;this.traverse_(function(node){var retNode=null,comparison=this.comparator_(node.value,value);if(0<comparison){retNode=node.left}else if(0>comparison){retNode=node.right}else{retValue=node.value;this.removeNode_(node)}return retNode});return retValue};goog.structs.AvlTree.prototype.clear=function(){this.root_=null;this.minNode_=null;this.maxNode_=null};goog.structs.AvlTree.prototype.contains=function(value){var isContained=!1;this.traverse_(function(node){var retNode=null,comparison=this.comparator_(node.value,value);if(0<comparison){retNode=node.left}else if(0>comparison){retNode=node.right}else{isContained=!0}return retNode});return isContained};goog.structs.AvlTree.prototype.indexOf=function(value){var retIndex=-1,currIndex=0;this.traverse_(function(node){var comparison=this.comparator_(node.value,value);if(0<comparison){return node.left}if(node.left){currIndex+=node.left.count}if(0>comparison){currIndex++;return node.right}retIndex=currIndex;return null});return retIndex};goog.structs.AvlTree.prototype.getCount=function(){return this.root_?this.root_.count:0};goog.structs.AvlTree.prototype.getKthValue=function(k){if(0>k||k>=this.getCount()){return null}return this.getKthNode_(k).value};goog.structs.AvlTree.prototype.getMinimum=function(){return this.getMinNode_().value};goog.structs.AvlTree.prototype.getMaximum=function(){return this.getMaxNode_().value};goog.structs.AvlTree.prototype.getHeight=function(){return this.root_?this.root_.height:0};goog.structs.AvlTree.prototype.getValues=function(){var ret=[];this.inOrderTraverse(function(value){ret.push(value)});return ret};goog.structs.AvlTree.prototype.inOrderTraverse=function(func,opt_startValue){if(!this.root_){return}var startNode;if(opt_startValue!==void 0){this.traverse_(function(node){var retNode=null,comparison=this.comparator_(node.value,opt_startValue);if(0<comparison){retNode=node.left;startNode=node}else if(0>comparison){retNode=node.right}else{startNode=node}return retNode});if(!startNode){return}}else{startNode=this.getMinNode_()}var node=startNode,prev=startNode.left?startNode.left:startNode;while(null!=node){if(null!=node.left&&node.left!=prev&&node.right!=prev){node=node.left}else{if(node.right!=prev){if(func(node.value)){return}}var temp=node;node=null!=node.right&&node.right!=prev?node.right:node.parent;prev=temp}}};goog.structs.AvlTree.prototype.reverseOrderTraverse=function(func,opt_startValue){if(!this.root_){return}var startNode;if(opt_startValue!==void 0){this.traverse_(goog.bind(function(node){var retNode=null,comparison=this.comparator_(node.value,opt_startValue);if(0<comparison){retNode=node.left}else if(0>comparison){retNode=node.right;startNode=node}else{startNode=node}return retNode},this));if(!startNode){return}}else{startNode=this.getMaxNode_()}var node=startNode,prev=startNode.right?startNode.right:startNode;while(null!=node){if(null!=node.right&&node.right!=prev&&node.left!=prev){node=node.right}else{if(node.left!=prev){if(func(node.value)){return}}var temp=node;node=null!=node.left&&node.left!=prev?node.left:node.parent;prev=temp}}};goog.structs.AvlTree.prototype.traverse_=function(traversalFunc,opt_startNode,opt_endNode){var node=opt_startNode?opt_startNode:this.root_,endNode=opt_endNode?opt_endNode:null;while(node&&node!=endNode){node=traversalFunc.call(this,node)}};goog.structs.AvlTree.prototype.balance_=function(node){this.traverse_(function(node){var lh=node.left?node.left.height:0,rh=node.right?node.right.height:0;if(1<lh-rh){if(node.left.right&&(!node.left.left||node.left.left.height<node.left.right.height)){this.leftRotate_(node.left)}this.rightRotate_(node)}else if(1<rh-lh){if(node.right.left&&(!node.right.right||node.right.right.height<node.right.left.height)){this.rightRotate_(node.right)}this.leftRotate_(node)}lh=node.left?node.left.height:0;rh=node.right?node.right.height:0;node.height=Math.max(lh,rh)+1;return node.parent},node)};goog.structs.AvlTree.prototype.leftRotate_=function(node){if(node.isLeftChild()){node.parent.left=node.right;node.right.parent=node.parent}else if(node.isRightChild()){node.parent.right=node.right;node.right.parent=node.parent}else{this.root_=node.right;this.root_.parent=null}var temp=node.right;node.right=node.right.left;if(null!=node.right)node.right.parent=node;temp.left=node;node.parent=temp;temp.count=node.count;node.count-=(temp.right?temp.right.count:0)+1};goog.structs.AvlTree.prototype.rightRotate_=function(node){if(node.isLeftChild()){node.parent.left=node.left;node.left.parent=node.parent}else if(node.isRightChild()){node.parent.right=node.left;node.left.parent=node.parent}else{this.root_=node.left;this.root_.parent=null}var temp=node.left;node.left=node.left.right;if(null!=node.left)node.left.parent=node;temp.right=node;node.parent=temp;temp.count=node.count;node.count-=(temp.left?temp.left.count:0)+1};goog.structs.AvlTree.prototype.removeNode_=function(node){if(null!=node.left||null!=node.right){var b=null,r;if(null!=node.left){r=this.getMaxNode_(node.left);this.traverse_(function(node){node.count--;return node.parent},r);if(r!=node.left){r.parent.right=r.left;if(r.left)r.left.parent=r.parent;r.left=node.left;r.left.parent=r;b=r.parent}r.parent=node.parent;r.right=node.right;if(r.right)r.right.parent=r;if(node==this.maxNode_)this.maxNode_=r;r.count=node.count}else{r=this.getMinNode_(node.right);this.traverse_(function(node){node.count--;return node.parent},r);if(r!=node.right){r.parent.left=r.right;if(r.right)r.right.parent=r.parent;r.right=node.right;r.right.parent=r;b=r.parent}r.parent=node.parent;r.left=node.left;if(r.left)r.left.parent=r;if(node==this.minNode_)this.minNode_=r;r.count=node.count}if(node.isLeftChild()){node.parent.left=r}else if(node.isRightChild()){node.parent.right=r}else{this.root_=r}this.balance_(b?b:r)}else{this.traverse_(function(node){node.count--;return node.parent},node.parent);if(node.isLeftChild()){this.special=1;node.parent.left=null;if(node==this.minNode_)this.minNode_=node.parent;this.balance_(node.parent)}else if(node.isRightChild()){node.parent.right=null;if(node==this.maxNode_)this.maxNode_=node.parent;this.balance_(node.parent)}else{this.clear()}}};goog.structs.AvlTree.prototype.getKthNode_=function(k,opt_rootNode){var root=opt_rootNode||this.root_,numNodesInLeftSubtree=root.left?root.left.count:0;if(k<numNodesInLeftSubtree){return this.getKthNode_(k,root.left)}else if(k==numNodesInLeftSubtree){return root}else{return this.getKthNode_(k-numNodesInLeftSubtree-1,root.right)}};goog.structs.AvlTree.prototype.getMinNode_=function(opt_rootNode){if(!opt_rootNode){return this.minNode_}var minNode=opt_rootNode;this.traverse_(function(node){var retNode=null;if(node.left){minNode=node.left;retNode=node.left}return retNode},opt_rootNode);return minNode};goog.structs.AvlTree.prototype.getMaxNode_=function(opt_rootNode){if(!opt_rootNode){return this.maxNode_}var maxNode=opt_rootNode;this.traverse_(function(node){var retNode=null;if(node.right){maxNode=node.right;retNode=node.right}return retNode},opt_rootNode);return maxNode};goog.structs.AvlTree.Node=function(value,opt_parent){this.value=value;this.parent=opt_parent?opt_parent:null;this.count=1};goog.structs.AvlTree.Node.prototype.left=null;goog.structs.AvlTree.Node.prototype.right=null;goog.structs.AvlTree.Node.prototype.height=1;goog.structs.AvlTree.Node.prototype.isRightChild=function(){return!!this.parent&&this.parent.right==this};goog.structs.AvlTree.Node.prototype.isLeftChild=function(){return!!this.parent&&this.parent.left==this};