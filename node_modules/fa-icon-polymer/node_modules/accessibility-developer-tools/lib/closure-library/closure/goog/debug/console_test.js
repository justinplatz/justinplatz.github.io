goog.provide("goog.debug.ConsoleTest");goog.setTestOnly("goog.debug.ConsoleTest");goog.require("goog.debug.Console");goog.require("goog.debug.LogRecord");goog.require("goog.debug.Logger");goog.require("goog.testing.jsunit");goog.require("goog.testing.recordFunction");var debugConsole,mockConsole,loggerName1,logRecord1,loggerName2,logRecord2,loggerName3,logRecord3;function setUp(){debugConsole=new goog.debug.Console;mockConsole={log:goog.testing.recordFunction()};goog.debug.Console.console_=mockConsole;loggerName1="this.is.a.logger";logRecord1=new goog.debug.LogRecord(goog.debug.Logger.Level.INFO,"this is a statement",loggerName1);loggerName2="name.of.logger";logRecord2=new goog.debug.LogRecord(goog.debug.Logger.Level.WARNING,"hey, this is a warning",loggerName2);loggerName3="third.logger";logRecord3=new goog.debug.LogRecord(goog.debug.Logger.Level.SEVERE,"seriously, this statement is serious",loggerName3)}function testLoggingWithSimpleConsole(){logAtAllLevels("test message");assertEquals(9,mockConsole.log.getCallCount())}function testLoggingWithInfoSupported(){mockConsole.info=goog.testing.recordFunction();logAtAllLevels("test message");assertEquals(1,mockConsole.info.getCallCount());assertEquals(8,mockConsole.log.getCallCount())}function testLoggingWithErrorSupported(){mockConsole.error=goog.testing.recordFunction();logAtAllLevels("test message");assertEquals(1,mockConsole.error.getCallCount());assertEquals(8,mockConsole.log.getCallCount())}function testLoggingWithWarningSupported(){mockConsole.warn=goog.testing.recordFunction();logAtAllLevels("test message");assertEquals(1,mockConsole.warn.getCallCount());assertEquals(8,mockConsole.log.getCallCount())}function testLoggingWithDebugSupported(){mockConsole.debug=goog.testing.recordFunction();logAtAllLevels("test message");assertEquals(6,mockConsole.debug.getCallCount());assertEquals(3,mockConsole.log.getCallCount())}function testLoggingWithEverythingSupported(){mockConsole.info=goog.testing.recordFunction();mockConsole.error=goog.testing.recordFunction();mockConsole.warn=goog.testing.recordFunction();mockConsole.debug=goog.testing.recordFunction();logAtAllLevels("test message");assertEquals(1,mockConsole.info.getCallCount());assertEquals(1,mockConsole.error.getCallCount());assertEquals(1,mockConsole.warn.getCallCount());assertEquals(6,mockConsole.debug.getCallCount())}function testAddLogRecordWithoutFilters(){debugConsole.addLogRecord(logRecord1);assertEquals(1,mockConsole.log.getCallCount());debugConsole.addLogRecord(logRecord2);assertEquals(2,mockConsole.log.getCallCount());debugConsole.addLogRecord(logRecord3);assertEquals(3,mockConsole.log.getCallCount())}function testAddLogRecordWithOneFilter(){debugConsole.addFilter(loggerName2);debugConsole.addLogRecord(logRecord1);assertEquals(1,mockConsole.log.getCallCount());debugConsole.addLogRecord(logRecord2);assertEquals(1,mockConsole.log.getCallCount());debugConsole.addLogRecord(logRecord3);assertEquals(2,mockConsole.log.getCallCount())}function testAddLogRecordWithMoreThanOneFilter(){debugConsole.addFilter(loggerName1);debugConsole.addFilter(loggerName3);debugConsole.addLogRecord(logRecord1);assertEquals(0,mockConsole.log.getCallCount());debugConsole.addLogRecord(logRecord2);assertEquals(1,mockConsole.log.getCallCount());debugConsole.addLogRecord(logRecord3);assertEquals(1,mockConsole.log.getCallCount())}function testAddLogRecordWithAddAndRemoveFilter(){debugConsole.addFilter(loggerName1);debugConsole.addFilter(loggerName2);debugConsole.removeFilter(loggerName1);debugConsole.removeFilter(loggerName2);debugConsole.addLogRecord(logRecord1);assertEquals(1,mockConsole.log.getCallCount());debugConsole.addLogRecord(logRecord2);assertEquals(2,mockConsole.log.getCallCount());debugConsole.addLogRecord(logRecord3);assertEquals(3,mockConsole.log.getCallCount())}function testSetConsole(){var fakeConsole={log:goog.testing.recordFunction()};logAtLevel(goog.debug.Logger.Level.INFO,"test message 1");logAtAllLevels("test message 1");assertEquals(0,fakeConsole.log.getCallCount());goog.debug.Console.setConsole(fakeConsole);logAtLevel(goog.debug.Logger.Level.INFO,"test message 2");assertEquals(1,fakeConsole.log.getCallCount())}function logAtAllLevels(message){logAtLevel(goog.debug.Logger.Level.SHOUT,message);logAtLevel(goog.debug.Logger.Level.SEVERE,message);logAtLevel(goog.debug.Logger.Level.WARNING,message);logAtLevel(goog.debug.Logger.Level.INFO,message);logAtLevel(goog.debug.Logger.Level.CONFIG,message);logAtLevel(goog.debug.Logger.Level.FINE,message);logAtLevel(goog.debug.Logger.Level.FINER,message);logAtLevel(goog.debug.Logger.Level.FINEST,message);logAtLevel(goog.debug.Logger.Level.ALL,message)}function logAtLevel(level,message){debugConsole.addLogRecord(new goog.debug.LogRecord(level,message,loggerName1))}