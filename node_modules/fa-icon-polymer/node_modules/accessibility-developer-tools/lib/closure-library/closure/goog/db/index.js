goog.provide("goog.db.Index");goog.require("goog.async.Deferred");goog.require("goog.db.Cursor");goog.require("goog.db.Error");goog.require("goog.debug");goog.db.Index=function(index){this.index_=index};goog.db.Index.prototype.getName=function(){return this.index_.name};goog.db.Index.prototype.getKeyPath=function(){return this.index_.keyPath};goog.db.Index.prototype.isUnique=function(){return this.index_.unique};goog.db.Index.prototype.get_=function(fn,msg,key){var d=new goog.async.Deferred,request;try{request=this.index_[fn](key)}catch(err){msg+=" with key "+goog.debug.deepExpose(key);d.errback(goog.db.Error.fromException(err,msg));return d}request.onsuccess=function(ev){d.callback(ev.target.result)};request.onerror=function(ev){msg+=" with key "+goog.debug.deepExpose(key);d.errback(goog.db.Error.fromRequest(ev.target,msg))};return d};goog.db.Index.prototype.get=function(key){return this.get_("get","getting from index "+this.getName(),key)};goog.db.Index.prototype.getKey=function(key){return this.get_("getKey","getting key from index "+this.getName(),key)};goog.db.Index.prototype.getAll_=function(fn,msg,opt_key){var IDBKeyRange=goog.global.IDBKeyRange||goog.global.webkitIDBKeyRange,d=new goog.async.Deferred,request;try{if(opt_key){request=this.index_[fn](IDBKeyRange.only(opt_key))}else{request=this.index_[fn]()}}catch(err){if(opt_key){msg+=" for key "+goog.debug.deepExpose(opt_key)}d.errback(goog.db.Error.fromException(err,msg));return d}var result=[];request.onsuccess=function(ev){var cursor=ev.target.result;if(cursor){result.push(cursor.value);cursor["continue"]()}else{d.callback(result)}};request.onerror=function(ev){if(opt_key){msg+=" for key "+goog.debug.deepExpose(opt_key)}d.errback(goog.db.Error.fromRequest(ev.target,msg))};return d};goog.db.Index.prototype.getAll=function(opt_key){return this.getAll_("openCursor","getting all from index "+this.getName(),opt_key)};goog.db.Index.prototype.getAllKeys=function(opt_key){return this.getAll_("openKeyCursor","getting all keys from index "+this.getName(),opt_key)};goog.db.Index.prototype.openCursor=function(opt_range,opt_direction){return goog.db.Cursor.openCursor(this.index_,opt_range,opt_direction)};