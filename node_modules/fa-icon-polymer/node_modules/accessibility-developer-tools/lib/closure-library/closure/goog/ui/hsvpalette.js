goog.provide("goog.ui.HsvPalette");goog.require("goog.color");goog.require("goog.dom.InputType");goog.require("goog.dom.TagName");goog.require("goog.events");goog.require("goog.events.EventType");goog.require("goog.events.InputHandler");goog.require("goog.style");goog.require("goog.style.bidi");goog.require("goog.ui.Component");goog.require("goog.userAgent");goog.ui.HsvPalette=function(opt_domHelper,opt_color,opt_class){goog.ui.Component.call(this,opt_domHelper);this.setColorInternal(opt_color||"#f00");this.className=opt_class||goog.getCssName("goog-hsv-palette");this.document_=this.getDomHelper().getDocument()};goog.inherits(goog.ui.HsvPalette,goog.ui.Component);goog.tagUnsealableClass(goog.ui.HsvPalette);goog.ui.HsvPalette.MSG_HSV_PALETTE_HEX_COLOR_=goog.getMsg("Hex color");goog.ui.HsvPalette.prototype.hsImageEl_;goog.ui.HsvPalette.prototype.hsHandleEl_;goog.ui.HsvPalette.prototype.valueBackgroundImageElement;goog.ui.HsvPalette.prototype.vHandleEl_;goog.ui.HsvPalette.prototype.swatchElement;goog.ui.HsvPalette.prototype.inputElement;goog.ui.HsvPalette.prototype.inputHandler_;goog.ui.HsvPalette.prototype.mouseMoveListener;goog.ui.HsvPalette.prototype.mouseUpListener;goog.ui.HsvPalette.prototype.hsv_;goog.ui.HsvPalette.prototype.color;goog.ui.HsvPalette.prototype.getColor=function(){return this.color};goog.ui.HsvPalette.prototype.getAlpha=function(){return 1};goog.ui.HsvPalette.prototype.updateInput=function(){var parsed;try{parsed=goog.color.parse(this.inputElement.value).hex}catch(e){}if(this.color!=parsed){this.inputElement.value=this.color}};goog.ui.HsvPalette.prototype.setColor=function(color){if(color!=this.color){this.setColorInternal(color);this.updateUi();this.dispatchEvent(goog.ui.Component.EventType.ACTION)}};goog.ui.HsvPalette.prototype.setColorInternal=function(color){var rgbHex=goog.color.parse(color).hex,rgbArray=goog.color.hexToRgb(rgbHex);this.hsv_=goog.color.rgbArrayToHsv(rgbArray);this.hsv_[0]=this.hsv_[0]/360;this.color=rgbHex};goog.ui.HsvPalette.prototype.setHsv=function(opt_hue,opt_saturation,opt_value){if(null!=opt_hue||null!=opt_saturation||null!=opt_value){this.setHsv_(opt_hue,opt_saturation,opt_value);this.updateUi();this.dispatchEvent(goog.ui.Component.EventType.ACTION)}};goog.ui.HsvPalette.prototype.setHsv_=function(opt_hue,opt_saturation,opt_value){this.hsv_[0]=null!=opt_hue?opt_hue:this.hsv_[0];this.hsv_[1]=null!=opt_saturation?opt_saturation:this.hsv_[1];this.hsv_[2]=null!=opt_value?opt_value:this.hsv_[2];this.color=goog.color.hsvArrayToHex([360*this.hsv_[0],this.hsv_[1],this.hsv_[2]])};goog.ui.HsvPalette.prototype.canDecorate=function(element){return!1};goog.ui.HsvPalette.prototype.createDom=function(){var dom=this.getDomHelper(),noalpha=goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("7")?" "+goog.getCssName(this.className,"noalpha"):"",backdrop=dom.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"hs-backdrop"));this.hsHandleEl_=dom.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"hs-handle"));this.hsImageEl_=dom.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"hs-image"),this.hsHandleEl_);this.valueBackgroundImageElement=dom.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"v-image"));this.vHandleEl_=dom.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"v-handle"));this.swatchElement=dom.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"swatch"));this.inputElement=dom.createDom(goog.dom.TagName.INPUT,{class:goog.getCssName(this.className,"input"),"aria-label":goog.ui.HsvPalette.MSG_HSV_PALETTE_HEX_COLOR_,type:goog.dom.InputType.TEXT,dir:"ltr"});var labelElement=dom.createDom(goog.dom.TagName.LABEL,null,this.inputElement),element=dom.createDom(goog.dom.TagName.DIV,this.className+noalpha,backdrop,this.hsImageEl_,this.valueBackgroundImageElement,this.vHandleEl_,this.swatchElement,labelElement);this.setElementInternal(element)};goog.ui.HsvPalette.prototype.enterDocument=function(){goog.ui.HsvPalette.superClass_.enterDocument.call(this);this.updateUi();var handler=this.getHandler();handler.listen(this.getElement(),goog.events.EventType.MOUSEDOWN,this.handleMouseDown);if(!this.inputHandler_){this.inputHandler_=new goog.events.InputHandler(this.inputElement)}handler.listen(this.inputHandler_,goog.events.InputHandler.EventType.INPUT,this.handleInput)};goog.ui.HsvPalette.prototype.disposeInternal=function(){goog.ui.HsvPalette.superClass_.disposeInternal.call(this);delete this.hsImageEl_;delete this.hsHandleEl_;delete this.valueBackgroundImageElement;delete this.vHandleEl_;delete this.swatchElement;delete this.inputElement;if(this.inputHandler_){this.inputHandler_.dispose();delete this.inputHandler_}goog.events.unlistenByKey(this.mouseMoveListener);goog.events.unlistenByKey(this.mouseUpListener)};goog.ui.HsvPalette.prototype.updateUi=function(){var _Mathceil=Math.ceil;if(this.isInDocument()){var h=this.hsv_[0],s=this.hsv_[1],v=this.hsv_[2],left=this.hsImageEl_.offsetWidth*h;if(this.isRightToLeft()){left=this.hsImageEl_.offsetWidth-left}var handleOffset=_Mathceil(this.hsHandleEl_.offsetWidth/2);left-=handleOffset;var top=this.hsImageEl_.offsetHeight*(1-s);top-=_Mathceil(this.hsHandleEl_.offsetHeight/2);goog.style.bidi.setPosition(this.hsHandleEl_,left,top,this.isRightToLeft());top=this.valueBackgroundImageElement.offsetTop-Math.floor(this.vHandleEl_.offsetHeight/2)+this.valueBackgroundImageElement.offsetHeight*((255-v)/255);this.vHandleEl_.style.top=top+"px";goog.style.setOpacity(this.hsImageEl_,v/255);goog.style.setStyle(this.valueBackgroundImageElement,"background-color",goog.color.hsvToHex(360*this.hsv_[0],this.hsv_[1],255));goog.style.setStyle(this.swatchElement,"background-color",this.color);goog.style.setStyle(this.swatchElement,"color",this.hsv_[2]>255/2?"#000":"#fff");this.updateInput()}};goog.ui.HsvPalette.prototype.handleMouseDown=function(e){if(e.target==this.valueBackgroundImageElement||e.target==this.vHandleEl_){var b=goog.style.getBounds(this.valueBackgroundImageElement);this.handleMouseMoveV_(b,e);this.mouseMoveListener=goog.events.listen(this.document_,goog.events.EventType.MOUSEMOVE,goog.bind(this.handleMouseMoveV_,this,b));this.mouseUpListener=goog.events.listen(this.document_,goog.events.EventType.MOUSEUP,this.handleMouseUp,!1,this)}else if(e.target==this.hsImageEl_||e.target==this.hsHandleEl_){var b=goog.style.getBounds(this.hsImageEl_);this.handleMouseMoveHs_(b,e);this.mouseMoveListener=goog.events.listen(this.document_,goog.events.EventType.MOUSEMOVE,goog.bind(this.handleMouseMoveHs_,this,b));this.mouseUpListener=goog.events.listen(this.document_,goog.events.EventType.MOUSEUP,this.handleMouseUp,!1,this)}};goog.ui.HsvPalette.prototype.handleMouseMoveV_=function(b,e){e.preventDefault();var vportPos=this.getDomHelper().getDocumentScroll(),height=Math.min(Math.max(vportPos.y+e.clientY,b.top),b.top+b.height),newV=Math.round(255*(b.top+b.height-height)/b.height);this.setHsv(null,null,newV)};goog.ui.HsvPalette.prototype.handleMouseMoveHs_=function(b,e){var _Mathmin=Math.min,_Mathmax=Math.max;e.preventDefault();var vportPos=this.getDomHelper().getDocumentScroll(),newH=(_Mathmin(_Mathmax(vportPos.x+e.clientX,b.left),b.left+b.width)-b.left)/b.width,newS=(-_Mathmin(_Mathmax(vportPos.y+e.clientY,b.top),b.top+b.height)+b.top+b.height)/b.height;this.setHsv(newH,newS,null)};goog.ui.HsvPalette.prototype.handleMouseUp=function(e){goog.events.unlistenByKey(this.mouseMoveListener);goog.events.unlistenByKey(this.mouseUpListener)};goog.ui.HsvPalette.prototype.handleInput=function(e){if(/^#?[0-9a-f]{6}$/i.test(this.inputElement.value)){this.setColor(this.inputElement.value)}};