goog.provide("goog.fs.FileReader");goog.provide("goog.fs.FileReader.EventType");goog.provide("goog.fs.FileReader.ReadyState");goog.require("goog.async.Deferred");goog.require("goog.events.EventTarget");goog.require("goog.fs.Error");goog.require("goog.fs.ProgressEvent");goog.fs.FileReader=function(){goog.fs.FileReader.base(this,"constructor");this.reader_=new FileReader;this.reader_.onloadstart=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onprogress=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onload=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onabort=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onerror=goog.bind(this.dispatchProgressEvent_,this);this.reader_.onloadend=goog.bind(this.dispatchProgressEvent_,this)};goog.inherits(goog.fs.FileReader,goog.events.EventTarget);goog.fs.FileReader.ReadyState={INIT:0,LOADING:1,DONE:2};goog.fs.FileReader.EventType={LOAD_START:"loadstart",PROGRESS:"progress",LOAD:"load",ABORT:"abort",ERROR:"error",LOAD_END:"loadend"};goog.fs.FileReader.prototype.abort=function(){try{this.reader_.abort()}catch(e){throw new goog.fs.Error(e,"aborting read")}};goog.fs.FileReader.prototype.getReadyState=function(){return this.reader_.readyState};goog.fs.FileReader.prototype.getResult=function(){return this.reader_.result};goog.fs.FileReader.prototype.getError=function(){return this.reader_.error&&new goog.fs.Error(this.reader_.error,"reading file")};goog.fs.FileReader.prototype.dispatchProgressEvent_=function(event){this.dispatchEvent(new goog.fs.ProgressEvent(event,this))};goog.fs.FileReader.prototype.disposeInternal=function(){goog.fs.FileReader.base(this,"disposeInternal");delete this.reader_};goog.fs.FileReader.prototype.readAsBinaryString=function(blob){this.reader_.readAsBinaryString(blob)};goog.fs.FileReader.readAsBinaryString=function(blob){var reader=new goog.fs.FileReader,d=goog.fs.FileReader.createDeferred_(reader);reader.readAsBinaryString(blob);return d};goog.fs.FileReader.prototype.readAsArrayBuffer=function(blob){this.reader_.readAsArrayBuffer(blob)};goog.fs.FileReader.readAsArrayBuffer=function(blob){var reader=new goog.fs.FileReader,d=goog.fs.FileReader.createDeferred_(reader);reader.readAsArrayBuffer(blob);return d};goog.fs.FileReader.prototype.readAsText=function(blob,opt_encoding){this.reader_.readAsText(blob,opt_encoding)};goog.fs.FileReader.readAsText=function(blob,opt_encoding){var reader=new goog.fs.FileReader,d=goog.fs.FileReader.createDeferred_(reader);reader.readAsText(blob,opt_encoding);return d};goog.fs.FileReader.prototype.readAsDataUrl=function(blob){this.reader_.readAsDataURL(blob)};goog.fs.FileReader.readAsDataUrl=function(blob){var reader=new goog.fs.FileReader,d=goog.fs.FileReader.createDeferred_(reader);reader.readAsDataUrl(blob);return d};goog.fs.FileReader.createDeferred_=function(reader){var deferred=new goog.async.Deferred;reader.listen(goog.fs.FileReader.EventType.LOAD_END,goog.partial(function(d,r,e){var result=r.getResult(),error=r.getError();if(null!=result&&!error){d.callback(result)}else{d.errback(error)}r.dispose()},deferred,reader));return deferred};