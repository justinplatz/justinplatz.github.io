goog.provide("goog.formatTest");goog.setTestOnly("goog.formatTest");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.format");goog.require("goog.string");goog.require("goog.testing.PropertyReplacer");goog.require("goog.testing.jsunit");var propertyReplacer=new goog.testing.PropertyReplacer;function tearDown(){propertyReplacer.reset()}function testFormatFileSize(){var fileSize=goog.format.fileSize;assertEquals("45",fileSize(45));assertEquals("45",fileSize(45,0));assertEquals("45",fileSize(45,1));assertEquals("45",fileSize(45,3));assertEquals("454",fileSize(454));assertEquals("600",fileSize(600));assertEquals("1K",fileSize(1024));assertEquals("2K",fileSize(1024*2));assertEquals("5K",fileSize(1024*5));assertEquals("5.123K",fileSize(1024*5.12345,3));assertEquals("5.68K",fileSize(1024*5.678,2));assertEquals("1M",fileSize(1024*1024));assertEquals("1.5M",fileSize(1024*(1024*1.5)));assertEquals("2M",fileSize(1024*(1024*1.5),0));assertEquals("1.5M",fileSize(1024*(1024*1.51),1));assertEquals("1.56M",fileSize(1024*(1024*1.56),2));assertEquals("1G",fileSize(1024*(1024*1024)));assertEquals("6G",fileSize(1024*(1024*(1024*6))));assertEquals("12.06T",fileSize(1024*(1024*(1024*12345.6789))))}function testIsConvertableScaledNumber(){var isConvertableScaledNumber=goog.format.isConvertableScaledNumber;assertTrue(isConvertableScaledNumber("0"));assertTrue(isConvertableScaledNumber("45"));assertTrue(isConvertableScaledNumber("45K"));assertTrue(isConvertableScaledNumber("45MB"));assertTrue(isConvertableScaledNumber("45GB"));assertTrue(isConvertableScaledNumber("45T"));assertTrue(isConvertableScaledNumber("2.33P"));assertTrue(isConvertableScaledNumber("45m"));assertTrue(isConvertableScaledNumber("45u"));assertTrue(isConvertableScaledNumber("-5.0n"));assertFalse(isConvertableScaledNumber("45x"));assertFalse(isConvertableScaledNumber("ux"));assertFalse(isConvertableScaledNumber("K"))}function testNumericValueToString(){var numericValueToString=goog.format.numericValueToString;assertEquals("0",numericValueToString(0));assertEquals("45",numericValueToString(45));assertEquals("454",numericValueToString(454));assertEquals("600",numericValueToString(600));assertEquals("1.02K",numericValueToString(1024));assertEquals("2.05K",numericValueToString(1024*2));assertEquals("5.12K",numericValueToString(1024*5));assertEquals("5.246K",numericValueToString(1024*5.12345,3));assertEquals("5.81K",numericValueToString(1024*5.678,2));assertEquals("1.05M",numericValueToString(1024*1024));assertEquals("1.57M",numericValueToString(1024*(1024*1.5)));assertEquals("2M",numericValueToString(1024*(1024*1.5),0));assertEquals("1.6M",numericValueToString(1024*(1024*1.51),1));assertEquals("1.64M",numericValueToString(1024*(1024*1.56),2));assertEquals("1.07G",numericValueToString(1024*(1024*1024)));assertEquals("6.44G",numericValueToString(1024*(1024*(1024*6))));assertEquals("13.26T",numericValueToString(1024*(1024*(1024*12345.6789))));assertEquals("23.4m",numericValueToString(.0234));assertEquals("1.23u",numericValueToString(123e-8));assertEquals("15.78n",numericValueToString(1.5784e-8));assertEquals("0.58u",numericValueToString(5.784e-7));assertEquals("0.5",numericValueToString(.5));assertEquals("-45",numericValueToString(-45.3,0));assertEquals("-45",numericValueToString(-45.5,0));assertEquals("-46",numericValueToString(-45.51,0))}function testFormatNumBytes(){var numBytesToString=goog.format.numBytesToString;assertEquals("45",numBytesToString(45));assertEquals("454",numBytesToString(454));assertEquals("5KB",numBytesToString(1024*5));assertEquals("1MB",numBytesToString(1024*1024));assertEquals("6GB",numBytesToString(1024*(1024*(1024*6))));assertEquals("12.06TB",numBytesToString(1024*(1024*(1024*12345.6789))));assertEquals("454",numBytesToString(454,2,!0,!0));assertEquals("5 KB",numBytesToString(1024*5,2,!0,!0))}function testStringToNumeric(){var _Mathabs=Math.abs,stringToNumericValue=goog.format.stringToNumericValue,epsilon=1e-10;assertNaN(stringToNumericValue("foo"));assertEquals(45,stringToNumericValue("45"));assertEquals(-45,stringToNumericValue("-45"));assertEquals(-45,stringToNumericValue("-45"));assertEquals(454,stringToNumericValue("454"));assertEquals(1024*5,stringToNumericValue("5KB"));assertEquals(1024*1024,stringToNumericValue("1MB"));assertEquals(1024*(1024*(1024*6)),stringToNumericValue("6GB"));assertEquals(13260110230978.56,stringToNumericValue("12.06TB"));assertEquals(5010,stringToNumericValue("5.01K"));assertEquals(51e5,stringToNumericValue("5.1M"));assertTrue(_Mathabs(.051-stringToNumericValue("51.0m"))<epsilon);assertTrue(_Mathabs(51e-6-stringToNumericValue("51.0u"))<epsilon)}function testStringToNumBytes(){var stringToNumBytes=goog.format.stringToNumBytes;assertEquals(45,stringToNumBytes("45"));assertEquals(454,stringToNumBytes("454"));assertEquals(1024*5,stringToNumBytes("5K"));assertEquals(1024*1024,stringToNumBytes("1M"));assertEquals(1024*(1024*(1024*6)),stringToNumBytes("6G"));assertEquals(13260110230978.56,stringToNumBytes("12.06T"))}function testInsertWordBreaks(){propertyReplacer.set(goog.format,"WORD_BREAK_HTML","<wbr>");var insertWordBreaks=goog.format.insertWordBreaks;assertEquals("abcdef",insertWordBreaks("abcdef",10));assertEquals("ab<wbr>cd<wbr>ef",insertWordBreaks("abcdef",2));assertEquals("a<wbr>b<wbr>c<wbr>d<wbr>e<wbr>f",insertWordBreaks("abcdef",1));assertEquals("a&amp;b=<wbr>=fal<wbr>se",insertWordBreaks("a&amp;b==false",4));assertEquals("&lt;&amp;&gt;&raquo;<wbr>&laquo;",insertWordBreaks("&lt;&amp;&gt;&raquo;&laquo;",4));assertEquals("a<wbr>b<wbr>c d<wbr>e<wbr>f",insertWordBreaks("abc def",1));assertEquals("ab<wbr>c de<wbr>f",insertWordBreaks("abc def",2));assertEquals("abc def",insertWordBreaks("abc def",3));assertEquals("abc def",insertWordBreaks("abc def",4));assertEquals("a<b>cd</b>e<wbr>f",insertWordBreaks("a<b>cd</b>ef",4));assertEquals("Thi<wbr>s is a <a href=\"\">lin<wbr>k</a>.",insertWordBreaks("This is a <a href=\"\">link</a>.",3));assertEquals("<abc a=\"&amp;&amp;&amp;&amp;&amp;\">a<wbr>b",insertWordBreaks("<abc a=\"&amp;&amp;&amp;&amp;&amp;\">ab",1));assertEquals("ab\u0300<wbr>cd",insertWordBreaks("ab\u0300cd",2));assertEquals("ab\u036F<wbr>cd",insertWordBreaks("ab\u036Fcd",2));assertEquals("ab<wbr>\u0370c<wbr>d",insertWordBreaks("ab\u0370cd",2));assertEquals("ab<wbr>\uFE1Fc<wbr>d",insertWordBreaks("ab\uFE1Fcd",2));assertEquals("ab\u0300<wbr>c\u0301<wbr>de<wbr>f",insertWordBreaks("ab\u0300c\u0301def",2))}function testInsertWordBreaksWithFormattingCharacters(){propertyReplacer.set(goog.format,"WORD_BREAK_HTML","<wbr>");var insertWordBreaks=goog.format.insertWordBreaks,textWithRLMs="This is a date - "+"\u0661\u0661\u200F/\u0660\u0661\u200F/\u0662\u0660\u0661\u0662",stringWithInvisibleFormatting="X\u200CX\u200DX\u200EX\u200FX\u202A"+"X\u202BX\u202CX\u202DX\u202EX",stringWithInvisibleFormattingAndSpacelikeCharacters=stringWithInvisibleFormatting+" "+stringWithInvisibleFormatting+"\u2000"+stringWithInvisibleFormatting+"\u2001"+stringWithInvisibleFormatting+"\u2002"+stringWithInvisibleFormatting+"\u2003"+stringWithInvisibleFormatting+"\u2005"+stringWithInvisibleFormatting+"\u2006"+stringWithInvisibleFormatting+"\u2008"+stringWithInvisibleFormatting+"\u2009"+stringWithInvisibleFormatting+"\u200A"+stringWithInvisibleFormatting+"\u200B"+stringWithInvisibleFormatting+"\u2029"+stringWithInvisibleFormatting;assertEquals(textWithRLMs,insertWordBreaks(textWithRLMs,10));assertEquals(stringWithInvisibleFormattingAndSpacelikeCharacters,insertWordBreaks(stringWithInvisibleFormattingAndSpacelikeCharacters,10))}function testInsertWordBreaksBasic(){propertyReplacer.set(goog.format,"WORD_BREAK_HTML","<wbr>");var insertWordBreaksBasic=goog.format.insertWordBreaksBasic;assertEquals("abcdef",insertWordBreaksBasic("abcdef",10));assertEquals("ab<wbr>cd<wbr>ef",insertWordBreaksBasic("abcdef",2));assertEquals("a<wbr>b<wbr>c<wbr>d<wbr>e<wbr>f",insertWordBreaksBasic("abcdef",1));assertEquals("ab\u0300<wbr>c\u0301<wbr>de<wbr>f",insertWordBreaksBasic("ab\u0300c\u0301def",2));assertEquals("Inserting word breaks into the word \"Russia\" should work fine.","\u0420\u043E<wbr>\u0441\u0441<wbr>\u0438\u044F",insertWordBreaksBasic("\u0420\u043E\u0441\u0441\u0438\u044F",2));var hindiInternet="\u0907\u0902\u091F\u0930\u0928\u0947\u091F";assertEquals("The basic algorithm is not good enough to insert word "+"breaks into Hindi.",hindiInternet,insertWordBreaksBasic(hindiInternet,2));assertEquals("Hindi can have word breaks inserted between slashes",hindiInternet+"<wbr>/"+hindiInternet+"<wbr>."+hindiInternet,insertWordBreaksBasic(hindiInternet+"/"+hindiInternet+"."+hindiInternet,2))}function testWordBreaksWorking(){var text=goog.string.repeat("test",20),textWbr=goog.string.repeat("test"+goog.format.WORD_BREAK_HTML,20),overflowEl=goog.dom.createDom(goog.dom.TagName.DIV,{style:"width: 100px; overflow: hidden; margin 5px"}),wbrEl=goog.dom.createDom(goog.dom.TagName.DIV,{style:"width: 100px; overflow: hidden; margin-top: 15px"});goog.dom.appendChild(goog.global.document.body,overflowEl);goog.dom.appendChild(goog.global.document.body,wbrEl);overflowEl.innerHTML=text;wbrEl.innerHTML=textWbr;assertTrue("Text should overflow",100<overflowEl.scrollWidth);assertTrue("Text should not overflow",100>=wbrEl.scrollWidth)}function testWordBreaksRemovedFromTextContent(){var expectedText=goog.string.repeat("test",20),textWbr=goog.string.repeat("test"+goog.format.WORD_BREAK_HTML,20),wbrEl=goog.dom.createDom(goog.dom.TagName.DIV,null);wbrEl.innerHTML=textWbr;assertEquals("text content should have wbr character removed",expectedText,goog.dom.getTextContent(wbrEl))}