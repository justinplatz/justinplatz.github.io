goog.provide("goog.format.HtmlPrettyPrinter");goog.provide("goog.format.HtmlPrettyPrinter.Buffer");goog.require("goog.dom.TagName");goog.require("goog.object");goog.require("goog.string.StringBuffer");goog.format.HtmlPrettyPrinter=function(opt_timeOutMillis){this.timeOutMillis_=opt_timeOutMillis&&0<opt_timeOutMillis?opt_timeOutMillis:0};goog.format.HtmlPrettyPrinter.instance_=null;goog.format.HtmlPrettyPrinter.getInstance_=function(){if(!goog.format.HtmlPrettyPrinter.instance_){goog.format.HtmlPrettyPrinter.instance_=new goog.format.HtmlPrettyPrinter}return goog.format.HtmlPrettyPrinter.instance_};goog.format.HtmlPrettyPrinter.format=function(html){return goog.format.HtmlPrettyPrinter.getInstance_().format(html)};goog.format.HtmlPrettyPrinter.TOKEN_REGEX_=/(?:<!--.*?-->|<!.*?>|<(\/?)(\w+)[^<>]*>|[^<]+|<)/g;goog.format.HtmlPrettyPrinter.NON_PRETTY_PRINTED_TAGS_=goog.object.createSet(goog.dom.TagName.SCRIPT,goog.dom.TagName.STYLE,goog.dom.TagName.PRE,"XMP");goog.format.HtmlPrettyPrinter.BLOCK_TAGS_=goog.object.createSet(goog.dom.TagName.ADDRESS,goog.dom.TagName.APPLET,goog.dom.TagName.AREA,goog.dom.TagName.BASE,goog.dom.TagName.BASEFONT,goog.dom.TagName.BLOCKQUOTE,goog.dom.TagName.BODY,goog.dom.TagName.CAPTION,goog.dom.TagName.CENTER,goog.dom.TagName.COL,goog.dom.TagName.COLGROUP,goog.dom.TagName.DIR,goog.dom.TagName.DIV,goog.dom.TagName.DL,goog.dom.TagName.FIELDSET,goog.dom.TagName.FORM,goog.dom.TagName.FRAME,goog.dom.TagName.FRAMESET,goog.dom.TagName.H1,goog.dom.TagName.H2,goog.dom.TagName.H3,goog.dom.TagName.H4,goog.dom.TagName.H5,goog.dom.TagName.H6,goog.dom.TagName.HEAD,goog.dom.TagName.HR,goog.dom.TagName.HTML,goog.dom.TagName.IFRAME,goog.dom.TagName.ISINDEX,goog.dom.TagName.LEGEND,goog.dom.TagName.LINK,goog.dom.TagName.MENU,goog.dom.TagName.META,goog.dom.TagName.NOFRAMES,goog.dom.TagName.NOSCRIPT,goog.dom.TagName.OL,goog.dom.TagName.OPTGROUP,goog.dom.TagName.OPTION,goog.dom.TagName.P,goog.dom.TagName.PARAM,goog.dom.TagName.TABLE,goog.dom.TagName.TBODY,goog.dom.TagName.TD,goog.dom.TagName.TFOOT,goog.dom.TagName.TH,goog.dom.TagName.THEAD,goog.dom.TagName.TITLE,goog.dom.TagName.TR,goog.dom.TagName.UL);goog.format.HtmlPrettyPrinter.BREAKS_FLOW_TAGS_=goog.object.createSet(goog.dom.TagName.BR,goog.dom.TagName.DD,goog.dom.TagName.DT,goog.dom.TagName.LI,goog.dom.TagName.NOFRAMES);goog.format.HtmlPrettyPrinter.EMPTY_TAGS_=goog.object.createSet(goog.dom.TagName.BR,goog.dom.TagName.HR,goog.dom.TagName.ISINDEX);goog.format.HtmlPrettyPrinter.prototype.format=function(html){html=html.replace(/^\s*?( *\S)/,"$1");html=html.replace(/\s+$/,"");var timeOutMillis=this.timeOutMillis_,startMillis=timeOutMillis?goog.now():0,buffer=new goog.format.HtmlPrettyPrinter.Buffer,tokenRegex=goog.format.HtmlPrettyPrinter.TOKEN_REGEX_,nonPpTags=goog.format.HtmlPrettyPrinter.NON_PRETTY_PRINTED_TAGS_,blockTags=goog.format.HtmlPrettyPrinter.BLOCK_TAGS_,breaksFlowTags=goog.format.HtmlPrettyPrinter.BREAKS_FLOW_TAGS_,emptyTags=goog.format.HtmlPrettyPrinter.EMPTY_TAGS_,lastIndex=0,nonPpTagStack=[],match;while(match=tokenRegex.exec(html)){var token=match[0];if(3==match.length){var tagName=match[2];if(tagName){tagName=tagName.toUpperCase()}if(nonPpTags.hasOwnProperty(tagName)){if("/"==match[1]){var stackSize=nonPpTagStack.length,startTagName=stackSize?nonPpTagStack[stackSize-1]:null;if(startTagName==tagName){nonPpTagStack.pop();buffer.pushToken(!1,token,!nonPpTagStack.length)}else{buffer.pushToken(!1,token,!1)}}else{buffer.pushToken(!nonPpTagStack.length,token,!1);nonPpTagStack.push(tagName)}}else if(nonPpTagStack.length){buffer.pushToken(!1,token,!1)}else if(blockTags.hasOwnProperty(tagName)){var isEmpty=emptyTags.hasOwnProperty(tagName),isEndTag="/"==match[1];buffer.pushToken(isEmpty||!isEndTag,token,isEmpty||isEndTag)}else if(breaksFlowTags.hasOwnProperty(tagName)){var isEmpty=emptyTags.hasOwnProperty(tagName),isEndTag="/"==match[1];buffer.pushToken(!1,token,isEndTag||isEmpty)}else{buffer.pushToken(!1,token,!1)}}else{buffer.pushToken(!1,token,!1)}var newLastIndex=tokenRegex.lastIndex;if(!token||newLastIndex<=lastIndex){throw Error("Regex failed to make progress through source html.")}lastIndex=newLastIndex;if(timeOutMillis){if(goog.now()-startMillis>timeOutMillis){buffer.pushToken(!1,html.substring(tokenRegex.lastIndex),!1);tokenRegex.lastIndex=0;break}}}buffer.lineBreak();var result=buffer+"",expectedLength=html.length+buffer.breakCount;if(result.length!=expectedLength){throw Error("Lost data pretty printing html.")}return result};goog.format.HtmlPrettyPrinter.Buffer=function(){this.out_=new goog.string.StringBuffer};goog.format.HtmlPrettyPrinter.Buffer.prototype.breakCount=0;goog.format.HtmlPrettyPrinter.Buffer.prototype.isBeginningOfNewLine_=!0;goog.format.HtmlPrettyPrinter.Buffer.prototype.needsNewLine_=!1;goog.format.HtmlPrettyPrinter.Buffer.prototype.pushToken=function(breakBefore,token,breakAfter){if((this.needsNewLine_||breakBefore)&&!/^\r?\n/.test(token)&&!/\/ul/i.test(token)){this.lineBreak()}this.out_.append(token);this.isBeginningOfNewLine_=/\r?\n$/.test(token);this.needsNewLine_=breakAfter&&!this.isBeginningOfNewLine_};goog.format.HtmlPrettyPrinter.Buffer.prototype.lineBreak=function(){if(!this.isBeginningOfNewLine_){this.out_.append("\n");++this.breakCount}};goog.format.HtmlPrettyPrinter.Buffer.prototype.toString=function(){return this.out_.toString()};