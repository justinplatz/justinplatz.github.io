goog.provide("goog.proto2.Message");goog.require("goog.asserts");goog.require("goog.proto2.Descriptor");goog.require("goog.proto2.FieldDescriptor");goog.forwardDeclare("goog.proto2.LazyDeserializer");goog.proto2.Message=function(){this.values_={};this.fields_=this.getDescriptor().getFieldsMap();this.lazyDeserializer_=null;this.deserializedFields_=null};goog.proto2.Message.FieldType={DOUBLE:1,FLOAT:2,INT64:3,UINT64:4,INT32:5,FIXED64:6,FIXED32:7,BOOL:8,STRING:9,GROUP:10,MESSAGE:11,BYTES:12,UINT32:13,ENUM:14,SFIXED32:15,SFIXED64:16,SINT32:17,SINT64:18};goog.proto2.Message.descriptor_;goog.proto2.Message.prototype.initializeForLazyDeserializer=function(deserializer,data){this.lazyDeserializer_=deserializer;this.values_=data;this.deserializedFields_={}};goog.proto2.Message.prototype.setUnknown=function(tag,value){goog.asserts.assert(!this.fields_[tag],"Field is not unknown in this message");goog.asserts.assert(1<=tag,"Tag "+tag+" has value \""+value+"\" in descriptor "+this.getDescriptor().getName());goog.asserts.assert(null!==value,"Value cannot be null");this.values_[tag]=value;if(this.deserializedFields_){delete this.deserializedFields_[tag]}};goog.proto2.Message.prototype.forEachUnknown=function(callback,opt_scope){var scope=opt_scope||this;for(var key in this.values_){var keyNum=+key;if(!this.fields_[keyNum]){callback.call(scope,keyNum,this.values_[key])}}};goog.proto2.Message.prototype.getDescriptor=goog.abstractMethod;goog.proto2.Message.prototype.has=function(field){goog.asserts.assert(field.getContainingType()==this.getDescriptor(),"The current message does not contain the given field");return this.has$Value(field.getTag())};goog.proto2.Message.prototype.arrayOf=function(field){goog.asserts.assert(field.getContainingType()==this.getDescriptor(),"The current message does not contain the given field");return this.array$Values(field.getTag())};goog.proto2.Message.prototype.countOf=function(field){goog.asserts.assert(field.getContainingType()==this.getDescriptor(),"The current message does not contain the given field");return this.count$Values(field.getTag())};goog.proto2.Message.prototype.get=function(field,opt_index){goog.asserts.assert(field.getContainingType()==this.getDescriptor(),"The current message does not contain the given field");return this.get$Value(field.getTag(),opt_index)};goog.proto2.Message.prototype.getOrDefault=function(field,opt_index){goog.asserts.assert(field.getContainingType()==this.getDescriptor(),"The current message does not contain the given field");return this.get$ValueOrDefault(field.getTag(),opt_index)};goog.proto2.Message.prototype.set=function(field,value){goog.asserts.assert(field.getContainingType()==this.getDescriptor(),"The current message does not contain the given field");this.set$Value(field.getTag(),value)};goog.proto2.Message.prototype.add=function(field,value){goog.asserts.assert(field.getContainingType()==this.getDescriptor(),"The current message does not contain the given field");this.add$Value(field.getTag(),value)};goog.proto2.Message.prototype.clear=function(field){goog.asserts.assert(field.getContainingType()==this.getDescriptor(),"The current message does not contain the given field");this.clear$Field(field.getTag())};goog.proto2.Message.prototype.equals=function(other){if(!other||this.constructor!=other.constructor){return!1}for(var fields=this.getDescriptor().getFields(),i=0;i<fields.length;i++){var field=fields[i],tag=field.getTag();if(this.has$Value(tag)!=other.has$Value(tag)){return!1}if(this.has$Value(tag)){var isComposite=field.isCompositeType(),fieldsEqual=function(value1,value2){return isComposite?value1.equals(value2):value1==value2},thisValue=this.getValueForTag_(tag),otherValue=other.getValueForTag_(tag);if(field.isRepeated()){if(thisValue.length!=otherValue.length){return!1}for(var j=0;j<thisValue.length;j++){if(!fieldsEqual(thisValue[j],otherValue[j])){return!1}}}else if(!fieldsEqual(thisValue,otherValue)){return!1}}}return!0};goog.proto2.Message.prototype.copyFrom=function(message){goog.asserts.assert(this.constructor==message.constructor,"The source message must have the same type.");if(this!=message){this.values_={};if(this.deserializedFields_){this.deserializedFields_={}}this.mergeFrom(message)}};goog.proto2.Message.prototype.mergeFrom=function(message){goog.asserts.assert(this.constructor==message.constructor,"The source message must have the same type.");for(var fields=this.getDescriptor().getFields(),i=0;i<fields.length;i++){var field=fields[i],tag=field.getTag();if(message.has$Value(tag)){if(this.deserializedFields_){delete this.deserializedFields_[field.getTag()]}var isComposite=field.isCompositeType();if(field.isRepeated()){for(var values=message.array$Values(tag),j=0;j<values.length;j++){this.add$Value(tag,isComposite?values[j].clone():values[j])}}else{var value=message.getValueForTag_(tag);if(isComposite){var child=this.getValueForTag_(tag);if(child){child.mergeFrom(value)}else{this.set$Value(tag,value.clone())}}else{this.set$Value(tag,value)}}}}};goog.proto2.Message.prototype.clone=function(){var clone=new this.constructor;clone.copyFrom(this);return clone};goog.proto2.Message.prototype.initDefaults=function(simpleFieldsToo){for(var fields=this.getDescriptor().getFields(),i=0;i<fields.length;i++){var field=fields[i],tag=field.getTag(),isComposite=field.isCompositeType();if(!this.has$Value(tag)&&!field.isRepeated()){if(isComposite){this.values_[tag]=new(field.getNativeType())}else if(simpleFieldsToo){this.values_[tag]=field.getDefaultValue()}}if(isComposite){if(field.isRepeated()){for(var values=this.array$Values(tag),j=0;j<values.length;j++){values[j].initDefaults(simpleFieldsToo)}}else{this.get$Value(tag).initDefaults(simpleFieldsToo)}}}};goog.proto2.Message.prototype.has$Value=function(tag){return null!=this.values_[tag]};goog.proto2.Message.prototype.getValueForTag_=function(tag){var value=this.values_[tag];if(!goog.isDefAndNotNull(value)){return null}if(this.lazyDeserializer_){if(!(tag in this.deserializedFields_)){var deserializedValue=this.lazyDeserializer_.deserializeField(this,this.fields_[tag],value);this.deserializedFields_[tag]=deserializedValue;return deserializedValue}return this.deserializedFields_[tag]}return value};goog.proto2.Message.prototype.get$Value=function(tag,opt_index){var value=this.getValueForTag_(tag);if(this.fields_[tag].isRepeated()){var index=opt_index||0;goog.asserts.assert(0<=index&&index<value.length,"Given index %s is out of bounds.  Repeated field length: %s",index,value.length);return value[index]}return value};goog.proto2.Message.prototype.get$ValueOrDefault=function(tag,opt_index){if(!this.has$Value(tag)){var field=this.fields_[tag];return field.getDefaultValue()}return this.get$Value(tag,opt_index)};goog.proto2.Message.prototype.array$Values=function(tag){var value=this.getValueForTag_(tag);return value||[]};goog.proto2.Message.prototype.count$Values=function(tag){var field=this.fields_[tag];if(field.isRepeated()){return this.has$Value(tag)?this.values_[tag].length:0}else{return this.has$Value(tag)?1:0}};goog.proto2.Message.prototype.set$Value=function(tag,value){if(goog.asserts.ENABLE_ASSERTS){var field=this.fields_[tag];this.checkFieldType_(field,value)}this.values_[tag]=value;if(this.deserializedFields_){this.deserializedFields_[tag]=value}};goog.proto2.Message.prototype.add$Value=function(tag,value){if(goog.asserts.ENABLE_ASSERTS){var field=this.fields_[tag];this.checkFieldType_(field,value)}if(!this.values_[tag]){this.values_[tag]=[]}this.values_[tag].push(value);if(this.deserializedFields_){delete this.deserializedFields_[tag]}};goog.proto2.Message.prototype.checkFieldType_=function(field,value){if(field.getFieldType()==goog.proto2.FieldDescriptor.FieldType.ENUM){goog.asserts.assertNumber(value)}else{goog.asserts.assert(Object(value).constructor==field.getNativeType())}};goog.proto2.Message.prototype.clear$Field=function(tag){delete this.values_[tag];if(this.deserializedFields_){delete this.deserializedFields_[tag]}};goog.proto2.Message.createDescriptor=function(messageType,metadataObj){var fields=[],descriptorInfo=metadataObj[0];for(var key in metadataObj){if(0!=key){fields.push(new goog.proto2.FieldDescriptor(messageType,key,metadataObj[key]))}}return new goog.proto2.Descriptor(messageType,descriptorInfo,fields)};