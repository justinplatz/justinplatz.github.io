goog.provide("goog.events.eventTargetTester");goog.setTestOnly("goog.events.eventTargetTester");goog.provide("goog.events.eventTargetTester.KeyType");goog.setTestOnly("goog.events.eventTargetTester.KeyType");goog.provide("goog.events.eventTargetTester.UnlistenReturnType");goog.setTestOnly("goog.events.eventTargetTester.UnlistenReturnType");goog.require("goog.array");goog.require("goog.events");goog.require("goog.events.Event");goog.require("goog.events.EventTarget");goog.require("goog.testing.asserts");goog.require("goog.testing.recordFunction");goog.events.eventTargetTester.setUp=function(listenableFactoryFn,listenFn,unlistenFn,unlistenByKeyFn,listenOnceFn,dispatchEventFn,removeAllFn,getListenersFn,getListenerFn,hasListenerFn,listenKeyType,unlistenFnReturnType,objectListenerSupported){listenableFactory=listenableFactoryFn;listen=listenFn;unlisten=unlistenFn;unlistenByKey=unlistenByKeyFn;listenOnce=listenOnceFn;dispatchEvent=dispatchEventFn;removeAll=removeAllFn;getListeners=getListenersFn;getListener=getListenerFn;hasListener=hasListenerFn;keyType=listenKeyType;unlistenReturnType=unlistenFnReturnType;objectTypeListenerSupported=objectListenerSupported;listeners=[];for(var i=0;i<goog.events.eventTargetTester.MAX_;i++){listeners[i]=createListener()}eventTargets=[];for(i=0;i<goog.events.eventTargetTester.MAX_;i++){eventTargets[i]=listenableFactory()}};goog.events.eventTargetTester.tearDown=function(){for(var i=0;i<goog.events.eventTargetTester.MAX_;i++){goog.dispose(eventTargets[i])}};goog.events.eventTargetTester.KeyType={NUMBER:0,UNDEFINED:1};goog.events.eventTargetTester.UnlistenReturnType={BOOLEAN:0,UNDEFINED:1};goog.events.eventTargetTester.ALREADY_CHECKED_PROP="__alreadyChecked";goog.events.eventTargetTester.NUM_CALLED_PROP="__numCalled";goog.events.eventTargetTester.MAX_=10;var EventType={A:goog.events.getUniqueId("a"),B:goog.events.getUniqueId("b"),C:goog.events.getUniqueId("c")},listenableFactory,listen,unlisten,unlistenByKey,listenOnce,dispatchEvent,removeAll,getListeners,getListener,hasListener,keyType,unlistenReturnType,objectTypeListenerSupported,eventTargets,listeners,TestEvent=function(){TestEvent.base(this,"constructor",EventType.A)};goog.inherits(TestEvent,goog.events.Event);function createListener(opt_listenerFn){return goog.testing.recordFunction(opt_listenerFn)}function assertListenerIsCalled(listener,numCount){assertEquals("Listeners is not called the correct number of times.",numCount,listener.getCallCount());listener[goog.events.eventTargetTester.ALREADY_CHECKED_PROP]=!0;listener[goog.events.eventTargetTester.NUM_CALLED_PROP]=numCount}function assertNoOtherListenerIsCalled(){goog.array.forEach(listeners,function(l,index){if(!l[goog.events.eventTargetTester.ALREADY_CHECKED_PROP]){assertEquals("Listeners "+index+" is unexpectedly called.",0,l.getCallCount())}else{assertEquals("Listeners "+index+" is unexpectedly called.",l[goog.events.eventTargetTester.NUM_CALLED_PROP],l.getCallCount())}})}function resetListeners(){goog.array.forEach(listeners,function(l){l.reset();l[goog.events.eventTargetTester.ALREADY_CHECKED_PROP]=!1})}function times(n){return n}function testNoListener(){dispatchEvent(eventTargets[0],EventType.A);assertNoOtherListenerIsCalled()}function testOneListener(){listen(eventTargets[0],EventType.A,listeners[0]);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertNoOtherListenerIsCalled();resetListeners();dispatchEvent(eventTargets[0],EventType.B);dispatchEvent(eventTargets[0],EventType.C);assertNoOtherListenerIsCalled()}function testTwoListenersOfSameType(){var key1=listen(eventTargets[0],EventType.A,listeners[0]),key2=listen(eventTargets[0],EventType.A,listeners[1]);if(keyType==goog.events.eventTargetTester.KeyType.NUMBER){assertNotEquals(key1,key2)}else{assertUndefined(key1);assertUndefined(key2)}dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertListenerIsCalled(listeners[1],times(1));assertNoOtherListenerIsCalled()}function testInstallingSameListeners(){var key1=listen(eventTargets[0],EventType.A,listeners[0]),key2=listen(eventTargets[0],EventType.A,listeners[0]),key3=listen(eventTargets[0],EventType.B,listeners[0]);if(keyType==goog.events.eventTargetTester.KeyType.NUMBER){assertEquals(key1,key2);assertNotEquals(key1,key3)}else{assertUndefined(key1);assertUndefined(key2);assertUndefined(key3)}dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));dispatchEvent(eventTargets[0],EventType.B);assertListenerIsCalled(listeners[0],times(2));assertNoOtherListenerIsCalled()}function testScope(){listeners[0]=createListener(function(e){assertEquals("Wrong scope with undefined scope",eventTargets[0],this)});listeners[1]=createListener(function(e){assertEquals("Wrong scope with null scope",eventTargets[0],this)});var scope={};listeners[2]=createListener(function(e){assertEquals("Wrong scope with specific scope object",scope,this)});listen(eventTargets[0],EventType.A,listeners[0]);listen(eventTargets[0],EventType.A,listeners[1],!1,null);listen(eventTargets[0],EventType.A,listeners[2],!1,scope);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertListenerIsCalled(listeners[1],times(1));assertListenerIsCalled(listeners[2],times(1))}function testDispatchEventDoesNotThrowWithDisposedEventTarget(){goog.dispose(eventTargets[0]);assertTrue(dispatchEvent(eventTargets[0],EventType.A))}function testDispatchEventWithObjectLiteral(){listen(eventTargets[0],EventType.A,listeners[0]);assertTrue(dispatchEvent(eventTargets[0],{type:EventType.A}));assertListenerIsCalled(listeners[0],times(1));assertNoOtherListenerIsCalled()}function testDispatchEventWithCustomEventObject(){listen(eventTargets[0],EventType.A,listeners[0]);var e=new TestEvent;assertTrue(dispatchEvent(eventTargets[0],e));assertListenerIsCalled(listeners[0],times(1));assertNoOtherListenerIsCalled();var actualEvent=listeners[0].getLastCall().getArgument(0);assertEquals(e,actualEvent);assertEquals(eventTargets[0],actualEvent.target)}function testDisposingEventTargetRemovesListeners(){if(!(listenableFactory()instanceof goog.events.EventTarget)){return}listen(eventTargets[0],EventType.A,listeners[0]);goog.dispose(eventTargets[0]);dispatchEvent(eventTargets[0],EventType.A);assertNoOtherListenerIsCalled()}function testUnlistenWorksAfterDisposal(){var key=listen(eventTargets[0],EventType.A,listeners[0]);goog.dispose(eventTargets[0]);unlisten(eventTargets[0],EventType.A,listeners[1]);if(unlistenByKey){unlistenByKey(eventTargets[0],key)}}function testRemovingListener(){var ret1=unlisten(eventTargets[0],EventType.A,listeners[0]);listen(eventTargets[0],EventType.A,listeners[0]);var ret2=unlisten(eventTargets[0],EventType.A,listeners[1]),ret3=unlisten(eventTargets[0],EventType.B,listeners[0]),ret4=unlisten(eventTargets[1],EventType.A,listeners[0]);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));var ret5=unlisten(eventTargets[0],EventType.A,listeners[0]),ret6=unlisten(eventTargets[0],EventType.A,listeners[0]);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertNoOtherListenerIsCalled();if(unlistenReturnType==goog.events.eventTargetTester.UnlistenReturnType.BOOLEAN){assertFalse(ret1);assertFalse(ret2);assertFalse(ret3);assertFalse(ret4);assertTrue(ret5);assertFalse(ret6)}else{assertUndefined(ret1);assertUndefined(ret2);assertUndefined(ret3);assertUndefined(ret4);assertUndefined(ret5);assertUndefined(ret6)}}function testCapture(){eventTargets[0].setParentEventTarget(eventTargets[1]);eventTargets[1].setParentEventTarget(eventTargets[2]);eventTargets[9].setParentEventTarget(eventTargets[0]);var ordering=0;listeners[0]=createListener(function(e){assertEquals(eventTargets[2],e.currentTarget);assertEquals(eventTargets[0],e.target);assertEquals("First capture listener is not called first",0,ordering);ordering++});listeners[1]=createListener(function(e){assertEquals(eventTargets[1],e.currentTarget);assertEquals(eventTargets[0],e.target);assertEquals("2nd capture listener is not called 2nd",1,ordering);ordering++});listeners[2]=createListener(function(e){assertEquals(eventTargets[0],e.currentTarget);assertEquals(eventTargets[0],e.target);assertEquals("3rd capture listener is not called 3rd",2,ordering);ordering++});listen(eventTargets[2],EventType.A,listeners[0],!0);listen(eventTargets[1],EventType.A,listeners[1],!0);listen(eventTargets[0],EventType.A,listeners[2],!0);listen(eventTargets[3],EventType.A,listeners[3],!0);listen(eventTargets[0],EventType.B,listeners[4],!0);listen(eventTargets[0],EventType.C,listeners[5],!0);listen(eventTargets[1],EventType.B,listeners[6],!0);listen(eventTargets[1],EventType.C,listeners[7],!0);listen(eventTargets[2],EventType.B,listeners[8],!0);listen(eventTargets[2],EventType.C,listeners[9],!0);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertListenerIsCalled(listeners[1],times(1));assertListenerIsCalled(listeners[2],times(1));assertNoOtherListenerIsCalled()}function testBubble(){eventTargets[0].setParentEventTarget(eventTargets[1]);eventTargets[1].setParentEventTarget(eventTargets[2]);eventTargets[9].setParentEventTarget(eventTargets[0]);var ordering=0;listeners[0]=createListener(function(e){assertEquals(eventTargets[0],e.currentTarget);assertEquals(eventTargets[0],e.target);assertEquals("First bubble listener is not called first",0,ordering);ordering++});listeners[1]=createListener(function(e){assertEquals(eventTargets[1],e.currentTarget);assertEquals(eventTargets[0],e.target);assertEquals("2nd bubble listener is not called 2nd",1,ordering);ordering++});listeners[2]=createListener(function(e){assertEquals(eventTargets[2],e.currentTarget);assertEquals(eventTargets[0],e.target);assertEquals("3rd bubble listener is not called 3rd",2,ordering);ordering++});listen(eventTargets[0],EventType.A,listeners[0]);listen(eventTargets[1],EventType.A,listeners[1]);listen(eventTargets[2],EventType.A,listeners[2]);listen(eventTargets[3],EventType.A,listeners[3]);listen(eventTargets[0],EventType.B,listeners[4]);listen(eventTargets[0],EventType.C,listeners[5]);listen(eventTargets[1],EventType.B,listeners[6]);listen(eventTargets[1],EventType.C,listeners[7]);listen(eventTargets[2],EventType.B,listeners[8]);listen(eventTargets[2],EventType.C,listeners[9]);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertListenerIsCalled(listeners[1],times(1));assertListenerIsCalled(listeners[2],times(1));assertNoOtherListenerIsCalled()}function testCaptureAndBubble(){eventTargets[0].setParentEventTarget(eventTargets[1]);eventTargets[1].setParentEventTarget(eventTargets[2]);listen(eventTargets[0],EventType.A,listeners[0],!0);listen(eventTargets[1],EventType.A,listeners[1],!0);listen(eventTargets[2],EventType.A,listeners[2],!0);listen(eventTargets[0],EventType.A,listeners[3]);listen(eventTargets[1],EventType.A,listeners[4]);listen(eventTargets[2],EventType.A,listeners[5]);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertListenerIsCalled(listeners[1],times(1));assertListenerIsCalled(listeners[2],times(1));assertListenerIsCalled(listeners[3],times(1));assertListenerIsCalled(listeners[4],times(1));assertListenerIsCalled(listeners[5],times(1));assertNoOtherListenerIsCalled()}function testPreventDefaultByReturningFalse(){listeners[0]=createListener(function(e){return!1});listeners[1]=createListener(function(e){return!0});listen(eventTargets[0],EventType.A,listeners[0]);listen(eventTargets[0],EventType.A,listeners[1]);var result=dispatchEvent(eventTargets[0],EventType.A);assertFalse(result)}function testPreventDefault(){listeners[0]=createListener(function(e){e.preventDefault()});listeners[1]=createListener(function(e){return!0});listen(eventTargets[0],EventType.A,listeners[0]);listen(eventTargets[0],EventType.A,listeners[1]);var result=dispatchEvent(eventTargets[0],EventType.A);assertFalse(result)}function testPreventDefaultAtCapture(){listeners[0]=createListener(function(e){e.preventDefault()});listeners[1]=createListener(function(e){return!0});listen(eventTargets[0],EventType.A,listeners[0],!0);listen(eventTargets[0],EventType.A,listeners[1],!0);var result=dispatchEvent(eventTargets[0],EventType.A);assertFalse(result)}function testStopPropagation(){eventTargets[0].setParentEventTarget(eventTargets[1]);eventTargets[1].setParentEventTarget(eventTargets[2]);listeners[0]=createListener(function(e){e.stopPropagation()});listen(eventTargets[0],EventType.A,listeners[0]);listen(eventTargets[0],EventType.A,listeners[1]);listen(eventTargets[1],EventType.A,listeners[2]);listen(eventTargets[2],EventType.A,listeners[3]);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertListenerIsCalled(listeners[1],times(1));assertNoOtherListenerIsCalled()}function testStopPropagation2(){eventTargets[0].setParentEventTarget(eventTargets[1]);eventTargets[1].setParentEventTarget(eventTargets[2]);listeners[1]=createListener(function(e){e.stopPropagation()});listen(eventTargets[0],EventType.A,listeners[0]);listen(eventTargets[0],EventType.A,listeners[1]);listen(eventTargets[1],EventType.A,listeners[2]);listen(eventTargets[2],EventType.A,listeners[3]);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertListenerIsCalled(listeners[1],times(1));assertNoOtherListenerIsCalled()}function testStopPropagation3(){eventTargets[0].setParentEventTarget(eventTargets[1]);eventTargets[1].setParentEventTarget(eventTargets[2]);listeners[2]=createListener(function(e){e.stopPropagation()});listen(eventTargets[0],EventType.A,listeners[0]);listen(eventTargets[0],EventType.A,listeners[1]);listen(eventTargets[1],EventType.A,listeners[2]);listen(eventTargets[2],EventType.A,listeners[3]);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertListenerIsCalled(listeners[1],times(1));assertListenerIsCalled(listeners[2],times(1));assertNoOtherListenerIsCalled()}function testStopPropagationAtCapture(){eventTargets[0].setParentEventTarget(eventTargets[1]);eventTargets[1].setParentEventTarget(eventTargets[2]);listeners[0]=createListener(function(e){e.stopPropagation()});listen(eventTargets[2],EventType.A,listeners[0],!0);listen(eventTargets[1],EventType.A,listeners[1],!0);listen(eventTargets[0],EventType.A,listeners[2],!0);listen(eventTargets[0],EventType.A,listeners[3]);listen(eventTargets[1],EventType.A,listeners[4]);listen(eventTargets[2],EventType.A,listeners[5]);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertNoOtherListenerIsCalled()}function testHandleEvent(){if(!objectTypeListenerSupported){return}var obj={handleEvent:goog.testing.recordFunction()};listen(eventTargets[0],EventType.A,obj);dispatchEvent(eventTargets[0],EventType.A);assertEquals(1,obj.handleEvent.getCallCount())}function testListenOnce(){if(!listenOnce){return}listenOnce(eventTargets[0],EventType.A,listeners[0],!0);listenOnce(eventTargets[0],EventType.A,listeners[1]);listenOnce(eventTargets[0],EventType.B,listeners[2]);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertListenerIsCalled(listeners[1],times(1));assertListenerIsCalled(listeners[2],times(0));assertNoOtherListenerIsCalled();resetListeners();dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(0));assertListenerIsCalled(listeners[1],times(0));assertListenerIsCalled(listeners[2],times(0));dispatchEvent(eventTargets[0],EventType.B);assertListenerIsCalled(listeners[2],times(1));assertNoOtherListenerIsCalled()}function testUnlistenInListen(){listeners[1]=createListener(function(e){unlisten(eventTargets[0],EventType.A,listeners[1]);unlisten(eventTargets[0],EventType.A,listeners[2])});listen(eventTargets[0],EventType.A,listeners[0]);listen(eventTargets[0],EventType.A,listeners[1]);listen(eventTargets[0],EventType.A,listeners[2]);listen(eventTargets[0],EventType.A,listeners[3]);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertListenerIsCalled(listeners[1],times(1));assertListenerIsCalled(listeners[2],times(0));assertListenerIsCalled(listeners[3],times(1));assertNoOtherListenerIsCalled();resetListeners();dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertListenerIsCalled(listeners[1],times(0));assertListenerIsCalled(listeners[2],times(0));assertListenerIsCalled(listeners[3],times(1));assertNoOtherListenerIsCalled()}function testUnlistenByKeyInListen(){if(!unlistenByKey){return}var key1,key2;listeners[1]=createListener(function(e){unlistenByKey(eventTargets[0],key1);unlistenByKey(eventTargets[0],key2)});listen(eventTargets[0],EventType.A,listeners[0]);key1=listen(eventTargets[0],EventType.A,listeners[1]);key2=listen(eventTargets[0],EventType.A,listeners[2]);listen(eventTargets[0],EventType.A,listeners[3]);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertListenerIsCalled(listeners[1],times(1));assertListenerIsCalled(listeners[2],times(0));assertListenerIsCalled(listeners[3],times(1));assertNoOtherListenerIsCalled();resetListeners();dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertListenerIsCalled(listeners[1],times(0));assertListenerIsCalled(listeners[2],times(0));assertListenerIsCalled(listeners[3],times(1));assertNoOtherListenerIsCalled()}function testSetParentEventTarget(){assertNull(eventTargets[0].getParentEventTarget());eventTargets[0].setParentEventTarget(eventTargets[1]);assertEquals(eventTargets[1],eventTargets[0].getParentEventTarget());assertNull(eventTargets[1].getParentEventTarget());eventTargets[0].setParentEventTarget(null);assertNull(eventTargets[0].getParentEventTarget())}function testListenOnceAfterListenDoesNotChangeExistingListener(){if(!listenOnce){return}listen(eventTargets[0],EventType.A,listeners[0]);listenOnce(eventTargets[0],EventType.A,listeners[0]);dispatchEvent(eventTargets[0],EventType.A);dispatchEvent(eventTargets[0],EventType.A);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(3));assertNoOtherListenerIsCalled()}function testListenOnceAfterListenOnceDoesNotChangeExistingListener(){if(!listenOnce){return}listenOnce(eventTargets[0],EventType.A,listeners[0]);listenOnce(eventTargets[0],EventType.A,listeners[0]);dispatchEvent(eventTargets[0],EventType.A);dispatchEvent(eventTargets[0],EventType.A);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(1));assertNoOtherListenerIsCalled()}function testListenAfterListenOnceRemoveOnceness(){if(!listenOnce){return}listenOnce(eventTargets[0],EventType.A,listeners[0]);listen(eventTargets[0],EventType.A,listeners[0]);dispatchEvent(eventTargets[0],EventType.A);dispatchEvent(eventTargets[0],EventType.A);dispatchEvent(eventTargets[0],EventType.A);assertListenerIsCalled(listeners[0],times(3));assertNoOtherListenerIsCalled()}function testUnlistenAfterListenOnce(){if(!listenOnce){return}listenOnce(eventTargets[0],EventType.A,listeners[0]);unlisten(eventTargets[0],EventType.A,listeners[0]);dispatchEvent(eventTargets[0],EventType.A);listen(eventTargets[0],EventType.A,listeners[0]);listenOnce(eventTargets[0],EventType.A,listeners[0]);unlisten(eventTargets[0],EventType.A,listeners[0]);dispatchEvent(eventTargets[0],EventType.A);listenOnce(eventTargets[0],EventType.A,listeners[0]);listen(eventTargets[0],EventType.A,listeners[0]);unlisten(eventTargets[0],EventType.A,listeners[0]);dispatchEvent(eventTargets[0],EventType.A);listenOnce(eventTargets[0],EventType.A,listeners[0]);listenOnce(eventTargets[0],EventType.A,listeners[0]);unlisten(eventTargets[0],EventType.A,listeners[0]);dispatchEvent(eventTargets[0],EventType.A);assertNoOtherListenerIsCalled()}function testRemoveAllWithType(){if(!removeAll){return}listen(eventTargets[0],EventType.A,listeners[0],!0);listen(eventTargets[0],EventType.A,listeners[1]);listen(eventTargets[0],EventType.C,listeners[2],!0);listen(eventTargets[0],EventType.C,listeners[3]);listen(eventTargets[0],EventType.B,listeners[4],!0);listen(eventTargets[0],EventType.B,listeners[5],!0);listen(eventTargets[0],EventType.B,listeners[6]);listen(eventTargets[0],EventType.B,listeners[7]);assertEquals(4,removeAll(eventTargets[0],EventType.B));dispatchEvent(eventTargets[0],EventType.A);dispatchEvent(eventTargets[0],EventType.B);dispatchEvent(eventTargets[0],EventType.C);assertListenerIsCalled(listeners[0],times(1));assertListenerIsCalled(listeners[1],times(1));assertListenerIsCalled(listeners[2],times(1));assertListenerIsCalled(listeners[3],times(1));assertNoOtherListenerIsCalled()}function testRemoveAll(){if(!removeAll){return}listen(eventTargets[0],EventType.A,listeners[0],!0);listen(eventTargets[0],EventType.A,listeners[1]);listen(eventTargets[0],EventType.C,listeners[2],!0);listen(eventTargets[0],EventType.C,listeners[3]);listen(eventTargets[0],EventType.B,listeners[4],!0);listen(eventTargets[0],EventType.B,listeners[5],!0);listen(eventTargets[0],EventType.B,listeners[6]);listen(eventTargets[0],EventType.B,listeners[7]);assertEquals(8,removeAll(eventTargets[0]));dispatchEvent(eventTargets[0],EventType.A);dispatchEvent(eventTargets[0],EventType.B);dispatchEvent(eventTargets[0],EventType.C);assertNoOtherListenerIsCalled()}function testRemoveAllCallsMarkAsRemoved(){if(!removeAll){return}var key0=listen(eventTargets[0],EventType.A,listeners[0]),key1=listen(eventTargets[1],EventType.A,listeners[1]);assertNotNullNorUndefined(key0.listener);assertFalse(key0.removed);assertNotNullNorUndefined(key1.listener);assertFalse(key1.removed);assertEquals(1,removeAll(eventTargets[0]));assertNull(key0.listener);assertTrue(key0.removed);assertNotNullNorUndefined(key1.listener);assertFalse(key1.removed);assertEquals(1,removeAll(eventTargets[1]));assertNull(key1.listener);assertTrue(key1.removed)}function testGetListeners(){if(!getListeners){return}listen(eventTargets[0],EventType.A,listeners[0],!0);listen(eventTargets[0],EventType.A,listeners[1],!0);listen(eventTargets[0],EventType.A,listeners[2]);listen(eventTargets[0],EventType.A,listeners[3]);var l=getListeners(eventTargets[0],EventType.A,!0);assertEquals(2,l.length);assertEquals(listeners[0],l[0].listener);assertEquals(listeners[1],l[1].listener);l=getListeners(eventTargets[0],EventType.A,!1);assertEquals(2,l.length);assertEquals(listeners[2],l[0].listener);assertEquals(listeners[3],l[1].listener);l=getListeners(eventTargets[0],EventType.B,!0);assertEquals(0,l.length)}function testGetListener(){if(!getListener){return}listen(eventTargets[0],EventType.A,listeners[0],!0);assertNotNull(getListener(eventTargets[0],EventType.A,listeners[0],!0));assertNull(getListener(eventTargets[0],EventType.A,listeners[0],!0,{}));assertNull(getListener(eventTargets[1],EventType.A,listeners[0],!0));assertNull(getListener(eventTargets[0],EventType.B,listeners[0],!0));assertNull(getListener(eventTargets[0],EventType.A,listeners[1],!0))}function testHasListener(){if(!hasListener){return}assertFalse(hasListener(eventTargets[0]));listen(eventTargets[0],EventType.A,listeners[0],!0);assertTrue(hasListener(eventTargets[0]));assertTrue(hasListener(eventTargets[0],EventType.A));assertTrue(hasListener(eventTargets[0],EventType.A,!0));assertTrue(hasListener(eventTargets[0],void 0,!0));assertFalse(hasListener(eventTargets[0],EventType.A,!1));assertFalse(hasListener(eventTargets[0],void 0,!1));assertFalse(hasListener(eventTargets[0],EventType.B));assertFalse(hasListener(eventTargets[0],EventType.B,!0));assertFalse(hasListener(eventTargets[1]))}function testFiringEventBeforeDisposeInternalWorks(){var MockTarget=function(){MockTarget.base(this,"constructor")};goog.inherits(MockTarget,goog.events.EventTarget);MockTarget.prototype.disposeInternal=function(){dispatchEvent(this,EventType.A);MockTarget.base(this,"disposeInternal")};var t=new MockTarget;try{listen(t,EventType.A,listeners[0]);t.dispose();assertListenerIsCalled(listeners[0],times(1))}catch(e){goog.dispose(t)}}function testLoopDetection(){var target=listenableFactory();target.setParentEventTarget(target);try{target.dispatchEvent("string");fail("expected error")}catch(e){assertContains("infinite",e.message)}}