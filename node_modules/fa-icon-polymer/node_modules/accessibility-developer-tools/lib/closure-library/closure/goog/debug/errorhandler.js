goog.provide("goog.debug.ErrorHandler");goog.provide("goog.debug.ErrorHandler.ProtectedFunctionError");goog.require("goog.Disposable");goog.require("goog.asserts");goog.require("goog.debug");goog.require("goog.debug.EntryPointMonitor");goog.require("goog.debug.Error");goog.require("goog.debug.Trace");goog.debug.ErrorHandler=function(handler){goog.debug.ErrorHandler.base(this,"constructor");this.errorHandlerFn_=handler;this.wrapErrors_=!0;this.prefixErrorMessages_=!1};goog.inherits(goog.debug.ErrorHandler,goog.Disposable);goog.debug.ErrorHandler.prototype.addTracersToProtectedFunctions_=!1;goog.debug.ErrorHandler.prototype.setAddTracersToProtectedFunctions=function(newVal){this.addTracersToProtectedFunctions_=newVal};goog.debug.ErrorHandler.prototype.wrap=function(fn){return this.protectEntryPoint(goog.asserts.assertFunction(fn))};goog.debug.ErrorHandler.prototype.unwrap=function(fn){goog.asserts.assertFunction(fn);return fn[this.getFunctionIndex_(!1)]||fn};goog.debug.ErrorHandler.prototype.getStackTraceHolder_=function(stackTrace){var buffer=["##PE_STACK_START##",stackTrace.replace(/(\r\n|\r|\n)/g,"##STACK_BR##"),"##PE_STACK_END##"];return buffer.join("")};goog.debug.ErrorHandler.prototype.getFunctionIndex_=function(wrapper){return(wrapper?"__wrapper_":"__protected_")+goog.getUid(this)+"__"};goog.debug.ErrorHandler.prototype.protectEntryPoint=function(fn){var protectedFnName=this.getFunctionIndex_(!0);if(!fn[protectedFnName]){var wrapper=fn[protectedFnName]=this.getProtectedFunction(fn);wrapper[this.getFunctionIndex_(!1)]=fn}return fn[protectedFnName]};goog.debug.ErrorHandler.prototype.getProtectedFunction=function(fn){var that=this,tracers=this.addTracersToProtectedFunctions_;if(tracers){var stackTrace=goog.debug.getStacktraceSimple(15)}var googDebugErrorHandlerProtectedFunction=function(){if(that.isDisposed()){return fn.apply(this,arguments)}if(tracers){var tracer=goog.debug.Trace.startTracer("protectedEntryPoint: "+that.getStackTraceHolder_(stackTrace))}try{return fn.apply(this,arguments)}catch(e){var MESSAGE_PREFIX=goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX;if(e&&"object"===typeof e&&e.message&&0==e.message.indexOf(MESSAGE_PREFIX)||"string"===typeof e&&0==e.indexOf(MESSAGE_PREFIX)){return}that.errorHandlerFn_(e);if(!that.wrapErrors_){if(that.prefixErrorMessages_){if("object"===typeof e&&e&&"message"in e){e.message=MESSAGE_PREFIX+e.message}else{e=MESSAGE_PREFIX+e}}if(goog.DEBUG){if(e&&e.stack&&Error.captureStackTrace&&goog.global.console){goog.global.console.error(e.message,e.stack)}}throw e}throw new goog.debug.ErrorHandler.ProtectedFunctionError(e)}finally{if(tracers){goog.debug.Trace.stopTracer(tracer)}}};googDebugErrorHandlerProtectedFunction[this.getFunctionIndex_(!1)]=fn;return googDebugErrorHandlerProtectedFunction};goog.debug.ErrorHandler.prototype.protectWindowSetTimeout=function(){this.protectWindowFunctionsHelper_("setTimeout")};goog.debug.ErrorHandler.prototype.protectWindowSetInterval=function(){this.protectWindowFunctionsHelper_("setInterval")};goog.debug.ErrorHandler.prototype.protectWindowRequestAnimationFrame=function(){for(var win=goog.getObjectByName("window"),fnNames=["requestAnimationFrame","mozRequestAnimationFrame","webkitAnimationFrame","msRequestAnimationFrame"],i=0,fnName;i<fnNames.length;i++){fnName=fnNames[i];if(fnNames[i]in win){this.protectWindowFunctionsHelper_(fnName)}}};goog.debug.ErrorHandler.prototype.protectWindowFunctionsHelper_=function(fnName){var win=goog.getObjectByName("window"),originalFn=win[fnName],that=this;win[fnName]=function(fn,time){if(goog.isString(fn)){fn=goog.partial(goog.globalEval,fn)}arguments[0]=fn=that.protectEntryPoint(fn);if(originalFn.apply){return originalFn.apply(this,arguments)}else{var callback=fn;if(2<arguments.length){var args=Array.prototype.slice.call(arguments,2);callback=function(){fn.apply(this,args)}}return originalFn(callback,time)}};win[fnName][this.getFunctionIndex_(!1)]=originalFn};goog.debug.ErrorHandler.prototype.setWrapErrors=function(wrapErrors){this.wrapErrors_=wrapErrors};goog.debug.ErrorHandler.prototype.setPrefixErrorMessages=function(prefixErrorMessages){this.prefixErrorMessages_=prefixErrorMessages};goog.debug.ErrorHandler.prototype.disposeInternal=function(){var win=goog.getObjectByName("window");win.setTimeout=this.unwrap(win.setTimeout);win.setInterval=this.unwrap(win.setInterval);goog.debug.ErrorHandler.base(this,"disposeInternal")};goog.debug.ErrorHandler.ProtectedFunctionError=function(cause){var message=goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX+(cause&&cause.message?cause.message+"":cause+"");goog.debug.ErrorHandler.ProtectedFunctionError.base(this,"constructor",message);this.cause=cause;var stack=cause&&cause.stack;if(stack&&goog.isString(stack)){this.stack=stack}};goog.inherits(goog.debug.ErrorHandler.ProtectedFunctionError,goog.debug.Error);goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX="Error in protected function: ";