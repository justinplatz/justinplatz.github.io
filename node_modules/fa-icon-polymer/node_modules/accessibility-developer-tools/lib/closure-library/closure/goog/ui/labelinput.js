goog.provide("goog.ui.LabelInput");goog.require("goog.Timer");goog.require("goog.a11y.aria");goog.require("goog.a11y.aria.State");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.InputType");goog.require("goog.dom.TagName");goog.require("goog.dom.classlist");goog.require("goog.events.EventHandler");goog.require("goog.events.EventType");goog.require("goog.ui.Component");goog.require("goog.userAgent");goog.ui.LabelInput=function(opt_label,opt_domHelper){goog.ui.Component.call(this,opt_domHelper);this.label_=opt_label||""};goog.inherits(goog.ui.LabelInput,goog.ui.Component);goog.tagUnsealableClass(goog.ui.LabelInput);goog.ui.LabelInput.prototype.ffKeyRestoreValue_=null;goog.ui.LabelInput.prototype.labelRestoreDelayMs=10;goog.ui.LabelInput.prototype.inFocusAndSelect_;goog.ui.LabelInput.prototype.formAttached_;goog.ui.LabelInput.supportsPlaceholder_;goog.ui.LabelInput.isPlaceholderSupported_=function(){if(!goog.isDefAndNotNull(goog.ui.LabelInput.supportsPlaceholder_)){goog.ui.LabelInput.supportsPlaceholder_="placeholder"in goog.dom.createElement(goog.dom.TagName.INPUT)}return goog.ui.LabelInput.supportsPlaceholder_};goog.ui.LabelInput.prototype.eventHandler_;goog.ui.LabelInput.prototype.hasFocus_=!1;goog.ui.LabelInput.prototype.createDom=function(){this.setElementInternal(this.getDomHelper().createDom(goog.dom.TagName.INPUT,{type:goog.dom.InputType.TEXT}))};goog.ui.LabelInput.prototype.decorateInternal=function(element){goog.ui.LabelInput.superClass_.decorateInternal.call(this,element);if(!this.label_){this.label_=element.getAttribute("label")||""}if(goog.dom.getActiveElement(goog.dom.getOwnerDocument(element))==element){this.hasFocus_=!0;var el=this.getElement();goog.asserts.assert(el);goog.dom.classlist.remove(el,this.labelCssClassName)}if(goog.ui.LabelInput.isPlaceholderSupported_()){this.getElement().placeholder=this.label_}var labelInputElement=this.getElement();goog.asserts.assert(labelInputElement,"The label input element cannot be null.");goog.a11y.aria.setState(labelInputElement,goog.a11y.aria.State.LABEL,this.label_)};goog.ui.LabelInput.prototype.enterDocument=function(){goog.ui.LabelInput.superClass_.enterDocument.call(this);this.attachEvents_();this.check_();this.getElement().labelInput_=this};goog.ui.LabelInput.prototype.exitDocument=function(){goog.ui.LabelInput.superClass_.exitDocument.call(this);this.detachEvents_();this.getElement().labelInput_=null};goog.ui.LabelInput.prototype.attachEvents_=function(){var eh=new goog.events.EventHandler(this);eh.listen(this.getElement(),goog.events.EventType.FOCUS,this.handleFocus_);eh.listen(this.getElement(),goog.events.EventType.BLUR,this.handleBlur_);if(goog.ui.LabelInput.isPlaceholderSupported_()){this.eventHandler_=eh;return}if(goog.userAgent.GECKO){eh.listen(this.getElement(),[goog.events.EventType.KEYPRESS,goog.events.EventType.KEYDOWN,goog.events.EventType.KEYUP],this.handleEscapeKeys_)}var d=goog.dom.getOwnerDocument(this.getElement()),w=goog.dom.getWindow(d);eh.listen(w,goog.events.EventType.LOAD,this.handleWindowLoad_);this.eventHandler_=eh;this.attachEventsToForm_()};goog.ui.LabelInput.prototype.attachEventsToForm_=function(){if(!this.formAttached_&&this.eventHandler_&&this.getElement().form){this.eventHandler_.listen(this.getElement().form,goog.events.EventType.SUBMIT,this.handleFormSubmit_);this.formAttached_=!0}};goog.ui.LabelInput.prototype.detachEvents_=function(){if(this.eventHandler_){this.eventHandler_.dispose();this.eventHandler_=null}};goog.ui.LabelInput.prototype.disposeInternal=function(){goog.ui.LabelInput.superClass_.disposeInternal.call(this);this.detachEvents_()};goog.ui.LabelInput.prototype.labelCssClassName=goog.getCssName("label-input-label");goog.ui.LabelInput.prototype.handleFocus_=function(e){this.hasFocus_=!0;var el=this.getElement();goog.asserts.assert(el);goog.dom.classlist.remove(el,this.labelCssClassName);if(goog.ui.LabelInput.isPlaceholderSupported_()){return}if(!this.hasChanged()&&!this.inFocusAndSelect_){var me=this,clearValue=function(){if(me.getElement()){me.getElement().value=""}};if(goog.userAgent.IE){goog.Timer.callOnce(clearValue,10)}else{clearValue()}}};goog.ui.LabelInput.prototype.handleBlur_=function(e){if(!goog.ui.LabelInput.isPlaceholderSupported_()){this.eventHandler_.unlisten(this.getElement(),goog.events.EventType.CLICK,this.handleFocus_);this.ffKeyRestoreValue_=null}this.hasFocus_=!1;this.check_()};goog.ui.LabelInput.prototype.handleEscapeKeys_=function(e){if(27==e.keyCode){if(e.type==goog.events.EventType.KEYDOWN){this.ffKeyRestoreValue_=this.getElement().value}else if(e.type==goog.events.EventType.KEYPRESS){this.getElement().value=this.ffKeyRestoreValue_}else if(e.type==goog.events.EventType.KEYUP){this.ffKeyRestoreValue_=null}e.preventDefault()}};goog.ui.LabelInput.prototype.handleFormSubmit_=function(e){if(!this.hasChanged()){this.getElement().value="";goog.Timer.callOnce(this.handleAfterSubmit_,10,this)}};goog.ui.LabelInput.prototype.handleAfterSubmit_=function(){if(!this.hasChanged()){this.getElement().value=this.label_}};goog.ui.LabelInput.prototype.handleWindowLoad_=function(e){this.check_()};goog.ui.LabelInput.prototype.hasFocus=function(){return this.hasFocus_};goog.ui.LabelInput.prototype.hasChanged=function(){return!!this.getElement()&&""!=this.getElement().value&&this.getElement().value!=this.label_};goog.ui.LabelInput.prototype.clear=function(){this.getElement().value="";if(null!=this.ffKeyRestoreValue_){this.ffKeyRestoreValue_=""}};goog.ui.LabelInput.prototype.reset=function(){if(this.hasChanged()){this.clear();this.check_()}};goog.ui.LabelInput.prototype.setValue=function(s){if(null!=this.ffKeyRestoreValue_){this.ffKeyRestoreValue_=s}this.getElement().value=s;this.check_()};goog.ui.LabelInput.prototype.getValue=function(){if(null!=this.ffKeyRestoreValue_){return this.ffKeyRestoreValue_}return this.hasChanged()?this.getElement().value:""};goog.ui.LabelInput.prototype.setLabel=function(label){var labelInputElement=this.getElement();if(goog.ui.LabelInput.isPlaceholderSupported_()){if(labelInputElement){labelInputElement.placeholder=label}this.label_=label}else if(!this.hasChanged()){if(labelInputElement){labelInputElement.value=""}this.label_=label;this.restoreLabel_()}if(labelInputElement){goog.a11y.aria.setState(labelInputElement,goog.a11y.aria.State.LABEL,this.label_)}};goog.ui.LabelInput.prototype.getLabel=function(){return this.label_};goog.ui.LabelInput.prototype.check_=function(){var labelInputElement=this.getElement();goog.asserts.assert(labelInputElement,"The label input element cannot be null.");if(!goog.ui.LabelInput.isPlaceholderSupported_()){this.attachEventsToForm_()}else if(this.getElement().placeholder!=this.label_){this.getElement().placeholder=this.label_}goog.a11y.aria.setState(labelInputElement,goog.a11y.aria.State.LABEL,this.label_);if(!this.hasChanged()){if(!this.inFocusAndSelect_&&!this.hasFocus_){var el=this.getElement();goog.asserts.assert(el);goog.dom.classlist.add(el,this.labelCssClassName)}if(!goog.ui.LabelInput.isPlaceholderSupported_()){goog.Timer.callOnce(this.restoreLabel_,this.labelRestoreDelayMs,this)}}else{var el=this.getElement();goog.asserts.assert(el);goog.dom.classlist.remove(el,this.labelCssClassName)}};goog.ui.LabelInput.prototype.focusAndSelect=function(){var hc=this.hasChanged();this.inFocusAndSelect_=!0;this.getElement().focus();if(!hc&&!goog.ui.LabelInput.isPlaceholderSupported_()){this.getElement().value=this.label_}this.getElement().select();if(goog.ui.LabelInput.isPlaceholderSupported_()){return}if(this.eventHandler_){this.eventHandler_.listenOnce(this.getElement(),goog.events.EventType.CLICK,this.handleFocus_)}goog.Timer.callOnce(this.focusAndSelect_,10,this)};goog.ui.LabelInput.prototype.setEnabled=function(enabled){this.getElement().disabled=!enabled;var el=this.getElement();goog.asserts.assert(el);goog.dom.classlist.enable(el,goog.getCssName(this.labelCssClassName,"disabled"),!enabled)};goog.ui.LabelInput.prototype.isEnabled=function(){return!this.getElement().disabled};goog.ui.LabelInput.prototype.focusAndSelect_=function(){this.inFocusAndSelect_=!1};goog.ui.LabelInput.prototype.restoreLabel_=function(){if(this.getElement()&&!this.hasChanged()&&!this.hasFocus_){this.getElement().value=this.label_}};