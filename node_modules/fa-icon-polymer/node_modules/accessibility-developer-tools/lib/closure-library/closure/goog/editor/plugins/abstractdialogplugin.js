goog.provide("goog.editor.plugins.AbstractDialogPlugin");goog.provide("goog.editor.plugins.AbstractDialogPlugin.EventType");goog.require("goog.dom");goog.require("goog.dom.Range");goog.require("goog.editor.Field");goog.require("goog.editor.Plugin");goog.require("goog.editor.range");goog.require("goog.events");goog.require("goog.ui.editor.AbstractDialog");goog.editor.plugins.AbstractDialogPlugin=function(command){goog.editor.plugins.AbstractDialogPlugin.base(this,"constructor");this.command_=command;this.restoreScrollPosition_=function(){};this.dialog_=null;this.reuseDialog_=!1;this.isDisposingDialog_=!1;this.savedRange_=null};goog.inherits(goog.editor.plugins.AbstractDialogPlugin,goog.editor.Plugin);goog.editor.plugins.AbstractDialogPlugin.prototype.isSupportedCommand=function(command){return command==this.command_};goog.editor.plugins.AbstractDialogPlugin.prototype.execCommand=function(command,var_args){return this.execCommandInternal.apply(this,arguments)};goog.editor.plugins.AbstractDialogPlugin.EventType={OPENED:"dialogOpened",CLOSED:"dialogClosed"};goog.editor.plugins.AbstractDialogPlugin.prototype.createDialog=goog.abstractMethod;goog.editor.plugins.AbstractDialogPlugin.prototype.getDialog=function(){return this.dialog_};goog.editor.plugins.AbstractDialogPlugin.prototype.setReuseDialog=function(reuse){this.reuseDialog_=reuse};goog.editor.plugins.AbstractDialogPlugin.prototype.execCommandInternal=function(command,opt_arg){if(!this.reuseDialog_){this.disposeDialog_()}if(!this.dialog_){this.dialog_=this.createDialog(goog.dom.getDomHelper(this.getFieldObject().getAppWindow()),opt_arg)}var tempRange=this.getFieldObject().getRange();this.restoreScrollPosition_=this.saveScrollPosition();this.savedRange_=tempRange&&goog.editor.range.saveUsingNormalizedCarets(tempRange);goog.dom.Range.clearSelection(this.getFieldObject().getEditableDomHelper().getWindow());goog.events.listenOnce(this.dialog_,goog.ui.editor.AbstractDialog.EventType.AFTER_HIDE,this.handleAfterHide,!1,this);this.getFieldObject().setModalMode(!0);this.dialog_.show();this.dispatchEvent(goog.editor.plugins.AbstractDialogPlugin.EventType.OPENED);this.getFieldObject().dispatchSelectionChangeEvent();return!0};goog.editor.plugins.AbstractDialogPlugin.prototype.handleAfterHide=function(e){this.getFieldObject().setModalMode(!1);this.restoreOriginalSelection();this.restoreScrollPosition_();if(!this.reuseDialog_){this.disposeDialog_()}this.dispatchEvent(goog.editor.plugins.AbstractDialogPlugin.EventType.CLOSED);this.getFieldObject().dispatchSelectionChangeEvent();this.getFieldObject().debounceEvent(goog.editor.Field.EventType.SELECTIONCHANGE)};goog.editor.plugins.AbstractDialogPlugin.prototype.restoreOriginalSelection=function(){this.getFieldObject().restoreSavedRange(this.savedRange_);this.savedRange_=null};goog.editor.plugins.AbstractDialogPlugin.prototype.disposeOriginalSelection=function(){if(this.savedRange_){this.savedRange_.dispose();this.savedRange_=null}};goog.editor.plugins.AbstractDialogPlugin.prototype.disposeInternal=function(){this.disposeDialog_();goog.editor.plugins.AbstractDialogPlugin.base(this,"disposeInternal")};goog.editor.plugins.AbstractDialogPlugin.prototype.disposeDialog_=function(){if(this.dialog_&&!this.isDisposingDialog_){this.isDisposingDialog_=!0;this.dialog_.dispose();this.dialog_=null;this.isDisposingDialog_=!1}};