goog.provide("goog.dom.selection");goog.require("goog.dom.InputType");goog.require("goog.string");goog.require("goog.userAgent");goog.dom.selection.setStart=function(textfield,pos){if(goog.dom.selection.useSelectionProperties_(textfield)){textfield.selectionStart=pos}else if(goog.dom.selection.isLegacyIe_()){var tmp=goog.dom.selection.getRangeIe_(textfield),range=tmp[0],selectionRange=tmp[1];if(range.inRange(selectionRange)){pos=goog.dom.selection.canonicalizePositionIe_(textfield,pos);range.collapse(!0);range.move("character",pos);range.select()}}};goog.dom.selection.getStart=function(textfield){return goog.dom.selection.getEndPoints_(textfield,!0)[0]};goog.dom.selection.getEndPointsTextareaIe_=function(range,selRange,getOnlyStart){var selectionRange=selRange.duplicate(),beforeSelectionText=range.text,untrimmedBeforeSelectionText=beforeSelectionText,selectionText=selectionRange.text,untrimmedSelectionText=selectionText,isRangeEndTrimmed=!1;while(!isRangeEndTrimmed){if(0==range.compareEndPoints("StartToEnd",range)){isRangeEndTrimmed=!0}else{range.moveEnd("character",-1);if(range.text==beforeSelectionText){untrimmedBeforeSelectionText+="\r\n"}else{isRangeEndTrimmed=!0}}}if(getOnlyStart){return[untrimmedBeforeSelectionText.length,-1]}var isSelectionRangeEndTrimmed=!1;while(!isSelectionRangeEndTrimmed){if(0==selectionRange.compareEndPoints("StartToEnd",selectionRange)){isSelectionRangeEndTrimmed=!0}else{selectionRange.moveEnd("character",-1);if(selectionRange.text==selectionText){untrimmedSelectionText+="\r\n"}else{isSelectionRangeEndTrimmed=!0}}}return[untrimmedBeforeSelectionText.length,untrimmedBeforeSelectionText.length+untrimmedSelectionText.length]};goog.dom.selection.getEndPoints=function(textfield){return goog.dom.selection.getEndPoints_(textfield,!1)};goog.dom.selection.getEndPoints_=function(textfield,getOnlyStart){textfield=textfield;var startPos=0,endPos=0;if(goog.dom.selection.useSelectionProperties_(textfield)){startPos=textfield.selectionStart;endPos=getOnlyStart?-1:textfield.selectionEnd}else if(goog.dom.selection.isLegacyIe_()){var tmp=goog.dom.selection.getRangeIe_(textfield),range=tmp[0],selectionRange=tmp[1];if(range.inRange(selectionRange)){range.setEndPoint("EndToStart",selectionRange);if(textfield.type==goog.dom.InputType.TEXTAREA){return goog.dom.selection.getEndPointsTextareaIe_(range,selectionRange,getOnlyStart)}startPos=range.text.length;if(!getOnlyStart){endPos=range.text.length+selectionRange.text.length}else{endPos=-1}}}return[startPos,endPos]};goog.dom.selection.setEnd=function(textfield,pos){if(goog.dom.selection.useSelectionProperties_(textfield)){textfield.selectionEnd=pos}else if(goog.dom.selection.isLegacyIe_()){var tmp=goog.dom.selection.getRangeIe_(textfield),range=tmp[0],selectionRange=tmp[1];if(range.inRange(selectionRange)){pos=goog.dom.selection.canonicalizePositionIe_(textfield,pos);var startCursorPos=goog.dom.selection.canonicalizePositionIe_(textfield,goog.dom.selection.getStart(textfield));selectionRange.collapse(!0);selectionRange.moveEnd("character",pos-startCursorPos);selectionRange.select()}}};goog.dom.selection.getEnd=function(textfield){return goog.dom.selection.getEndPoints_(textfield,!1)[1]};goog.dom.selection.setCursorPosition=function(textfield,pos){if(goog.dom.selection.useSelectionProperties_(textfield)){textfield.selectionStart=pos;textfield.selectionEnd=pos}else if(goog.dom.selection.isLegacyIe_()){pos=goog.dom.selection.canonicalizePositionIe_(textfield,pos);var sel=textfield.createTextRange();sel.collapse(!0);sel.move("character",pos);sel.select()}};goog.dom.selection.setText=function(textfield,text){textfield=textfield;if(goog.dom.selection.useSelectionProperties_(textfield)){var value=textfield.value,oldSelectionStart=textfield.selectionStart,before=value.substr(0,oldSelectionStart),after=value.substr(textfield.selectionEnd);textfield.value=before+text+after;textfield.selectionStart=oldSelectionStart;textfield.selectionEnd=oldSelectionStart+text.length}else if(goog.dom.selection.isLegacyIe_()){var tmp=goog.dom.selection.getRangeIe_(textfield),range=tmp[0],selectionRange=tmp[1];if(!range.inRange(selectionRange)){return}var range2=selectionRange.duplicate();selectionRange.text=text;selectionRange.setEndPoint("StartToStart",range2);selectionRange.select()}else{throw Error("Cannot set the selection end")}};goog.dom.selection.getText=function(textfield){textfield=textfield;if(goog.dom.selection.useSelectionProperties_(textfield)){var s=textfield.value;return s.substring(textfield.selectionStart,textfield.selectionEnd)}if(goog.dom.selection.isLegacyIe_()){var tmp=goog.dom.selection.getRangeIe_(textfield),range=tmp[0],selectionRange=tmp[1];if(!range.inRange(selectionRange)){return""}else if(textfield.type==goog.dom.InputType.TEXTAREA){return goog.dom.selection.getSelectionRangeText_(selectionRange)}return selectionRange.text}throw Error("Cannot get the selection text")};goog.dom.selection.getSelectionRangeText_=function(selRange){var selectionRange=selRange.duplicate(),selectionText=selectionRange.text,untrimmedSelectionText=selectionText,isSelectionRangeEndTrimmed=!1;while(!isSelectionRangeEndTrimmed){if(0==selectionRange.compareEndPoints("StartToEnd",selectionRange)){isSelectionRangeEndTrimmed=!0}else{selectionRange.moveEnd("character",-1);if(selectionRange.text==selectionText){untrimmedSelectionText+="\r\n"}else{isSelectionRangeEndTrimmed=!0}}}return untrimmedSelectionText};goog.dom.selection.getRangeIe_=function(el){var doc=el.ownerDocument||el.document,selectionRange=doc.selection.createRange(),range;if(el.type==goog.dom.InputType.TEXTAREA){range=doc.body.createTextRange();range.moveToElementText(el)}else{range=el.createTextRange()}return[range,selectionRange]};goog.dom.selection.canonicalizePositionIe_=function(textfield,pos){textfield=textfield;if(textfield.type==goog.dom.InputType.TEXTAREA){var value=textfield.value.substring(0,pos);pos=goog.string.canonicalizeNewlines(value).length}return pos};goog.dom.selection.useSelectionProperties_=function(el){try{return"number"==typeof el.selectionStart}catch(e){return!1}};goog.dom.selection.isLegacyIe_=function(){return goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9")};