goog.provide("goog.events.ImeHandler");goog.provide("goog.events.ImeHandler.Event");goog.provide("goog.events.ImeHandler.EventType");goog.require("goog.events.Event");goog.require("goog.events.EventHandler");goog.require("goog.events.EventTarget");goog.require("goog.events.EventType");goog.require("goog.events.KeyCodes");goog.require("goog.userAgent");goog.events.ImeHandler=function(el){goog.events.ImeHandler.base(this,"constructor");this.el_=el;this.keyUpHandler_=new goog.events.EventHandler(this);this.handler_=new goog.events.EventHandler(this);if(goog.events.ImeHandler.USES_COMPOSITION_EVENTS){this.handler_.listen(el,goog.events.EventType.COMPOSITIONSTART,this.handleCompositionStart_).listen(el,goog.events.EventType.COMPOSITIONEND,this.handleCompositionEnd_).listen(el,goog.events.EventType.COMPOSITIONUPDATE,this.handleTextModifyingInput_)}this.handler_.listen(el,goog.events.EventType.TEXTINPUT,this.handleTextInput_).listen(el,goog.events.EventType.TEXT,this.handleTextModifyingInput_).listen(el,goog.events.EventType.KEYDOWN,this.handleKeyDown_)};goog.inherits(goog.events.ImeHandler,goog.events.EventTarget);goog.events.ImeHandler.EventType={START:"startIme",UPDATE:"updateIme",END:"endIme"};goog.events.ImeHandler.Event=function(type,reason){goog.events.ImeHandler.Event.base(this,"constructor",type);this.reason=reason};goog.inherits(goog.events.ImeHandler.Event,goog.events.Event);goog.events.ImeHandler.USES_COMPOSITION_EVENTS=goog.userAgent.GECKO||goog.userAgent.WEBKIT&&goog.userAgent.isVersionOrHigher(532);goog.events.ImeHandler.prototype.imeMode_=!1;goog.events.ImeHandler.prototype.lastKeyCode_=0;goog.events.ImeHandler.prototype.isImeMode=function(){return this.imeMode_};goog.events.ImeHandler.prototype.handleCompositionStart_=function(e){this.handleImeActivate_(e)};goog.events.ImeHandler.prototype.handleCompositionEnd_=function(e){this.handleImeDeactivate_(e)};goog.events.ImeHandler.prototype.handleTextModifyingInput_=function(e){if(this.isImeMode()){this.processImeComposition_(e)}};goog.events.ImeHandler.prototype.handleImeActivate_=function(e){if(this.imeMode_){return}if(goog.userAgent.WEBKIT&&!goog.events.ImeHandler.USES_COMPOSITION_EVENTS){this.keyUpHandler_.listen(this.el_,goog.events.EventType.KEYUP,this.handleKeyUpSafari4_)}this.imeMode_=!0;this.dispatchEvent(new goog.events.ImeHandler.Event(goog.events.ImeHandler.EventType.START,e))};goog.events.ImeHandler.prototype.processImeComposition_=function(e){this.dispatchEvent(new goog.events.ImeHandler.Event(goog.events.ImeHandler.EventType.UPDATE,e))};goog.events.ImeHandler.prototype.handleImeDeactivate_=function(e){this.imeMode_=!1;this.keyUpHandler_.removeAll();this.dispatchEvent(new goog.events.ImeHandler.Event(goog.events.ImeHandler.EventType.END,e))};goog.events.ImeHandler.prototype.handleKeyDown_=function(e){if(!goog.events.ImeHandler.USES_COMPOSITION_EVENTS){var imeMode=this.isImeMode();if(!imeMode&&e.keyCode==goog.events.KeyCodes.WIN_IME){this.handleImeActivate_(e)}else if(imeMode&&e.keyCode!=goog.events.KeyCodes.WIN_IME){if(goog.events.ImeHandler.isImeDeactivateKeyEvent_(e)){this.handleImeDeactivate_(e)}}else if(imeMode){this.processImeComposition_(e)}}if(goog.events.ImeHandler.isImeDeactivateKeyEvent_(e)){this.lastKeyCode_=e.keyCode}};goog.events.ImeHandler.prototype.handleTextInput_=function(e){if(!goog.events.ImeHandler.USES_COMPOSITION_EVENTS&&goog.userAgent.WEBKIT&&this.lastKeyCode_==goog.events.KeyCodes.WIN_IME&&this.isImeMode()){this.handleImeDeactivate_(e)}};goog.events.ImeHandler.prototype.handleKeyUpSafari4_=function(e){if(this.isImeMode()){switch(e.keyCode){case goog.events.KeyCodes.ENTER:case goog.events.KeyCodes.TAB:case goog.events.KeyCodes.ESC:this.handleImeDeactivate_(e);break;}}};goog.events.ImeHandler.isImeDeactivateKeyEvent_=function(e){switch(e.keyCode){case goog.events.KeyCodes.SHIFT:case goog.events.KeyCodes.CTRL:return!1;default:return!0;}};goog.events.ImeHandler.prototype.disposeInternal=function(){this.handler_.dispose();this.keyUpHandler_.dispose();this.el_=null;goog.events.ImeHandler.base(this,"disposeInternal")};