goog.provide("goog.editor.plugins.FirstStrong");goog.require("goog.dom.NodeType");goog.require("goog.dom.TagIterator");goog.require("goog.dom.TagName");goog.require("goog.editor.Command");goog.require("goog.editor.Field");goog.require("goog.editor.Plugin");goog.require("goog.editor.node");goog.require("goog.editor.range");goog.require("goog.i18n.bidi");goog.require("goog.i18n.uChar");goog.require("goog.iter");goog.require("goog.userAgent");goog.editor.plugins.FirstStrong=function(){goog.editor.plugins.FirstStrong.base(this,"constructor");this.isNewBlock_=!0;this.switchToRtl_=!1;this.switchToLtr_=!1};goog.inherits(goog.editor.plugins.FirstStrong,goog.editor.Plugin);goog.editor.plugins.FirstStrong.prototype.getTrogClassId=function(){return"FirstStrong"};goog.editor.plugins.FirstStrong.prototype.queryCommandValue=function(command){return!1};goog.editor.plugins.FirstStrong.prototype.handleSelectionChange=function(e,node){this.isNewBlock_=!0;return!1};goog.editor.plugins.FirstStrong.INPUT_ATTRIBUTE="fs-input";goog.editor.plugins.FirstStrong.prototype.handleKeyPress=function(e){if(goog.editor.Field.SELECTION_CHANGE_KEYCODES[e.keyCode]){this.isNewBlock_=!0;return!1}if(!this.isNewBlock_){return!1}if(e.ctrlKey||e.metaKey){return!1}var newInput=goog.i18n.uChar.fromCharCode(e.charCode);if(!newInput||!e.charCode){var browserEvent=e.getBrowserEvent();if(browserEvent){if(goog.userAgent.IE&&browserEvent.getAttribute){newInput=browserEvent.getAttribute(goog.editor.plugins.FirstStrong.INPUT_ATTRIBUTE)}else{newInput=browserEvent[goog.editor.plugins.FirstStrong.INPUT_ATTRIBUTE]}}}if(!newInput){return!1}var isLtr=goog.i18n.bidi.isLtrChar(newInput),isRtl=!isLtr&&goog.i18n.bidi.isRtlChar(newInput);if(!isLtr&&!isRtl){return!1}this.isNewBlock_=!1;if(this.isNeutralBlock_()){this.switchToRtl_=isRtl;this.switchToLtr_=isLtr}return!1};goog.editor.plugins.FirstStrong.prototype.handleKeyUp=function(e){if(this.switchToRtl_){var field=this.getFieldObject();field.dispatchChange(!0);field.execCommand(goog.editor.Command.DIR_RTL);this.switchToRtl_=!1}else if(this.switchToLtr_){var field=this.getFieldObject();field.dispatchChange(!0);field.execCommand(goog.editor.Command.DIR_LTR);this.switchToLtr_=!1}return!1};goog.editor.plugins.FirstStrong.prototype.getBlockAncestor_=function(){var start=this.getFieldObject().getRange().getStartNode();while(!goog.editor.plugins.FirstStrong.isBlock_(start)){start=start.parentNode}return start};goog.editor.plugins.FirstStrong.prototype.isNeutralBlock_=function(){var root=this.getBlockAncestor_(),cursor=goog.editor.range.getDeepEndPoint(this.getFieldObject().getRange(),!1).node,blockFunction=goog.userAgent.GECKO&&!this.isList_(root)?goog.editor.plugins.FirstStrong.isGeckoBlock_:goog.editor.plugins.FirstStrong.isBlock_,paragraph=this.getTextAround_(root,cursor,blockFunction);return!goog.i18n.bidi.hasAnyLtr(paragraph)&&!goog.i18n.bidi.hasAnyRtl(paragraph)};goog.editor.plugins.FirstStrong.prototype.isList_=function(element){if(!element){return!1}var tagName=element.tagName;return tagName==goog.dom.TagName.UL||tagName==goog.dom.TagName.OL};goog.editor.plugins.FirstStrong.prototype.getTextAround_=function(root,cursorLocation,isParagraphBoundary){var buffer=[],pastCursorLocation=!1;if(root&&cursorLocation){goog.iter.some(new goog.dom.TagIterator(root),function(node){if(node==cursorLocation){pastCursorLocation=!0}else if(isParagraphBoundary(node)){if(pastCursorLocation){return!0}else{buffer=[]}}if(node.nodeType==goog.dom.NodeType.TEXT){buffer.push(node.nodeValue)}return!1})}return buffer.join("")};goog.editor.plugins.FirstStrong.isBlock_=function(node){return!!node&&goog.editor.node.isBlockTag(node)&&node.tagName!=goog.dom.TagName.LI};goog.editor.plugins.FirstStrong.isGeckoBlock_=function(node){return!!node&&(node.tagName==goog.dom.TagName.BR||goog.editor.plugins.FirstStrong.isBlock_(node))};