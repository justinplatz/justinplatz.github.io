goog.provide("goog.debugEnhanceErrorTest");goog.setTestOnly("goog.debugEnhanceErrorTest");goog.require("goog.debug");goog.require("goog.testing.jsunit");var THROW_STRING=1,THROW_NPE=2,THROW_ERROR=3,THROW_ENHANCED_ERROR=4,THROW_ENHANCED_STRING=5,THROW_OBJECT=6;if("undefined"==typeof debug){function debug(str){if(window.console)window.console.log(str)}}function testEnhanceError(){for(var tests=[[THROW_STRING],[THROW_OBJECT],[THROW_NPE],[THROW_ERROR],[THROW_ENHANCED_ERROR,"throwEnhancedError","an enhanced error"],[THROW_ENHANCED_STRING,"throwEnhancedString"]],i=0;i<tests.length;++i){var test=tests[i],testNum=test[0],testInStack=test[1],testExtraMessage=test[2]||null;try{foo(testNum)}catch(e){debug(goog.debug.expose(e));for(var s=e.stack.split("\n"),j=0;j<s.length;++j){debug(s[j])}assertTrue("stack should contain \"baz\"",-1!=e.stack.indexOf("baz"));if(testInStack){assertTrue("stack should contain \""+testInStack+"\"",-1!=e.stack.indexOf(testInStack))}if(testExtraMessage){assertTrue("message0 should contain \""+testExtraMessage+"\"",-1!=e.message0.indexOf(testExtraMessage));assertTrue("message1 should contain \"message from baz\"",-1!=e.message1.indexOf("message from baz"))}else{assertTrue("message0 should contain \"message from baz\"",-1!=e.message0.indexOf("message from baz"))}continue}fail("expected to catch an exception")}}function foo(testNum){bar(testNum)}function bar(testNum){baz(testNum)}function baz(testNum){try{switch(testNum){case THROW_STRING:throwString();break;case THROW_NPE:throwNpe();break;case THROW_ERROR:throwError();break;case THROW_ENHANCED_ERROR:throwEnhancedError();break;case THROW_ENHANCED_STRING:throwEnhancedString();break;case THROW_OBJECT:throwObject();break;}}catch(e){throw goog.debug.enhanceError(e,"message from baz")}}function throwString(){throw"a string"}function throwNpe(){var nada=null;nada.noSuchFunction()}function throwError(){throw Error("an error")}function throwEnhancedError(){throw goog.debug.enhanceError(Error("dang!"),"an enhanced error")}function throwEnhancedString(){throw goog.debug.enhanceError("oh nos!")}function throwObject(){throw{property:"value"}}