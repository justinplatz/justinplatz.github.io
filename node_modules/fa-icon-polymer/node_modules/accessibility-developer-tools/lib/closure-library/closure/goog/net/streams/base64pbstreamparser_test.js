goog.module("goog.net.streams.Base64PbStreamParserTest");goog.setTestOnly("goog.net.streams.Base64PbStreamParserTest");var testSuite=goog.require("goog.testing.testSuite"),base64=goog.require("goog.crypt.base64"),object=goog.require("goog.object"),Base64PbStreamParser=goog.require("goog.net.streams.Base64PbStreamParser"),testMessage1={data:[10,0,10,7,97,98,99,100,101,102,103,122,4,112,97,100,49,10,8,0,1,2,3,10,255,254,253,122,0,18,23,8,200,1,18,18,115,111,109,101,116,104,105,110,103,45,105,115,45,119,114,111,110,103,122,2,0,0],parsed:[{1:[]},{1:[97,98,99,100,101,102,103]},{1:[0,1,2,3,10,255,254,253]},{2:[8,200,1,18,18,115,111,109,101,116,104,105,110,103,45,105,115,45,119,114,111,110,103]}]};function encodeBytes(input){return base64.encodeByteArray(input,!0)}testSuite({testSingleMessage:function(){var parser=new Base64PbStreamParser,input="CgX__gABdw==",result=parser.parse(input);assertEquals(1,result.length);assertElementsEquals(["1"],object.getKeys(result[0]));assertElementsEquals([255,254,0,1,119],result[0][1]);if("undefined"!==typeof Uint8Array){assertTrue(result[0][1]instanceof Uint8Array)}else{assertTrue(result[0][1]instanceof Array)}result=parser.parse("");assertNull(result);assertTrue(parser.isInputValid())},testMultipleMessages:function(){var parser=new Base64PbStreamParser,input=encodeBytes(testMessage1.data),expected=testMessage1.parsed,result=parser.parse(input);assertEquals(expected.length,result.length);for(var i=0,keys;i<expected.length;i++){keys=object.getKeys(result[i]);assertElementsEquals(object.getKeys(expected[i]),keys);assertEquals(1,keys.length);assertElementsEquals(expected[i][keys[0]],result[i][keys[0]])}},testInvalidInputs:function(){var parser1=new Base64PbStreamParser;assertThrows(function(){parser1.parse("badchar!")});assertFalse(parser1.isInputValid());assertThrows(function(){parser1.parse("CgX__gABdw==")});assertFalse(parser1.isInputValid());var parser2=new Base64PbStreamParser;assertThrows(function(){parser2.parse("GgGq")});assertFalse(parser2.isInputValid());var parser3=new Base64PbStreamParser;assertThrows(function(){parser3.parse("Cv____8Q")});assertFalse(parser3.isInputValid())},testMessagesInChunks:function(){var data=[10,3,97,98,99,10,3,100,101,102,18,3,103,104,105],parser=new Base64PbStreamParser,result=parser.parse(encodeBytes(data.slice(0,3)));assertNull(result);result=parser.parse(encodeBytes(data.slice(3,12)));assertEquals(2,result.length);assertElementsEquals(["1"],object.getKeys(result[0]));assertElementsEquals([97,98,99],result[0][1]);assertElementsEquals(["1"],object.getKeys(result[1]));assertElementsEquals([100,101,102],result[1][1]);result=parser.parse(encodeBytes(data.slice(12)));assertEquals(1,result.length);assertElementsEquals(["2"],object.getKeys(result[0]));assertElementsEquals([103,104,105],result[0][2])}});