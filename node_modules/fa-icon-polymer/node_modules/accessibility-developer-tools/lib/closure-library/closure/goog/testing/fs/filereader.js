goog.setTestOnly("goog.testing.fs.FileReader");goog.provide("goog.testing.fs.FileReader");goog.require("goog.Timer");goog.require("goog.events.EventTarget");goog.require("goog.fs.Error");goog.require("goog.fs.FileReader");goog.require("goog.testing.fs.ProgressEvent");goog.testing.fs.FileReader=function(){goog.testing.fs.FileReader.base(this,"constructor");this.readyState_=goog.fs.FileReader.ReadyState.INIT};goog.inherits(goog.testing.fs.FileReader,goog.events.EventTarget);goog.testing.fs.FileReader.prototype.error_;goog.testing.fs.FileReader.prototype.aborted_=!1;goog.testing.fs.FileReader.prototype.blob_;goog.testing.fs.FileReader.ReturnType={TEXT:1,BINARY_STRING:2,ARRAY_BUFFER:3,DATA_URL:4};goog.testing.fs.FileReader.returnType_;goog.testing.fs.FileReader.prototype.getReadyState=function(){return this.readyState_};goog.testing.fs.FileReader.prototype.getError=function(){return this.error_};goog.testing.fs.FileReader.prototype.abort=function(){if(this.readyState_!=goog.fs.FileReader.ReadyState.LOADING){var msg="aborting read";throw new goog.fs.Error({name:"InvalidStateError"},msg)}this.aborted_=!0};goog.testing.fs.FileReader.prototype.getResult=function(){if(this.readyState_!=goog.fs.FileReader.ReadyState.DONE){return}if(this.error_){return}if(this.returnType_==goog.testing.fs.FileReader.ReturnType.TEXT){return this.blob_.toString()}else if(this.returnType_==goog.testing.fs.FileReader.ReturnType.ARRAY_BUFFER){return this.blob_.toArrayBuffer()}else if(this.returnType_==goog.testing.fs.FileReader.ReturnType.BINARY_STRING){return this.blob_.toString()}else if(this.returnType_==goog.testing.fs.FileReader.ReturnType.DATA_URL){return this.blob_.toDataUrl()}else{return}};goog.testing.fs.FileReader.prototype.read_=function(blob){this.blob_=blob;if(this.readyState_==goog.fs.FileReader.ReadyState.LOADING){var msg="reading file";throw new goog.fs.Error({name:"InvalidStateError"},msg)}this.readyState_=goog.fs.FileReader.ReadyState.LOADING;goog.Timer.callOnce(function(){if(this.aborted_){this.abort_(blob.size);return}this.progressEvent_(goog.fs.FileReader.EventType.LOAD_START,0,blob.size);this.progressEvent_(goog.fs.FileReader.EventType.LOAD,blob.size/2,blob.size);this.progressEvent_(goog.fs.FileReader.EventType.LOAD,blob.size,blob.size);this.readyState_=goog.fs.FileReader.ReadyState.DONE;this.progressEvent_(goog.fs.FileReader.EventType.LOAD,blob.size,blob.size);this.progressEvent_(goog.fs.FileReader.EventType.LOAD_END,blob.size,blob.size)},0,this)};goog.testing.fs.FileReader.prototype.readAsBinaryString=function(blob){this.returnType_=goog.testing.fs.FileReader.ReturnType.BINARY_STRING;this.read_(blob)};goog.testing.fs.FileReader.prototype.readAsArrayBuffer=function(blob){this.returnType_=goog.testing.fs.FileReader.ReturnType.ARRAY_BUFFER;this.read_(blob)};goog.testing.fs.FileReader.prototype.readAsText=function(blob,opt_encoding){this.returnType_=goog.testing.fs.FileReader.ReturnType.TEXT;this.read_(blob)};goog.testing.fs.FileReader.prototype.readAsDataUrl=function(blob){this.returnType_=goog.testing.fs.FileReader.ReturnType.DATA_URL;this.read_(blob)};goog.testing.fs.FileReader.prototype.abort_=function(total){this.error_=new goog.fs.Error({name:"AbortError"},"reading file");this.progressEvent_(goog.fs.FileReader.EventType.ERROR,0,total);this.progressEvent_(goog.fs.FileReader.EventType.ABORT,0,total);this.readyState_=goog.fs.FileReader.ReadyState.DONE;this.progressEvent_(goog.fs.FileReader.EventType.LOAD_END,0,total);this.aborted_=!1};goog.testing.fs.FileReader.prototype.progressEvent_=function(type,loaded,total){this.dispatchEvent(new goog.testing.fs.ProgressEvent(type,loaded,total))};