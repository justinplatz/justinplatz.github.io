goog.provide("goog.async.ConditionalDelay");goog.require("goog.Disposable");goog.require("goog.async.Delay");goog.async.ConditionalDelay=function(listener,opt_handler){goog.async.ConditionalDelay.base(this,"constructor");this.interval_=0;this.runUntil_=0;this.isDone_=!1;this.listener_=listener;this.handler_=opt_handler;this.delay_=new goog.async.Delay(goog.bind(this.onTick_,this),0,this)};goog.inherits(goog.async.ConditionalDelay,goog.Disposable);goog.async.ConditionalDelay.prototype.disposeInternal=function(){this.delay_.dispose();delete this.listener_;delete this.handler_;goog.async.ConditionalDelay.superClass_.disposeInternal.call(this)};goog.async.ConditionalDelay.prototype.start=function(opt_interval,opt_timeout){this.stop();this.isDone_=!1;var timeout=opt_timeout||0;this.interval_=Math.max(opt_interval||0,0);this.runUntil_=0>timeout?-1:goog.now()+timeout;this.delay_.start(0>timeout?this.interval_:Math.min(this.interval_,timeout))};goog.async.ConditionalDelay.prototype.stop=function(){this.delay_.stop()};goog.async.ConditionalDelay.prototype.isActive=function(){return this.delay_.isActive()};goog.async.ConditionalDelay.prototype.isDone=function(){return this.isDone_};goog.async.ConditionalDelay.prototype.onSuccess=function(){};goog.async.ConditionalDelay.prototype.onFailure=function(){};goog.async.ConditionalDelay.prototype.onTick_=function(){var successful=this.listener_.call(this.handler_);if(successful){this.isDone_=!0;this.onSuccess()}else{if(0>this.runUntil_){this.delay_.start(this.interval_)}else{var timeLeft=this.runUntil_-goog.now();if(0>=timeLeft){this.onFailure()}else{this.delay_.start(Math.min(this.interval_,timeLeft))}}}};