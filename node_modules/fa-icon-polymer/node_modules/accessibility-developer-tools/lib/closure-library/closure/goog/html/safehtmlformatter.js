goog.provide("goog.html.SafeHtmlFormatter");goog.require("goog.asserts");goog.require("goog.dom.tags");goog.require("goog.html.SafeHtml");goog.require("goog.string");goog.html.SafeHtmlFormatter=function(){this.replacements_={};this.replacementsCount_=0};goog.html.SafeHtmlFormatter.Replacement;goog.html.SafeHtmlFormatter.prototype.format=function(format){var openedTags=[],html=goog.string.htmlEscape(format).replace(/\{SafeHtmlFormatter:\w+\}/g,goog.bind(this.replaceFormattingString_,this,openedTags));goog.asserts.assert(0==openedTags.length,"Expected no unclosed tags, got <"+openedTags.join(">, <")+">.");return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(html,null)};goog.html.SafeHtmlFormatter.prototype.replaceFormattingString_=function(openedTags,match){var replacement=this.replacements_[match];if(!replacement){return match}var result="";if(replacement.startTag){result+="<"+replacement.startTag+replacement.attributes+">";if(goog.asserts.ENABLE_ASSERTS){if(!goog.dom.tags.isVoidTag(replacement.startTag.toLowerCase())){openedTags.push(replacement.startTag.toLowerCase())}}}if(replacement.html){result+=replacement.html}if(replacement.endTag){result+="</"+replacement.endTag+">";if(goog.asserts.ENABLE_ASSERTS){var lastTag=openedTags.pop();goog.asserts.assert(lastTag==replacement.endTag.toLowerCase(),"Expected </"+lastTag+">, got </"+replacement.endTag+">.")}}return result};goog.html.SafeHtmlFormatter.prototype.startTag=function(tagName,opt_attributes){goog.html.SafeHtml.verifyTagName(tagName);return this.storeReplacement_({startTag:tagName,attributes:goog.html.SafeHtml.stringifyAttributes(tagName,opt_attributes)})};goog.html.SafeHtmlFormatter.prototype.endTag=function(tagName){goog.html.SafeHtml.verifyTagName(tagName);return this.storeReplacement_({endTag:tagName})};goog.html.SafeHtmlFormatter.prototype.text=function(text){return this.storeReplacement_({html:goog.string.htmlEscape(text)})};goog.html.SafeHtmlFormatter.prototype.safeHtml=function(safeHtml){return this.storeReplacement_({html:goog.html.SafeHtml.unwrap(safeHtml)})};goog.html.SafeHtmlFormatter.prototype.storeReplacement_=function(replacement){this.replacementsCount_++;var marker="{SafeHtmlFormatter:"+this.replacementsCount_+"_"+goog.string.getRandomString()+"}";this.replacements_[marker]=replacement;return marker};