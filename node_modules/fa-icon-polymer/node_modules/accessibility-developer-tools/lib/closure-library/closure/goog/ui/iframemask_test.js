goog.provide("goog.ui.IframeMaskTest");goog.setTestOnly("goog.ui.IframeMaskTest");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.dom.iframe");goog.require("goog.structs.Pool");goog.require("goog.style");goog.require("goog.testing.MockClock");goog.require("goog.testing.StrictMock");goog.require("goog.testing.jsunit");goog.require("goog.ui.IframeMask");goog.require("goog.ui.Popup");goog.require("goog.ui.PopupBase");goog.require("goog.userAgent");var iframeMask,mockClock;function setUp(){goog.dom.getElement("sandbox").innerHTML="<div id=\"popup\"></div>";mockClock=new goog.testing.MockClock(!0);iframeMask=new goog.ui.IframeMask}function tearDown(){iframeMask.dispose();mockClock.dispose();assertNoIframes()}function findOneAndOnlyIframe(){var iframes=goog.dom.getElementsByTagName(goog.dom.TagName.IFRAME);assertEquals("There should be exactly 1 iframe in the document",1,iframes.length);return iframes[0]}function assertNoIframes(){assertEquals("Expected no iframes in the document",0,goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.IFRAME).length)}function testApplyFullScreenMask(){iframeMask.applyMask();var iframe=findOneAndOnlyIframe();assertEquals("block",iframe.style.display);assertEquals("absolute",iframe.style.position);assertEquals("1",iframe.style.zIndex+"");iframeMask.hideMask();assertEquals("none",iframe.style.display)}function testApplyOpacity(){iframeMask.setOpacity(.3);iframeMask.applyMask();if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)){assertContains("Expected opactity to be set in the CSS style","30",findOneAndOnlyIframe().style.cssText)}else{assertContains("Expected opactity to be set in the CSS style","0.3",findOneAndOnlyIframe().style.cssText)}}function testApplyZIndex(){iframeMask.setZIndex(5);iframeMask.applyMask();assertEquals("5",findOneAndOnlyIframe().style.zIndex+"")}function testSnapElement(){iframeMask.setSnapElement(goog.dom.getElement("popup"));iframeMask.applyMask();var iframe=findOneAndOnlyIframe(),bounds=goog.style.getBounds(iframe);assertEquals(100,bounds.left);assertEquals(900,bounds.top);assertEquals(300,bounds.width);assertEquals(400,bounds.height);iframeMask.setSnapElement(document.documentElement);assertNotEquals("Snap element not updated",400,goog.style.getBounds(iframe).height)}function testAttachToPopup(){var popup=new goog.ui.Popup(goog.dom.getElement("popup"));iframeMask.listenOnTarget(popup,goog.ui.PopupBase.EventType.SHOW,goog.ui.PopupBase.EventType.HIDE,goog.dom.getElement("popup"));assertNoIframes();popup.setVisible(!0);assertNoIframes();mockClock.tick(1);var iframe=findOneAndOnlyIframe(),bounds=goog.style.getBounds(iframe);assertEquals(300,bounds.width);assertEquals(400,bounds.height);assertEquals("block",iframe.style.display);popup.setVisible(!1);assertEquals("none",iframe.style.display)}function testQuickHidingPopup(){var popup=new goog.ui.Popup(goog.dom.getElement("popup"));iframeMask.listenOnTarget(popup,goog.ui.PopupBase.EventType.SHOW,goog.ui.PopupBase.EventType.HIDE);assertNoIframes();popup.setVisible(!0);assertNoIframes();popup.setVisible(!1);assertNoIframes();mockClock.tick(1);assertNoIframes()}function testRemoveHandlers(){var popup=new goog.ui.Popup(goog.dom.getElement("popup"));iframeMask.listenOnTarget(popup,goog.ui.PopupBase.EventType.SHOW,goog.ui.PopupBase.EventType.HIDE);iframeMask.removeHandlers();popup.setVisible(!0);mockClock.tick(1);assertNoIframes()}function testIframePool(){var iframe=goog.dom.iframe.createBlank(goog.dom.getDomHelper()),mockPool=new goog.testing.StrictMock(goog.structs.Pool);mockPool.getObject();mockPool.$returns(iframe);mockPool.$replay();iframeMask.dispose();iframeMask=new goog.ui.IframeMask(null,mockPool);iframeMask.applyMask();mockPool.$verify();findOneAndOnlyIframe();mockPool.$reset();mockPool.releaseObject(iframe);mockPool.$replay();iframeMask.hideMask();mockPool.$verify();findOneAndOnlyIframe();mockPool.$reset();mockPool.getObject();mockPool.$returns(iframe);mockPool.$replay();iframeMask.applyMask();mockPool.$verify();mockPool.$reset();mockPool.releaseObject(iframe);mockPool.$does(function(){goog.dom.removeNode(iframe)});mockPool.$replay()}