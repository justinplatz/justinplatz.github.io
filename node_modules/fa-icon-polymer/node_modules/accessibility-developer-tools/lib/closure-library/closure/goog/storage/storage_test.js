goog.provide("goog.storage.storage_test");goog.setTestOnly("goog.storage.storage_test");goog.require("goog.functions");goog.require("goog.storage.ErrorCode");goog.require("goog.storage.Storage");goog.require("goog.storage.mechanism.mechanismfactory");goog.require("goog.structs.Map");goog.require("goog.testing.asserts");goog.require("goog.testing.jsunit");goog.require("goog.testing.storage.FakeMechanism");goog.storage.storage_test.runBasicTests=function(storage){storage.set("first","Hello world!");storage.set("second",["one","two","three"]);storage.set("third",{a:97,b:98});assertEquals("Hello world!",storage.get("first"));assertObjectEquals(["one","two","three"],storage.get("second"));assertObjectEquals({a:97,b:98},storage.get("third"));var map=new goog.structs.Map;map.set("Alice","Hello world!");map.set("Bob",["one","two","three"]);map.set("Cecile",{a:97,b:98});storage.set("first",map.toObject());assertObjectEquals(map.toObject(),storage.get("first"));storage.set("second",null);assertEquals(null,storage.get("second"));storage.set("second",void 0);assertEquals(void 0,storage.get("second"));storage.set("second","");assertEquals("",storage.get("second"));storage.remove("first");storage.remove("second");storage.remove("third");assertUndefined(storage.get("first"));assertUndefined(storage.get("second"));assertUndefined(storage.get("third"))};function testBasicOperations(){var mechanism=new goog.testing.storage.FakeMechanism,storage=new goog.storage.Storage(mechanism);goog.storage.storage_test.runBasicTests(storage)}function testMechanismCommunication(){var mechanism=new goog.testing.storage.FakeMechanism,storage=new goog.storage.Storage(mechanism);mechanism.set("first","");assertEquals(goog.storage.ErrorCode.INVALID_VALUE,assertThrows(function(){storage.get("first")}));mechanism.set("second","(");assertEquals(goog.storage.ErrorCode.INVALID_VALUE,assertThrows(function(){storage.get("second")}));storage.remove("first");storage.remove("second");assertUndefined(storage.get("first"));assertUndefined(storage.get("second"));assertNull(mechanism.get("first"));assertNull(mechanism.get("second"))}function testMechanismFailsGracefullyOnInvalidValue(){var mechanism={get:goog.functions.error("Invalid value")},storage=new goog.storage.Storage(mechanism);assertUndefined(storage.get("foobar"))}