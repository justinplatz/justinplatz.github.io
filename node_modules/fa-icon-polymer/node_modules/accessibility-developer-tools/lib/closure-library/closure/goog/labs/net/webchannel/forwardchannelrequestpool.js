goog.provide("goog.labs.net.webChannel.ForwardChannelRequestPool");goog.require("goog.array");goog.require("goog.string");goog.require("goog.structs.Set");goog.scope(function(){var ChannelRequest=goog.labs.net.webChannel.ChannelRequest;goog.labs.net.webChannel.ForwardChannelRequestPool=function(opt_maxPoolSize){this.maxPoolSizeConfigured_=opt_maxPoolSize||goog.labs.net.webChannel.ForwardChannelRequestPool.MAX_POOL_SIZE_;this.maxSize_=ForwardChannelRequestPool.isSpdyEnabled_()?this.maxPoolSizeConfigured_:1;this.requestPool_=null;if(1<this.maxSize_){this.requestPool_=new goog.structs.Set}this.request_=null};var ForwardChannelRequestPool=goog.labs.net.webChannel.ForwardChannelRequestPool;ForwardChannelRequestPool.MAX_POOL_SIZE_=10;ForwardChannelRequestPool.isSpdyEnabled_=function(){return!!(goog.global.chrome&&goog.global.chrome.loadTimes&&goog.global.chrome.loadTimes()&&goog.global.chrome.loadTimes().wasFetchedViaSpdy)};ForwardChannelRequestPool.prototype.applyClientProtocol=function(clientProtocol){if(this.requestPool_){return}if(goog.string.contains(clientProtocol,"spdy")||goog.string.contains(clientProtocol,"quic")){this.maxSize_=this.maxPoolSizeConfigured_;this.requestPool_=new goog.structs.Set;if(this.request_){this.addRequest(this.request_);this.request_=null}}};ForwardChannelRequestPool.prototype.isFull=function(){if(this.request_){return!0}if(this.requestPool_){return this.requestPool_.getCount()>=this.maxSize_}return!1};ForwardChannelRequestPool.prototype.getMaxSize=function(){return this.maxSize_};ForwardChannelRequestPool.prototype.getRequestCount=function(){if(this.request_){return 1}if(this.requestPool_){return this.requestPool_.getCount()}return 0};ForwardChannelRequestPool.prototype.hasRequest=function(req){if(this.request_){return this.request_==req}if(this.requestPool_){return this.requestPool_.contains(req)}return!1};ForwardChannelRequestPool.prototype.addRequest=function(req){if(this.requestPool_){this.requestPool_.add(req)}else{this.request_=req}};ForwardChannelRequestPool.prototype.removeRequest=function(req){if(this.request_&&this.request_==req){this.request_=null;return!0}if(this.requestPool_&&this.requestPool_.contains(req)){this.requestPool_.remove(req);return!0}return!1};ForwardChannelRequestPool.prototype.cancel=function(){if(this.request_){this.request_.cancel();this.request_=null;return}if(this.requestPool_&&!this.requestPool_.isEmpty()){goog.array.forEach(this.requestPool_.getValues(),function(val){val.cancel()});this.requestPool_.clear()}};ForwardChannelRequestPool.prototype.hasPendingRequest=function(){return null!=this.request_||null!=this.requestPool_&&!this.requestPool_.isEmpty()};ForwardChannelRequestPool.prototype.forceComplete=function(onComplete){if(null!=this.request_){this.request_.cancel();onComplete(this.request_);return!0}if(this.requestPool_&&!this.requestPool_.isEmpty()){goog.array.forEach(this.requestPool_.getValues(),function(val){val.cancel();onComplete(val)});return!0}return!1}});