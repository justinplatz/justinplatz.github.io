goog.provide("goog.stats.BasicStat");goog.require("goog.asserts");goog.require("goog.log");goog.require("goog.string.format");goog.require("goog.structs.CircularBuffer");goog.stats.BasicStat=function(interval){goog.asserts.assert(50<interval);this.interval_=interval;this.slotInterval_=Math.floor(interval/goog.stats.BasicStat.NUM_SLOTS_);this.slots_=new goog.structs.CircularBuffer(goog.stats.BasicStat.NUM_SLOTS_)};goog.stats.BasicStat.NUM_SLOTS_=50;goog.stats.BasicStat.prototype.logger_=goog.log.getLogger("goog.stats.BasicStat");goog.stats.BasicStat.prototype.getInterval=function(){return this.interval_};goog.stats.BasicStat.prototype.incBy=function(amt,opt_now){var now=opt_now?opt_now:goog.now();this.checkForTimeTravel_(now);var slot=this.slots_.getLast();if(!slot||now>=slot.end){slot=new goog.stats.BasicStat.Slot_(this.getSlotBoundary_(now));this.slots_.add(slot)}slot.count+=amt;slot.min=Math.min(amt,slot.min);slot.max=Math.max(amt,slot.max)};goog.stats.BasicStat.prototype.get=function(opt_now){return this.reduceSlots_(opt_now,function(sum,slot){return sum+slot.count},0)};goog.stats.BasicStat.prototype.getMax=function(opt_now){return this.reduceSlots_(opt_now,function(max,slot){return Math.max(max,slot.max)},Number.MIN_VALUE)};goog.stats.BasicStat.prototype.getMin=function(opt_now){return this.reduceSlots_(opt_now,function(min,slot){return Math.min(min,slot.min)},Number.MAX_VALUE)};goog.stats.BasicStat.prototype.reduceSlots_=function(now,func,val){now=now||goog.now();this.checkForTimeTravel_(now);for(var rval=val,start=this.getSlotBoundary_(now)-this.interval_,i=this.slots_.getCount()-1,slot;0<=i;--i){slot=this.slots_.get(i);if(slot.end<=start){break}rval=func(rval,slot)}return rval};goog.stats.BasicStat.prototype.getSlotBoundary_=function(time){return this.slotInterval_*(Math.floor(time/this.slotInterval_)+1)};goog.stats.BasicStat.prototype.checkForTimeTravel_=function(now){var slot=this.slots_.getLast();if(slot){var slotStart=slot.end-this.slotInterval_;if(now<slotStart){goog.log.warning(this.logger_,goog.string.format("Went backwards in time: now=%d, slotStart=%d.  Resetting state.",now,slotStart));this.reset_()}}};goog.stats.BasicStat.prototype.reset_=function(){this.slots_.clear()};goog.stats.BasicStat.Slot_=function(end){this.end=end};goog.stats.BasicStat.Slot_.prototype.count=0;goog.stats.BasicStat.Slot_.prototype.min=Number.MAX_VALUE;goog.stats.BasicStat.Slot_.prototype.max=Number.MIN_VALUE;