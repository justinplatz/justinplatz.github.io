goog.provide("goog.async.runTest");goog.require("goog.async.run");goog.require("goog.testing.MockClock");goog.require("goog.testing.jsunit");goog.require("goog.testing.recordFunction");goog.setTestOnly("goog.async.runTest");var mockClock,futureCallback1,futureCallback2;function setUpPage(){mockClock=new goog.testing.MockClock;mockClock.install()}function setUp(){mockClock.reset();futureCallback1=new goog.testing.recordFunction;futureCallback2=new goog.testing.recordFunction}function tearDown(){futureCallback1=null;futureCallback2=null}function tearDownPage(){mockClock.uninstall();goog.dispose(mockClock)}function testCalledAsync(){goog.async.run(futureCallback1);goog.async.run(futureCallback2);assertEquals(0,futureCallback1.getCallCount());assertEquals(0,futureCallback2.getCallCount());mockClock.tick();assertEquals(1,futureCallback1.getCallCount());assertEquals(1,futureCallback2.getCallCount());assertEquals(1,futureCallback1.getCallCount());assertEquals(1,futureCallback2.getCallCount())}function testSequenceCalledInOrder(){futureCallback1=new goog.testing.recordFunction(function(){assertEquals(0,futureCallback2.getCallCount())});futureCallback2=new goog.testing.recordFunction(function(){assertEquals(1,futureCallback1.getCallCount())});goog.async.run(futureCallback1);goog.async.run(futureCallback2);assertEquals(0,futureCallback1.getCallCount());mockClock.tick();assertEquals(1,futureCallback1.getCallCount());assertEquals(1,futureCallback2.getCallCount())}function testSequenceScheduledTwice(){goog.async.run(futureCallback1);goog.async.run(futureCallback1);assertEquals(0,futureCallback1.getCallCount());mockClock.tick();assertEquals(2,futureCallback1.getCallCount())}function testSequenceCalledSync(){futureCallback1=new goog.testing.recordFunction(function(){goog.async.run(futureCallback2);assertEquals(0,futureCallback2.getCallCount())});goog.async.run(futureCallback1);assertEquals(0,futureCallback1.getCallCount());mockClock.tick();assertEquals(1,futureCallback1.getCallCount());assertEquals(1,futureCallback2.getCallCount())}function testScope(){var aScope={};goog.async.run(futureCallback1);goog.async.run(futureCallback2,aScope);mockClock.tick();assertEquals(1,futureCallback1.getCallCount());assertEquals(1,futureCallback2.getCallCount());var last1=futureCallback1.popLastCall();assertEquals(0,last1.getArguments().length);assertEquals(goog.global,last1.getThis());var last2=futureCallback2.popLastCall();assertEquals(0,last2.getArguments().length);assertEquals(aScope,last2.getThis())}