goog.provide("goog.ui.ActivityMonitor");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.events.EventHandler");goog.require("goog.events.EventTarget");goog.require("goog.events.EventType");goog.ui.ActivityMonitor=function(opt_domHelper,opt_useBubble){goog.events.EventTarget.call(this);this.documents_=[];this.useBubble_=!!opt_useBubble;this.eventHandler_=new goog.events.EventHandler(this);this.isIframe_=window.parent!=window;if(!opt_domHelper){this.addDocument(goog.dom.getDomHelper().getDocument())}else if(goog.isArray(opt_domHelper)){for(var i=0;i<opt_domHelper.length;i++){this.addDocument(opt_domHelper[i].getDocument())}}else{this.addDocument(opt_domHelper.getDocument())}this.lastEventTime_=goog.now()};goog.inherits(goog.ui.ActivityMonitor,goog.events.EventTarget);goog.tagUnsealableClass(goog.ui.ActivityMonitor);goog.ui.ActivityMonitor.prototype.lastEventType_="";goog.ui.ActivityMonitor.prototype.lastMouseX_;goog.ui.ActivityMonitor.prototype.lastMouseY_;goog.ui.ActivityMonitor.prototype.minEventTime_=0;goog.ui.ActivityMonitor.MIN_EVENT_SPACING=1e3*3;goog.ui.ActivityMonitor.userEventTypesBody_=[goog.events.EventType.CLICK,goog.events.EventType.DBLCLICK,goog.events.EventType.MOUSEDOWN,goog.events.EventType.MOUSEMOVE,goog.events.EventType.MOUSEUP];goog.ui.ActivityMonitor.userTouchEventTypesBody_=[goog.events.EventType.TOUCHEND,goog.events.EventType.TOUCHMOVE,goog.events.EventType.TOUCHSTART];goog.ui.ActivityMonitor.userEventTypesDocuments_=[goog.events.EventType.KEYDOWN,goog.events.EventType.KEYUP];goog.ui.ActivityMonitor.Event={ACTIVITY:"activity"};goog.ui.ActivityMonitor.prototype.disposeInternal=function(){goog.ui.ActivityMonitor.superClass_.disposeInternal.call(this);this.eventHandler_.dispose();this.eventHandler_=null;delete this.documents_};goog.ui.ActivityMonitor.prototype.addDocument=function(doc){if(goog.array.contains(this.documents_,doc)){return}this.documents_.push(doc);var useCapture=!this.useBubble_,eventsToListenTo=goog.array.concat(goog.ui.ActivityMonitor.userEventTypesDocuments_,goog.ui.ActivityMonitor.userEventTypesBody_);if(!this.isIframe_){goog.array.extend(eventsToListenTo,goog.ui.ActivityMonitor.userTouchEventTypesBody_)}this.eventHandler_.listen(doc,eventsToListenTo,this.handleEvent_,useCapture)};goog.ui.ActivityMonitor.prototype.removeDocument=function(doc){if(this.isDisposed()){return}goog.array.remove(this.documents_,doc);var useCapture=!this.useBubble_,eventsToUnlistenTo=goog.array.concat(goog.ui.ActivityMonitor.userEventTypesDocuments_,goog.ui.ActivityMonitor.userEventTypesBody_);if(!this.isIframe_){goog.array.extend(eventsToUnlistenTo,goog.ui.ActivityMonitor.userTouchEventTypesBody_)}this.eventHandler_.unlisten(doc,eventsToUnlistenTo,this.handleEvent_,useCapture)};goog.ui.ActivityMonitor.prototype.handleEvent_=function(e){var update=!1;switch(e.type){case goog.events.EventType.MOUSEMOVE:if("number"==typeof this.lastMouseX_&&this.lastMouseX_!=e.clientX||"number"==typeof this.lastMouseY_&&this.lastMouseY_!=e.clientY){update=!0}this.lastMouseX_=e.clientX;this.lastMouseY_=e.clientY;break;default:update=!0;}if(update){var type=goog.asserts.assertString(e.type);this.updateIdleTime(goog.now(),type)}};goog.ui.ActivityMonitor.prototype.resetTimer=function(){this.updateIdleTime(goog.now(),"manual")};goog.ui.ActivityMonitor.prototype.updateIdleTime=function(eventTime,eventType){this.lastEventTime_=eventTime;this.lastEventType_=eventType;if(eventTime>this.minEventTime_){this.dispatchEvent(goog.ui.ActivityMonitor.Event.ACTIVITY);this.minEventTime_=eventTime+goog.ui.ActivityMonitor.MIN_EVENT_SPACING}};goog.ui.ActivityMonitor.prototype.getIdleTime=function(opt_now){var now=opt_now||goog.now();return now-this.lastEventTime_};goog.ui.ActivityMonitor.prototype.getLastEventType=function(){return this.lastEventType_};goog.ui.ActivityMonitor.prototype.getLastEventTime=function(){return this.lastEventTime_};