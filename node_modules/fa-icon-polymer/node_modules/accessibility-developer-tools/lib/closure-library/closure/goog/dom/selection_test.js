goog.provide("goog.dom.selectionTest");goog.setTestOnly("goog.dom.selectionTest");goog.require("goog.dom");goog.require("goog.dom.InputType");goog.require("goog.dom.TagName");goog.require("goog.dom.selection");goog.require("goog.testing.jsunit");goog.require("goog.userAgent");var input,hiddenInput,textarea,hiddenTextarea;function setUp(){input=goog.dom.createDom(goog.dom.TagName.INPUT,{type:goog.dom.InputType.TEXT});textarea=goog.dom.createDom(goog.dom.TagName.TEXTAREA);hiddenInput=goog.dom.createDom(goog.dom.TagName.INPUT,{type:goog.dom.InputType.TEXT,style:"display: none"});hiddenTextarea=goog.dom.createDom(goog.dom.TagName.TEXTAREA,{style:"display: none"});document.body.appendChild(input);document.body.appendChild(textarea);document.body.appendChild(hiddenInput);document.body.appendChild(hiddenTextarea)}function tearDown(){goog.dom.removeChildren(document.body)}function testGetStartInput(){getStartHelper(input,hiddenInput)}function testGetStartTextarea(){getStartHelper(textarea,hiddenTextarea)}function testGetStartOther(){var button=goog.dom.createDom(goog.dom.TagName.BUTTON),hiddenButton=goog.dom.createDom(goog.dom.TagName.BUTTON,{style:"display: none"});document.body.appendChild(button);document.body.appendChild(hiddenButton);getStartHelper(button,hiddenButton)}function getStartHelper(field,hiddenField){assertEquals(0,goog.dom.selection.getStart(field));assertEquals(0,goog.dom.selection.getStart(hiddenField));field.focus();assertEquals(0,goog.dom.selection.getStart(field))}function testSetTextInput(){setTextHelper(input)}function testSetTextTextarea(){setTextHelper(textarea)}function setTextHelper(field){select(field);assertEquals("",goog.dom.selection.getText(field));goog.dom.selection.setText(field,"Get Behind Me Satan");assertEquals("Get Behind Me Satan",goog.dom.selection.getText(field))}function testSetTextMultipleLines(){select(textarea);assertEquals("",goog.dom.selection.getText(textarea));var isLegacyIE=goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),message=isLegacyIE?"Get Behind Me\r\nSatan":"Get Behind Me\nSatan";goog.dom.selection.setText(textarea,message);assertEquals(message,goog.dom.selection.getText(textarea));var endOfNewline=isLegacyIE?15:14,selectedMessage=message.substring(0,endOfNewline);goog.dom.selection.setStart(textarea,0);goog.dom.selection.setEnd(textarea,endOfNewline);assertEquals(selectedMessage,goog.dom.selection.getText(textarea));selectedMessage=isLegacyIE?"\r\n":"\n";goog.dom.selection.setStart(textarea,13);goog.dom.selection.setEnd(textarea,endOfNewline);assertEquals(selectedMessage,goog.dom.selection.getText(textarea))}function testSetCursorInput(){setCursorHelper(input)}function testSetCursorTextarea(){setCursorHelper(textarea)}function setCursorHelper(field){select(field);goog.dom.selection.setStart(field,5);goog.dom.selection.setEnd(field,15);assertEquals(0,goog.dom.selection.getStart(field));assertEquals(0,goog.dom.selection.getEnd(field));select(field);var message="Get Behind Me Satan";goog.dom.selection.setText(field,message);goog.dom.selection.setStart(field,5);goog.dom.selection.setEnd(field,message.length);assertEquals(5,goog.dom.selection.getStart(field));assertEquals(message.length,goog.dom.selection.getEnd(field));goog.dom.selection.setStart(field,5);goog.dom.selection.setEnd(field,3);assertEquals(3,goog.dom.selection.getEnd(field))}function testGetAndSetSelectedTextInput(){getAndSetSelectedTextHelper(input)}function testGetAndSetSelectedTextTextarea(){getAndSetSelectedTextHelper(textarea)}function getAndSetSelectedTextHelper(field){select(field);goog.dom.selection.setText(field,"Get Behind Me Satan");goog.dom.selection.setStart(field,4);goog.dom.selection.setEnd(field,10);assertEquals("Behind",goog.dom.selection.getText(field));goog.dom.selection.setText(field,"In Front Of");goog.dom.selection.setStart(field,0);goog.dom.selection.setEnd(field,100);assertEquals("Get In Front Of Me Satan",goog.dom.selection.getText(field))}function testSetCursorOnHiddenInput(){setCursorOnHiddenInputHelper(hiddenInput)}function testSetCursorOnHiddenTextarea(){setCursorOnHiddenInputHelper(hiddenTextarea)}function setCursorOnHiddenInputHelper(hiddenField){goog.dom.selection.setStart(hiddenField,0);assertEquals(0,goog.dom.selection.getStart(hiddenField))}function testSetAndGetCursorWithLineBreaks(){select(textarea);var isLegacyIE=goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),newline=isLegacyIE?"\r\n":"\n",message="Hello"+newline+"World";goog.dom.selection.setText(textarea,message);goog.dom.selection.setEnd(textarea,9);assertEquals(9,goog.dom.selection.getEnd(textarea));goog.dom.selection.setStart(textarea,10);assertEquals(10,goog.dom.selection.getStart(textarea));var endOfNewline=isLegacyIE?7:6;checkSetAndGetTextarea(endOfNewline,endOfNewline);clearField(textarea);message="Hello"+newline+newline+"World";goog.dom.selection.setText(textarea,message);var startOfNewline=isLegacyIE?7:6;endOfNewline=isLegacyIE?9:7;checkSetAndGetTextarea(startOfNewline,endOfNewline);checkSetAndGetTextarea(5,endOfNewline);clearField(textarea);message="Hello"+newline+newline+newline+newline+"World";goog.dom.selection.setText(textarea,message);var middleOfNewlines=isLegacyIE?9:7;checkSetAndGetTextarea(middleOfNewlines,middleOfNewlines);if(!goog.userAgent.IE||!goog.userAgent.isVersionOrHigher("11")){clearField(textarea);message="Hello"+newline+newline;goog.dom.selection.setText(textarea,message);var endOfTextarea=message.length;checkSetAndGetTextarea(endOfTextarea,endOfTextarea)}clearField(textarea);message=newline+newline+"World";goog.dom.selection.setText(textarea,message);var endOfTwoNewlines=isLegacyIE?4:2;checkSetAndGetTextarea(endOfTwoNewlines,endOfTwoNewlines);endOfOneNewline=isLegacyIE?2:1;checkSetAndGetTextarea(endOfOneNewline,endOfOneNewline)}function testGetStartOnUnfocusedTextarea(){input.value="White Blood Cells";input.focus();goog.dom.selection.setCursorPosition(input,5);assertEquals("getStart on input should return where we put the cursor",5,goog.dom.selection.getStart(input));assertEquals("getStart on unfocused textarea should succeed without error",0,goog.dom.selection.getStart(textarea))}function testSetCursorPositionTextareaWithNewlines(){textarea.value="Hello\nWorld";textarea.focus();goog.dom.selection.setCursorPosition(textarea,textarea.value.length-4);var isLegacyIE=goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),linebreak=isLegacyIE?"\r\n":"\n",expectedLeftString="Hello"+linebreak+"W";assertEquals("getStart on input should return after the newline",expectedLeftString.length,goog.dom.selection.getStart(textarea));assertEquals("getEnd on input should return after the newline",expectedLeftString.length,goog.dom.selection.getEnd(textarea));goog.dom.selection.setEnd(textarea,textarea.value.length);assertEquals("orld",goog.dom.selection.getText(textarea))}function clearField(field){field.value=""}function checkSetAndGetTextarea(start,end){goog.dom.selection.setStart(textarea,start);goog.dom.selection.setEnd(textarea,end);assertEquals(start,goog.dom.selection.getStart(textarea));assertEquals(end,goog.dom.selection.getEnd(textarea))}function select(field){field.focus();field.select()}