goog.provide("goog.async.DebouncerTest");goog.setTestOnly("goog.async.DebouncerTest");goog.require("goog.array");goog.require("goog.async.Debouncer");goog.require("goog.testing.MockClock");goog.require("goog.testing.jsunit");goog.require("goog.testing.recordFunction");function testDebouncerCommandSequences(){var expectedCommandSequenceCalls={f:0,ff:0,fw:1,ffw:1,fpr:0,fsf:0,fsw:0,fprw:1,fpwr:1,fsfw:1,fswf:0,fprfw:1,fprsw:0,fpswr:0,fpwfr:0,fpwsr:0,fswfw:1,fpswrw:0,fpwfrw:1,fpwsfr:0,fpwsrw:0,fspwrw:0,fpwsfrw:1,ffwfwfffw:3},interval=500,mockClock=new goog.testing.MockClock(!0);for(var commandSequence in expectedCommandSequenceCalls){for(var recordFn=goog.testing.recordFunction(),debouncer=new goog.async.Debouncer(recordFn,interval),i=0;i<commandSequence.length;++i){switch(commandSequence[i]){case"f":debouncer.fire();break;case"w":mockClock.tick(interval);break;case"p":debouncer.pause();break;case"r":debouncer.resume();break;case"s":debouncer.stop();break;}}var expectedCalls=expectedCommandSequenceCalls[commandSequence];assertEquals("Expected "+expectedCalls+" calls for command sequence \""+commandSequence+"\" ("+goog.array.map(commandSequence,function(command){switch(command){case"f":return"fire";case"w":return"wait";case"p":return"pause";case"r":return"resume";case"s":return"stop";}}).join(" -> ")+")",expectedCalls,recordFn.getCallCount());debouncer.dispose()}mockClock.uninstall()}function testDebouncerScopeBinding(){var interval=500,mockClock=new goog.testing.MockClock(!0),x={y:0},debouncer=new goog.async.Debouncer(function(){++this.y},interval,x);debouncer.fire();assertEquals(0,x.y);mockClock.tick(interval);assertEquals(1,x.y);mockClock.uninstall()}function testDebouncerArgumentBinding(){var interval=500,mockClock=new goog.testing.MockClock(!0),calls=0,debouncer=new goog.async.Debouncer(function(a,b,c){++calls;assertEquals(3,a);assertEquals("string",b);assertEquals(!1,c)},interval);debouncer.fire(3,"string",!1);mockClock.tick(interval);assertEquals(1,calls);debouncer.fire();mockClock.tick(interval/2);debouncer.fire(8,null,!0);debouncer.fire(3,"string",!1);mockClock.tick(interval);assertEquals(2,calls);mockClock.uninstall()}function testDebouncerArgumentAndScopeBinding(){var interval=500,mockClock=new goog.testing.MockClock(!0),x={calls:0},debouncer=new goog.async.Debouncer(function(a,b,c){++this.calls;assertEquals(3,a);assertEquals("string",b);assertEquals(!1,c)},interval,x);debouncer.fire(3,"string",!1);mockClock.tick(interval);assertEquals(1,x.calls);debouncer.fire();mockClock.tick(interval/2);debouncer.fire(8,null,!0);debouncer.fire(3,"string",!1);mockClock.tick(interval);assertEquals(2,x.calls);mockClock.uninstall()}