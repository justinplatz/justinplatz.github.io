goog.provide("goog.ui.ac.RemoteArrayMatcher");goog.require("goog.Disposable");goog.require("goog.Uri");goog.require("goog.events");goog.require("goog.json");goog.require("goog.net.EventType");goog.require("goog.net.XhrIo");goog.ui.ac.RemoteArrayMatcher=function(url,opt_noSimilar,opt_xmlHttpFactory){goog.Disposable.call(this);this.url_=url;this.useSimilar_=!opt_noSimilar;this.xhr_=new goog.net.XhrIo(opt_xmlHttpFactory)};goog.inherits(goog.ui.ac.RemoteArrayMatcher,goog.Disposable);goog.ui.ac.RemoteArrayMatcher.prototype.method_="GET";goog.ui.ac.RemoteArrayMatcher.prototype.content_=void 0;goog.ui.ac.RemoteArrayMatcher.prototype.headers_=null;goog.ui.ac.RemoteArrayMatcher.prototype.lastListenerKey_=null;goog.ui.ac.RemoteArrayMatcher.prototype.setMethod=function(method){this.method_=method};goog.ui.ac.RemoteArrayMatcher.prototype.setContent=function(content){this.content_=content};goog.ui.ac.RemoteArrayMatcher.prototype.setHeaders=function(headers){this.headers_=headers};goog.ui.ac.RemoteArrayMatcher.prototype.setTimeoutInterval=function(interval){this.xhr_.setTimeoutInterval(interval)};goog.ui.ac.RemoteArrayMatcher.prototype.buildUrl=function(uri,token,maxMatches,useSimilar,opt_fullString){var url=new goog.Uri(uri);url.setParameterValue("token",token);url.setParameterValue("max_matches",maxMatches+"");url.setParameterValue("use_similar",+useSimilar+"");return url.toString()};goog.ui.ac.RemoteArrayMatcher.prototype.shouldRequestMatches=function(uri,token,maxMatches,useSimilar,opt_fullString){return!0};goog.ui.ac.RemoteArrayMatcher.prototype.parseResponseText=function(responseText){var matches=[];if(responseText){try{matches=goog.json.unsafeParse(responseText)}catch(exception){}}return matches};goog.ui.ac.RemoteArrayMatcher.prototype.xhrCallback=function(token,matchHandler,event){var text=event.target.getResponseText();matchHandler(token,this.parseResponseText(text))};goog.ui.ac.RemoteArrayMatcher.prototype.requestMatchingRows=function(token,maxMatches,matchHandler,opt_fullString){if(!this.shouldRequestMatches(this.url_,token,maxMatches,this.useSimilar_,opt_fullString)){return}var url=this.buildUrl(this.url_,token,maxMatches,this.useSimilar_,opt_fullString);if(!url){return}var callback=goog.bind(this.xhrCallback,this,token,matchHandler);if(this.xhr_.isActive()){this.xhr_.abort()}if(this.lastListenerKey_){goog.events.unlistenByKey(this.lastListenerKey_)}this.lastListenerKey_=goog.events.listenOnce(this.xhr_,goog.net.EventType.SUCCESS,callback);this.xhr_.send(url,this.method_,this.content_,this.headers_)};goog.ui.ac.RemoteArrayMatcher.prototype.disposeInternal=function(){this.xhr_.dispose();goog.ui.ac.RemoteArrayMatcher.superClass_.disposeInternal.call(this)};