goog.provide("goog.dom.FontSizeMonitorTest");goog.setTestOnly("goog.dom.FontSizeMonitorTest");goog.require("goog.dom");goog.require("goog.dom.FontSizeMonitor");goog.require("goog.dom.TagName");goog.require("goog.events");goog.require("goog.events.Event");goog.require("goog.testing.PropertyReplacer");goog.require("goog.testing.events");goog.require("goog.testing.jsunit");goog.require("goog.userAgent");function isBuggyGecko(){return goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher("1.9")}var monitor;function setUp(){monitor=new goog.dom.FontSizeMonitor}function tearDown(){monitor.dispose()}function getResizeTarget(){return goog.userAgent.IE?monitor.sizeElement_:goog.dom.getFrameContentWindow(monitor.sizeElement_)}function testFontSizeNoChange(){var fired=!1;goog.events.listen(monitor,goog.dom.FontSizeMonitor.EventType.CHANGE,function(e){fired=!0});var resizeEvent=new goog.events.Event("resize",getResizeTarget());goog.testing.events.fireBrowserEvent(resizeEvent);assertFalse("The font size should not have changed",fired)}function testFontSizeChanged(){var fired=!1;goog.events.listen(monitor,goog.dom.FontSizeMonitor.EventType.CHANGE,function(e){fired=!0});monitor.lastWidth_--;var resizeEvent=new goog.events.Event("resize",getResizeTarget());goog.testing.events.fireBrowserEvent(resizeEvent);assertTrue("The font size should have changed",fired)}function testCreateAndDispose(){var frameCount=window.frames.length,iframeElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.IFRAME).length,divElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.DIV).length,monitor=new goog.dom.FontSizeMonitor;monitor.dispose();var newFrameCount=window.frames.length,newIframeElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.IFRAME).length,newDivElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.DIV).length;assertEquals("There should be no trailing frames",frameCount+isBuggyGecko(),newFrameCount);assertEquals("There should be no trailing iframe elements",iframeElementCount+isBuggyGecko(),newIframeElementCount);assertEquals("There should be no trailing div elements",divElementCount,newDivElementCount)}function testWithDomHelper(){var frameCount=window.frames.length,iframeElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.IFRAME).length,divElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.DIV).length,monitor=new goog.dom.FontSizeMonitor(goog.dom.getDomHelper()),newFrameCount=window.frames.length,newIframeElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.IFRAME).length,newDivElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.DIV).length;if(goog.userAgent.IE){assertEquals("There should be one new div element",divElementCount+1,newDivElementCount)}else{assertEquals("There should be one new frame",frameCount+1,newFrameCount);assertEquals("There should be one new iframe element",iframeElementCount+1,newIframeElementCount)}var win=window.frames[0],doc=win.document;doc.open();doc.write("<html><body></body></html>");doc.close();var domHelper=goog.dom.getDomHelper(doc),frameCount2=win.frames.length,iframeElementCount2=goog.dom.getElementsByTagName(goog.dom.TagName.IFRAME,doc).length,divElementCount2=goog.dom.getElementsByTagName(goog.dom.TagName.DIV,doc).length,monitor2=new goog.dom.FontSizeMonitor(domHelper),newFrameCount2=win.frames.length,newIframeElementCount2=goog.dom.getElementsByTagName(goog.dom.TagName.IFRAME,doc).length,newDivElementCount2=goog.dom.getElementsByTagName(goog.dom.TagName.DIV,doc).length;if(goog.userAgent.IE){assertEquals("There should be one new div element",divElementCount2+1,newDivElementCount2)}else{assertEquals("There should be one new frame",frameCount2+1,newFrameCount2);assertEquals("There should be one new iframe element",iframeElementCount2+1,newIframeElementCount2)}monitor.dispose();monitor2.dispose()}function testEnsureThatDocIsOpenedForGecko(){var pr=new goog.testing.PropertyReplacer;pr.set(goog.userAgent,"GECKO",!0);pr.set(goog.userAgent,"IE",!1);var openCalled=!1,closeCalled=!1,instance={document:{open:function(){openCalled=!0},close:function(){closeCalled=!0}},attachEvent:function(){}};pr.set(goog.dom,"getFrameContentWindow",function(){return instance});try{var monitor=new goog.dom.FontSizeMonitor;assertTrue("doc.open should have been called",openCalled);assertTrue("doc.close should have been called",closeCalled);monitor.dispose()}finally{pr.reset()}}function testFirefox2WorkAroundFirefox3(){var pr=new goog.testing.PropertyReplacer;pr.set(goog.userAgent,"GECKO",!0);pr.set(goog.userAgent,"IE",!1);try{pr.set(goog.userAgent,"VERSION","1.9");goog.userAgent.isVersionOrHigherCache_={};var frameCount=window.frames.length,iframeElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.IFRAME).length,divElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.DIV).length,monitor=new goog.dom.FontSizeMonitor;monitor.dispose();var newFrameCount=window.frames.length,newIframeElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.IFRAME).length,newDivElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.DIV).length;assertEquals("There should be no trailing frames",frameCount,newFrameCount);assertEquals("There should be no trailing iframe elements",iframeElementCount,newIframeElementCount);assertEquals("There should be no trailing div elements",divElementCount,newDivElementCount)}finally{pr.reset()}}function testFirefox2WorkAroundFirefox2(){var pr=new goog.testing.PropertyReplacer;pr.set(goog.userAgent,"GECKO",!0);pr.set(goog.userAgent,"IE",!1);try{pr.set(goog.userAgent,"VERSION","1.8");goog.userAgent.isVersionOrHigherCache_={};var frameCount=window.frames.length,iframeElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.IFRAME).length,divElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.DIV).length,monitor=new goog.dom.FontSizeMonitor;monitor.dispose();var newFrameCount=window.frames.length,newIframeElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.IFRAME).length,newDivElementCount=goog.dom.getElementsByTagName(goog.dom.TagName.DIV).length;assertEquals("There should be no trailing frames",frameCount+1,newFrameCount);assertEquals("There should be no trailing iframe elements",iframeElementCount+1,newIframeElementCount);assertEquals("There should be no trailing div elements",divElementCount,newDivElementCount)}finally{pr.reset()}}