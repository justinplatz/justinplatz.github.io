goog.provide("goog.storage.ExpiringStorageTest");goog.setTestOnly("goog.storage.ExpiringStorageTest");goog.require("goog.storage.ExpiringStorage");goog.require("goog.storage.storage_test");goog.require("goog.testing.MockClock");goog.require("goog.testing.jsunit");goog.require("goog.testing.storage.FakeMechanism");function testBasicOperations(){var mechanism=new goog.testing.storage.FakeMechanism,storage=new goog.storage.ExpiringStorage(mechanism);goog.storage.storage_test.runBasicTests(storage)}function testExpiration(){var mechanism=new goog.testing.storage.FakeMechanism,clock=new goog.testing.MockClock(!0),storage=new goog.storage.ExpiringStorage(mechanism);storage.set("first","one second",1e3);storage.set("second","permanent");storage.set("third","two seconds",2e3);storage.set("fourth","permanent");clock.tick(100);assertEquals("one second",storage.get("first"));assertEquals("permanent",storage.get("second"));assertEquals("two seconds",storage.get("third"));assertEquals("permanent",storage.get("fourth"));clock.tick(1e3);assertUndefined(storage.get("first"));assertEquals("permanent",storage.get("second"));assertEquals("two seconds",storage.get("third"));assertEquals("permanent",storage.get("fourth"));assertNull(mechanism.get("first"));storage.set("fourth","one second again",1e3);assertNull(mechanism.get("fourth"));assertUndefined(storage.get("fourth"));clock.tick(1e3);assertEquals("permanent",storage.get("second"));assertUndefined(storage.get("third"));assertNull(mechanism.get("third"));storage.remove("second");assertNull(mechanism.get("second"));assertUndefined(storage.get("second"));clock.uninstall()}function testClockSkew(){var mechanism=new goog.testing.storage.FakeMechanism,storage=new goog.storage.ExpiringStorage(mechanism),clock=new goog.testing.MockClock(!0);clock.tick(100);storage.set("first","one second",1e3);clock.reset();assertUndefined(storage.get("first"));assertNull(mechanism.get("first"));clock.uninstall()}