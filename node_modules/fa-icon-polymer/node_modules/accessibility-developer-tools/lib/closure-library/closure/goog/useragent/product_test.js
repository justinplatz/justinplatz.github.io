goog.provide("goog.userAgent.productTest");goog.setTestOnly("goog.userAgent.productTest");goog.require("goog.array");goog.require("goog.labs.userAgent.testAgents");goog.require("goog.labs.userAgent.util");goog.require("goog.testing.MockUserAgent");goog.require("goog.testing.PropertyReplacer");goog.require("goog.testing.jsunit");goog.require("goog.userAgent");goog.require("goog.userAgent.product");goog.require("goog.userAgent.product.isVersion");goog.require("goog.userAgentTestUtil");var mockAgent,replacer;function setUp(){mockAgent=new goog.testing.MockUserAgent;mockAgent.install();replacer=new goog.testing.PropertyReplacer}function tearDown(){replacer.reset();mockAgent.dispose();updateUserAgentUtils()}function updateUserAgentUtils(){goog.labs.userAgent.util.setUserAgent(null);goog.userAgentTestUtil.reinitializeUserAgent()}var DETECTED_BROWSER_KEYS=["FIREFOX","IPHONE","IPAD","ANDROID","CHROME","SAFARI"];function assertIsBrowser(currentBrowser){assertTrue("Current browser key into goog.userAgent.product "+"should be true",goog.userAgent.product[currentBrowser]);goog.array.forEach(DETECTED_BROWSER_KEYS,function(browserKey){if("IPAD"==currentBrowser&&"SAFARI"==browserKey){return}if("IPHONE"==currentBrowser&&"SAFARI"==browserKey){return}if(currentBrowser!=browserKey){assertFalse("Current browser key is "+currentBrowser+" but different key into goog.userAgent.product is true: "+browserKey,goog.userAgent.product[browserKey])}})}function assertBrowserAndVersion(userAgent,browser,version){mockAgent.setUserAgentString(userAgent);updateUserAgentUtils();assertIsBrowser(browser);assertEquals("User agent should have this version",version,goog.userAgent.VERSION)}function checkEachUserAgentDetected(userAgents,browser){goog.array.forEach(userAgents,function(ua){mockAgent.setUserAgentString(ua.ua);updateUserAgentUtils();assertIsBrowser(browser);goog.array.forEach(ua.versions,function(v){mockAgent.setUserAgentString(ua.ua);updateUserAgentUtils();assertEquals("Expected version "+v.num+" from "+ua.ua+" but got "+goog.userAgent.product.VERSION,v.truth,goog.userAgent.product.isVersion(v.num))})})}function testInternetExplorer(){var userAgents=[{ua:"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; GTB6; "+"chromeframe; .NET CLR 1.1.4322; InfoPath.1; "+".NET CLR 3.0.04506.30; .NET CLR 3.0.04506.648; "+".NET CLR 3.0.4506.2152; .NET CLR 3.5.30729; .NET CLR 2.0.50727)",versions:[{num:6,truth:!0},{num:"7.0",truth:!0},{num:7.1,truth:!1},{num:8,truth:!1}]},{ua:"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko",versions:[{num:10,truth:!0},{num:11,truth:!0},{num:"11.0",truth:!0},{num:"12",truth:!1}]}];mockAgent.setNavigator({});checkEachUserAgentDetected(userAgents,"IE")}function testEdge(){var userAgents=[{ua:goog.labs.userAgent.testAgents.EDGE_12_9600,versions:[{num:11,truth:!0},{num:12,truth:!0},{num:"12.96",truth:!0},{num:"12.9600",truth:!0},{num:"12.9601",truth:!1},{num:"12.10240",truth:!1},{num:13,truth:!1}]}];checkEachUserAgentDetected(userAgents,"EDGE")}function testOpera(){var opera={},userAgents=[{ua:"Opera/9.80 (Windows NT 5.1; U; en) Presto/2.2.15 Version/10.01",versions:[{num:9,truth:!0},{num:"10.1",truth:!0},{num:11,truth:!1}]}];replacer.set(goog.global,"opera",opera);opera.version="10.01";checkEachUserAgentDetected(userAgents,"OPERA")}function testFirefox(){var userAgents=[{ua:"Mozilla/6.0 (Macintosh; U; PPC Mac OS X Mach-O; en-US; "+"rv:2.0.0.0) Gecko/20061028 Firefox/3.0",versions:[{num:2,truth:!0},{num:"3.0",truth:!0},{num:"3.5.3",truth:!1}]},{ua:"Mozilla/5.0 (Macintosh; U; PPC Mac OS X Mach-O; en-US; "+"rv:1.8.1.4) Gecko/20070515 Firefox/2.0.4",versions:[{num:2,truth:!0},{num:"2.0.4",truth:!0},{num:3,truth:!1},{num:"3.5.3",truth:!1}]},{ua:"Mozilla/5.0 (X11; Linux i686; rv:6.0) Gecko/6.0 Firefox/6.0",versions:[{num:6,truth:!0},{num:"6.0",truth:!0},{num:7,truth:!1},{num:"7.0",truth:!1}]}];checkEachUserAgentDetected(userAgents,"FIREFOX");mockAgent.setNavigator({product:"Gecko"});assertBrowserAndVersion("Mozilla/5.0 (X11; Linux i686; rv:6.0) Gecko/6.0 Firefox/6.0","FIREFOX","6.0")}function testChrome(){var userAgents=[{ua:"Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) "+"AppleWebKit/525.19 (KHTML, like Gecko) Chrome/0.2.153.0 "+"Safari/525.19",versions:[{num:"0.2.153",truth:!0},{num:1,truth:!1}]},{ua:"Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) "+"AppleWebKit/532.3 (KHTML, like Gecko) Chrome/4.0.223.11 "+"Safari/532.3",versions:[{num:4,truth:!0},{num:"0.2.153",truth:!0},{num:"4.1.223.13",truth:!1},{num:"4.0.223.10",truth:!0}]},{ua:"Mozilla/5.0 (Linux; Android 4.0.4; Galaxy Nexus Build/IMM76B)"+"AppleWebKit/535.19 (KHTML, like Gecko) "+"Chrome/18.0.1025.133 Mobile"+"Safari/535.19",versions:[{num:18,truth:!0},{num:"0.2.153",truth:!0},{num:29,truth:!1},{num:"18.0.1025.133",truth:!0}]}];checkEachUserAgentDetected(userAgents,"CHROME")}function testSafari(){var userAgents=[{ua:"Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_7; de-de) "+"AppleWebKit/534.16+ (KHTML, like Gecko) Version/5.0.3 "+"Safari/533.19.4",versions:[{num:5,truth:!0},{num:"5.0.3",truth:!0},{num:"5.0.4",truth:!1},{num:"533",truth:!1}]},{ua:"Mozilla/5.0 (Windows; U; Windows NT 6.0; pl-PL) "+"AppleWebKit/525.19 (KHTML, like Gecko) Version/3.1.2 Safari/525.21",versions:[{num:3,truth:!0},{num:"3.0",truth:!0},{num:"3.1.2",truth:!0}]},{ua:"Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_5_3; en-us) "+"AppleWebKit/525.18 (KHTML, like Gecko) Version/3.1.1 Safari/525.20",versions:[{num:3,truth:!0},{num:"3.1.1",truth:!0},{num:"3.1.2",truth:!1},{num:"525.21",truth:!1}]},{ua:"Mozilla/5.0 (Macintosh; U; PPC Mac OS X; ja-jp) "+"AppleWebKit/418.9.1 (KHTML, like Gecko) Safari/419.3",versions:[{num:3,truth:!1},{num:2,truth:!1},{num:1,truth:!1},{num:0,truth:!0},{num:"0",truth:!0},{num:"",truth:!0}]}];checkEachUserAgentDetected(userAgents,"SAFARI")}function testIphone(){var userAgents=[{ua:"Mozilla/5.0 (iPhone; U; CPU like Mac OS X; en) AppleWebKit/420+ "+"(KHTML, like Gecko) Version/3.0 Mobile/1A543a Safari/419.3",versions:[{num:"3.0.1A543a",truth:!0},{num:"3.0",truth:!0},{num:"3.0.1B543a",truth:!1},{num:"3.1.1A543a",truth:!1},{num:"3.0.1A320c",truth:!0},{num:"3.0.3A100a",truth:!1}]},{ua:"Mozilla/5.0 (iPod; U; CPU like Mac OS X; en) AppleWebKit/420.1 "+"(KHTML, like Gecko) Version/3.0 Mobile/3A100a Safari/419.3",versions:[{num:"3.0.1A543a",truth:!0},{num:"3.0.3A100a",truth:!0}]}];checkEachUserAgentDetected(userAgents,"IPHONE")}function testIpad(){var userAgents=[{ua:"Mozilla/5.0 (iPad; U; CPU OS 3_2 like Mac OS X; en-us) "+"AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 "+"Mobile/7B334b Safari/531.21.10",versions:[{num:"4.0.4.7B334b",truth:!0},{num:"4.0",truth:!0},{num:"4.0.4.7C334b",truth:!1},{num:"4.1.7B334b",truth:!1},{num:"4.0.4.7B320c",truth:!0},{num:"4.0.4.8B334b",truth:!1}]},{ua:"Mozilla/5.0 (iPad; CPU OS 8_1 like Mac OS X) AppleWebKit/600.1.4"+"(KHTML, like Gecko) Mobile/12B410 [FBAN/FBIOS;FBAV/16.0.0.13.22;"+"FBBV/4697910;FBDV/iPad3,4;FBMD/iPad;FBSN/iPhone OS;FBSV/8.1;"+"FBSS/2; FBCR/;FBID/tablet;FBLC/ja_JP;FBOP/1]",versions:[{num:"",truth:!0}]}];checkEachUserAgentDetected(userAgents,"IPAD")}function testAndroid(){var userAgents=[{ua:"Mozilla/5.0 (Linux; U; Android 0.5; en-us) AppleWebKit/522+ "+"(KHTML, like Gecko) Safari/419.3",versions:[{num:.5,truth:!0},{num:"1.0",truth:!1}]},{ua:"Mozilla/5.0 (Linux; U; Android 1.0; en-us; dream) "+"AppleWebKit/525.10+ (KHTML, like Gecko) Version/3.0.4 Mobile "+"Safari/523.12.2",versions:[{num:.5,truth:!0},{num:1,truth:!0},{num:"1.0",truth:!0},{num:"3.0.12",truth:!1}]}];checkEachUserAgentDetected(userAgents,"ANDROID")}function testAndroidLegacyBehavior(){mockAgent.setUserAgentString(goog.labs.userAgent.testAgents.FIREFOX_ANDROID_TABLET);updateUserAgentUtils();assertFalse(goog.userAgent.product.ANDROID)}function testSafariIosLegacyBehavior(){mockAgent.setUserAgentString(goog.labs.userAgent.testAgents.SAFARI_IPHONE_6);updateUserAgentUtils();assertFalse(goog.userAgent.product.SAFARI)}