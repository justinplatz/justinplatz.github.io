goog.provide("goog.events");goog.provide("goog.events.CaptureSimulationMode");goog.provide("goog.events.Key");goog.provide("goog.events.ListenableType");goog.require("goog.asserts");goog.require("goog.debug.entryPointRegistry");goog.require("goog.events.BrowserEvent");goog.require("goog.events.BrowserFeature");goog.require("goog.events.Listenable");goog.require("goog.events.ListenerMap");goog.forwardDeclare("goog.debug.ErrorHandler");goog.forwardDeclare("goog.events.EventWrapper");goog.events.Key;goog.events.ListenableType;goog.events.LISTENER_MAP_PROP_="closure_lm_"+(0|1e6*Math.random());goog.events.onString_="on";goog.events.onStringMap_={};goog.events.CaptureSimulationMode={OFF_AND_FAIL:0,OFF_AND_SILENT:1,ON:2};goog.define("goog.events.CAPTURE_SIMULATION_MODE",2);goog.events.listenerCountEstimate_=0;goog.events.listen=function(src,type,listener,opt_capt,opt_handler){if(goog.isArray(type)){for(var i=0;i<type.length;i++){goog.events.listen(src,type[i],listener,opt_capt,opt_handler)}return null}listener=goog.events.wrapListener(listener);if(goog.events.Listenable.isImplementedBy(src)){return src.listen(type,listener,opt_capt,opt_handler)}else{return goog.events.listen_(src,type,listener,!1,opt_capt,opt_handler)}};goog.events.listen_=function(src,type,listener,callOnce,opt_capt,opt_handler){if(!type){throw Error("Invalid event type")}var capture=!!opt_capt;if(capture&&!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT){if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.OFF_AND_FAIL){goog.asserts.fail("Can not register capture listener in IE8-.");return null}else if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.OFF_AND_SILENT){return null}}var listenerMap=goog.events.getListenerMap_(src);if(!listenerMap){src[goog.events.LISTENER_MAP_PROP_]=listenerMap=new goog.events.ListenerMap(src)}var listenerObj=listenerMap.add(type,listener,callOnce,opt_capt,opt_handler);if(listenerObj.proxy){return listenerObj}var proxy=goog.events.getProxy();listenerObj.proxy=proxy;proxy.src=src;proxy.listener=listenerObj;if(src.addEventListener){src.addEventListener(type.toString(),proxy,capture)}else if(src.attachEvent){src.attachEvent(goog.events.getOnString_(type.toString()),proxy)}else{throw Error("addEventListener and attachEvent are unavailable.")}goog.events.listenerCountEstimate_++;return listenerObj};goog.events.getProxy=function(){var proxyCallbackFunction=goog.events.handleBrowserEvent_,f=goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT?function(eventObject){return proxyCallbackFunction.call(f.src,f.listener,eventObject)}:function(eventObject){var v=proxyCallbackFunction.call(f.src,f.listener,eventObject);if(!v)return v};return f};goog.events.listenOnce=function(src,type,listener,opt_capt,opt_handler){if(goog.isArray(type)){for(var i=0;i<type.length;i++){goog.events.listenOnce(src,type[i],listener,opt_capt,opt_handler)}return null}listener=goog.events.wrapListener(listener);if(goog.events.Listenable.isImplementedBy(src)){return src.listenOnce(type,listener,opt_capt,opt_handler)}else{return goog.events.listen_(src,type,listener,!0,opt_capt,opt_handler)}};goog.events.listenWithWrapper=function(src,wrapper,listener,opt_capt,opt_handler){wrapper.listen(src,listener,opt_capt,opt_handler)};goog.events.unlisten=function(src,type,listener,opt_capt,opt_handler){if(goog.isArray(type)){for(var i=0;i<type.length;i++){goog.events.unlisten(src,type[i],listener,opt_capt,opt_handler)}return null}listener=goog.events.wrapListener(listener);if(goog.events.Listenable.isImplementedBy(src)){return src.unlisten(type,listener,opt_capt,opt_handler)}if(!src){return!1}var capture=!!opt_capt,listenerMap=goog.events.getListenerMap_(src);if(listenerMap){var listenerObj=listenerMap.getListener(type,listener,capture,opt_handler);if(listenerObj){return goog.events.unlistenByKey(listenerObj)}}return!1};goog.events.unlistenByKey=function(key){if(goog.isNumber(key)){return!1}var listener=key;if(!listener||listener.removed){return!1}var src=listener.src;if(goog.events.Listenable.isImplementedBy(src)){return src.unlistenByKey(listener)}var type=listener.type,proxy=listener.proxy;if(src.removeEventListener){src.removeEventListener(type,proxy,listener.capture)}else if(src.detachEvent){src.detachEvent(goog.events.getOnString_(type),proxy)}goog.events.listenerCountEstimate_--;var listenerMap=goog.events.getListenerMap_(src);if(listenerMap){listenerMap.removeByKey(listener);if(0==listenerMap.getTypeCount()){listenerMap.src=null;src[goog.events.LISTENER_MAP_PROP_]=null}}else{listener.markAsRemoved()}return!0};goog.events.unlistenWithWrapper=function(src,wrapper,listener,opt_capt,opt_handler){wrapper.unlisten(src,listener,opt_capt,opt_handler)};goog.events.removeAll=function(obj,opt_type){if(!obj){return 0}if(goog.events.Listenable.isImplementedBy(obj)){return obj.removeAllListeners(opt_type)}var listenerMap=goog.events.getListenerMap_(obj);if(!listenerMap){return 0}var count=0,typeStr=opt_type&&opt_type.toString();for(var type in listenerMap.listeners){if(!typeStr||type==typeStr){for(var listeners=listenerMap.listeners[type].concat(),i=0;i<listeners.length;++i){if(goog.events.unlistenByKey(listeners[i])){++count}}}}return count};goog.events.getListeners=function(obj,type,capture){if(goog.events.Listenable.isImplementedBy(obj)){return obj.getListeners(type,capture)}else{if(!obj){return[]}var listenerMap=goog.events.getListenerMap_(obj);return listenerMap?listenerMap.getListeners(type,capture):[]}};goog.events.getListener=function(src,type,listener,opt_capt,opt_handler){type=type;listener=goog.events.wrapListener(listener);var capture=!!opt_capt;if(goog.events.Listenable.isImplementedBy(src)){return src.getListener(type,listener,capture,opt_handler)}if(!src){return null}var listenerMap=goog.events.getListenerMap_(src);if(listenerMap){return listenerMap.getListener(type,listener,capture,opt_handler)}return null};goog.events.hasListener=function(obj,opt_type,opt_capture){if(goog.events.Listenable.isImplementedBy(obj)){return obj.hasListener(opt_type,opt_capture)}var listenerMap=goog.events.getListenerMap_(obj);return!!listenerMap&&listenerMap.hasListener(opt_type,opt_capture)};goog.events.expose=function(e){var str=[];for(var key in e){if(e[key]&&e[key].id){str.push(key+" = "+e[key]+" ("+e[key].id+")")}else{str.push(key+" = "+e[key])}}return str.join("\n")};goog.events.getOnString_=function(type){if(type in goog.events.onStringMap_){return goog.events.onStringMap_[type]}return goog.events.onStringMap_[type]=goog.events.onString_+type};goog.events.fireListeners=function(obj,type,capture,eventObject){if(goog.events.Listenable.isImplementedBy(obj)){return obj.fireListeners(type,capture,eventObject)}return goog.events.fireListeners_(obj,type,capture,eventObject)};goog.events.fireListeners_=function(obj,type,capture,eventObject){var retval=!0,listenerMap=goog.events.getListenerMap_(obj);if(listenerMap){var listenerArray=listenerMap.listeners[type.toString()];if(listenerArray){listenerArray=listenerArray.concat();for(var i=0,listener;i<listenerArray.length;i++){listener=listenerArray[i];if(listener&&listener.capture==capture&&!listener.removed){var result=goog.events.fireListener(listener,eventObject);retval=retval&&!1!==result}}}}return retval};goog.events.fireListener=function(listener,eventObject){var listenerFn=listener.listener,listenerHandler=listener.handler||listener.src;if(listener.callOnce){goog.events.unlistenByKey(listener)}return listenerFn.call(listenerHandler,eventObject)};goog.events.getTotalListenerCount=function(){return goog.events.listenerCountEstimate_};goog.events.dispatchEvent=function(src,e){goog.asserts.assert(goog.events.Listenable.isImplementedBy(src),"Can not use goog.events.dispatchEvent with "+"non-goog.events.Listenable instance.");return src.dispatchEvent(e)};goog.events.protectBrowserEventEntryPoint=function(errorHandler){goog.events.handleBrowserEvent_=errorHandler.protectEntryPoint(goog.events.handleBrowserEvent_)};goog.events.handleBrowserEvent_=function(listener,opt_evt){if(listener.removed){return!0}if(!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT){var ieEvent=opt_evt||goog.getObjectByName("window.event"),evt=new goog.events.BrowserEvent(ieEvent,this),retval=!0;if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.ON){if(!goog.events.isMarkedIeEvent_(ieEvent)){goog.events.markIeEvent_(ieEvent);for(var ancestors=[],parent=evt.currentTarget;parent;parent=parent.parentNode){ancestors.push(parent)}for(var type=listener.type,i=ancestors.length-1;!evt.propagationStopped_&&0<=i;i--){evt.currentTarget=ancestors[i];var result=goog.events.fireListeners_(ancestors[i],type,!0,evt);retval=retval&&result}for(var i=0;!evt.propagationStopped_&&i<ancestors.length;i++){evt.currentTarget=ancestors[i];var result=goog.events.fireListeners_(ancestors[i],type,!1,evt);retval=retval&&result}}}else{retval=goog.events.fireListener(listener,evt)}return retval}return goog.events.fireListener(listener,new goog.events.BrowserEvent(opt_evt,this))};goog.events.markIeEvent_=function(e){var useReturnValue=!1;if(0==e.keyCode){try{e.keyCode=-1;return}catch(ex){useReturnValue=!0}}if(useReturnValue||e.returnValue==void 0){e.returnValue=!0}};goog.events.isMarkedIeEvent_=function(e){return 0>e.keyCode||e.returnValue!=void 0};goog.events.uniqueIdCounter_=0;goog.events.getUniqueId=function(identifier){return identifier+"_"+goog.events.uniqueIdCounter_++};goog.events.getListenerMap_=function(src){var listenerMap=src[goog.events.LISTENER_MAP_PROP_];return listenerMap instanceof goog.events.ListenerMap?listenerMap:null};goog.events.LISTENER_WRAPPER_PROP_="__closure_events_fn_"+(1e9*Math.random()>>>0);goog.events.wrapListener=function(listener){goog.asserts.assert(listener,"Listener can not be null.");if(goog.isFunction(listener)){return listener}goog.asserts.assert(listener.handleEvent,"An object listener must have handleEvent method.");if(!listener[goog.events.LISTENER_WRAPPER_PROP_]){listener[goog.events.LISTENER_WRAPPER_PROP_]=function(e){return listener.handleEvent(e)}}return listener[goog.events.LISTENER_WRAPPER_PROP_]};goog.debug.entryPointRegistry.register(function(transformer){goog.events.handleBrowserEvent_=transformer(goog.events.handleBrowserEvent_)});