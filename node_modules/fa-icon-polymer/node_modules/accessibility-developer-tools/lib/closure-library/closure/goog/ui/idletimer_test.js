goog.provide("goog.ui.IdleTimerTest");goog.setTestOnly("goog.ui.IdleTimerTest");goog.require("goog.events");goog.require("goog.testing.MockClock");goog.require("goog.testing.jsunit");goog.require("goog.ui.IdleTimer");goog.require("goog.ui.MockActivityMonitor");var clock;function setUp(){clock=new goog.testing.MockClock(!0);goog.now=goog.bind(clock.getCurrentTime,clock)}function tearDown(){clock.dispose()}function testBecomeIdle(){var idleThreshold=1e3,mockActivityMonitor=new goog.ui.MockActivityMonitor,idleTimer=new goog.ui.IdleTimer(idleThreshold,mockActivityMonitor);mockActivityMonitor.simulateEvent();assertFalse("Precondition: user should be active",idleTimer.isIdle());var onBecomeIdleCount=0,onBecomeIdle=function(){onBecomeIdleCount+=1};goog.events.listen(idleTimer,goog.ui.IdleTimer.Event.BECOME_IDLE,onBecomeIdle);clock.tick(idleThreshold);mockActivityMonitor.simulateEvent();clock.tick(idleThreshold);assert("The BECOME_IDLE event fired too early",0==onBecomeIdleCount);assertFalse("The user should still be active",idleTimer.isIdle());clock.tick(1);assert("The BECOME_IDLE event fired too late",1==onBecomeIdleCount);assert("The user should be idle",idleTimer.isIdle());idleTimer.dispose()}function testBecomeActive(){var idleThreshold=1e3,mockActivityMonitor=new goog.ui.MockActivityMonitor,idleTimer=new goog.ui.IdleTimer(idleThreshold,mockActivityMonitor);clock.tick(idleThreshold+1);assert("Precondition: user should be idle",idleTimer.isIdle());var onBecomeActiveCount=0,onBecomeActive=function(){onBecomeActiveCount+=1};goog.events.listen(idleTimer,goog.ui.IdleTimer.Event.BECOME_ACTIVE,onBecomeActive);clock.tick(idleThreshold);assert("The BECOME_ACTIVE event fired too early",0==onBecomeActiveCount);assert("The user should still be idle",idleTimer.isIdle());mockActivityMonitor.simulateEvent();assert("The BECOME_ACTIVE event fired too late",1==onBecomeActiveCount);assertFalse("The user should be active",idleTimer.isIdle());idleTimer.dispose()}