goog.provide("goog.fx.DragScrollSupportTest");goog.setTestOnly("goog.fx.DragScrollSupportTest");goog.require("goog.fx.DragScrollSupport");goog.require("goog.math.Coordinate");goog.require("goog.math.Rect");goog.require("goog.testing.MockClock");goog.require("goog.testing.events");goog.require("goog.testing.jsunit");var vContainerDiv,vContentDiv,hContainerDiv,hContentDiv,clock;function setUpPage(){vContainerDiv=document.getElementById("vContainerDiv");vContentDiv=document.getElementById("vContentDiv");hContainerDiv=document.getElementById("hContainerDiv");hContentDiv=document.getElementById("hContentDiv")}function setUp(){clock=new goog.testing.MockClock(!0)}function tearDown(){clock.dispose()}function testDragZeroMarginDivVContainer(){var dsc=new goog.fx.DragScrollSupport(vContainerDiv),scrollTop=50;vContainerDiv.scrollTop=scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(50,20+50));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Mousing inside the vContainer should not trigger scrolling.",scrollTop,vContainerDiv.scrollTop);assertEquals("Scroll timer should not tick yet",0,clock.getTimeoutsMade());scrollTop=vContainerDiv.scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(50,10));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing above the vContainer should trigger scrolling up.",scrollTop>vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing above the vContainer should trigger scrolling up.",scrollTop>vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(50,20+110));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing below the vContainer should trigger scrolling down.",scrollTop<vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing below the vContainer should trigger scrolling down.",scrollTop<vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(50,20+50));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Mousing inside the vContainer should stop scrolling.",scrollTop,vContainerDiv.scrollTop);clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);dsc.dispose()}function testDragZeroMarginDivHContainer(){var dsc=new goog.fx.DragScrollSupport(hContainerDiv),scrollLeft=50;hContainerDiv.scrollLeft=scrollLeft;goog.testing.events.fireMouseMoveEvent(hContainerDiv,new goog.math.Coordinate(200+50,20+50));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Mousing inside the hContainer should not trigger scrolling.",scrollLeft,hContainerDiv.scrollLeft);assertEquals("Scroll timer should not tick yet",0,clock.getTimeoutsMade());scrollLeft=hContainerDiv.scrollLeft;goog.testing.events.fireMouseMoveEvent(hContainerDiv,new goog.math.Coordinate(200-10,20+50));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing left of the hContainer should trigger scrolling left.",scrollLeft>hContainerDiv.scrollLeft);scrollLeft=hContainerDiv.scrollLeft;clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing left of the hContainer should trigger scrolling left.",scrollLeft>hContainerDiv.scrollLeft);scrollLeft=hContainerDiv.scrollLeft;goog.testing.events.fireMouseMoveEvent(hContainerDiv,new goog.math.Coordinate(200+110,20+50));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing right of the hContainer should trigger scrolling right.",scrollLeft<hContainerDiv.scrollLeft);scrollLeft=hContainerDiv.scrollLeft;clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing right of the hContainer should trigger scrolling right.",scrollLeft<hContainerDiv.scrollLeft);scrollLeft=hContainerDiv.scrollLeft;goog.testing.events.fireMouseMoveEvent(hContainerDiv,new goog.math.Coordinate(200+50,20+50));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Mousing inside the hContainer should stop scrolling.",scrollLeft,hContainerDiv.scrollLeft);clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);dsc.dispose()}function testDragMarginDivVContainer(){var dsc=new goog.fx.DragScrollSupport(vContainerDiv,20),scrollTop=50;vContainerDiv.scrollTop=scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(50,20+50));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Mousing inside the vContainer should not trigger scrolling.",scrollTop,vContainerDiv.scrollTop);assertEquals("Scroll timer should not tick yet",0,clock.getTimeoutsMade());scrollTop=vContainerDiv.scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(50,30));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing above the margin should trigger scrolling up.",scrollTop>vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing above the margin should trigger scrolling up.",scrollTop>vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(50,20+90));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing below the margin should trigger scrolling down.",scrollTop<vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing above the margin should trigger scrolling down.",scrollTop<vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(50,20+50));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Mousing inside the margin should stop scrolling.",scrollTop,vContainerDiv.scrollTop);clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Scroll timer should have ticked 4 times",4,clock.getCallbacksTriggered());dsc.dispose()}function testDragMarginScrollConstrainedDivVContainer(){var dsc=new goog.fx.DragScrollSupport(vContainerDiv,20);dsc.setConstrainScroll(!0);var scrollTop=50;vContainerDiv.scrollTop=scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(50,20+50));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Mousing inside the vContainer should not trigger scrolling.",scrollTop,vContainerDiv.scrollTop);assertEquals("Scroll timer should not tick yet",0,clock.getTimeoutsMade());scrollTop=vContainerDiv.scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(50,30));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing above the margin should trigger scrolling up.",scrollTop>vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing above the margin should trigger scrolling up.",scrollTop>vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(50,20+90));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing below the margin should trigger scrolling down.",scrollTop<vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing above the margin should trigger scrolling down.",scrollTop<vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(50,20+50));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Mousing inside the margin should stop scrolling.",scrollTop,vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(50,10));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Mousing above the vContainer should not trigger scrolling up.",scrollTop,vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Mousing above the vContainer should not trigger scrolling up.",scrollTop,vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(50,20+110));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Mousing below the vContainer should not trigger scrolling down.",scrollTop,vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Mousing below the vContainer should not trigger scrolling down.",scrollTop,vContainerDiv.scrollTop);clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);scrollTop=vContainerDiv.scrollTop;goog.testing.events.fireMouseMoveEvent(vContainerDiv,new goog.math.Coordinate(150,20+90));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Mousing to the right of the vContainer should not trigger "+"scrolling up.",scrollTop,vContainerDiv.scrollTop);scrollTop=vContainerDiv.scrollTop;clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Mousing to the right of the vContainer should not trigger "+"scrolling up.",scrollTop,vContainerDiv.scrollTop);clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Scroll timer should have ticked 4 times",4,clock.getCallbacksTriggered());dsc.dispose()}function testSetHorizontalScrolling(){var dsc=new goog.fx.DragScrollSupport(hContainerDiv);dsc.setHorizontalScrolling(!1);var scrollLeft=50;hContainerDiv.scrollLeft=scrollLeft;goog.testing.events.fireMouseMoveEvent(hContainerDiv,new goog.math.Coordinate(200-10,20+50));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Horizontal scrolling should be turned off",0,clock.getTimeoutsMade());goog.testing.events.fireMouseMoveEvent(hContainerDiv,new goog.math.Coordinate(200+110,20+50));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertEquals("Horizontal scrolling should be turned off",0,clock.getTimeoutsMade());dsc.setHorizontalScrolling(!0);scrollLeft=hContainerDiv.scrollLeft;goog.testing.events.fireMouseMoveEvent(hContainerDiv,new goog.math.Coordinate(200-10,20+50));clock.tick(goog.fx.DragScrollSupport.TIMER_STEP_+1);assertTrue("Mousing left of the hContainer should trigger scrolling left.",scrollLeft>hContainerDiv.scrollLeft);dsc.dispose()}function testConstrainBoundsWithMargin(){var rect=goog.fx.DragScrollSupport.prototype.constrainBounds_.call({margin_:25},new goog.math.Rect(0,0,100,100));assertEquals(25,rect.left);assertEquals(25,rect.top);assertEquals(25,rect.left);assertEquals(50,rect.width);assertEquals(50,rect.height)}