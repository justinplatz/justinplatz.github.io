goog.setTestOnly("goog.testing.PropertyReplacer");goog.provide("goog.testing.PropertyReplacer");goog.require("goog.testing.ObjectPropertyString");goog.require("goog.userAgent");goog.testing.PropertyReplacer=function(){this.original_=[]};goog.testing.PropertyReplacer.NO_SUCH_KEY_={};goog.testing.PropertyReplacer.hasKey_=function(obj,key){if(!(key in obj)){return!1}if(Object.prototype.hasOwnProperty.call(obj,key)){return!0}if(obj.constructor==Object&&(!goog.userAgent.OPERA||"[object Object]"==Object.prototype.toString.call(obj))){return!1}try{var dummy=obj.constructor.prototype[key]}catch(e){return!0}return!(key in obj.constructor.prototype)};goog.testing.PropertyReplacer.deleteKey_=function(obj,key){try{delete obj[key];if(!goog.testing.PropertyReplacer.hasKey_(obj,key)){return}}catch(e){}obj[key]=void 0;if("undefined"==obj[key]){obj[key]=""}if(obj[key]){throw Error("Cannot delete non configurable property \""+key+"\" in "+obj)}};goog.testing.PropertyReplacer.restoreOriginal_=function(original){if(original.value==goog.testing.PropertyReplacer.NO_SUCH_KEY_){goog.testing.PropertyReplacer.deleteKey_(original.object,original.key)}else{original.object[original.key]=original.value}};goog.testing.PropertyReplacer.prototype.set=function(obj,key,value){var origValue=goog.testing.PropertyReplacer.hasKey_(obj,key)?obj[key]:goog.testing.PropertyReplacer.NO_SUCH_KEY_;this.original_.push({object:obj,key:key,value:origValue});obj[key]=value;if(obj[key]!=value&&value+"px"!=obj[key]){throw Error("Cannot overwrite read-only property \""+key+"\" in "+obj)}};goog.testing.PropertyReplacer.prototype.replace=function(obj,key,value){if(!(key in obj)){throw Error("Cannot replace missing property \""+key+"\" in "+obj)}if(goog.typeOf(obj[key])!=goog.typeOf(value)){throw Error("Cannot replace property \""+key+"\" in "+obj+" with a value of different type")}this.set(obj,key,value)};goog.testing.PropertyReplacer.prototype.setPath=function(path,value){for(var parts=path.split("."),obj=goog.global,i=0,part;i<parts.length-1;i++){part=parts[i];if("prototype"==part&&!obj[part]){throw Error("Cannot set the prototype of "+parts.slice(0,i).join("."))}if(!goog.isObject(obj[part])&&!goog.isFunction(obj[part])){this.set(obj,part,{})}obj=obj[part]}this.set(obj,parts[parts.length-1],value)};goog.testing.PropertyReplacer.prototype.remove=function(obj,key){if(goog.testing.PropertyReplacer.hasKey_(obj,key)){this.original_.push({object:obj,key:key,value:obj[key]});goog.testing.PropertyReplacer.deleteKey_(obj,key)}};goog.testing.PropertyReplacer.prototype.restore=function(obj,key){for(var i=this.original_.length-1,original;0<=i;i--){original=this.original_[i];if(original.object===obj&&original.key==key){goog.testing.PropertyReplacer.restoreOriginal_(original);this.original_.splice(i,1);return}}throw Error("Cannot restore unmodified property \""+key+"\" of "+obj)};goog.testing.PropertyReplacer.prototype.reset=function(){for(var i=this.original_.length-1;0<=i;i--){goog.testing.PropertyReplacer.restoreOriginal_(this.original_[i]);delete this.original_[i]}this.original_.length=0};