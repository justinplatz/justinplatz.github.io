goog.provide("goog.ui.HsvaPalette");goog.require("goog.array");goog.require("goog.color.alpha");goog.require("goog.dom.TagName");goog.require("goog.events");goog.require("goog.events.EventType");goog.require("goog.style");goog.require("goog.ui.Component");goog.require("goog.ui.HsvPalette");goog.ui.HsvaPalette=function(opt_domHelper,opt_color,opt_alpha,opt_class){goog.ui.HsvaPalette.base(this,"constructor",opt_domHelper,opt_color,opt_class);this.alpha_=goog.isDef(opt_alpha)?opt_alpha:1;this.className=opt_class||goog.getCssName("goog-hsva-palette")};goog.inherits(goog.ui.HsvaPalette,goog.ui.HsvPalette);goog.ui.HsvaPalette.prototype.aImageEl_;goog.ui.HsvaPalette.prototype.aHandleEl_;goog.ui.HsvaPalette.prototype.swatchBackdropEl_;goog.ui.HsvaPalette.prototype.getAlpha=function(){return this.alpha_};goog.ui.HsvaPalette.prototype.setAlpha=function(alpha){this.setColorAlphaHelper_(this.color,alpha)};goog.ui.HsvaPalette.prototype.setColor=function(color){this.setColorAlphaHelper_(color,1)};goog.ui.HsvaPalette.prototype.getColorRgbaHex=function(){var alphaHex=Math.floor(255*this.alpha_).toString(16);return this.color+(1==alphaHex.length?"0"+alphaHex:alphaHex)};goog.ui.HsvaPalette.prototype.setColorRgbaHex=function(color){var parsed=goog.ui.HsvaPalette.parseColorRgbaHex_(color);this.setColorAlphaHelper_(parsed[0],parsed[1])};goog.ui.HsvaPalette.prototype.setColorAlphaHelper_=function(color,alpha){var colorChange=this.color!=color,alphaChange=this.alpha_!=alpha;this.alpha_=alpha;this.color=color;if(colorChange){this.setColorInternal(color)}if(colorChange||alphaChange){this.updateUi();this.dispatchEvent(goog.ui.Component.EventType.ACTION)}};goog.ui.HsvaPalette.prototype.createDom=function(){goog.ui.HsvaPalette.base(this,"createDom");var dom=this.getDomHelper();this.aImageEl_=dom.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"a-image"));this.aHandleEl_=dom.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"a-handle"));this.swatchBackdropEl_=dom.createDom(goog.dom.TagName.DIV,goog.getCssName(this.className,"swatch-backdrop"));var element=this.getElement();dom.appendChild(element,this.aImageEl_);dom.appendChild(element,this.aHandleEl_);dom.appendChild(element,this.swatchBackdropEl_)};goog.ui.HsvaPalette.prototype.disposeInternal=function(){goog.ui.HsvaPalette.base(this,"disposeInternal");delete this.aImageEl_;delete this.aHandleEl_;delete this.swatchBackdropEl_};goog.ui.HsvaPalette.prototype.updateUi=function(){goog.ui.HsvaPalette.base(this,"updateUi");if(this.isInDocument()){var a=255*this.alpha_,top=this.aImageEl_.offsetTop-Math.floor(this.aHandleEl_.offsetHeight/2)+this.aImageEl_.offsetHeight*((255-a)/255);this.aHandleEl_.style.top=top+"px";this.aImageEl_.style.backgroundColor=this.color;goog.style.setOpacity(this.swatchElement,a/255)}};goog.ui.HsvaPalette.prototype.updateInput=function(){if(!goog.array.equals([this.color,this.alpha_],goog.ui.HsvaPalette.parseUserInput_(this.inputElement.value))){this.inputElement.value=this.getColorRgbaHex()}};goog.ui.HsvaPalette.prototype.handleMouseDown=function(e){goog.ui.HsvaPalette.base(this,"handleMouseDown",e);if(e.target==this.aImageEl_||e.target==this.aHandleEl_){var b=goog.style.getBounds(this.valueBackgroundImageElement);this.handleMouseMoveA_(b,e);this.mouseMoveListener=goog.events.listen(this.getDomHelper().getDocument(),goog.events.EventType.MOUSEMOVE,goog.bind(this.handleMouseMoveA_,this,b));this.mouseUpListener=goog.events.listen(this.getDomHelper().getDocument(),goog.events.EventType.MOUSEUP,this.handleMouseUp,!1,this)}};goog.ui.HsvaPalette.prototype.handleMouseMoveA_=function(b,e){e.preventDefault();var vportPos=this.getDomHelper().getDocumentScroll(),newA=(b.top+b.height-Math.min(Math.max(vportPos.y+e.clientY,b.top),b.top+b.height))/b.height;this.setAlpha(newA)};goog.ui.HsvaPalette.prototype.handleInput=function(e){var parsed=goog.ui.HsvaPalette.parseUserInput_(this.inputElement.value);if(parsed){this.setColorAlphaHelper_(parsed[0],parsed[1])}};goog.ui.HsvaPalette.parseUserInput_=function(value){if(/^#?[0-9a-f]{8}$/i.test(value)){return goog.ui.HsvaPalette.parseColorRgbaHex_(value)}else if(/^#?[0-9a-f]{6}$/i.test(value)){return[value,1]}return null};goog.ui.HsvaPalette.parseColorRgbaHex_=function(color){var hex=goog.color.alpha.parse(color).hex;return[goog.color.alpha.extractHexColor(hex),parseInt(goog.color.alpha.extractAlpha(hex),16)/255]};