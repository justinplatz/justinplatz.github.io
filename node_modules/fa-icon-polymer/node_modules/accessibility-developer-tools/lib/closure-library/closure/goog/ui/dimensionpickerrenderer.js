goog.provide("goog.ui.DimensionPickerRenderer");goog.require("goog.a11y.aria.Announcer");goog.require("goog.a11y.aria.LivePriority");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.i18n.bidi");goog.require("goog.style");goog.require("goog.ui.ControlRenderer");goog.require("goog.userAgent");goog.ui.DimensionPickerRenderer=function(){goog.ui.ControlRenderer.call(this);this.announcer_=new goog.a11y.aria.Announcer};goog.inherits(goog.ui.DimensionPickerRenderer,goog.ui.ControlRenderer);goog.addSingletonGetter(goog.ui.DimensionPickerRenderer);goog.ui.DimensionPickerRenderer.CSS_CLASS=goog.getCssName("goog-dimension-picker");goog.ui.DimensionPickerRenderer.prototype.getUnderlyingDiv_=function(element){return element.firstChild.childNodes[1]};goog.ui.DimensionPickerRenderer.prototype.getHighlightDiv_=function(element){return element.firstChild.lastChild};goog.ui.DimensionPickerRenderer.prototype.getStatusDiv_=function(element){return element.lastChild};goog.ui.DimensionPickerRenderer.prototype.getMouseCatcher_=function(element){return element.firstChild.firstChild};goog.ui.DimensionPickerRenderer.prototype.canDecorate=function(element){return element.tagName==goog.dom.TagName.DIV&&!element.firstChild};goog.ui.DimensionPickerRenderer.prototype.decorate=function(control,element){var palette=control;goog.ui.DimensionPickerRenderer.superClass_.decorate.call(this,palette,element);this.addElementContents_(palette,element);this.updateSize(palette,element);return element};goog.ui.DimensionPickerRenderer.prototype.updateSize=function(palette,element){var size=palette.getSize();element.style.width=size.width+"em";var underlyingDiv=this.getUnderlyingDiv_(element);underlyingDiv.style.width=size.width+"em";underlyingDiv.style.height=size.height+"em";if(palette.isRightToLeft()){this.adjustParentDirection_(palette,element)}};goog.ui.DimensionPickerRenderer.prototype.addElementContents_=function(palette,element){var mouseCatcherDiv=palette.getDomHelper().createDom(goog.dom.TagName.DIV,goog.getCssName(this.getCssClass(),"mousecatcher")),unhighlightedDiv=palette.getDomHelper().createDom(goog.dom.TagName.DIV,{class:goog.getCssName(this.getCssClass(),"unhighlighted"),style:"width:100%;height:100%"}),highlightedDiv=palette.getDomHelper().createDom(goog.dom.TagName.DIV,goog.getCssName(this.getCssClass(),"highlighted"));element.appendChild(palette.getDomHelper().createDom(goog.dom.TagName.DIV,{style:"width:100%;height:100%"},mouseCatcherDiv,unhighlightedDiv,highlightedDiv));element.appendChild(palette.getDomHelper().createDom(goog.dom.TagName.DIV,goog.getCssName(this.getCssClass(),"status")))};goog.ui.DimensionPickerRenderer.prototype.createDom=function(control){var palette=control,classNames=this.getClassNames(palette),element=palette.getDomHelper().createDom(goog.dom.TagName.DIV,{class:classNames?classNames.join(" "):"","aria-hidden":"true"});this.addElementContents_(palette,element);this.updateSize(palette,element);return element};goog.ui.DimensionPickerRenderer.prototype.initializeDom=function(control){var palette=control;goog.ui.DimensionPickerRenderer.superClass_.initializeDom.call(this,palette);var highlightedSize=palette.getValue();this.setHighlightedSize(palette,highlightedSize.width,highlightedSize.height);this.positionMouseCatcher(palette)};goog.ui.DimensionPickerRenderer.prototype.getMouseMoveElement=function(palette){return palette.getElement().firstChild};goog.ui.DimensionPickerRenderer.prototype.getGridOffsetX=function(palette,x){return Math.min(palette.maxColumns,Math.ceil(x/18))};goog.ui.DimensionPickerRenderer.prototype.getGridOffsetY=function(palette,y){return Math.min(palette.maxRows,Math.ceil(y/18))};goog.ui.DimensionPickerRenderer.prototype.setHighlightedSize=function(palette,columns,rows){var element=palette.getElement();if(!element){return}var style=this.getHighlightDiv_(element).style;style.width=columns+"em";style.height=rows+"em";if(palette.isRightToLeft()){style.right="0"}var MSG_DIMENSION_PICKER_HIGHLIGHTED_DIMENSIONS=goog.getMsg("{$numCols} by {$numRows}",{numCols:columns,numRows:rows});this.announcer_.say(MSG_DIMENSION_PICKER_HIGHLIGHTED_DIMENSIONS,goog.a11y.aria.LivePriority.ASSERTIVE);goog.dom.setTextContent(this.getStatusDiv_(element),goog.i18n.bidi.enforceLtrInText(columns+" x "+rows))};goog.ui.DimensionPickerRenderer.prototype.positionMouseCatcher=function(palette){var _Mathfloor=Math.floor,_Mathmin=Math.min,mouseCatcher=this.getMouseCatcher_(palette.getElement()),doc=goog.dom.getOwnerDocument(mouseCatcher),body=doc.body,position=goog.style.getRelativePosition(mouseCatcher,body);mouseCatcher.style.display="none";var xAvailableEm=palette.isRightToLeft()&&0<position.x?_Mathfloor(position.x/18):_Mathfloor((body.scrollWidth-position.x)/18),height;if(goog.userAgent.IE){height=goog.style.getClientViewportElement(body).scrollHeight-20}else{var win=goog.dom.getWindow(doc);height=Math.max(win.innerHeight,body.scrollHeight)-20}var yAvailableEm=_Mathfloor((height-position.y)/18);mouseCatcher.style.width=_Mathmin(palette.maxColumns,xAvailableEm)+"em";mouseCatcher.style.height=_Mathmin(palette.maxRows,yAvailableEm)+"em";mouseCatcher.style.display="";if(palette.isRightToLeft()){mouseCatcher.style.right="0"}};goog.ui.DimensionPickerRenderer.prototype.getCssClass=function(){return goog.ui.DimensionPickerRenderer.CSS_CLASS};goog.ui.DimensionPickerRenderer.prototype.adjustParentDirection_=function(palette,element){var parent=palette.getParent();if(parent){var parentElement=parent.getElement(),right=goog.style.getStyle(parentElement,"right");if(""==right){var parentPos=goog.style.getPosition(parentElement),parentSize=goog.style.getSize(parentElement);if(0!=parentSize.width&&0!=parentPos.x){var visibleRect=goog.style.getBounds(goog.style.getClientViewportElement()),visibleWidth=visibleRect.width;right=visibleWidth-parentPos.x-parentSize.width;goog.style.setStyle(parentElement,"right",right+"px")}}var left=goog.style.getStyle(parentElement,"left");if(""!=left){goog.style.setStyle(parentElement,"left","")}}else{goog.style.setStyle(element,"right","0px")}};