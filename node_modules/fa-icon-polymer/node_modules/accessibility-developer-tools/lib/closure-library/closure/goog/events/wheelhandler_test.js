goog.provide("goog.events.WheelHandlerTest");goog.setTestOnly("goog.events.WheelHandlerTest");goog.require("goog.dom");goog.require("goog.events");goog.require("goog.events.BrowserEvent");goog.require("goog.events.WheelEvent");goog.require("goog.events.WheelHandler");goog.require("goog.string");goog.require("goog.testing.PropertyReplacer");goog.require("goog.testing.events");goog.require("goog.testing.jsunit");goog.require("goog.userAgent");goog.require("goog.userAgent.product");var log,stubs=new goog.testing.PropertyReplacer,PREFERRED_TYPE="wheel",LEGACY_TYPE="mousewheel",GECKO_TYPE="DOMMouseScroll",HORIZONTAL="h",VERTICAL="v",DeltaMode=goog.events.WheelEvent.DeltaMode,mouseWheelEvent,mouseWheelEventRtl,mouseWheelHandler,mouseWheelHandlerRtl;function setUpPage(){log=goog.dom.getElement("log")}function setUp(){stubs.remove(goog,"userAgent");goog.userAgent={product:{CHROME:!1,version:0,isVersion:function(version){return 0<=goog.string.compareVersions(this.version,version)}},GECKO:!1,IE:!1,version:0,isVersionOrHigher:function(version){return 0<=goog.string.compareVersions(this.version,version)}}}function tearDown(){stubs.reset();goog.dispose(mouseWheelHandler);goog.dispose(mouseWheelHandlerRtl);mouseWheelHandlerRtl=null;mouseWheelHandler=null;mouseWheelEvent=null;mouseWheelEventRtl=null}function tearDownPage(){mouseWheelHandler=new goog.events.WheelHandler(document.body);goog.events.listen(mouseWheelHandler,goog.events.WheelEvent.EventType.WHEEL,function(e){log.innerHTML+=goog.string.subs("<br />(deltaX, deltaY): (%s, %s)",e.deltaX,e.deltaY)})}function testGetDomEventType(){assertEquals(LEGACY_TYPE,goog.events.WheelHandler.getDomEventType());goog.userAgent.GECKO=!0;goog.userAgent.version=16;assertEquals(GECKO_TYPE,goog.events.WheelHandler.getDomEventType());goog.userAgent.version=17;assertEquals(PREFERRED_TYPE,goog.events.WheelHandler.getDomEventType());goog.userAgent.GECKO=!1;goog.userAgent.IE=!0;goog.userAgent.version=8;assertEquals(LEGACY_TYPE,goog.events.WheelHandler.getDomEventType());goog.userAgent.version=9;assertEquals(PREFERRED_TYPE,goog.events.WheelHandler.getDomEventType());goog.userAgent.IE=!1;goog.userAgent.product.CHROME=!0;goog.userAgent.product.version=30;assertEquals(LEGACY_TYPE,goog.events.WheelHandler.getDomEventType());goog.userAgent.product.version=31;assertEquals(PREFERRED_TYPE,goog.events.WheelHandler.getDomEventType());goog.userAgent.product.CHROME=!1}function testPreferredStyleWheel(){goog.userAgent.IE=!0;goog.userAgent.version=9;createHandlerAndListen();handleEvent(createFakePreferredEvent(DeltaMode.PIXEL,10,20,30));assertWheelEvent(DeltaMode.PIXEL,10,20,30);assertPixelDeltas(1);handleEvent(createFakePreferredEvent(DeltaMode.LINE,10,20,30));assertWheelEvent(DeltaMode.LINE,10,20,30);assertPixelDeltas(15);handleEvent(createFakePreferredEvent(DeltaMode.PAGE,10,20,30));assertWheelEvent(DeltaMode.PAGE,10,20,30);assertPixelDeltas(15*30)}function testLegacyStyleWheel(){createHandlerAndListen();handleEvent(createFakeLegacyEvent(10));assertWheelEvent(DeltaMode.PIXEL,0,-10,0);assertPixelDeltas(1);handleEvent(createFakeLegacyEvent(10,20,30));assertWheelEvent(DeltaMode.PIXEL,-20,-30,0);assertPixelDeltas(1)}function testLegacyGeckoStyleWheel(){goog.userAgent.GECKO=!0;createHandlerAndListen();handleEvent(createFakeGeckoEvent(10));assertWheelEvent(DeltaMode.LINE,0,10,0);assertPixelDeltas(15);handleEvent(createFakeGeckoEvent(10,VERTICAL));assertWheelEvent(DeltaMode.LINE,0,10,0);assertPixelDeltas(15);handleEvent(createFakeGeckoEvent(10,HORIZONTAL));assertWheelEvent(DeltaMode.LINE,10,0,0);assertPixelDeltas(15)}function testLegacyIeStyleWheel(){goog.userAgent.IE=!0;createHandlerAndListen();handleEvent(createFakeLegacyEvent(120));assertWheelEvent(DeltaMode.PIXEL,0,-120,0);handleEvent(createFakeLegacyEvent(-120));assertWheelEvent(DeltaMode.PIXEL,0,120,0);handleEvent(createFakeLegacyEvent(1200));assertWheelEvent(DeltaMode.PIXEL,0,-1200,0)}function testNullBody(){goog.userAgent.IE=!0;var documentObjectWithNoBody={};goog.testing.events.mixinListenable(documentObjectWithNoBody);mouseWheelHandler=new goog.events.WheelHandler(documentObjectWithNoBody)}function createHandlerAndListen(){mouseWheelHandler=new goog.events.WheelHandler(goog.dom.getElement("foo"));goog.events.listen(mouseWheelHandler,goog.events.WheelEvent.EventType.WHEEL,function(e){mouseWheelEvent=e});mouseWheelHandlerRtl=new goog.events.WheelHandler(goog.dom.getElement("fooRtl"));goog.events.listen(mouseWheelHandlerRtl,goog.events.WheelEvent.EventType.WHEEL,function(e){mouseWheelEventRtl=e})}function handleEvent(event){mouseWheelHandler.handleEvent(event);mouseWheelHandlerRtl.handleEvent(event)}function assertWheelEvent(deltaMode,deltaX,deltaY,deltaZ){assertTrue("event should be non-null",!!mouseWheelEvent);assertTrue("event should have correct JS type",mouseWheelEvent instanceof goog.events.WheelEvent);assertEquals("event should have correct deltaMode property",deltaMode,mouseWheelEvent.deltaMode);assertEquals("event should have correct deltaX property",deltaX,mouseWheelEvent.deltaX);assertEquals("event should have correct deltaY property",deltaY,mouseWheelEvent.deltaY);assertEquals("event should have correct deltaZ property",deltaZ,mouseWheelEvent.deltaZ);assertTrue("event should be non-null",!!mouseWheelEventRtl);assertTrue("event should have correct JS type",mouseWheelEventRtl instanceof goog.events.WheelEvent);assertEquals("event should have correct deltaMode property",deltaMode,mouseWheelEventRtl.deltaMode);assertEquals("event should have correct deltaX property",-deltaX,mouseWheelEventRtl.deltaX);assertEquals("event should have correct deltaY property",deltaY,mouseWheelEventRtl.deltaY);assertEquals("event should have correct deltaZ property",deltaZ,mouseWheelEventRtl.deltaZ)}function assertPixelDeltas(scale){assertEquals(mouseWheelEvent.deltaX*scale,mouseWheelEvent.pixelDeltaX);assertEquals(mouseWheelEvent.deltaY*scale,mouseWheelEvent.pixelDeltaY);assertEquals(mouseWheelEvent.deltaZ*scale,mouseWheelEvent.pixelDeltaZ);assertEquals(mouseWheelEventRtl.deltaX*scale,mouseWheelEventRtl.pixelDeltaX);assertEquals(mouseWheelEventRtl.deltaY*scale,mouseWheelEventRtl.pixelDeltaY);assertEquals(mouseWheelEventRtl.deltaZ*scale,mouseWheelEventRtl.pixelDeltaZ)}function createFakePreferredEvent(opt_deltaMode,opt_deltaX,opt_deltaY,opt_deltaZ){var event={type:PREFERRED_TYPE,deltaMode:opt_deltaMode,deltaX:opt_deltaX,deltaY:opt_deltaY,deltaZ:opt_deltaZ};return new goog.events.BrowserEvent(event)}function createFakeLegacyEvent(opt_wheelDelta,opt_wheelDeltaX,opt_wheelDeltaY){var event={type:LEGACY_TYPE,wheelDelta:opt_wheelDelta,wheelDeltaX:opt_wheelDeltaX,wheelDeltaY:opt_wheelDeltaY};return new goog.events.BrowserEvent(event)}function createFakeGeckoEvent(opt_detail,opt_axis){var event={type:GECKO_TYPE,detail:opt_detail,axis:opt_axis,HORIZONTAL_AXIS:HORIZONTAL,VERTICAL_AXIS:VERTICAL};return new goog.events.BrowserEvent(event)}