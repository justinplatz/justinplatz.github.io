goog.provide("goog.editor.plugins.LoremIpsumTest");goog.setTestOnly("goog.editor.plugins.LoremIpsumTest");goog.require("goog.dom");goog.require("goog.editor.Command");goog.require("goog.editor.Field");goog.require("goog.editor.plugins.LoremIpsum");goog.require("goog.string.Unicode");goog.require("goog.testing.jsunit");goog.require("goog.userAgent");var FIELD,PLUGIN,HTML,UPPERCASE_CONTENTS="<P>THE OWLS ARE NOT WHAT THEY SEEM.</P>";function setUp(){HTML=goog.dom.getElement("root").innerHTML;FIELD=new goog.editor.Field("field");PLUGIN=new goog.editor.plugins.LoremIpsum("The owls are not what they seem.");FIELD.registerPlugin(PLUGIN)}function tearDown(){FIELD.dispose();goog.dom.getElement("root").innerHTML=HTML}function testQueryUsingLorem(){FIELD.makeEditable();assertTrue(FIELD.queryCommandValue(goog.editor.Command.USING_LOREM));FIELD.setHtml(!0,"fresh content",!1,!0);assertFalse(FIELD.queryCommandValue(goog.editor.Command.USING_LOREM))}function testUpdateLoremIpsum(){goog.dom.setTextContent(goog.dom.getElement("field"),"stuff");var loremPlugin=FIELD.getPluginByClassId("LoremIpsum");FIELD.makeEditable();var content="<div>foo</div>";FIELD.setHtml(!1,"",!1,!1);assertFalse("Field started with content, lorem must not be enabled.",FIELD.queryCommandValue(goog.editor.Command.USING_LOREM));FIELD.execCommand(goog.editor.Command.UPDATE_LOREM);assertTrue("Field was set to empty, update must turn on lorem ipsum",FIELD.queryCommandValue(goog.editor.Command.USING_LOREM));FIELD.unregisterPlugin(loremPlugin);FIELD.setHtml(!1,content,!1,!0);FIELD.setHtml(!1,"",!1,!1);FIELD.execCommand(goog.editor.Command.UPDATE_LOREM);assertFalse("Field with no lorem message must not use lorem ipsum",FIELD.queryCommandValue(goog.editor.Command.USING_LOREM));FIELD.registerPlugin(loremPlugin);FIELD.setHtml(!1,content,!1,!0);FIELD.setHtml(!1,"",!1,!1);goog.editor.Field.setActiveFieldId(FIELD.id);FIELD.execCommand(goog.editor.Command.UPDATE_LOREM);assertFalse("Active field must not use lorem ipsum",FIELD.queryCommandValue(goog.editor.Command.USING_LOREM));goog.editor.Field.setActiveFieldId(null);FIELD.setHtml(!1,content,!1,!0);FIELD.setHtml(!1,"",!1,!1);FIELD.setModalMode(!0);FIELD.execCommand(goog.editor.Command.UPDATE_LOREM);assertFalse("Must not turn on lorem ipsum while a dialog is open.",FIELD.queryCommandValue(goog.editor.Command.USING_LOREM));FIELD.setModalMode(!0);FIELD.dispose()}function testLoremIpsumAndGetCleanContents(){goog.dom.setTextContent(goog.dom.getElement("field"),"This is a field");FIELD.makeEditable();assertEquals("field reported wrong contents","This is a field",FIELD.getCleanContents());var contents=FIELD.getCleanContents();assertEquals("field reported wrong contents","This is a field",contents);FIELD.setHtml(!1,"&nbsp;",!0,!1);assertEquals("field contains unexpected contents",getNbsp(),FIELD.getElement().innerHTML);assertEquals("field reported wrong contents",getNbsp(),FIELD.getCleanContents());FIELD.setHtml(!1,"&nbsp;",!0,!0);assertEquals("field reported wrong contents",goog.string.Unicode.NBSP,FIELD.getCleanContents());assertEquals("field contains unexpected contents",UPPERCASE_CONTENTS,FIELD.getElement().innerHTML.toUpperCase())}function testLoremIpsumAndGetCleanContents2(){assert("field is editable",FIELD.isUneditable());goog.dom.setTextContent(goog.dom.getElement("field"),"   ");FIELD.makeEditable();assertEquals("field contains unexpected contents",UPPERCASE_CONTENTS,FIELD.getElement().innerHTML.toUpperCase());FIELD.makeUneditable();assertEquals("field contains unexpected contents",UPPERCASE_CONTENTS,goog.dom.getElement("field").innerHTML.toUpperCase())}function testLoremIpsumInClickToEditMode(){FIELD.makeEditable();assertEquals("field contains unexpected contents",UPPERCASE_CONTENTS,FIELD.getElement().innerHTML.toUpperCase());FIELD.makeUneditable();assertEquals("field contains unexpected contents",UPPERCASE_CONTENTS,goog.dom.getElement("field").innerHTML.toUpperCase())}function getNbsp(){return goog.userAgent.WEBKIT&&!goog.userAgent.isVersionOrHigher("528")||goog.userAgent.OPERA?"\xA0":"&nbsp;"}