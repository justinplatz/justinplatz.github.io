goog.provide("goog.html.sanitizer.HtmlSanitizer");goog.provide("goog.html.sanitizer.HtmlSanitizer.Builder");goog.provide("goog.html.sanitizer.HtmlSanitizerPolicy");goog.provide("goog.html.sanitizer.HtmlSanitizerPolicyContext");goog.provide("goog.html.sanitizer.HtmlSanitizerPolicyHints");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.NodeType");goog.require("goog.functions");goog.require("goog.html.SafeHtml");goog.require("goog.html.SafeStyle");goog.require("goog.html.SafeUrl");goog.require("goog.html.sanitizer.AttributeSanitizedWhitelist");goog.require("goog.html.sanitizer.AttributeWhitelist");goog.require("goog.html.sanitizer.CssSanitizer");goog.require("goog.html.sanitizer.TagBlacklist");goog.require("goog.html.sanitizer.TagWhitelist");goog.require("goog.html.uncheckedconversions");goog.require("goog.object");goog.require("goog.string");goog.require("goog.string.Const");goog.require("goog.userAgent");goog.html.sanitizer.HtmlSanitizerPolicyHints;goog.html.sanitizer.HtmlSanitizerPolicyContext;goog.html.sanitizer.HtmlSanitizerPolicy;goog.html.sanitizer.HtmlSanitizerAttributePolicy;goog.html.sanitizer.HTML_SANITIZER_SUPPORTED_=!goog.userAgent.IE||10<=document.documentMode;goog.html.sanitizer.HTML_SANITIZER_TEMPLATE_SUPPORTED=!goog.userAgent.IE||!goog.isDefAndNotNull(document.documentMode);goog.html.sanitizer.HTML_SANITIZER_BOOKKEEPING_PREFIX_="data-sanitizer-";goog.html.sanitizer.HTML_SANITIZER_BOOKKEEPING_ATTR_NAME_=goog.html.sanitizer.HTML_SANITIZER_BOOKKEEPING_PREFIX_+"elem-num";goog.html.sanitizer.HTML_SANITIZER_SANITIZED_ATTR_NAME_=goog.html.sanitizer.HTML_SANITIZER_BOOKKEEPING_PREFIX_+"original-tag";goog.html.sanitizer.HTML_SANITIZER_BLACKLISTED_TAG_=goog.html.sanitizer.HTML_SANITIZER_BOOKKEEPING_PREFIX_+"blacklisted-tag";goog.html.sanitizer.HTML_SANITIZER_PROPERTY_DESCRIPTORS_=goog.html.sanitizer.HTML_SANITIZER_SUPPORTED_?{attributes:Object.getOwnPropertyDescriptor(Element.prototype,"attributes"),setAttribute:Object.getOwnPropertyDescriptor(Element.prototype,"setAttribute"),innerHTML:Object.getOwnPropertyDescriptor(Element.prototype,"innerHTML"),nodeName:Object.getOwnPropertyDescriptor(Node.prototype,"nodeName"),parentNode:Object.getOwnPropertyDescriptor(Node.prototype,"parentNode"),childNodes:Object.getOwnPropertyDescriptor(Node.prototype,"childNodes"),style:Object.getOwnPropertyDescriptor(HTMLElement.prototype,"style")}:{};goog.html.sanitizer.HtmlSanitizer=function(opt_builder){opt_builder=opt_builder||new goog.html.sanitizer.HtmlSanitizer.Builder;this.shouldSanitizeTemplateContents_=opt_builder.shouldSanitizeTemplateContents_;this.attributeHandlers_=goog.object.clone(opt_builder.attributeWhitelist_);this.tagBlacklist_=goog.object.clone(opt_builder.tagBlacklist_);this.tagWhitelist_=goog.object.clone(opt_builder.tagWhitelist_);this.shouldAddOriginalTagNames_=opt_builder.shouldAddOriginalTagNames_;goog.array.forEach(opt_builder.dataAttributeWhitelist_,function(dataAttr){goog.asserts.assert(goog.string.startsWith(dataAttr,"data-"));goog.asserts.assert(!goog.string.startsWith(dataAttr,goog.html.sanitizer.HTML_SANITIZER_BOOKKEEPING_PREFIX_));this.attributeHandlers_["* "+dataAttr.toUpperCase()]=goog.html.sanitizer.HtmlSanitizer.cleanUpAttribute_},this)};goog.html.sanitizer.HtmlSanitizer.sanitizeUrl_=function(customUrlPolicy){return function(url,policyHints){var trimmed=goog.html.sanitizer.HtmlSanitizer.cleanUpAttribute_(url,policyHints),safeUrl=customUrlPolicy(trimmed,policyHints);if(safeUrl&&goog.html.SafeUrl.unwrap(safeUrl)!=goog.html.SafeUrl.INNOCUOUS_STRING){return goog.html.SafeUrl.unwrap(safeUrl)}else{return null}}};goog.html.sanitizer.HtmlSanitizer.Builder=function(){this.attributeWhitelist_={};goog.array.forEach([goog.html.sanitizer.AttributeWhitelist,goog.html.sanitizer.AttributeSanitizedWhitelist],function(wl){goog.array.forEach(goog.object.getKeys(wl),function(attr){this.attributeWhitelist_[attr]=goog.html.sanitizer.HtmlSanitizer.cleanUpAttribute_},this)},this);this.attributeOverrideList_={};this.allowFormTag_=!1;this.shouldSanitizeTemplateContents_=!0;this.dataAttributeWhitelist_=[];this.tagBlacklist_={};this.tagWhitelist_=goog.object.clone(goog.html.sanitizer.TagWhitelist);this.shouldAddOriginalTagNames_=!1;this.urlPolicy_=goog.html.sanitizer.HtmlSanitizer.defaultUrlPolicy_;this.networkRequestUrlPolicy_=goog.html.sanitizer.HtmlSanitizer.defaultNetworkRequestUrlPolicy_;this.namePolicy_=goog.html.sanitizer.HtmlSanitizer.defaultNamePolicy_;this.tokenPolicy_=goog.html.sanitizer.HtmlSanitizer.defaultTokenPolicy_;this.sanitizeCssPolicy_=void 0};goog.html.sanitizer.HtmlSanitizer.Builder.prototype.allowDataAttributes=function(dataAttributeWhitelist){goog.array.extend(this.dataAttributeWhitelist_,dataAttributeWhitelist);return this};goog.html.sanitizer.HtmlSanitizer.Builder.prototype.allowFormTag=function(){this.allowFormTag_=!0;return this};goog.html.sanitizer.HtmlSanitizer.Builder.prototype.alsoAllowTagsPrivateDoNotAccessOrElse=function(tags){goog.array.forEach(tags,function(tag){this.tagWhitelist_[tag.toUpperCase()]=!0},this);return this};goog.html.sanitizer.HtmlSanitizer.Builder.prototype.alsoAllowAttributesPrivateDoNotAccessOrElse=function(attrs){goog.array.forEach(attrs,function(attr){if(goog.isString(attr)){attr={tagName:"*",attributeName:attr,policy:null}}var handlerName=goog.html.sanitizer.HtmlSanitizer.attrIdentifier_(attr.tagName,attr.attributeName);this.attributeWhitelist_[handlerName]=attr.policy?attr.policy:goog.html.sanitizer.HtmlSanitizer.cleanUpAttribute_;this.attributeOverrideList_[handlerName]=!0},this);return this};goog.html.sanitizer.HtmlSanitizer.Builder.prototype.keepUnsanitizedTemplateContentsPrivateDoNotAccessOrElse=function(){if(!goog.html.sanitizer.HTML_SANITIZER_TEMPLATE_SUPPORTED){throw new Error("Cannot let unsanitized template contents through on "+"browsers that do not support TEMPLATE")}this.shouldSanitizeTemplateContents_=!1;return this};goog.html.sanitizer.HtmlSanitizer.Builder.prototype.onlyAllowTags=function(tagWhitelist){this.tagWhitelist_={SPAN:!0};goog.array.forEach(tagWhitelist,function(tag){tag=tag.toUpperCase();if(goog.html.sanitizer.TagWhitelist[tag]){this.tagWhitelist_[tag]=!0}else{throw new Error("Only whitelisted tags can be allowed. See "+"goog.html.sanitizer.TagWhitelist")}},this);return this};goog.html.sanitizer.HtmlSanitizer.Builder.prototype.onlyAllowAttributes=function(attrWhitelist){var oldWhitelist=this.attributeWhitelist_;this.attributeWhitelist_={};goog.array.forEach(attrWhitelist,function(attr){if("string"===goog.typeOf(attr)){attr={tagName:"*",attributeName:attr.toUpperCase(),policy:null}}var handlerName=goog.html.sanitizer.HtmlSanitizer.attrIdentifier_(attr.tagName,attr.attributeName);if(!oldWhitelist[handlerName]){throw new Error("Only whitelisted attributes can be allowed.")}this.attributeWhitelist_[handlerName]=attr.policy?attr.policy:goog.html.sanitizer.HtmlSanitizer.cleanUpAttribute_},this);return this};goog.html.sanitizer.HtmlSanitizer.Builder.prototype.addOriginalTagNames=function(){this.shouldAddOriginalTagNames_=!0;return this};goog.html.sanitizer.HtmlSanitizer.Builder.prototype.withCustomNetworkRequestUrlPolicy=function(customNetworkReqUrlPolicy){this.networkRequestUrlPolicy_=goog.html.sanitizer.HtmlSanitizer.sanitizeUrl_(customNetworkReqUrlPolicy);return this};goog.html.sanitizer.HtmlSanitizer.Builder.prototype.withCustomUrlPolicy=function(customUrlPolicy){this.urlPolicy_=goog.html.sanitizer.HtmlSanitizer.sanitizeUrl_(customUrlPolicy);return this};goog.html.sanitizer.HtmlSanitizer.Builder.prototype.withCustomNamePolicy=function(customNamePolicy){this.namePolicy_=customNamePolicy;return this};goog.html.sanitizer.HtmlSanitizer.Builder.prototype.withCustomTokenPolicy=function(customTokenPolicy){this.tokenPolicy_=customTokenPolicy;return this};goog.html.sanitizer.HtmlSanitizer.Builder.prototype.allowCssStyles=function(){this.sanitizeCssPolicy_=goog.html.sanitizer.HtmlSanitizer.sanitizeCssBlock_;return this};goog.html.sanitizer.HtmlSanitizer.wrapPolicy_=function(customPolicy,defaultPolicy){return function(value,hints,ctx,policy){var result=customPolicy(value,hints,ctx,policy);if(goog.isNull(result)){return null}return defaultPolicy(result,hints,ctx,policy)}};goog.html.sanitizer.HtmlSanitizer.installDefaultPolicy_=function(wl,ol,key,defaultPolicy){if(wl[key]&&!ol[key]){wl[key]=goog.html.sanitizer.HtmlSanitizer.wrapPolicy_(wl[key],defaultPolicy)}};goog.html.sanitizer.HtmlSanitizer.Builder.prototype.build=function(){if(!this.allowFormTag_){this.tagBlacklist_.FORM=!0}var installPolicy=goog.html.sanitizer.HtmlSanitizer.installDefaultPolicy_;installPolicy(this.attributeWhitelist_,this.attributeOverrideList_,"* USEMAP",goog.html.sanitizer.HtmlSanitizer.sanitizeUrlFragment_);var urlAttributes=["* ACTION","* CITE","* HREF"];goog.array.forEach(urlAttributes,function(attribute){installPolicy(this.attributeWhitelist_,this.attributeOverrideList_,attribute,this.urlPolicy_)},this);var networkUrlAttributes=["* LONGDESC","* SRC","LINK HREF"];goog.array.forEach(networkUrlAttributes,function(attribute){installPolicy(this.attributeWhitelist_,this.attributeOverrideList_,attribute,this.networkRequestUrlPolicy_)},this);var nameAttributes=["* FOR","* HEADERS","* NAME"];goog.array.forEach(nameAttributes,function(attribute){installPolicy(this.attributeWhitelist_,this.attributeOverrideList_,attribute,goog.partial(goog.html.sanitizer.HtmlSanitizer.sanitizeName_,this.namePolicy_))},this);installPolicy(this.attributeWhitelist_,this.attributeOverrideList_,"A TARGET",goog.partial(goog.html.sanitizer.HtmlSanitizer.allowedAttributeValues_,["_blank","_self"]));installPolicy(this.attributeWhitelist_,this.attributeOverrideList_,"* CLASS",goog.partial(goog.html.sanitizer.HtmlSanitizer.sanitizeClasses_,this.tokenPolicy_));installPolicy(this.attributeWhitelist_,this.attributeOverrideList_,"* ID",goog.partial(goog.html.sanitizer.HtmlSanitizer.sanitizeId_,this.tokenPolicy_));if(this.sanitizeCssPolicy_){installPolicy(this.attributeWhitelist_,this.attributeOverrideList_,"* STYLE",goog.partial(this.sanitizeCssPolicy_,this.networkRequestUrlPolicy_))}else{installPolicy(this.attributeWhitelist_,this.attributeOverrideList_,"* STYLE",goog.functions.NULL)}return new goog.html.sanitizer.HtmlSanitizer(this)};goog.html.sanitizer.HtmlSanitizer.defaultUrlPolicy_=goog.html.sanitizer.HtmlSanitizer.sanitizeUrl_(goog.html.SafeUrl.sanitize);goog.html.sanitizer.HtmlSanitizer.defaultNetworkRequestUrlPolicy_=goog.functions.NULL;goog.html.sanitizer.HtmlSanitizer.defaultNamePolicy_=goog.functions.NULL;goog.html.sanitizer.HtmlSanitizer.defaultTokenPolicy_=goog.functions.NULL;goog.html.sanitizer.HtmlSanitizer.attrIdentifier_=function(nodeName,attributeName){if(!nodeName){nodeName="*"}return(nodeName+" "+attributeName).toUpperCase()};goog.html.sanitizer.HtmlSanitizer.sanitizeCssBlock_=function(policySanitizeUrl,attrValue,policyHints,policyContext){if(!policyContext.cssStyle){return null}var naiveUriRewriter=function(uri,prop){policyHints.cssProperty=prop;return policySanitizeUrl(uri,policyHints)},sanitizedStyle=goog.html.SafeStyle.unwrap(goog.html.sanitizer.CssSanitizer.sanitizeInlineStyle(policyContext.cssStyle,naiveUriRewriter));return""==sanitizedStyle?null:sanitizedStyle};goog.html.sanitizer.HtmlSanitizer.cleanUpAttribute_=function(attrValue,policyHints){return goog.string.trim(attrValue)};goog.html.sanitizer.HtmlSanitizer.allowedAttributeValues_=function(allowedAttrs,attrValue,policyHints){attrValue=goog.string.trim(attrValue);if(goog.array.contains(allowedAttrs,attrValue.toLowerCase())){return attrValue}return null};goog.html.sanitizer.HtmlSanitizer.sanitizeUrlFragment_=function(attrValue,policyHints){var trimmed=goog.string.trim(attrValue);if(attrValue&&"#"==trimmed.charAt(0)){return trimmed}return null};goog.html.sanitizer.HtmlSanitizer.sanitizeName_=function(namePolicy,attrValue,policyHints){var trimmed=goog.string.trim(attrValue);return namePolicy(trimmed,policyHints)};goog.html.sanitizer.HtmlSanitizer.sanitizeClasses_=function(tokenPolicy,attrValue,policyHints){for(var classes=attrValue.split(/(?:\s+)/),sanitizedClasses=[],i=0,sanitizedClass;i<classes.length;i++){sanitizedClass=tokenPolicy(classes[i],policyHints);if(sanitizedClass){sanitizedClasses.push(sanitizedClass)}}if(0==sanitizedClasses.length){return null}else{return sanitizedClasses.join(" ")}};goog.html.sanitizer.HtmlSanitizer.sanitizeId_=function(tokenPolicy,attrValue,policyHints){var trimmed=goog.string.trim(attrValue);return tokenPolicy(trimmed,policyHints)};goog.html.sanitizer.HtmlSanitizer.getDomTreeWalker_=function(unsanitizedHtml){var iteratorParent,templateElement=document.createElement("template");if("content"in templateElement){templateElement.innerHTML=unsanitizedHtml;iteratorParent=templateElement.content}else{var doc=document.implementation.createHTMLDocument("x");iteratorParent=doc.body;doc.body.innerHTML=unsanitizedHtml}return document.createTreeWalker(iteratorParent,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,null,!1)};goog.html.sanitizer.HtmlSanitizer.getAttributes_=function(node){var attrDescriptor=goog.html.sanitizer.HTML_SANITIZER_PROPERTY_DESCRIPTORS_.attributes;if(attrDescriptor&&attrDescriptor.get){return attrDescriptor.get.apply(node)}else{return node.attributes instanceof NamedNodeMap?node.attributes:null}};goog.html.sanitizer.HtmlSanitizer.getAttribute_=function(node,name){var protoFn=Element.prototype.getAttribute;if(protoFn){var ret=protoFn.call(node,name);return ret?ret:""}else{return""}};goog.html.sanitizer.HtmlSanitizer.setAttribute_=function(node,name,value){var attrDescriptor=goog.html.sanitizer.HTML_SANITIZER_PROPERTY_DESCRIPTORS_.setAttribute;if(attrDescriptor&&attrDescriptor.value){attrDescriptor.value.call(node,name,value)}};goog.html.sanitizer.HtmlSanitizer.getInnerHTML_=function(node){var descriptor=goog.html.sanitizer.HTML_SANITIZER_PROPERTY_DESCRIPTORS_.innerHTML;if(descriptor&&descriptor.get){return descriptor.get.apply(node)}else{return"string"==typeof node.innerHTML?node.innerHTML:""}};goog.html.sanitizer.HtmlSanitizer.getStyle_=function(node){var styleDescriptor=goog.html.sanitizer.HTML_SANITIZER_PROPERTY_DESCRIPTORS_.style;if(node instanceof HTMLElement&&styleDescriptor&&styleDescriptor.get){return styleDescriptor.get.apply(node)}else{return node.style instanceof CSSStyleDeclaration?node.style:null}};goog.html.sanitizer.HtmlSanitizer.getNodeName_=function(node){var nodeNameDescriptor=goog.html.sanitizer.HTML_SANITIZER_PROPERTY_DESCRIPTORS_.nodeName;if(nodeNameDescriptor&&nodeNameDescriptor.get){return nodeNameDescriptor.get.apply(node)}else{return"string"==typeof node.nodeName?node.nodeName:"unknown"}};goog.html.sanitizer.HtmlSanitizer.getParentNode_=function(node){if(!goog.isDefAndNotNull(node)){return null}var parentNodeDescriptor=goog.html.sanitizer.HTML_SANITIZER_PROPERTY_DESCRIPTORS_.parentNode;if(parentNodeDescriptor&&parentNodeDescriptor.get){return parentNodeDescriptor.get.apply(node)}else{var parentNode=node.parentNode;if(parentNode&&parentNode.name&&"string"==typeof parentNode.name&&"parentnode"==parentNode.name.toLowerCase()){return null}else{return parentNode}}};goog.html.sanitizer.HtmlSanitizer.getChildNodes_=function(node){var descriptor=goog.html.sanitizer.HTML_SANITIZER_PROPERTY_DESCRIPTORS_.childNodes;if(goog.dom.isElement(node)&&descriptor&&descriptor.get){return descriptor.get.apply(node)}else{return node.childNodes instanceof NodeList?node.childNodes:null}};goog.html.sanitizer.HtmlSanitizer.prototype.sanitize=function(unsanitizedHtml){var sanitizedParent=this.sanitizeToDomNode(unsanitizedHtml),sanitizedString=new XMLSerializer().serializeToString(sanitizedParent);if(goog.string.startsWith(sanitizedString,"<span")){if(goog.string.endsWith(sanitizedString,"</span>")){sanitizedString=sanitizedString.slice(sanitizedString.indexOf(">")+1,-1*"</span>".length)}else if(goog.string.endsWith(sanitizedString,"/>")){sanitizedString=""}}return goog.html.uncheckedconversions.safeHtmlFromStringKnownToSatisfyTypeContract(goog.string.Const.from("Output of HTML sanitizer"),sanitizedString)};goog.html.sanitizer.HtmlSanitizer.prototype.sanitizeToDomNode=function(unsanitizedHtml){var sanitizedParent=document.createElement("span");if(!goog.html.sanitizer.HTML_SANITIZER_SUPPORTED_||!unsanitizedHtml){return sanitizedParent}try{var treeWalker=goog.html.sanitizer.HtmlSanitizer.getDomTreeWalker_(unsanitizedHtml)}catch(e){return sanitizedParent}var elementMap={},elemNum=0,dirtyNode;while(dirtyNode=treeWalker.nextNode()){elemNum++;var cleanNode=this.sanitizeElement_(dirtyNode);if(cleanNode.nodeType!=goog.dom.NodeType.TEXT){this.sanitizeAttrs_(dirtyNode,cleanNode);elementMap[elemNum]=cleanNode;goog.html.sanitizer.HtmlSanitizer.setAttribute_(dirtyNode,goog.html.sanitizer.HTML_SANITIZER_BOOKKEEPING_ATTR_NAME_,elemNum+"")}var dirtyNodeName=goog.html.sanitizer.HtmlSanitizer.getNodeName_(dirtyNode);if(goog.html.sanitizer.HTML_SANITIZER_TEMPLATE_SUPPORTED&&"template"===dirtyNodeName.toLowerCase()&&!cleanNode.hasAttribute(goog.html.sanitizer.HTML_SANITIZER_BLACKLISTED_TAG_)){this.processTemplateContents_(dirtyNode,cleanNode)}var target,dirtyParent=goog.html.sanitizer.HtmlSanitizer.getParentNode_(dirtyNode),isSanitizedParent=!1;if(goog.isNull(dirtyParent)){isSanitizedParent=!0}else if("body"==goog.html.sanitizer.HtmlSanitizer.getNodeName_(dirtyParent).toLowerCase()||dirtyParent.nodeType==goog.dom.NodeType.DOCUMENT_FRAGMENT){var dirtyGrandParent=goog.html.sanitizer.HtmlSanitizer.getParentNode_(dirtyParent);if(dirtyParent.nodeType==goog.dom.NodeType.DOCUMENT_FRAGMENT&&goog.isNull(dirtyGrandParent)){isSanitizedParent=!0}else if("body"==goog.html.sanitizer.HtmlSanitizer.getNodeName_(dirtyParent).toLowerCase()){var dirtyGrtGrandParent=goog.html.sanitizer.HtmlSanitizer.getParentNode_(dirtyGrandParent);if(goog.isNull(goog.html.sanitizer.HtmlSanitizer.getParentNode_(dirtyGrtGrandParent))){isSanitizedParent=!0}}}if(isSanitizedParent||goog.isNull(dirtyParent)){target=sanitizedParent}else{target=elementMap[goog.html.sanitizer.HtmlSanitizer.getAttribute_(dirtyParent,goog.html.sanitizer.HTML_SANITIZER_BOOKKEEPING_ATTR_NAME_)]}if(target.content){target=target.content}if(!goog.dom.isElement(cleanNode)||!cleanNode.hasAttribute(goog.html.sanitizer.HTML_SANITIZER_BLACKLISTED_TAG_)){target.appendChild(cleanNode)}}return sanitizedParent};goog.html.sanitizer.HtmlSanitizer.prototype.sanitizeElement_=function(dirtyNode){if(dirtyNode.nodeType==goog.dom.NodeType.TEXT){return document.createTextNode(dirtyNode.data)}var elemName=goog.html.sanitizer.HtmlSanitizer.getNodeName_(dirtyNode).toUpperCase(),sanitized=!1,blacklisted=!1,cleanElemName;if(elemName in goog.html.sanitizer.TagBlacklist||elemName in this.tagBlacklist_){cleanElemName="template";blacklisted=!0}else if(this.tagWhitelist_[elemName]){cleanElemName=elemName}else{cleanElemName="span";sanitized=!0}var cleanElem=document.createElement(cleanElemName);if(this.shouldAddOriginalTagNames_&&sanitized){goog.html.sanitizer.HtmlSanitizer.setAttribute_(cleanElem,goog.html.sanitizer.HTML_SANITIZER_SANITIZED_ATTR_NAME_,elemName.toLowerCase())}if(blacklisted){goog.html.sanitizer.HtmlSanitizer.setAttribute_(cleanElem,goog.html.sanitizer.HTML_SANITIZER_BLACKLISTED_TAG_,"")}return cleanElem};goog.html.sanitizer.HtmlSanitizer.prototype.sanitizeAttrs_=function(dirtyNode,cleanNode){var attributes=goog.html.sanitizer.HtmlSanitizer.getAttributes_(dirtyNode);if(!goog.isDefAndNotNull(attributes)){return cleanNode}for(var i=0,attrib;i<attributes.length;i++){attrib=attributes[i];if(attrib.specified){var cleanValue=this.sanitizeAttribute_(dirtyNode,attrib);if(!goog.isNull(cleanValue)){goog.html.sanitizer.HtmlSanitizer.setAttribute_(cleanNode,attrib.name,cleanValue)}}}return cleanNode};goog.html.sanitizer.HtmlSanitizer.prototype.sanitizeAttribute_=function(dirtyNode,attribute){var attributeName=attribute.name;if(goog.string.startsWith(goog.html.sanitizer.HTML_SANITIZER_BOOKKEEPING_PREFIX_,attributeName)){return null}var nodeName=goog.html.sanitizer.HtmlSanitizer.getNodeName_(dirtyNode),unsanitizedAttrValue=attribute.value,policyHints={tagName:goog.string.trim(nodeName).toLowerCase(),attributeName:goog.string.trim(attributeName).toLowerCase()},policyContext=goog.html.sanitizer.HtmlSanitizer.getContext_(policyHints.attributeName,dirtyNode),tagHandlerIndex=goog.html.sanitizer.HtmlSanitizer.attrIdentifier_(nodeName,attributeName);if(tagHandlerIndex in this.attributeHandlers_){var handler=this.attributeHandlers_[tagHandlerIndex];return handler(unsanitizedAttrValue,policyHints,policyContext)}var genericHandlerIndex=goog.html.sanitizer.HtmlSanitizer.attrIdentifier_(null,attributeName);if(genericHandlerIndex in this.attributeHandlers_){var handler=this.attributeHandlers_[genericHandlerIndex];return handler(unsanitizedAttrValue,policyHints,policyContext)}return null};goog.html.sanitizer.HtmlSanitizer.prototype.processTemplateContents_=function(dirtyNode,cleanNode){if(this.shouldSanitizeTemplateContents_||"template"!==cleanNode.nodeName.toLowerCase()){var dirtyNodeHTML=goog.html.sanitizer.HtmlSanitizer.getInnerHTML_(dirtyNode),templateSpan=this.sanitizeToDomNode(dirtyNodeHTML);goog.array.forEach(templateSpan.childNodes,function(node){cleanNode.appendChild(node)})}else{var templateDoc=cleanNode.content.ownerDocument,dirtyCopy=templateDoc.importNode(dirtyNode,!0),dirtyCopyChildren=goog.html.sanitizer.HtmlSanitizer.getChildNodes_(dirtyCopy);goog.array.forEach(dirtyCopyChildren,function(node){cleanNode.appendChild(node)})}};goog.html.sanitizer.HtmlSanitizer.getContext_=function(attributeName,dirtyNode){var policyContext={cssStyle:void 0};if("style"==attributeName){policyContext.cssStyle=goog.html.sanitizer.HtmlSanitizer.getStyle_(dirtyNode)}return policyContext};goog.html.sanitizer.HtmlSanitizer.sanitize=function(unsanitizedHtml){var sanitizer=new goog.html.sanitizer.HtmlSanitizer.Builder().build();return sanitizer.sanitize(unsanitizedHtml)};