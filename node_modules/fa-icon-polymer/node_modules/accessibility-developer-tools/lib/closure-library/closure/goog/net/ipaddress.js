goog.provide("goog.net.IpAddress");goog.provide("goog.net.Ipv4Address");goog.provide("goog.net.Ipv6Address");goog.require("goog.array");goog.require("goog.math.Integer");goog.require("goog.object");goog.require("goog.string");goog.net.IpAddress=function(address,version){this.ip_=address;this.version_=version};goog.net.IpAddress.prototype.getVersion=function(){return this.version_};goog.net.IpAddress.prototype.equals=function(other){return this.version_==other.getVersion()&&this.ip_.equals(other.toInteger())};goog.net.IpAddress.prototype.toInteger=function(){return goog.object.clone(this.ip_)};goog.net.IpAddress.prototype.toUriString=goog.abstractMethod;goog.net.IpAddress.prototype.toString=goog.abstractMethod;goog.net.IpAddress.prototype.isSiteLocal=goog.abstractMethod;goog.net.IpAddress.prototype.isLinkLocal=goog.abstractMethod;goog.net.IpAddress.fromString=function(address){try{if(-1!=address.indexOf(":")){return new goog.net.Ipv6Address(address)}return new goog.net.Ipv4Address(address)}catch(e){return null}};goog.net.IpAddress.fromUriString=function(address){try{if(goog.string.startsWith(address,"[")&&goog.string.endsWith(address,"]")){return new goog.net.Ipv6Address(address.substring(1,address.length-1))}return new goog.net.Ipv4Address(address)}catch(e){return null}};goog.net.Ipv4Address=function(address){var ip=goog.math.Integer.ZERO;if(address instanceof goog.math.Integer){if(0!=address.getSign()||address.lessThan(goog.math.Integer.ZERO)||address.greaterThan(goog.net.Ipv4Address.MAX_ADDRESS_)){throw Error("The address does not look like an IPv4.")}else{ip=goog.object.clone(address)}}else{if(!goog.net.Ipv4Address.REGEX_.test(address)){throw Error(address+" does not look like an IPv4 address.")}var octets=address.split(".");if(4!=octets.length){throw Error(address+" does not look like an IPv4 address.")}for(var i=0,parsedOctet;i<octets.length;i++){parsedOctet=goog.string.toNumber(octets[i]);if(isNaN(parsedOctet)||0>parsedOctet||255<parsedOctet||1!=octets[i].length&&goog.string.startsWith(octets[i],"0")){throw Error("In "+address+", octet "+i+" is not valid")}var intOctet=goog.math.Integer.fromNumber(parsedOctet);ip=ip.shiftLeft(8).or(intOctet)}}goog.net.Ipv4Address.base(this,"constructor",ip,4)};goog.inherits(goog.net.Ipv4Address,goog.net.IpAddress);goog.net.Ipv4Address.REGEX_=/^[0-9.]*$/;goog.net.Ipv4Address.MAX_NETMASK_LENGTH=32;goog.net.Ipv4Address.MAX_ADDRESS_=goog.math.Integer.ONE.shiftLeft(goog.net.Ipv4Address.MAX_NETMASK_LENGTH).subtract(goog.math.Integer.ONE);goog.net.Ipv4Address.prototype.toString=function(){if(this.ipStr_){return this.ipStr_}for(var ip=this.ip_.getBitsUnsigned(0),octets=[],i=3;0<=i;i--){octets[i]=(255&ip)+"";ip=ip>>>8}this.ipStr_=octets.join(".");return this.ipStr_};goog.net.Ipv4Address.prototype.toUriString=function(){return this.toString()};goog.net.Ipv4Address.prototype.isSiteLocal=function(){var ipInt=this.ip_.toInt();return 10==(255&ipInt>>>24)||172==(255&ipInt>>>24)&&16==(240&ipInt>>>16)||192==(255&ipInt>>>24)&&168==(255&ipInt>>>16)};goog.net.Ipv4Address.prototype.isLinkLocal=function(){var ipInt=this.ip_.toInt();return 169==(255&ipInt>>>24)&&254==(255&ipInt>>>16)};goog.net.Ipv6Address=function(address){var ip=goog.math.Integer.ZERO;if(address instanceof goog.math.Integer){if(0!=address.getSign()||address.lessThan(goog.math.Integer.ZERO)||address.greaterThan(goog.net.Ipv6Address.MAX_ADDRESS_)){throw Error("The address does not look like a valid IPv6.")}else{ip=goog.object.clone(address)}}else{if(!goog.net.Ipv6Address.REGEX_.test(address)){throw Error(address+" is not a valid IPv6 address.")}var splitColon=address.split(":");if(-1!=splitColon[splitColon.length-1].indexOf(".")){var newHextets=goog.net.Ipv6Address.dottedQuadtoHextets_(splitColon[splitColon.length-1]);goog.array.removeAt(splitColon,splitColon.length-1);goog.array.extend(splitColon,newHextets);address=splitColon.join(":")}var splitDoubleColon=address.split("::");if(2<splitDoubleColon.length||1==splitDoubleColon.length&&8!=splitColon.length){throw Error(address+" is not a valid IPv6 address.")}var ipArr;if(1<splitDoubleColon.length){ipArr=goog.net.Ipv6Address.explode_(splitDoubleColon)}else{ipArr=splitColon}if(8!=ipArr.length){throw Error(address+" is not a valid IPv6 address")}for(var i=0,parsedHextet;i<ipArr.length;i++){parsedHextet=goog.math.Integer.fromString(ipArr[i],16);if(parsedHextet.lessThan(goog.math.Integer.ZERO)||parsedHextet.greaterThan(goog.net.Ipv6Address.MAX_HEXTET_VALUE_)){throw Error(ipArr[i]+" in "+address+" is not a valid hextet.")}ip=ip.shiftLeft(16).or(parsedHextet)}}goog.net.Ipv6Address.base(this,"constructor",ip,6)};goog.inherits(goog.net.Ipv6Address,goog.net.IpAddress);goog.net.Ipv6Address.REGEX_=/^([a-fA-F0-9]*:){2}[a-fA-F0-9:.]*$/;goog.net.Ipv6Address.MAX_NETMASK_LENGTH=128;goog.net.Ipv6Address.MAX_HEXTET_VALUE_=goog.math.Integer.fromInt(65535);goog.net.Ipv6Address.MAX_ADDRESS_=goog.math.Integer.ONE.shiftLeft(goog.net.Ipv6Address.MAX_NETMASK_LENGTH).subtract(goog.math.Integer.ONE);goog.net.Ipv6Address.prototype.toString=function(){if(this.ipStr_){return this.ipStr_}for(var outputArr=[],i=3;0<=i;i--){var bits=this.ip_.getBitsUnsigned(i),firstHextet=bits>>>16,secondHextet=65535&bits;outputArr.push(firstHextet.toString(16));outputArr.push(secondHextet.toString(16))}outputArr=goog.net.Ipv6Address.compress_(outputArr);this.ipStr_=outputArr.join(":");return this.ipStr_};goog.net.Ipv6Address.prototype.toUriString=function(){return"["+this.toString()+"]"};goog.net.Ipv6Address.prototype.isSiteLocal=function(){var firstDWord=this.ip_.getBitsUnsigned(3),firstHextet=firstDWord>>>16;return 64768==(65280&firstHextet)};goog.net.Ipv6Address.prototype.isLinkLocal=function(){var firstDWord=this.ip_.getBitsUnsigned(3),firstHextet=firstDWord>>>16;return 65152==(65472&firstHextet)};goog.net.Ipv6Address.explode_=function(address){var basePart=address[0].split(":"),secondPart=address[1].split(":");if(1==basePart.length&&""==basePart[0]){basePart=[]}if(1==secondPart.length&&""==secondPart[0]){secondPart=[]}var gap=8-(basePart.length+secondPart.length);if(1>gap){return[]}return goog.array.join(basePart,goog.array.repeat("0",gap),secondPart)};goog.net.Ipv6Address.compress_=function(hextets){for(var bestStart=-1,start=-1,bestSize=0,size=0,i=0;i<hextets.length;i++){if("0"==hextets[i]){size++;if(-1==start){start=i}if(size>bestSize){bestSize=size;bestStart=start}}else{start=-1;size=0}}if(0<bestSize){if(bestStart+bestSize==hextets.length){hextets.push("")}hextets.splice(bestStart,bestSize,"");if(0==bestStart){hextets=[""].concat(hextets)}}return hextets};goog.net.Ipv6Address.dottedQuadtoHextets_=function(quads){var ip4=new goog.net.Ipv4Address(quads).toInteger(),bits=ip4.getBitsUnsigned(0),hextets=[];hextets.push((65535&bits>>>16).toString(16));hextets.push((65535&bits).toString(16));return hextets};goog.net.Ipv6Address.prototype.isMappedIpv4Address=function(){return 0==this.ip_.getBitsUnsigned(3)&&0==this.ip_.getBitsUnsigned(2)&&65535==this.ip_.getBitsUnsigned(1)};goog.net.Ipv6Address.prototype.getMappedIpv4Address=function(){if(!this.isMappedIpv4Address()){return null}var newIpv4=new goog.math.Integer([this.ip_.getBitsUnsigned(0)],0);return new goog.net.Ipv4Address(newIpv4)};