goog.provide("goog.db.Cursor");goog.require("goog.async.Deferred");goog.require("goog.db.Error");goog.require("goog.debug");goog.require("goog.events.EventTarget");goog.db.Cursor=function(){goog.db.Cursor.base(this,"constructor")};goog.inherits(goog.db.Cursor,goog.events.EventTarget);goog.db.Cursor.prototype.cursor_=null;goog.db.Cursor.prototype.next=function(opt_key){if(opt_key){this.cursor_["continue"](opt_key)}else{this.cursor_["continue"]()}};goog.db.Cursor.prototype.update=function(value){var msg="updating via cursor with value ",d=new goog.async.Deferred,request;try{request=this.cursor_.update(value)}catch(err){msg+=goog.debug.deepExpose(value);d.errback(goog.db.Error.fromException(err,msg));return d}request.onsuccess=function(ev){d.callback()};request.onerror=function(ev){msg+=goog.debug.deepExpose(value);d.errback(goog.db.Error.fromRequest(ev.target,msg))};return d};goog.db.Cursor.prototype.remove=function(){var msg="deleting via cursor",d=new goog.async.Deferred,request;try{request=this.cursor_["delete"]()}catch(err){d.errback(goog.db.Error.fromException(err,msg));return d}request.onsuccess=function(ev){d.callback()};request.onerror=function(ev){d.errback(goog.db.Error.fromRequest(ev.target,msg))};return d};goog.db.Cursor.prototype.getValue=function(){return this.cursor_.value};goog.db.Cursor.prototype.getKey=function(){return this.cursor_.key};goog.db.Cursor.openCursor=function(source,opt_range,opt_direction){var cursor=new goog.db.Cursor,request;try{var range=opt_range?opt_range.range():null;if(opt_direction){request=source.openCursor(range,opt_direction)}else{request=source.openCursor(range)}}catch(ex){cursor.dispose();throw goog.db.Error.fromException(ex,source.name)}request.onsuccess=function(e){cursor.cursor_=e.target.result||null;if(cursor.cursor_){cursor.dispatchEvent(goog.db.Cursor.EventType.NEW_DATA)}else{cursor.dispatchEvent(goog.db.Cursor.EventType.COMPLETE)}};request.onerror=function(e){cursor.dispatchEvent(goog.db.Cursor.EventType.ERROR)};return cursor};goog.db.Cursor.Direction={NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"};goog.db.Cursor.EventType={COMPLETE:"c",ERROR:"e",NEW_DATA:"n"};