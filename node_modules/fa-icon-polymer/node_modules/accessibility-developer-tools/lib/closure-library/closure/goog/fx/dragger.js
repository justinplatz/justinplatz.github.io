goog.provide("goog.fx.DragEvent");goog.provide("goog.fx.Dragger");goog.provide("goog.fx.Dragger.EventType");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.events");goog.require("goog.events.Event");goog.require("goog.events.EventHandler");goog.require("goog.events.EventTarget");goog.require("goog.events.EventType");goog.require("goog.math.Coordinate");goog.require("goog.math.Rect");goog.require("goog.style");goog.require("goog.style.bidi");goog.require("goog.userAgent");goog.fx.Dragger=function(target,opt_handle,opt_limits){goog.fx.Dragger.base(this,"constructor");this.target=target;this.handle=opt_handle||target;this.limits=opt_limits||new goog.math.Rect(NaN,NaN,NaN,NaN);this.document_=goog.dom.getOwnerDocument(target);this.eventHandler_=new goog.events.EventHandler(this);this.registerDisposable(this.eventHandler_);this.rightToLeft_;this.clientX=0;this.clientY=0;this.screenX=0;this.screenY=0;this.startX=0;this.startY=0;this.deltaX=0;this.deltaY=0;this.pageScroll;this.enabled_=!0;this.dragging_=!1;this.preventMouseDown_=!0;this.hysteresisDistanceSquared_=0;this.scrollTarget_;this.ieDragStartCancellingOn_=!1;this.useRightPositioningForRtl_=!1;goog.events.listen(this.handle,[goog.events.EventType.TOUCHSTART,goog.events.EventType.MOUSEDOWN],this.startDrag,!1,this)};goog.inherits(goog.fx.Dragger,goog.events.EventTarget);goog.tagUnsealableClass(goog.fx.Dragger);goog.fx.Dragger.HAS_SET_CAPTURE_=goog.global.document&&goog.global.document.documentElement&&!!goog.global.document.documentElement.setCapture&&!!goog.global.document.releaseCapture;goog.fx.Dragger.cloneNode=function(sourceEl){for(var clonedEl=sourceEl.cloneNode(!0),origTexts=goog.dom.getElementsByTagName(goog.dom.TagName.TEXTAREA,sourceEl),dragTexts=goog.dom.getElementsByTagName(goog.dom.TagName.TEXTAREA,clonedEl),i=0;i<origTexts.length;i++){dragTexts[i].value=origTexts[i].value}switch(sourceEl.tagName){case goog.dom.TagName.TR+"":return goog.dom.createDom(goog.dom.TagName.TABLE,null,goog.dom.createDom(goog.dom.TagName.TBODY,null,clonedEl));case goog.dom.TagName.TD+"":case goog.dom.TagName.TH+"":return goog.dom.createDom(goog.dom.TagName.TABLE,null,goog.dom.createDom(goog.dom.TagName.TBODY,null,goog.dom.createDom(goog.dom.TagName.TR,null,clonedEl)));case goog.dom.TagName.TEXTAREA+"":clonedEl.value=sourceEl.value;default:return clonedEl;}};goog.fx.Dragger.EventType={EARLY_CANCEL:"earlycancel",START:"start",BEFOREDRAG:"beforedrag",DRAG:"drag",END:"end"};goog.fx.Dragger.prototype.enableRightPositioningForRtl=function(useRightPositioningForRtl){this.useRightPositioningForRtl_=useRightPositioningForRtl};goog.fx.Dragger.prototype.getHandler=function(){var self=this;return self.eventHandler_};goog.fx.Dragger.prototype.setLimits=function(limits){this.limits=limits||new goog.math.Rect(NaN,NaN,NaN,NaN)};goog.fx.Dragger.prototype.setHysteresis=function(distance){this.hysteresisDistanceSquared_=Math.pow(distance,2)};goog.fx.Dragger.prototype.getHysteresis=function(){return Math.sqrt(this.hysteresisDistanceSquared_)};goog.fx.Dragger.prototype.setScrollTarget=function(scrollTarget){this.scrollTarget_=scrollTarget};goog.fx.Dragger.prototype.setCancelIeDragStart=function(cancelIeDragStart){this.ieDragStartCancellingOn_=cancelIeDragStart};goog.fx.Dragger.prototype.getEnabled=function(){return this.enabled_};goog.fx.Dragger.prototype.setEnabled=function(enabled){this.enabled_=enabled};goog.fx.Dragger.prototype.setPreventMouseDown=function(preventMouseDown){this.preventMouseDown_=preventMouseDown};goog.fx.Dragger.prototype.disposeInternal=function(){goog.fx.Dragger.superClass_.disposeInternal.call(this);goog.events.unlisten(this.handle,[goog.events.EventType.TOUCHSTART,goog.events.EventType.MOUSEDOWN],this.startDrag,!1,this);this.cleanUpAfterDragging_();this.target=null;this.handle=null};goog.fx.Dragger.prototype.isRightToLeft_=function(){if(!goog.isDef(this.rightToLeft_)){this.rightToLeft_=goog.style.isRightToLeft(this.target)}return this.rightToLeft_};goog.fx.Dragger.prototype.startDrag=function(e){var isMouseDown=e.type==goog.events.EventType.MOUSEDOWN;if(this.enabled_&&!this.dragging_&&(!isMouseDown||e.isMouseActionButton())){if(0==this.hysteresisDistanceSquared_){if(this.fireDragStart_(e)){this.dragging_=!0;if(this.preventMouseDown_&&isMouseDown){e.preventDefault()}}else{return}}else if(this.preventMouseDown_&&isMouseDown){e.preventDefault()}this.setupDragHandlers();this.clientX=this.startX=e.clientX;this.clientY=this.startY=e.clientY;this.screenX=e.screenX;this.screenY=e.screenY;this.computeInitialPosition();this.pageScroll=goog.dom.getDomHelper(this.document_).getDocumentScroll()}else{this.dispatchEvent(goog.fx.Dragger.EventType.EARLY_CANCEL)}};goog.fx.Dragger.prototype.setupDragHandlers=function(){var doc=this.document_,docEl=doc.documentElement,useCapture=!goog.fx.Dragger.HAS_SET_CAPTURE_;this.eventHandler_.listen(doc,[goog.events.EventType.TOUCHMOVE,goog.events.EventType.MOUSEMOVE],this.handleMove_,useCapture);this.eventHandler_.listen(doc,[goog.events.EventType.TOUCHEND,goog.events.EventType.MOUSEUP],this.endDrag,useCapture);if(goog.fx.Dragger.HAS_SET_CAPTURE_){docEl.setCapture(!1);this.eventHandler_.listen(docEl,goog.events.EventType.LOSECAPTURE,this.endDrag)}else{this.eventHandler_.listen(goog.dom.getWindow(doc),goog.events.EventType.BLUR,this.endDrag)}if(goog.userAgent.IE&&this.ieDragStartCancellingOn_){this.eventHandler_.listen(doc,goog.events.EventType.DRAGSTART,goog.events.Event.preventDefault)}if(this.scrollTarget_){this.eventHandler_.listen(this.scrollTarget_,goog.events.EventType.SCROLL,this.onScroll_,useCapture)}};goog.fx.Dragger.prototype.fireDragStart_=function(e){return this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.START,this,e.clientX,e.clientY,e))};goog.fx.Dragger.prototype.cleanUpAfterDragging_=function(){this.eventHandler_.removeAll();if(goog.fx.Dragger.HAS_SET_CAPTURE_){this.document_.releaseCapture()}};goog.fx.Dragger.prototype.endDrag=function(e,opt_dragCanceled){this.cleanUpAfterDragging_();if(this.dragging_){this.dragging_=!1;var x=this.limitX(this.deltaX),y=this.limitY(this.deltaY),dragCanceled=opt_dragCanceled||e.type==goog.events.EventType.TOUCHCANCEL;this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.END,this,e.clientX,e.clientY,e,x,y,dragCanceled))}else{this.dispatchEvent(goog.fx.Dragger.EventType.EARLY_CANCEL)}};goog.fx.Dragger.prototype.endDragCancel=function(e){this.endDrag(e,!0)};goog.fx.Dragger.prototype.handleMove_=function(e){if(this.enabled_){var sign=this.useRightPositioningForRtl_&&this.isRightToLeft_()?-1:1,dx=sign*(e.clientX-this.clientX),dy=e.clientY-this.clientY;this.clientX=e.clientX;this.clientY=e.clientY;this.screenX=e.screenX;this.screenY=e.screenY;if(!this.dragging_){var diffX=this.startX-this.clientX,diffY=this.startY-this.clientY,distance=diffX*diffX+diffY*diffY;if(distance>this.hysteresisDistanceSquared_){if(this.fireDragStart_(e)){this.dragging_=!0}else{if(!this.isDisposed()){this.endDrag(e)}return}}}var pos=this.calculatePosition_(dx,dy),x=pos.x,y=pos.y;if(this.dragging_){var rv=this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.BEFOREDRAG,this,e.clientX,e.clientY,e,x,y));if(rv){this.doDrag(e,x,y,!1);e.preventDefault()}}}};goog.fx.Dragger.prototype.calculatePosition_=function(dx,dy){var pageScroll=goog.dom.getDomHelper(this.document_).getDocumentScroll();dx+=pageScroll.x-this.pageScroll.x;dy+=pageScroll.y-this.pageScroll.y;this.pageScroll=pageScroll;this.deltaX+=dx;this.deltaY+=dy;var x=this.limitX(this.deltaX),y=this.limitY(this.deltaY);return new goog.math.Coordinate(x,y)};goog.fx.Dragger.prototype.onScroll_=function(e){var pos=this.calculatePosition_(0,0);e.clientX=this.clientX;e.clientY=this.clientY;this.doDrag(e,pos.x,pos.y,!0)};goog.fx.Dragger.prototype.doDrag=function(e,x,y,dragFromScroll){this.defaultAction(x,y);this.dispatchEvent(new goog.fx.DragEvent(goog.fx.Dragger.EventType.DRAG,this,e.clientX,e.clientY,e,x,y))};goog.fx.Dragger.prototype.limitX=function(x){var rect=this.limits,left=!isNaN(rect.left)?rect.left:null,width=!isNaN(rect.width)?rect.width:0,maxX=null!=left?left+width:1/0,minX=null!=left?left:-Infinity;return Math.min(maxX,Math.max(minX,x))};goog.fx.Dragger.prototype.limitY=function(y){var rect=this.limits,top=!isNaN(rect.top)?rect.top:null,height=!isNaN(rect.height)?rect.height:0,maxY=null!=top?top+height:1/0,minY=null!=top?top:-Infinity;return Math.min(maxY,Math.max(minY,y))};goog.fx.Dragger.prototype.computeInitialPosition=function(){this.deltaX=this.useRightPositioningForRtl_?goog.style.bidi.getOffsetStart(this.target):this.target.offsetLeft;this.deltaY=this.target.offsetTop};goog.fx.Dragger.prototype.defaultAction=function(x,y){if(this.useRightPositioningForRtl_&&this.isRightToLeft_()){this.target.style.right=x+"px"}else{this.target.style.left=x+"px"}this.target.style.top=y+"px"};goog.fx.Dragger.prototype.isDragging=function(){return this.dragging_};goog.fx.DragEvent=function(type,dragobj,clientX,clientY,browserEvent,opt_actX,opt_actY,opt_dragCanceled){goog.events.Event.call(this,type);this.clientX=clientX;this.clientY=clientY;this.browserEvent=browserEvent;this.left=goog.isDef(opt_actX)?opt_actX:dragobj.deltaX;this.top=goog.isDef(opt_actY)?opt_actY:dragobj.deltaY;this.dragger=dragobj;this.dragCanceled=!!opt_dragCanceled};goog.inherits(goog.fx.DragEvent,goog.events.Event);