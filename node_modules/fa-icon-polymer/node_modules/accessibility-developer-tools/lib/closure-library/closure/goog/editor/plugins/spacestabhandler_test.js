goog.provide("goog.editor.plugins.SpacesTabHandlerTest");goog.setTestOnly("goog.editor.plugins.SpacesTabHandlerTest");goog.require("goog.dom");goog.require("goog.dom.Range");goog.require("goog.editor.plugins.SpacesTabHandler");goog.require("goog.events.BrowserEvent");goog.require("goog.events.KeyCodes");goog.require("goog.functions");goog.require("goog.testing.StrictMock");goog.require("goog.testing.editor.FieldMock");goog.require("goog.testing.editor.TestHelper");goog.require("goog.testing.jsunit");var field,editableField,tabHandler,testHelper;function setUp(){field=goog.dom.getElement("field");editableField=new goog.testing.editor.FieldMock;editableField.inModalMode=goog.functions.FALSE;testHelper=new goog.testing.editor.TestHelper(field);testHelper.setUpEditableElement();tabHandler=new goog.editor.plugins.SpacesTabHandler;tabHandler.registerFieldObject(editableField)}function tearDown(){editableField=null;testHelper.tearDownEditableElement();tabHandler.dispose()}function testSelectedTextIndent(){goog.dom.setTextContent(field,"Test");var testText=field.firstChild;testHelper.select(testText,0,testText,4);var event=new goog.testing.StrictMock(goog.events.BrowserEvent);event.keyCode=goog.events.KeyCodes.TAB;event.shiftKey=!1;editableField.stopChangeEvents(!0,!0);editableField.dispatchChange();editableField.dispatchSelectionChangeEvent();event.preventDefault();editableField.$replay();event.$replay();assertTrue("Event marked as handled",tabHandler.handleKeyboardShortcut(event,"",!1));var contents=field.textContent||field.innerText;assertTrue("Text should be replaced with 4 spaces but was: \""+contents+"\"",/^(\s|\u00a0){4}$/.test(contents));editableField.$verify();event.$verify()}function testCursorIndent(){goog.dom.setTextContent(field,"Test");var testText=field.firstChild;testHelper.select(testText,2,testText,2);var event=new goog.testing.StrictMock(goog.events.BrowserEvent);event.keyCode=goog.events.KeyCodes.TAB;event.shiftKey=!1;editableField.stopChangeEvents(!0,!0);editableField.dispatchChange();editableField.dispatchSelectionChangeEvent();event.preventDefault();editableField.$replay();event.$replay();assertTrue("Event marked as handled",tabHandler.handleKeyboardShortcut(event,"",!1));var contents=field.textContent||field.innerText;assertTrue("Expected contents \"Te    st\" but was: \""+contents+"\"",/Te[\s|\u00a0]{4}st/.test(contents));editableField.$verify();event.$verify()}function testShiftTabNoOp(){goog.dom.setTextContent(field,"Test");range=goog.dom.Range.createFromNodeContents(field);range.collapse();range.select();var event=new goog.testing.StrictMock(goog.events.BrowserEvent);event.keyCode=goog.events.KeyCodes.TAB;event.shiftKey=!0;event.preventDefault();editableField.$replay();event.$replay();assertTrue("Event marked as handled",tabHandler.handleKeyboardShortcut(event,"",!1));var contents=field.textContent||field.innerText;assertEquals("Shift+tab should not change contents","Test",contents);editableField.$verify();event.$verify()}function testInListNoOp(){field.innerHTML="<ul><li>Test</li></ul>";var testText=field.firstChild.firstChild.firstChild;testHelper.select(testText,2,testText,2);var event=new goog.testing.StrictMock(goog.events.BrowserEvent);event.keyCode=goog.events.KeyCodes.TAB;event.shiftKey=!1;editableField.$replay();event.$replay();assertFalse("Event must not be handled when selection inside list.",tabHandler.handleKeyboardShortcut(event,"",!1));testHelper.assertHtmlMatches("<ul><li>Test</li></ul>");editableField.$verify();event.$verify()}function testContainsListNoOp(){field.innerHTML="<ul><li>Test</li></ul>";var testText=field.firstChild.firstChild.firstChild;testHelper.select(field.firstChild,0,testText,2);var event=new goog.testing.StrictMock(goog.events.BrowserEvent);event.keyCode=goog.events.KeyCodes.TAB;event.shiftKey=!1;editableField.$replay();event.$replay();assertFalse("Event must not be handled when selection inside list.",tabHandler.handleKeyboardShortcut(event,"",!1));testHelper.assertHtmlMatches("<ul><li>Test</li></ul>");editableField.$verify();event.$verify()}