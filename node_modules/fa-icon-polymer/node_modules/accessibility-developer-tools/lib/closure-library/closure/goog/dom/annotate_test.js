goog.provide("goog.dom.annotateTest");goog.setTestOnly("goog.dom.annotateTest");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.dom.annotate");goog.require("goog.html.SafeHtml");goog.require("goog.testing.jsunit");var $=goog.dom.getElement,TEXT="This little piggy cried \"Wee! Wee! Wee!\" all the way home.";function doAnnotation(termIndex,termHtml){return goog.html.SafeHtml.create("span",{class:"c"+termIndex},termHtml)}function testAnnotateText(){var terms=[["pig",!0]],html=goog.dom.annotate.annotateText(TEXT,terms,doAnnotation);assertEquals(null,html);terms=[["pig",!1]];html=goog.dom.annotate.annotateText(TEXT,terms,doAnnotation);html=goog.html.SafeHtml.unwrap(html);assertEquals("This little <span class=\"c0\">pig</span>gy cried "+"&quot;Wee! Wee! Wee!&quot; all the way home.",html);terms=[[" piggy ",!0]];html=goog.dom.annotate.annotateText(TEXT,terms,doAnnotation);assertEquals(null,html);terms=[[" piggy ",!1]];html=goog.dom.annotate.annotateText(TEXT,terms,doAnnotation);html=goog.html.SafeHtml.unwrap(html);assertEquals("This little<span class=\"c0\"> piggy </span>cried "+"&quot;Wee! Wee! Wee!&quot; all the way home.",html);terms=[["goose",!0],["piggy",!0]];html=goog.dom.annotate.annotateText(TEXT,terms,doAnnotation);html=goog.html.SafeHtml.unwrap(html);assertEquals("This little <span class=\"c1\">piggy</span> cried "+"&quot;Wee! Wee! Wee!&quot; all the way home.",html)}function testAnnotateTextHtmlEscaping(){var terms=[["a",!1]],html=goog.dom.annotate.annotateText("&a",terms,doAnnotation);html=goog.html.SafeHtml.unwrap(html);assertEquals("&amp;<span class=\"c0\">a</span>",html);terms=[["a",!1]];html=goog.dom.annotate.annotateText("a&",terms,doAnnotation);html=goog.html.SafeHtml.unwrap(html);assertEquals("<span class=\"c0\">a</span>&amp;",html);terms=[["&",!1]];html=goog.dom.annotate.annotateText("&",terms,doAnnotation);html=goog.html.SafeHtml.unwrap(html);assertEquals("<span class=\"c0\">&amp;</span>",html)}function testAnnotateTextIgnoreCase(){var terms=[["wEe",!0]],html=goog.dom.annotate.annotateText(TEXT,terms,doAnnotation,!0);html=goog.html.SafeHtml.unwrap(html);assertEquals("This little piggy cried &quot;<span class=\"c0\">Wee</span>! "+"<span class=\"c0\">Wee</span>! <span class=\"c0\">Wee</span>!"+"&quot; all the way home.",html);terms=[["WEE!",!0],["HE",!1]];html=goog.dom.annotate.annotateText(TEXT,terms,doAnnotation,!0);html=goog.html.SafeHtml.unwrap(html);assertEquals("This little piggy cried &quot;<span class=\"c0\">Wee!</span> "+"<span class=\"c0\">Wee!</span> <span class=\"c0\">Wee!</span>"+"&quot; all t<span class=\"c1\">he</span> way home.",html)}function testAnnotateTextOverlappingTerms(){var terms=[["tt",!1],["little",!1]],html=goog.dom.annotate.annotateText(TEXT,terms,doAnnotation);html=goog.html.SafeHtml.unwrap(html);assertEquals("This <span class=\"c1\">little</span> piggy cried &quot;Wee! "+"Wee! Wee!&quot; all the way home.",html)}function testAnnotateTerms(){var terms=[["pig",!0]];assertFalse(goog.dom.annotate.annotateTerms($("p"),terms,doAnnotation));assertEquals("Tom &amp; Jerry",$("p").innerHTML);terms=[["Tom",!0]];assertTrue(goog.dom.annotate.annotateTerms($("p"),terms,doAnnotation));var spans=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.SPAN,"c0",$("p"));assertEquals(1,spans.length);assertEquals("Tom",spans[0].innerHTML);assertEquals(" & Jerry",spans[0].nextSibling.nodeValue)}function testAnnotateTermsInTable(){var terms=[["pig",!1]];assertTrue(goog.dom.annotate.annotateTerms($("q"),terms,doAnnotation));var spans=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.SPAN,"c0",$("q"));assertEquals(2,spans.length);assertEquals("pig",spans[0].innerHTML);assertEquals("gy",spans[0].nextSibling.nodeValue);assertEquals("pig",spans[1].innerHTML);assertEquals(goog.dom.TagName.I+"",spans[1].parentNode.tagName)}function testAnnotateTermsWithClassExclusions(){var terms=[["pig",!1]],classesToIgnore=["s"];assertTrue(goog.dom.annotate.annotateTerms($("r"),terms,doAnnotation,!1,classesToIgnore));var spans=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.SPAN,"c0",$("r"));assertEquals(1,spans.length);assertEquals("pig",spans[0].innerHTML);assertEquals("gy",spans[0].nextSibling.nodeValue)}function testAnnotateTermsIgnoreCase(){var terms1=[["pig",!1]];assertTrue(goog.dom.annotate.annotateTerms($("t"),terms1,doAnnotation,!0));var spans=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.SPAN,"c0",$("t"));assertEquals(2,spans.length);assertEquals("pig",spans[0].innerHTML);assertEquals("gy",spans[0].nextSibling.nodeValue);assertEquals("Pig",spans[1].innerHTML);var terms2=[["Pig",!1]];assertTrue(goog.dom.annotate.annotateTerms($("u"),terms2,doAnnotation,!0));var spans=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.SPAN,"c0",$("u"));assertEquals(2,spans.length);assertEquals("pig",spans[0].innerHTML);assertEquals("gy",spans[0].nextSibling.nodeValue);assertEquals("Pig",spans[1].innerHTML)}function testAnnotateTermsInObject(){var terms=[["object",!0]];assertTrue(goog.dom.annotate.annotateTerms($("o"),terms,doAnnotation));var spans=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.SPAN,"c0",$("o"));assertEquals(1,spans.length);assertEquals("object",spans[0].innerHTML)}function testAnnotateTermsInScript(){var terms=[["variable",!0]];assertFalse(goog.dom.annotate.annotateTerms($("script"),terms,doAnnotation))}function testAnnotateTermsInStyle(){var terms=[["color",!0]];assertFalse(goog.dom.annotate.annotateTerms($("style"),terms,doAnnotation))}function testAnnotateTermsInHtmlComment(){var terms=[["note",!0]];assertFalse(goog.dom.annotate.annotateTerms($("comment"),terms,doAnnotation))}