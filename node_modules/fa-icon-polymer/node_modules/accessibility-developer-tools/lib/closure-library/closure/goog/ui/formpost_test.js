goog.provide("goog.ui.FormPostTest");goog.setTestOnly("goog.ui.FormPostTest");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.object");goog.require("goog.testing.jsunit");goog.require("goog.ui.FormPost");goog.require("goog.userAgent.product");goog.require("goog.userAgent.product.isVersion");var TARGET="target",ACTION_URL="http://url/",formPost,parameters,submits,originalCreateDom=goog.ui.FormPost.prototype.createDom;function isChrome7or8(){if(goog.userAgent.product.CHROME&&goog.userAgent.product.isVersion("7.0")&&!goog.userAgent.product.isVersion("8.0")){return!1}return!0}function setUp(){formPost=new goog.ui.FormPost;submits=0;goog.ui.FormPost.prototype.createDom=function(){originalCreateDom.apply(this,arguments);this.getElement().submit=function(){submits++}};parameters={foo:"bar",baz:1,array:[0,"yes"]}}function tearDown(){formPost.dispose();goog.ui.FormPost.prototype.createDom=originalCreateDom}function testPost(){formPost.post(parameters,ACTION_URL,TARGET);expectUrlAndParameters_(ACTION_URL,TARGET,parameters)}function testPostWithDefaults(){if(isChrome7or8){return}formPost=new goog.ui.FormPost;formPost.post(parameters);expectUrlAndParameters_("","",parameters)}function expectUrlAndParameters_(url,target,parameters){var form=formPost.getElement();assertEquals("element must be a form",goog.dom.TagName.FORM+"",form.tagName);assertEquals("form must be hidden","none",form.style.display);assertEquals("form method must be POST","POST",form.method.toUpperCase());assertEquals("submits",1,submits);assertEquals("action attribute",url,form.action);assertEquals("target attribute",target,form.target);for(var inputs=goog.dom.getElementsByTagNameAndClass(goog.dom.TagName.INPUT,null,form),formValues={},i=0,input=inputs[i];input=inputs[i];i++){if(goog.isArray(formValues[input.name])){formValues[input.name].push(input.value)}else if(input.name in formValues){formValues[input.name]=[formValues[input.name],input.value]}else{formValues[input.name]=input.value}}var expected=goog.object.map(parameters,valueToString);assertObjectEquals("form values must match",expected,formValues)}function valueToString(value){if(goog.isArray(value)){return goog.array.map(value,valueToString)}return value+""}