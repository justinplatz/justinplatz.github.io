goog.provide("goog.editor.ClickToEditWrapperTest");goog.setTestOnly("goog.editor.ClickToEditWrapperTest");goog.require("goog.dom");goog.require("goog.dom.Range");goog.require("goog.dom.TagName");goog.require("goog.editor.ClickToEditWrapper");goog.require("goog.editor.SeamlessField");goog.require("goog.testing.MockClock");goog.require("goog.testing.events");goog.require("goog.testing.jsunit");goog.require("goog.userAgent");goog.require("goog.userAgent.product");var FIELD,CLOCK,HTML;function setUp(){HTML=goog.dom.getElement("root").innerHTML;CLOCK=new goog.testing.MockClock(!0);goog.dom.Range.clearSelection();window.blur();window.focus()}function setUpField(opt_isBlended){FIELD=opt_isBlended?new goog.editor.SeamlessField("testField"):new goog.editor.SeamlessField("testField");new goog.editor.ClickToEditWrapper(FIELD);goog.dom.Range.clearSelection()}function tearDown(){if(FIELD){FIELD.dispose()}CLOCK.dispose();goog.dom.getElement("root").innerHTML=HTML}function testClickToEdit(opt_isBlended){setUpField(opt_isBlended);var text=goog.dom.getElement("testField").firstChild;goog.dom.Range.createFromNodes(text,4,text,8).select();goog.testing.events.fireClickSequence(text.parentNode);assertFalse("Field should not be made editable immediately after clicking",FIELD.isLoaded());CLOCK.tick(1);assertTrue("Field should be editable",FIELD.isLoaded());var dom=FIELD.getEditableDomHelper(),selection=goog.dom.Range.createFromWindow(dom.getWindow()),body=FIELD.getElement();text=body.firstChild;assertEquals("Wrong start node",text,selection.getStartNode());assertEquals("Wrong end node",text,selection.getEndNode());assertEquals("Wrong start offset",4,selection.getStartOffset());assertEquals("Wrong end offset",8,selection.getEndOffset())}function testBlendedClickToEdit(){testClickToEdit(!0)}function testClickToEditWithAnchor(opt_isBlended){if(goog.userAgent.product.CHROME&&goog.userAgent.WINDOWS){return}setUpField(opt_isBlended);goog.dom.getElement("testAnchor").focus();goog.testing.events.fireClickSequence(goog.dom.getElement("testAnchor"));CLOCK.tick(1);assertTrue("Field should be editable",FIELD.isLoaded());var dom=FIELD.getEditableDomHelper(),selection=goog.dom.Range.createFromWindow(dom.getWindow()),body=FIELD.getElement(),text=body.firstChild,link=dom.getElementsByTagNameAndClass(goog.dom.TagName.A,null,body)[0].firstChild,isIELessThan9OrWebkit=goog.userAgent.WEBKIT||goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher(9);assertEquals("Wrong start node",isIELessThan9OrWebkit?text:link,selection.getStartNode());assertEquals("Wrong start offset",isIELessThan9OrWebkit?17:0,selection.getStartOffset());assertEquals("Wrong end node",isIELessThan9OrWebkit?text:link,selection.getEndNode());assertEquals("Wrong end offset",isIELessThan9OrWebkit?17:0,selection.getEndOffset())}function testBlendedClickToEditWithAnchor(){testClickToEditWithAnchor(!0)}