goog.setTestOnly("goog.testing.MultiTestRunner");goog.provide("goog.testing.MultiTestRunner");goog.provide("goog.testing.MultiTestRunner.TestFrame");goog.require("goog.Timer");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.dom.classlist");goog.require("goog.events.EventHandler");goog.require("goog.functions");goog.require("goog.object");goog.require("goog.string");goog.require("goog.ui.Component");goog.require("goog.ui.ServerChart");goog.require("goog.ui.TableSorter");goog.testing.MultiTestRunner=function(opt_domHelper){goog.ui.Component.call(this,opt_domHelper);this.allTests_=[];this.activeTests_=[];this.eh_=new goog.events.EventHandler(this);this.tableSorter_=new goog.ui.TableSorter(this.dom_);this.failureReports_=[];this.allTestResults_=[]};goog.inherits(goog.testing.MultiTestRunner,goog.ui.Component);goog.testing.MultiTestRunner.DEFAULT_TIMEOUT_MS=1e3*45;goog.testing.MultiTestRunner.STATES=["waiting for test runner","initializing tests","waiting for tests to finish"];goog.testing.MultiTestRunner.TESTS_FINISHED="testsFinished";goog.testing.MultiTestRunner.prototype.name_="";goog.testing.MultiTestRunner.prototype.basePath_="";goog.testing.MultiTestRunner.prototype.finished_=null;goog.testing.MultiTestRunner.prototype.verbosePasses_=!1;goog.testing.MultiTestRunner.prototype.hidePasses_=!1;goog.testing.MultiTestRunner.prototype.stopped_=!1;goog.testing.MultiTestRunner.prototype.active_=!1;goog.testing.MultiTestRunner.prototype.startedCount_=0;goog.testing.MultiTestRunner.prototype.resultCount_=0;goog.testing.MultiTestRunner.prototype.passes_=0;goog.testing.MultiTestRunner.prototype.startTime_=0;goog.testing.MultiTestRunner.prototype.filterFn_=goog.functions.TRUE;goog.testing.MultiTestRunner.prototype.timeoutMs_=goog.testing.MultiTestRunner.DEFAULT_TIMEOUT_MS;goog.testing.MultiTestRunner.prototype.stats_=null;goog.testing.MultiTestRunner.prototype.startButtonEl_=null;goog.testing.MultiTestRunner.prototype.stopButtonEl_=null;goog.testing.MultiTestRunner.prototype.logEl_=null;goog.testing.MultiTestRunner.prototype.reportEl_=null;goog.testing.MultiTestRunner.prototype.statsEl_=null;goog.testing.MultiTestRunner.prototype.progressEl_=null;goog.testing.MultiTestRunner.prototype.progressRow_=null;goog.testing.MultiTestRunner.prototype.logTabEl_=null;goog.testing.MultiTestRunner.prototype.reportTabEl_=null;goog.testing.MultiTestRunner.prototype.statsTabEl_=null;goog.testing.MultiTestRunner.prototype.poolSize_=1;goog.testing.MultiTestRunner.prototype.numFilesStatsBucketSize_=20;goog.testing.MultiTestRunner.prototype.runTimeStatsBucketSize_=500;goog.testing.MultiTestRunner.prototype.setName=function(name){this.name_=name;return this};goog.testing.MultiTestRunner.prototype.getName=function(){return this.name_};goog.testing.MultiTestRunner.prototype.setBasePath=function(path){this.basePath_=path;return this};goog.testing.MultiTestRunner.prototype.getBasePath=function(){return this.basePath_};goog.testing.MultiTestRunner.prototype.setVerbosePasses=function(verbose){this.verbosePasses_=verbose;return this};goog.testing.MultiTestRunner.prototype.getVerbosePasses=function(){return this.verbosePasses_};goog.testing.MultiTestRunner.prototype.setHidePasses=function(hide){this.hidePasses_=hide;return this};goog.testing.MultiTestRunner.prototype.getHidePasses=function(){return this.hidePasses_};goog.testing.MultiTestRunner.prototype.setStatsBucketSizes=function(f,t){this.numFilesStatsBucketSize_=f;this.runTimeStatsBucketSize_=t;return this};goog.testing.MultiTestRunner.prototype.setTimeout=function(timeout){this.timeoutMs_=timeout;return this};goog.testing.MultiTestRunner.prototype.getTimeout=function(){return this.timeoutMs_};goog.testing.MultiTestRunner.prototype.setPoolSize=function(size){this.poolSize_=size;return this};goog.testing.MultiTestRunner.prototype.getPoolSize=function(){return this.poolSize_};goog.testing.MultiTestRunner.prototype.setFilterFunction=function(filterFn){this.filterFn_=filterFn;return this};goog.testing.MultiTestRunner.prototype.getFilterFunction=function(){return this.filterFn_};goog.testing.MultiTestRunner.prototype.addTests=function(tests){goog.array.extend(this.allTests_,tests);return this};goog.testing.MultiTestRunner.prototype.getAllTests=function(){return this.allTests_};goog.testing.MultiTestRunner.prototype.getTestsToRun=function(){return goog.array.filter(this.allTests_,this.filterFn_)};goog.testing.MultiTestRunner.prototype.getTestsThatFailed=function(){var stats=this.stats_,failedTests=[];if(stats){for(var i=0,stat;stat=stats[i];i++){if(!stat.success){failedTests.push(stat.testFile)}}}return failedTests};goog.testing.MultiTestRunner.prototype.getFailureReports=function(){return this.failureReports_};goog.testing.MultiTestRunner.prototype.getAllTestResults=function(){return this.allTestResults_};goog.testing.MultiTestRunner.prototype.resetProgressDom_=function(){goog.dom.removeChildren(this.progressEl_);var progressTable=this.dom_.createDom(goog.dom.TagName.TABLE),progressTBody=this.dom_.createDom(goog.dom.TagName.TBODY);this.progressRow_=this.dom_.createDom(goog.dom.TagName.TR);for(var i=0,progressCell;i<this.activeTests_.length;i++){progressCell=this.dom_.createDom(goog.dom.TagName.TD);this.progressRow_.appendChild(progressCell)}progressTBody.appendChild(this.progressRow_);progressTable.appendChild(progressTBody);this.progressEl_.appendChild(progressTable)};goog.testing.MultiTestRunner.prototype.createDom=function(){goog.testing.MultiTestRunner.superClass_.createDom.call(this);var el=this.getElement();el.className=goog.getCssName("goog-testrunner");this.progressEl_=this.dom_.createDom(goog.dom.TagName.DIV);this.progressEl_.className=goog.getCssName("goog-testrunner-progress");el.appendChild(this.progressEl_);var buttons=this.dom_.createDom(goog.dom.TagName.DIV);buttons.className=goog.getCssName("goog-testrunner-buttons");this.startButtonEl_=this.dom_.createDom(goog.dom.TagName.BUTTON,null,"Start");this.stopButtonEl_=this.dom_.createDom(goog.dom.TagName.BUTTON,{disabled:!0},"Stop");buttons.appendChild(this.startButtonEl_);buttons.appendChild(this.stopButtonEl_);el.appendChild(buttons);this.eh_.listen(this.startButtonEl_,"click",this.onStartClicked_);this.eh_.listen(this.stopButtonEl_,"click",this.onStopClicked_);this.logEl_=this.dom_.createElement(goog.dom.TagName.DIV);this.logEl_.className=goog.getCssName("goog-testrunner-log");el.appendChild(this.logEl_);this.reportEl_=this.dom_.createElement(goog.dom.TagName.DIV);this.reportEl_.className=goog.getCssName("goog-testrunner-report");this.reportEl_.style.display="none";el.appendChild(this.reportEl_);this.statsEl_=this.dom_.createElement(goog.dom.TagName.DIV);this.statsEl_.className=goog.getCssName("goog-testrunner-stats");this.statsEl_.style.display="none";el.appendChild(this.statsEl_);this.logTabEl_=this.dom_.createDom(goog.dom.TagName.DIV,null,"Log");this.logTabEl_.className=goog.getCssName("goog-testrunner-logtab")+" "+goog.getCssName("goog-testrunner-activetab");el.appendChild(this.logTabEl_);this.reportTabEl_=this.dom_.createDom(goog.dom.TagName.DIV,null,"Report");this.reportTabEl_.className=goog.getCssName("goog-testrunner-reporttab");el.appendChild(this.reportTabEl_);this.statsTabEl_=this.dom_.createDom(goog.dom.TagName.DIV,null,"Stats");this.statsTabEl_.className=goog.getCssName("goog-testrunner-statstab");el.appendChild(this.statsTabEl_);this.eh_.listen(this.logTabEl_,"click",this.onLogTabClicked_);this.eh_.listen(this.reportTabEl_,"click",this.onReportTabClicked_);this.eh_.listen(this.statsTabEl_,"click",this.onStatsTabClicked_)};goog.testing.MultiTestRunner.prototype.disposeInternal=function(){goog.testing.MultiTestRunner.superClass_.disposeInternal.call(this);this.tableSorter_.dispose();this.eh_.dispose();this.startButtonEl_=null;this.stopButtonEl_=null;this.logEl_=null;this.reportEl_=null;this.progressEl_=null;this.logTabEl_=null;this.reportTabEl_=null;this.statsTabEl_=null;this.statsEl_=null};goog.testing.MultiTestRunner.prototype.start=function(){this.startButtonEl_.disabled=!0;this.stopButtonEl_.disabled=!1;this.stopped_=!1;this.active_=!0;this.finished_={};this.activeTests_=this.getTestsToRun();this.startedCount_=0;this.resultCount_=0;this.passes_=0;this.stats_=[];this.startTime_=goog.now();this.failureReports_=[];this.resetProgressDom_();goog.dom.removeChildren(this.logEl_);this.resetReport_();this.clearStats_();this.showTab_(0);if(0==this.activeTests_.length){this.finish_();return}while(this.getChildCount()>this.poolSize_){this.removeChildAt(0,!0).dispose()}for(var i=0;i<this.poolSize_;i++){if(i>=this.getChildCount()){var testFrame=new goog.testing.MultiTestRunner.TestFrame(this.basePath_,this.timeoutMs_,this.verbosePasses_,this.dom_);this.addChild(testFrame,!0)}this.runNextTest_(this.getChildAt(i))}};goog.testing.MultiTestRunner.prototype.log=function(msg){if("."!=msg){msg=this.getTimeStamp_()+" : "+msg}this.logEl_.appendChild(this.dom_.createDom(goog.dom.TagName.DIV,null,msg));var top=this.logEl_.scrollTop,height=this.logEl_.scrollHeight-this.logEl_.offsetHeight;if(0==top||top>height-50){this.logEl_.scrollTop=height}};goog.testing.MultiTestRunner.prototype.processResult=function(frame){var success=frame.isSuccess(),report=frame.getReport(),test=frame.getTestFile(),stats=frame.getStats();if(!stats.success){this.failureReports_.push(report)}this.allTestResults_.push(frame.getTestResults());this.stats_.push(stats);this.finished_[test]=!0;var prefix=success?"":"*** FAILURE *** ";this.log(prefix+this.trimFileName_(test)+" : "+(success?"Passed":"Failed"));this.resultCount_++;if(success){this.passes_++}this.drawProgressSegment_(test,success);this.writeCurrentSummary_();if(!(success&&this.hidePasses_)){this.drawTestResult_(test,success,report)}if(!this.stopped_&&this.startedCount_<this.activeTests_.length){this.runNextTest_(frame)}else if(this.resultCount_==this.activeTests_.length){this.finish_()}};goog.testing.MultiTestRunner.prototype.runNextTest_=function(frame){if(this.startedCount_<this.activeTests_.length){var nextTest=this.activeTests_[this.startedCount_++];this.log(this.trimFileName_(nextTest)+" : Loading");frame.runTest(nextTest)}};goog.testing.MultiTestRunner.prototype.finish_=function(){if(this.stopped_){this.log("Stopped")}else{this.log("Finished")}this.startButtonEl_.disabled=!1;this.stopButtonEl_.disabled=!0;this.active_=!1;this.showTab_(1);this.drawStats_();while(0<this.getChildCount()){this.removeChildAt(0,!0).dispose()}for(var unfinished=[],i=0,test;i<this.activeTests_.length;i++){test=this.activeTests_[i];if(!this.finished_[test]){unfinished.push(test)}}if(unfinished.length){this.reportEl_.appendChild(goog.dom.createDom(goog.dom.TagName.PRE,void 0,"These tests did not finish:\n"+unfinished.join("\n")))}this.dispatchEvent({type:goog.testing.MultiTestRunner.TESTS_FINISHED,allTestResults:this.getAllTestResults()})};goog.testing.MultiTestRunner.prototype.resetReport_=function(){goog.dom.removeChildren(this.reportEl_);var summary=this.dom_.createDom(goog.dom.TagName.DIV);summary.className=goog.getCssName("goog-testrunner-progress-summary");this.reportEl_.appendChild(summary);this.writeCurrentSummary_()};goog.testing.MultiTestRunner.prototype.drawStats_=function(){this.drawFilesHistogram_();if(1==this.poolSize_){this.drawRunTimePie_();this.drawTimeHistogram_()}this.drawWorstTestsTable_()};goog.testing.MultiTestRunner.prototype.drawFilesHistogram_=function(){this.drawStatsHistogram_("numFilesLoaded",this.numFilesStatsBucketSize_,goog.functions.identity,500,"Histogram showing distribution of\nnumber of files loaded per test")};goog.testing.MultiTestRunner.prototype.drawTimeHistogram_=function(){this.drawStatsHistogram_("totalTime",this.runTimeStatsBucketSize_,function(x){return x/1e3},500,"Histogram showing distribution of\ntime spent running tests in s")};goog.testing.MultiTestRunner.prototype.drawStatsHistogram_=function(statsField,bucketSize,valueTransformFn,width,title){for(var hist={},data=[],xlabels=[],ylabels=[],max=0,i=0;i<this.stats_.length;i++){var num=this.stats_[i][statsField],bucket=Math.floor(num/bucketSize)*bucketSize;if(bucket>max){max=bucket}if(!hist[bucket]){hist[bucket]=1}else{hist[bucket]++}}for(var maxBucketSize=0,i=0;i<=max;i+=bucketSize){xlabels.push(valueTransformFn(i));var count=hist[i]||0;if(count>maxBucketSize){maxBucketSize=count}data.push(count)}for(var diff=Math.max(1,Math.ceil(maxBucketSize/10)),i=0;i<=maxBucketSize;i+=diff){ylabels.push(i)}var chart=new goog.ui.ServerChart(goog.ui.ServerChart.ChartType.VERTICAL_STACKED_BAR,width,250,null,goog.ui.ServerChart.CHART_SERVER_HTTPS_URI);chart.setTitle(title);chart.addDataSet(data,"ff9900");chart.setLeftLabels(ylabels);chart.setGridY(ylabels.length-1);chart.setXLabels(xlabels);chart.render(this.statsEl_)};goog.testing.MultiTestRunner.prototype.drawRunTimePie_=function(){for(var totalTime=0,runTime=0,i=0,stat;i<this.stats_.length;i++){stat=this.stats_[i];totalTime+=stat.totalTime;runTime+=stat.runTime}var loadTime=totalTime-runTime,pie=new goog.ui.ServerChart(goog.ui.ServerChart.ChartType.PIE,500,250,null,goog.ui.ServerChart.CHART_SERVER_HTTPS_URI);pie.setMinValue(0);pie.setMaxValue(totalTime);pie.addDataSet([runTime,loadTime],"ff9900");pie.setXLabels(["Test execution ("+runTime+"ms)","Loading ("+loadTime+"ms)"]);pie.render(this.statsEl_)};goog.testing.MultiTestRunner.prototype.drawWorstTestsTable_=function(){this.stats_.sort(function(a,b){return b.numFilesLoaded-a.numFilesLoaded});for(var tbody=goog.bind(this.dom_.createDom,this.dom_,"tbody"),thead=goog.bind(this.dom_.createDom,this.dom_,"thead"),tr=goog.bind(this.dom_.createDom,this.dom_,"tr"),th=goog.bind(this.dom_.createDom,this.dom_,"th"),td=goog.bind(this.dom_.createDom,this.dom_,"td"),a=goog.bind(this.dom_.createDom,this.dom_,"a"),head=thead({style:"cursor: pointer"},tr(null,th(null," "),th(null,"Test file"),th("center","Num files loaded"),th("center","Run time (ms)"),th("center","Total time (ms)"))),body=tbody(),table=this.dom_.createDom(goog.dom.TagName.TABLE,null,head,body),i=0,stat;i<this.stats_.length;i++){stat=this.stats_[i];body.appendChild(tr(null,td("center",i+1+""),td(null,a({href:this.basePath_+stat.testFile,target:"_blank"},stat.testFile)),td("center",stat.numFilesLoaded+""),td("center",stat.runTime+""),td("center",stat.totalTime+"")))}this.statsEl_.appendChild(table);this.tableSorter_.setDefaultSortFunction(goog.ui.TableSorter.numericSort);this.tableSorter_.setSortFunction(1,goog.ui.TableSorter.alphaSort);this.tableSorter_.decorate(table)};goog.testing.MultiTestRunner.prototype.clearStats_=function(){goog.dom.removeChildren(this.statsEl_);this.tableSorter_.exitDocument()};goog.testing.MultiTestRunner.prototype.writeCurrentSummary_=function(){var total=this.activeTests_.length,executed=this.resultCount_,passes=this.passes_,duration=Math.round((goog.now()-this.startTime_)/1e3),text=executed+" of "+total+" tests executed.<br>"+passes+" passed, "+(executed-passes)+" failed.<br>"+"Duration: "+duration+"s.";this.reportEl_.firstChild.innerHTML=text};goog.testing.MultiTestRunner.prototype.drawProgressSegment_=function(title,success){var part=this.progressRow_.cells[this.resultCount_-1];part.title=title+" : "+(success?"SUCCESS":"FAILURE");part.style.backgroundColor=success?"#090":"#900"};goog.testing.MultiTestRunner.prototype.drawTestResult_=function(test,success,report){var text=goog.string.isEmptyOrWhitespace(report)?"No report for "+test+"\n":report,el=this.dom_.createDom(goog.dom.TagName.DIV);text=goog.string.htmlEscape(text).replace(/\n/g,"<br>");if(success){el.className=goog.getCssName("goog-testrunner-report-success")}else{text+="<a href=\""+this.basePath_+test+"\">Run individually &raquo;</a><br>&nbsp;";el.className=goog.getCssName("goog-testrunner-report-failure")}el.innerHTML=text;this.reportEl_.appendChild(el)};goog.testing.MultiTestRunner.prototype.getTimeStamp_=function(){var d=new Date;return goog.string.padNumber(d.getHours(),2)+":"+goog.string.padNumber(d.getMinutes(),2)+":"+goog.string.padNumber(d.getSeconds(),2)};goog.testing.MultiTestRunner.prototype.trimFileName_=function(name){if(35>name.length){return name}var parts=name.split("/"),result="";while(35>result.length&&0<parts.length){result="/"+parts.pop()+result}return"..."+result};goog.testing.MultiTestRunner.prototype.showTab_=function(tab){var activeTabCssClass=goog.getCssName("goog-testrunner-activetab"),logTabElement=goog.asserts.assert(this.logTabEl_),reportTabElement=goog.asserts.assert(this.reportTabEl_),statsTabElement=goog.asserts.assert(this.statsTabEl_);if(0==tab){this.logEl_.style.display="";goog.dom.classlist.add(logTabElement,activeTabCssClass)}else{this.logEl_.style.display="none";goog.dom.classlist.remove(logTabElement,activeTabCssClass)}if(1==tab){this.reportEl_.style.display="";goog.dom.classlist.add(reportTabElement,activeTabCssClass)}else{this.reportEl_.style.display="none";goog.dom.classlist.remove(reportTabElement,activeTabCssClass)}if(2==tab){this.statsEl_.style.display="";goog.dom.classlist.add(statsTabElement,activeTabCssClass)}else{this.statsEl_.style.display="none";goog.dom.classlist.remove(statsTabElement,activeTabCssClass)}};goog.testing.MultiTestRunner.prototype.onStartClicked_=function(e){this.start()};goog.testing.MultiTestRunner.prototype.onStopClicked_=function(e){this.stopped_=!0;this.finish_()};goog.testing.MultiTestRunner.prototype.onLogTabClicked_=function(e){this.showTab_(0)};goog.testing.MultiTestRunner.prototype.onReportTabClicked_=function(e){this.showTab_(1)};goog.testing.MultiTestRunner.prototype.onStatsTabClicked_=function(e){this.showTab_(2)};goog.testing.MultiTestRunner.TestFrame=function(basePath,timeoutMs,verbosePasses,opt_domHelper){goog.ui.Component.call(this,opt_domHelper);this.basePath_=basePath;this.timeoutMs_=timeoutMs;this.verbosePasses_=verbosePasses;this.eh_=new goog.events.EventHandler(this);this.testResults_={}};goog.inherits(goog.testing.MultiTestRunner.TestFrame,goog.ui.Component);goog.testing.MultiTestRunner.TestFrame.prototype.iframeEl_=null;goog.testing.MultiTestRunner.TestFrame.prototype.iframeLoaded_=!1;goog.testing.MultiTestRunner.TestFrame.prototype.testFile_="";goog.testing.MultiTestRunner.TestFrame.prototype.report_="";goog.testing.MultiTestRunner.TestFrame.prototype.totalTime_=0;goog.testing.MultiTestRunner.TestFrame.prototype.runTime_=0;goog.testing.MultiTestRunner.TestFrame.prototype.numFilesLoaded_=0;goog.testing.MultiTestRunner.TestFrame.prototype.isSuccess_=null;goog.testing.MultiTestRunner.TestFrame.prototype.startTime_=0;goog.testing.MultiTestRunner.TestFrame.prototype.lastStateTime_=0;goog.testing.MultiTestRunner.TestFrame.prototype.currentState_=0;goog.testing.MultiTestRunner.TestFrame.prototype.disposeInternal=function(){goog.testing.MultiTestRunner.TestFrame.superClass_.disposeInternal.call(this);this.dom_.removeNode(this.iframeEl_);this.eh_.dispose();this.iframeEl_=null};goog.testing.MultiTestRunner.TestFrame.prototype.runTest=function(testFile){this.lastStateTime_=this.startTime_=goog.now();if(!this.iframeEl_){this.createIframe_()}this.iframeLoaded_=!1;this.currentState_=0;this.isSuccess_=null;this.report_="";this.testResults_={};this.testFile_=testFile;try{this.iframeEl_.src=this.basePath_+testFile}catch(e){this.report_=this.testFile_+" failed to load : "+e.message;this.isSuccess_=!1;this.finish_();return}this.checkForCompletion_()};goog.testing.MultiTestRunner.TestFrame.prototype.getTestFile=function(){return this.testFile_};goog.testing.MultiTestRunner.TestFrame.prototype.getStats=function(){return{testFile:this.testFile_,success:this.isSuccess_,runTime:this.runTime_,totalTime:this.totalTime_,numFilesLoaded:this.numFilesLoaded_}};goog.testing.MultiTestRunner.TestFrame.prototype.getReport=function(){return this.report_};goog.testing.MultiTestRunner.TestFrame.prototype.getTestResults=function(){var results={};for(var testName in this.testResults_){var testKey=this.testFile_.replace(/\.html$/,"");if(testName!=this.testFile_){testKey+=":"+testName}results[testKey]=this.testResults_[testName]}return results};goog.testing.MultiTestRunner.TestFrame.prototype.isSuccess=function(){return this.isSuccess_};goog.testing.MultiTestRunner.TestFrame.prototype.finish_=function(){this.totalTime_=goog.now()-this.startTime_;if(this.getParent()&&this.getParent().processResult){this.getParent().processResult(this)}};goog.testing.MultiTestRunner.TestFrame.prototype.createIframe_=function(){this.iframeEl_=this.dom_.createDom(goog.dom.TagName.IFRAME);this.getElement().appendChild(this.iframeEl_);this.eh_.listen(this.iframeEl_,"load",this.onIframeLoaded_)};goog.testing.MultiTestRunner.TestFrame.prototype.onIframeLoaded_=function(e){this.iframeLoaded_=!0};goog.testing.MultiTestRunner.TestFrame.prototype.checkForCompletion_=function(){var js=goog.dom.getFrameContentWindow(this.iframeEl_);switch(this.currentState_){case 0:if(this.iframeLoaded_&&js.G_testRunner){this.lastStateTime_=goog.now();this.currentState_++}break;case 1:if(js.G_testRunner.isInitialized()){this.lastStateTime_=goog.now();this.currentState_++}break;case 2:if(js.G_testRunner.isFinished()){var tr=js.G_testRunner;this.isSuccess_=tr.isSuccess();this.report_=tr.getReport(this.verbosePasses_);this.testResults_=tr.getTestResults();if(goog.object.isEmpty(this.testResults_)){this.testResults_[this.testFile_]=this.isSuccess_?[]:[this.report_]}this.runTime_=tr.getRunTime();this.numFilesLoaded_=tr.getNumFilesLoaded();this.finish_();return}}if(goog.now()-this.lastStateTime_>this.timeoutMs_){this.report_=this.testFile_+" timed out  "+goog.testing.MultiTestRunner.STATES[this.currentState_];this.testResults_[this.testFile_]=[this.report_];this.isSuccess_=!1;this.finish_();return}goog.Timer.callOnce(this.checkForCompletion_,100,this)};