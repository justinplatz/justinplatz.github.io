goog.provide("goog.positioning.AnchoredViewportPositionTest");goog.setTestOnly("goog.positioning.AnchoredViewportPositionTest");goog.require("goog.dom");goog.require("goog.math.Box");goog.require("goog.positioning.AnchoredViewportPosition");goog.require("goog.positioning.Corner");goog.require("goog.positioning.OverflowStatus");goog.require("goog.style");goog.require("goog.testing.jsunit");var frame,doc,dom,viewportSize,anchor,popup,corner=goog.positioning.Corner;function setUp(){frame=document.getElementById("frame1");doc=goog.dom.getFrameContentDocument(frame);dom=goog.dom.getDomHelper(doc);viewportSize=dom.getViewportSize();anchor=dom.getElement("anchor");popup=dom.getElement("popup");goog.style.setSize(popup,20,20)}function testRepositionBottom(){var avp=new goog.positioning.AnchoredViewportPosition(anchor,corner.BOTTOM_LEFT,!1);goog.style.setSize(anchor,100,100);goog.style.setPosition(anchor,0,0);assertTrue(viewportSize.height>=100+20);avp.reposition(popup,corner.TOP_LEFT);var anchorRect=goog.style.getBounds(anchor);assertEquals(anchorRect.top+anchorRect.height,goog.style.getPageOffset(popup).y)}function testRepositionTop(){var avp=new goog.positioning.AnchoredViewportPosition(anchor,corner.BOTTOM_LEFT,!1),newTop=viewportSize.height-100;goog.style.setSize(anchor,100,100);goog.style.setPosition(anchor,50,newTop);assertTrue(20<=newTop);avp.reposition(popup,corner.TOP_LEFT);anchorRect=goog.style.getBounds(anchor);var popupRect=goog.style.getBounds(popup);assertEquals(anchorRect.top,popupRect.top+popupRect.height)}function testRepositionBottomRight(){var avp=new goog.positioning.AnchoredViewportPosition(anchor,corner.BOTTOM_RIGHT,!1);goog.style.setSize(anchor,100,100);goog.style.setPosition(anchor,viewportSize.width-110,viewportSize.height-110);avp.reposition(popup,corner.TOP_LEFT);anchorRect=goog.style.getBounds(anchor);var popupRect=goog.style.getBounds(popup);assertEquals(anchorRect.top,popupRect.top+popupRect.height);assertEquals(anchorRect.left,popupRect.left+popupRect.width)}function testRepositionNoSpaceWithoutAdjustment(){var avp=new goog.positioning.AnchoredViewportPosition(anchor,corner.BOTTOM_LEFT,!1);goog.style.setPosition(anchor,50,10);goog.style.setSize(anchor,100,viewportSize.height-20);avp.reposition(popup,corner.TOP_LEFT);anchorRect=goog.style.getBounds(anchor);popupRect=goog.style.getBounds(popup);assertEquals(anchorRect.top+anchorRect.height,popupRect.top);assertTrue(popupRect.top+popupRect.height>viewportSize.height)}function testRepositionNoSpaceWithAdjustment(){var avp=new goog.positioning.AnchoredViewportPosition(anchor,corner.BOTTOM_LEFT,!0);goog.style.setPosition(anchor,50,10);goog.style.setSize(anchor,100,viewportSize.height-20);avp.reposition(popup,corner.TOP_LEFT);anchorRect=goog.style.getBounds(anchor);popupRect=goog.style.getBounds(popup);assertTrue(anchorRect.top+anchorRect.height>popupRect.top);assertEquals(viewportSize.height,popupRect.top+popupRect.height)}function testAdjustCorner(){var avp=new goog.positioning.AnchoredViewportPosition(anchor,corner.BOTTOM_LEFT);assertEquals(corner.BOTTOM_LEFT,avp.adjustCorner(0,corner.BOTTOM_LEFT));assertEquals(corner.BOTTOM_RIGHT,avp.adjustCorner(goog.positioning.OverflowStatus.FAILED_HORIZONTAL,corner.BOTTOM_LEFT));assertEquals(corner.TOP_LEFT,avp.adjustCorner(goog.positioning.OverflowStatus.FAILED_VERTICAL,corner.BOTTOM_LEFT));assertEquals(corner.TOP_RIGHT,avp.adjustCorner(goog.positioning.OverflowStatus.FAILED_VERTICAL|goog.positioning.OverflowStatus.FAILED_HORIZONTAL,corner.BOTTOM_LEFT))}function testOverflowConstraint(){var tinyBox=new goog.math.Box(0,0,0,0),avp=new goog.positioning.AnchoredViewportPosition(anchor,corner.BOTTOM_LEFT,!1,tinyBox);assertEquals(tinyBox,avp.getOverflowConstraint());goog.style.setSize(anchor,50,50);goog.style.setPosition(anchor,80,80);avp.reposition(popup,corner.TOP_LEFT);anchorRect=goog.style.getBounds(anchor);popupRect=goog.style.getBounds(popup);assertEquals(anchorRect.left,popupRect.left);assertEquals(anchorRect.top+anchorRect.height,popupRect.top)}function testChangeOverflowConstraint(){var tinyBox=new goog.math.Box(0,0,0,0),avp=new goog.positioning.AnchoredViewportPosition(anchor,corner.BOTTOM_LEFT,!1,tinyBox);assertEquals(tinyBox,avp.getOverflowConstraint());goog.style.setSize(anchor,50,50);goog.style.setPosition(anchor,80,80);avp.reposition(popup,corner.TOP_LEFT);popupRect=goog.style.getBounds(popup);assertNotEquals(60,popupRect.top);var movedBox=new goog.math.Box(60,100,100,60);avp.setOverflowConstraint(movedBox);assertEquals(movedBox,avp.getOverflowConstraint());avp.reposition(popup,corner.TOP_LEFT);popupRect=goog.style.getBounds(popup);assertEquals(80,popupRect.left);assertEquals(60,popupRect.top)}