goog.provide("goog.net.XhrManagerTest");goog.setTestOnly("goog.net.XhrManagerTest");goog.require("goog.events");goog.require("goog.net.EventType");goog.require("goog.net.XhrIo");goog.require("goog.net.XhrManager");goog.require("goog.testing.jsunit");goog.require("goog.testing.net.XhrIoPool");goog.require("goog.testing.recordFunction");var xhrManager,xhrIo;function setUp(){xhrManager=new goog.net.XhrManager;xhrManager.xhrPool_=new goog.testing.net.XhrIoPool;xhrIo=xhrManager.xhrPool_.getXhr()}function tearDown(){goog.dispose(xhrManager)}function testGetOutstandingRequestIds(){assertArrayEquals("No outstanding requests",[],xhrManager.getOutstandingRequestIds());xhrManager.send("test1","/test1");assertArrayEquals("Single outstanding request",["test1"],xhrManager.getOutstandingRequestIds());xhrManager.send("test2","/test2");assertArrayEquals("Two outstanding requests",["test1","test2"],xhrManager.getOutstandingRequestIds());xhrIo.simulateResponse(200,"data");assertArrayEquals("Single outstanding request",["test2"],xhrManager.getOutstandingRequestIds());xhrIo.simulateResponse(200,"data");assertArrayEquals("No outstanding requests",[],xhrManager.getOutstandingRequestIds())}function testForceAbortQueuedRequest(){xhrManager.send("test","/test");xhrManager.send("queued","/queued");assertNotThrows("Forced abort of queued request should not throw an error",goog.bind(xhrManager.abort,xhrManager,"queued",!0));assertNotThrows("Forced abort of normal request should not throw an error",goog.bind(xhrManager.abort,xhrManager,"test",!0))}function testDefaultResponseType(){var callback=goog.testing.recordFunction(function(e){assertEquals("test1",e.id);assertEquals(goog.net.XhrIo.ResponseType.DEFAULT,e.xhrIo.getResponseType());eventCalled=!0});goog.events.listenOnce(xhrManager,goog.net.EventType.READY,callback);xhrManager.send("test1","/test2");assertEquals(1,callback.getCallCount());xhrIo.simulateResponse(200,"data")}function testNonDefaultResponseType(){var callback=goog.testing.recordFunction(function(e){assertEquals("test2",e.id);assertEquals(goog.net.XhrIo.ResponseType.ARRAY_BUFFER,e.xhrIo.getResponseType());eventCalled=!0});goog.events.listenOnce(xhrManager,goog.net.EventType.READY,callback);xhrManager.send("test2","/test2",void 0,void 0,void 0,void 0,void 0,void 0,goog.net.XhrIo.ResponseType.ARRAY_BUFFER);assertEquals(1,callback.getCallCount());xhrIo.simulateResponse(200,"data")}