goog.provide("goog.async.ConditionalDelayTest");goog.setTestOnly("goog.async.ConditionalDelayTest");goog.require("goog.async.ConditionalDelay");goog.require("goog.testing.MockClock");goog.require("goog.testing.jsunit");var invoked=!1,delay=null,clock=null,returnValue=!0,onSuccessCalled=!1,onFailureCalled=!1;function callback(){invoked=!0;return returnValue}function setUp(){clock=new goog.testing.MockClock(!0);invoked=!1;returnValue=!0;onSuccessCalled=!1;onFailureCalled=!1;delay=new goog.async.ConditionalDelay(callback);delay.onSuccess=function(){onSuccessCalled=!0};delay.onFailure=function(){onFailureCalled=!0}}function tearDown(){clock.dispose();delay.dispose()}function testDelay(){delay.start(200,200);assertFalse(invoked);clock.tick(100);assertFalse(invoked);clock.tick(100);assertTrue(invoked)}function testStop(){delay.start(200,500);assertTrue(delay.isActive());clock.tick(100);assertFalse(invoked);delay.stop();clock.tick(100);assertFalse(invoked);assertFalse(delay.isActive())}function testIsActive(){assertFalse(delay.isActive());delay.start(200,200);assertTrue(delay.isActive());clock.tick(200);assertFalse(delay.isActive())}function testRestart(){delay.start(200,5e4);clock.tick(100);delay.stop();assertFalse(invoked);delay.start(200,5e4);clock.tick(199);assertFalse(invoked);clock.tick(1);assertTrue(invoked);invoked=!1;delay.start(200,200);clock.tick(200);assertTrue(invoked);assertFalse(delay.isActive())}function testDispose(){delay.start(200,200);delay.dispose();assertTrue(delay.isDisposed());clock.tick(500);assertFalse(invoked)}function testConditionalDelay_Success(){returnValue=!1;delay.start(100,300);clock.tick(99);assertFalse(invoked);clock.tick(1);assertTrue(invoked);assertTrue(delay.isActive());assertFalse(delay.isDone());assertFalse(onSuccessCalled);assertFalse(onFailureCalled);returnValue=!0;invoked=!1;clock.tick(100);assertTrue(invoked);assertFalse(delay.isActive());assertTrue(delay.isDone());assertTrue(onSuccessCalled);assertFalse(onFailureCalled);invoked=!1;clock.tick(200);assertFalse(invoked)}function testConditionalDelay_Failure(){returnValue=!1;delay.start(100,300);clock.tick(99);assertFalse(invoked);clock.tick(1);assertTrue(invoked);assertTrue(delay.isActive());assertFalse(delay.isDone());assertFalse(onSuccessCalled);assertFalse(onFailureCalled);invoked=!1;clock.tick(100);assertTrue(invoked);assertFalse(onSuccessCalled);assertFalse(onFailureCalled);invoked=!1;clock.tick(90);assertFalse(invoked);clock.tick(10);assertTrue(invoked);assertFalse(delay.isActive());assertFalse(delay.isDone());assertFalse(onSuccessCalled);assertTrue(onFailureCalled)}function testInfiniteDelay(){returnValue=!1;delay.start(100,-1);for(var i=0;1e3>i;++i){clock.tick(80);assertTrue(delay.isActive());assertFalse(delay.isDone());assertFalse(onSuccessCalled);assertFalse(onFailureCalled)}delay.stop();assertFalse(delay.isActive());assertFalse(delay.isDone());assertFalse(onSuccessCalled);assertFalse(onFailureCalled)}function testCallbackScope(){var callbackCalled=!1,scopeObject={};function internalCallback(){assertEquals(this,scopeObject);callbackCalled=!0;return!0}delay=new goog.async.ConditionalDelay(internalCallback,scopeObject);delay.start(200,200);clock.tick(201);assertTrue(callbackCalled)}