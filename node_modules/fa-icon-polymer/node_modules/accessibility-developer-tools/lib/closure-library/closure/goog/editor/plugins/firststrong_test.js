goog.provide("goog.editor.plugins.FirstStrongTest");goog.setTestOnly("goog.editor.plugins.FirstStrongTest");goog.require("goog.dom.Range");goog.require("goog.editor.Command");goog.require("goog.editor.Field");goog.require("goog.editor.plugins.FirstStrong");goog.require("goog.editor.range");goog.require("goog.events.KeyCodes");goog.require("goog.testing.MockClock");goog.require("goog.testing.editor.TestHelper");goog.require("goog.testing.events");goog.require("goog.testing.jsunit");goog.require("goog.userAgent");var ALEPH_KEYCODE=1488,field,fieldElement,dom,helper,triggeredCommand=null,clock;function setUp(){field=new goog.editor.Field("field");field.registerPlugin(new goog.editor.plugins.FirstStrong);field.makeEditable();fieldElement=field.getElement();helper=new goog.testing.editor.TestHelper(fieldElement);dom=field.getEditableDomHelper();field.execCommand=function(command){if(command==goog.editor.Command.DIR_LTR||command==goog.editor.Command.DIR_RTL)triggeredCommand=command}}function tearDown(){goog.dispose(field);goog.dispose(helper);triggeredCommand=null;goog.dispose(clock)}function testFirstCharacter_RTL(){field.setHtml(!1,"<div id=\"text\">&nbsp;</div>");field.focusAndPlaceCursorAtStart();goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);assertRTL()}function testFirstCharacter_LTR(){field.setHtml(!1,"<div dir=\"rtl\" id=\"text\">&nbsp;</div>");field.focusAndPlaceCursorAtStart();goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.A);assertLTR()}function testFirstStrongCharacter_RTL(){field.setHtml(!1,"<div id=\"text\">123.7 3121, <b><++{}></b> - $45</div>");field.focusAndPlaceCursorAtStart();goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);assertRTL()}function testFirstStrongCharacter_LTR(){field.setHtml(!1,"<div dir=\"rtl\" id=\"text\">123.7 3121, <b><++{}></b> - $45</div>");field.focusAndPlaceCursorAtStart();goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.A);assertLTR()}function testNotStrongCharacter_RTL(){field.setHtml(!1,"<div id=\"text\">123.7 3121, - $45</div>");field.focusAndPlaceCursorAtStart();goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.NINE);assertNoCommand()}function testNotStrongCharacter_LTR(){field.setHtml(!1,"<div dir=\"rtl\" id=\"text\">123.7 3121 $45</div>");field.focusAndPlaceCursorAtStart();goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.NINE);assertNoCommand()}function testNotFirstStrongCharacter_RTL(){field.setHtml(!1,"<div id=\"text\">123.7 3121, <b>English</b> - $45</div>");field.focusAndPlaceCursorAtStart();goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);assertNoCommand()}function testNotFirstStrongCharacter_LTR(){field.setHtml(!1,"<div dir=\"rtl\" id=\"text\">123.7 3121, <b>\u05E2\u05D1\u05E8\u05D9\u05EA</b> - $45</div>");field.focusAndPlaceCursorAtStart();goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.A);assertNoCommand()}function testFirstStrongCharacterWithInnerDiv_RTL(){field.setHtml(!1,"<div id=\"text\">123.7 3121, <b id=\"b\"><++{}></b>"+"<div id=\"inner\">English</div>"+"</div>");field.focusAndPlaceCursorAtStart();goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);assertRTL()}function testFirstStrongCharacterWithInnerDiv_LTR(){field.setHtml(!1,"<div dir=\"rtl\" id=\"text\">123.7 3121, <b id=\"b\"><++{}></b>"+"<div id=\"inner\">English</div>"+"</div>");field.focusAndPlaceCursorAtStart();goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.A);assertLTR()}function testFirstStrongCharacterInNewLine_RTL(){field.setHtml(!1,"<div><b id=\"cur\">English<br>1</b></div>");goog.dom.Range.createCaret(dom.$("cur"),2).select();goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);if(goog.userAgent.GECKO){assertRTL()}else{assertNoCommand()}}function testFirstStrongCharacterInParagraph_RTL(){field.setHtml(!1,"<div id=\"text1\">1&gt; English</div>"+"<div id=\"text2\">2&gt;</div>"+"<div id=\"text3\">3&gt;</div>");goog.dom.Range.createCaret(dom.$("text2"),0).select();goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);assertRTL()}function testFirstStrongCharacterInParagraph_LTR(){field.setHtml(!1,"<div dir=\"rtl\" id=\"text1\">1&gt; \u05E2\u05D1\u05E8\u05D9\u05EA</div>"+"<div dir=\"rtl\" id=\"text2\">2&gt;</div>"+"<div dir=\"rtl\" id=\"text3\">3&gt;</div>");goog.dom.Range.createCaret(dom.$("text2"),0).select();goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.A);assertLTR()}function testFirstStrongCharacterInList_RTL(){field.setHtml(!1,"<div id=\"text1\">1&gt; English</div>"+"<ul id=\"list\">"+"<li>10&gt;</li>"+"<li id=\"li2\"></li>"+"<li>30</li>"+"</ul>"+"<div id=\"text3\">3&gt;</div>");goog.editor.range.placeCursorNextTo(dom.$("li2"),!0);goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);assertRTL()}function testFirstStrongCharacterInList_LTR(){field.setHtml(!1,"<div dir=\"rtl\" id=\"text1\">1&gt; English</div>"+"<ul dir=\"rtl\" id=\"list\">"+"<li>10&gt;</li>"+"<li id=\"li2\"></li>"+"<li>30</li>"+"</ul>"+"<div dir=\"rtl\" id=\"text3\">3&gt;</div>");goog.editor.range.placeCursorNextTo(dom.$("li2"),!0);goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.A);assertLTR()}function testNotFirstStrongCharacterInList_RTL(){field.setHtml(!1,"<div id=\"text1\">1</div>"+"<ul id=\"list\">"+"<li>10&gt;</li>"+"<li id=\"li2\"></li>"+"<li>30<b>3<i>Hidden English</i>32</b></li>"+"</ul>"+"<div id=\"text3\">3&gt;</div>");goog.editor.range.placeCursorNextTo(dom.$("li2"),!0);goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);assertNoCommand()}function testNotFirstStrongCharacterInList_LTR(){field.setHtml(!1,"<div dir=\"rtl\" id=\"text1\">1&gt; English</div>"+"<ul dir=\"rtl\" id=\"list\">"+"<li>10&gt;</li>"+"<li id=\"li2\"></li>"+"<li>30<b>3<i>\u05E2\u05D1\u05E8\u05D9\u05EA \u05E1\u05DE\u05D5\u05D9\u05D4</i>32</b></li>"+"</ul>"+"<div dir=\"rtl\" id=\"text3\">3&gt;</div>");goog.editor.range.placeCursorNextTo(dom.$("li2"),!0);goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.A);assertNoCommand()}function testFirstStrongCharacterWithBR_RTL(){field.setHtml(!1,"<div id=\"container\">"+"<div id=\"text1\">ABC</div>"+"<div id=\"text2\">"+"1<br>"+"2<b id=\"inner\">3</b><i>4<u>5<br>"+"6</u>7</i>8</b>9<br>"+"10"+"</div>"+"<div id=\"text3\">11</div>"+"</div>");goog.editor.range.placeCursorNextTo(dom.$("inner"),!0);goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);assertRTL()}function testFirstStrongCharacterWithBR_LTR(){field.setHtml(!1,"<div dir=\"rtl\" id=\"container\">"+"<div dir=\"rtl\" id=\"text1\">\u05D0\u05D1\u05D2</div>"+"<div dir=\"rtl\" id=\"text2\">"+"1<br>"+"2<b id=\"inner\">3</b><i>4<u>5<br>"+"6</u>7</i>8</b>9<br>"+"10"+"</div>"+"<div dir=\"rtl\" id=\"text3\">11</div>"+"</div>");goog.editor.range.placeCursorNextTo(dom.$("inner"),!0);goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.A);assertLTR()}function testNotFirstStrongCharacterInBR_RTL(){field.setHtml(!1,"<div id=\"container\">"+"<div id=\"text1\">ABC</div>"+"<div id=\"text2\">"+"1<br>"+"2<b id=\"inner\">3</b><i><em>4G</em><u>5<br>"+"6</u>7</i>8</b>9<br>"+"10"+"</div>"+"<div id=\"text3\">11</div>"+"</div>");goog.editor.range.placeCursorNextTo(dom.$("inner"),!0);goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);assertNoCommand()}function testNotFirstStrongCharacterInBR_LTR(){field.setHtml(!1,"<div dir=\"rtl\" id=\"container\">"+"<div dir=\"rtl\" id=\"text1\">ABC</div>"+"<div dir=\"rtl\" id=\"text2\">"+"1<br>"+"2<b id=\"inner\">3</b><i><em>4G</em><u>5<br>"+"6</u>7</i>8</b>9<br>"+"10"+"</div>"+"<div dir=\"rtl\" id=\"text3\">11</div>"+"</div>");goog.editor.range.placeCursorNextTo(dom.$("inner"),!0);goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.A);assertNoCommand()}function testFirstStrongCharacterWithPreviousBlockSibling_RTL(){field.setHtml(!1,"<div>Te<div>xt</div>1<b id=\"cur\">2</b>3</div>");goog.editor.range.placeCursorNextTo(dom.$("cur"),!0);goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);assertRTL()}function testFirstStrongCharacterWithPreviousBlockSibling_LTR(){field.setHtml(!1,"<div dir=\"rtl\">\u05D8\u05E7<div>\u05E1\u05D8</div>1<b id=\"cur\">2</b>3</div>");goog.editor.range.placeCursorNextTo(dom.$("cur"),!0);goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.A);assertLTR()}function testFirstStrongCharacterWithFollowingBlockSibling_RTL(){field.setHtml(!1,"<div>1<b id=\"cur\">2</b>3<div>Te</div>xt</div>");goog.editor.range.placeCursorNextTo(dom.$("cur"),!0);goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);assertRTL()}function testFirstStrongCharacterWithFollowingBlockSibling_RTL(){field.setHtml(!1,"<div dir=\"rtl\">1<b id=\"cur\">2</b>3<div>\u05D0</div>\u05D1</div>");goog.editor.range.placeCursorNextTo(dom.$("cur"),!0);goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.A);assertLTR()}function testFirstStrongCharacterFromIME_RTL(){field.setHtml(!1,"<div id=\"text\">123.7 3121, </div>");field.focusAndPlaceCursorAtStart();var attributes={};attributes[goog.editor.plugins.FirstStrong.INPUT_ATTRIBUTE]="\u05D0\u05D1\u05D2";goog.testing.events.fireNonAsciiKeySequence(fieldElement,0,0,attributes);if(goog.userAgent.IE){assertNoCommand()}else{assertRTL()}}function testFirstCharacterFromIME_LTR(){field.setHtml(!1,"<div dir=\"rtl\" id=\"text\"> 1234 </div>");field.focusAndPlaceCursorAtStart();var attributes={};attributes[goog.editor.plugins.FirstStrong.INPUT_ATTRIBUTE]="ABC";goog.testing.events.fireNonAsciiKeySequence(fieldElement,0,0,attributes);if(goog.userAgent.IE){assertNoCommand()}else{assertLTR()}}function testLTRShortlyAfterRTLAndEnter(){clock=new goog.testing.MockClock;field.focusAndPlaceCursorAtStart();goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);assertRTL();clock.tick(1e3);goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.ENTER);assertRTL();goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.A);assertLTR();clock.tick(1e3);goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);assertLTR()}function testRTLShortlyAfterLTRAndEnter(){clock=new goog.testing.MockClock;field.focusAndPlaceCursorAtStart();goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.A);assertLTR();clock.tick(1e3);goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.ENTER);assertLTR();goog.testing.events.fireNonAsciiKeySequence(fieldElement,goog.events.KeyCodes.T,ALEPH_KEYCODE);assertRTL();clock.tick(1e3);goog.testing.events.fireKeySequence(fieldElement,goog.events.KeyCodes.A);assertRTL()}function assertRTL(){assertEquals(goog.editor.Command.DIR_RTL,triggeredCommand)}function assertLTR(){assertEquals(goog.editor.Command.DIR_LTR,triggeredCommand)}function assertNoCommand(){assertNull(triggeredCommand)}