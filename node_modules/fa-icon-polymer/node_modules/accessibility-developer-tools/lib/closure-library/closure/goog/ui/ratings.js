goog.provide("goog.ui.Ratings");goog.provide("goog.ui.Ratings.EventType");goog.require("goog.a11y.aria");goog.require("goog.a11y.aria.Role");goog.require("goog.a11y.aria.State");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.dom.classlist");goog.require("goog.events.EventType");goog.require("goog.ui.Component");goog.ui.Ratings=function(opt_ratings,opt_domHelper){goog.ui.Component.call(this,opt_domHelper);this.ratings_=opt_ratings||["1","2","3","4","5"];this.stars_=[];this.isEnabled_=!0;this.highlightedIndex_=-1;this.selectedIndex_=-1;this.attachedFormField_=null};goog.inherits(goog.ui.Ratings,goog.ui.Component);goog.tagUnsealableClass(goog.ui.Ratings);goog.ui.Ratings.CSS_CLASS=goog.getCssName("goog-ratings");goog.ui.Ratings.EventType={CHANGE:"change",HIGHLIGHT_CHANGE:"highlightchange",HIGHLIGHT:"highlight",UNHIGHLIGHT:"unhighlight"};goog.ui.Ratings.prototype.decorateInternal=function(el){var select=goog.dom.getElementsByTagName(goog.dom.TagName.SELECT,goog.asserts.assert(el))[0];if(!select){throw Error("Can not decorate "+el+", with Ratings. Must "+"contain select box")}this.ratings_.length=0;for(var i=0,n=select.options.length,option;i<n;i++){option=select.options[i];this.ratings_.push(option.text)}this.setSelectedIndex(select.selectedIndex);select.style.display="none";this.attachedFormField_=select;this.createDom();el.insertBefore(this.getElement(),select)};goog.ui.Ratings.prototype.enterDocument=function(){var el=this.getElement();goog.asserts.assert(el,"The DOM element for ratings cannot be null.");goog.ui.Ratings.base(this,"enterDocument");el.tabIndex=0;goog.dom.classlist.add(el,this.getCssClass());goog.a11y.aria.setRole(el,goog.a11y.aria.Role.SLIDER);goog.a11y.aria.setState(el,goog.a11y.aria.State.VALUEMIN,0);var max=this.ratings_.length-1;goog.a11y.aria.setState(el,goog.a11y.aria.State.VALUEMAX,max);var handler=this.getHandler();handler.listen(el,"keydown",this.onKeyDown_);for(var i=0,star;i<this.ratings_.length;i++){star=this.getDomHelper().createDom(goog.dom.TagName.SPAN,{title:this.ratings_[i],class:this.getClassName_(i,!1),index:i});this.stars_.push(star);el.appendChild(star)}handler.listen(el,goog.events.EventType.CLICK,this.onClick_);handler.listen(el,goog.events.EventType.MOUSEOUT,this.onMouseOut_);handler.listen(el,goog.events.EventType.MOUSEOVER,this.onMouseOver_);this.highlightIndex_(this.selectedIndex_)};goog.ui.Ratings.prototype.exitDocument=function(){goog.ui.Ratings.superClass_.exitDocument.call(this);for(var i=0;i<this.stars_.length;i++){this.getDomHelper().removeNode(this.stars_[i])}this.stars_.length=0};goog.ui.Ratings.prototype.disposeInternal=function(){goog.ui.Ratings.superClass_.disposeInternal.call(this);this.ratings_.length=0};goog.ui.Ratings.prototype.getCssClass=function(){return goog.ui.Ratings.CSS_CLASS};goog.ui.Ratings.prototype.setSelectedIndex=function(index){index=Math.max(-1,Math.min(index,this.ratings_.length-1));if(index!=this.selectedIndex_){this.selectedIndex_=index;this.highlightIndex_(this.selectedIndex_);if(this.attachedFormField_){if(this.attachedFormField_.tagName==goog.dom.TagName.SELECT){this.attachedFormField_.selectedIndex=index}else{this.attachedFormField_.value=this.getValue()}var ratingsElement=this.getElement();goog.asserts.assert(ratingsElement,"The DOM ratings element cannot be null.");goog.a11y.aria.setState(ratingsElement,goog.a11y.aria.State.VALUENOW,this.ratings_[index])}this.dispatchEvent(goog.ui.Ratings.EventType.CHANGE)}};goog.ui.Ratings.prototype.getSelectedIndex=function(){return this.selectedIndex_};goog.ui.Ratings.prototype.getValue=function(){return-1==this.selectedIndex_?null:this.ratings_[this.selectedIndex_]};goog.ui.Ratings.prototype.getHighlightedIndex=function(){return this.highlightedIndex_};goog.ui.Ratings.prototype.getHighlightedValue=function(){return-1==this.highlightedIndex_?null:this.ratings_[this.highlightedIndex_]};goog.ui.Ratings.prototype.setRatings=function(ratings){this.ratings_=ratings};goog.ui.Ratings.prototype.getRatings=function(){return this.ratings_};goog.ui.Ratings.prototype.setAttachedFormField=function(field){this.attachedFormField_=field};goog.ui.Ratings.prototype.getAttachedFormField=function(){return this.attachedFormField_};goog.ui.Ratings.prototype.setEnabled=function(enable){this.isEnabled_=enable;if(!enable){this.resetHighlights_()}};goog.ui.Ratings.prototype.isEnabled=function(){return this.isEnabled_};goog.ui.Ratings.prototype.onMouseOver_=function(e){if(!this.isEnabled()){return}if(goog.isDef(e.target.index)){var n=e.target.index;if(this.highlightedIndex_!=n){this.highlightIndex_(n);this.highlightedIndex_=n;this.dispatchEvent(goog.ui.Ratings.EventType.HIGHLIGHT_CHANGE);this.dispatchEvent(goog.ui.Ratings.EventType.HIGHLIGHT)}}};goog.ui.Ratings.prototype.onMouseOut_=function(e){if(e.relatedTarget&&!goog.isDef(e.relatedTarget.index)){this.resetHighlights_()}};goog.ui.Ratings.prototype.onClick_=function(e){if(!this.isEnabled()){return}if(goog.isDef(e.target.index)){this.setSelectedIndex(e.target.index)}};goog.ui.Ratings.prototype.onKeyDown_=function(e){if(!this.isEnabled()){return}switch(e.keyCode){case 27:this.setSelectedIndex(-1);break;case 36:this.setSelectedIndex(0);break;case 35:this.setSelectedIndex(this.ratings_.length);break;case 37:this.setSelectedIndex(this.getSelectedIndex()-1);break;case 39:this.setSelectedIndex(this.getSelectedIndex()+1);break;default:var num=parseInt(String.fromCharCode(e.keyCode),10);if(!isNaN(num)){this.setSelectedIndex(num-1)}}};goog.ui.Ratings.prototype.resetHighlights_=function(){this.highlightIndex_(this.selectedIndex_);this.highlightedIndex_=-1;this.dispatchEvent(goog.ui.Ratings.EventType.HIGHLIGHT_CHANGE);this.dispatchEvent(goog.ui.Ratings.EventType.UNHIGHLIGHT)};goog.ui.Ratings.prototype.highlightIndex_=function(n){for(var i=0,star;star=this.stars_[i];i++){goog.dom.classlist.set(star,this.getClassName_(i,i<=n))}};goog.ui.Ratings.prototype.getClassName_=function(i,on){var className,enabledClassName,baseClass=this.getCssClass();if(0===i){className=goog.getCssName(baseClass,"firststar")}else if(i==this.ratings_.length-1){className=goog.getCssName(baseClass,"laststar")}else{className=goog.getCssName(baseClass,"midstar")}if(on){className=goog.getCssName(className,"on")}else{className=goog.getCssName(className,"off")}if(this.isEnabled_){enabledClassName=goog.getCssName(baseClass,"enabled")}else{enabledClassName=goog.getCssName(baseClass,"disabled")}return goog.getCssName(baseClass,"star")+" "+className+" "+enabledClassName};