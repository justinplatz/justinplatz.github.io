goog.provide("goog.labs.net.webChannel.WebChannelDebug");goog.require("goog.json");goog.require("goog.log");goog.labs.net.webChannel.WebChannelDebug=function(){this.logger_=goog.log.getLogger("goog.labs.net.webChannel.WebChannelDebug")};goog.scope(function(){var WebChannelDebug=goog.labs.net.webChannel.WebChannelDebug;WebChannelDebug.prototype.getLogger=function(){return this.logger_};WebChannelDebug.prototype.browserOfflineResponse=function(url){this.info("BROWSER_OFFLINE: "+url)};WebChannelDebug.prototype.xmlHttpChannelRequest=function(verb,uri,id,attempt,postData){this.info("XMLHTTP REQ ("+id+") [attempt "+attempt+"]: "+verb+"\n"+uri+"\n"+this.maybeRedactPostData_(postData))};WebChannelDebug.prototype.xmlHttpChannelResponseMetaData=function(verb,uri,id,attempt,readyState,statusCode){this.info("XMLHTTP RESP ("+id+") [ attempt "+attempt+"]: "+verb+"\n"+uri+"\n"+readyState+" "+statusCode)};WebChannelDebug.prototype.xmlHttpChannelResponseText=function(id,responseText,opt_desc){this.info("XMLHTTP TEXT ("+id+"): "+this.redactResponse_(responseText)+(opt_desc?" "+opt_desc:""))};WebChannelDebug.prototype.timeoutResponse=function(uri){this.info("TIMEOUT: "+uri)};WebChannelDebug.prototype.debug=function(text){this.info(text)};WebChannelDebug.prototype.dumpException=function(e,opt_msg){this.severe((opt_msg||"Exception")+e)};WebChannelDebug.prototype.info=function(text){goog.log.info(this.logger_,text)};WebChannelDebug.prototype.warning=function(text){goog.log.warning(this.logger_,text)};WebChannelDebug.prototype.severe=function(text){goog.log.error(this.logger_,text)};WebChannelDebug.prototype.redactResponse_=function(responseText){if(!responseText){return null}try{var responseArray=goog.json.unsafeParse(responseText);if(responseArray){for(var i=0;i<responseArray.length;i++){if(goog.isArray(responseArray[i])){this.maybeRedactArray_(responseArray[i])}}}return goog.json.serialize(responseArray)}catch(e){this.debug("Exception parsing expected JS array - probably was not JS");return responseText}};WebChannelDebug.prototype.maybeRedactArray_=function(array){if(2>array.length){return}var dataPart=array[1];if(!goog.isArray(dataPart)){return}if(1>dataPart.length){return}var type=dataPart[0];if("noop"!=type&&"stop"!=type&&"close"!=type){for(var i=1;i<dataPart.length;i++){dataPart[i]=""}}};WebChannelDebug.prototype.maybeRedactPostData_=function(data){if(!data){return null}for(var out="",params=data.split("&"),i=0;i<params.length;i++){var param=params[i],keyValue=param.split("=");if(1<keyValue.length){var key=keyValue[0],value=keyValue[1],keyParts=key.split("_");if(2<=keyParts.length&&"type"==keyParts[1]){out+=key+"="+value+"&"}else{out+=key+"="+"redacted"+"&"}}}return out}});