goog.provide("goog.ui.ScrollFloaterTest");goog.setTestOnly("goog.ui.ScrollFloaterTest");goog.require("goog.dom");goog.require("goog.events");goog.require("goog.style");goog.require("goog.testing.PropertyReplacer");goog.require("goog.testing.jsunit");goog.require("goog.ui.ScrollFloater");function testScrollFloater(){var scrollFloater=new goog.ui.ScrollFloater,floater=goog.dom.getElement("floater");scrollFloater.decorate(floater);assertTrue("Default state is enabled",scrollFloater.isScrollingEnabled());assertFalse("On unscrolled page should not be floating",scrollFloater.isFloating());scrollFloater.setScrollingEnabled(!1);assertFalse("We can disable the floater",scrollFloater.isScrollingEnabled());scrollFloater.dispose()}function testScrollFloaterEvents(){var scrollFloater=new goog.ui.ScrollFloater,floater=goog.dom.getElement("floater");scrollFloater.setContainerElement(goog.dom.getElement("container"));scrollFloater.decorate(floater);var floatWasCalled=!1,callRecorder=function(){floatWasCalled=!0};goog.events.listen(scrollFloater,goog.ui.ScrollFloater.EventType.FLOAT,callRecorder);scrollFloater.float_(goog.ui.ScrollFloater.FloatMode_.TOP);assertTrue("FLOAT event was called",floatWasCalled);assertTrue("Should be floating",scrollFloater.isFloating());assertFalse("Should not be pinned",scrollFloater.isPinned());var dockWasCalled=!1;callRecorder=function(){dockWasCalled=!0};goog.events.listen(scrollFloater,goog.ui.ScrollFloater.EventType.DOCK,callRecorder);scrollFloater.dock_();assertTrue("DOCK event was called",dockWasCalled);assertFalse("Should not be floating",scrollFloater.isFloating());assertFalse("Should not be pinned",scrollFloater.isPinned());var pinWasCalled=!1;callRecorder=function(){pinWasCalled=!0};goog.events.listen(scrollFloater,goog.ui.ScrollFloater.EventType.PIN,callRecorder);scrollFloater.pin_();assertTrue("PIN event was called",pinWasCalled);assertFalse("Should not be floating",scrollFloater.isFloating());assertTrue("Should be pinned",scrollFloater.isPinned());scrollFloater.dispose()}function testScrollFloaterEventCancellation(){var scrollFloater=new goog.ui.ScrollFloater,floater=goog.dom.getElement("floater");scrollFloater.decorate(floater);var eventCanceller=function(){return!1};goog.events.listen(scrollFloater,goog.ui.ScrollFloater.EventType.FLOAT,eventCanceller);scrollFloater.float_(goog.ui.ScrollFloater.FloatMode_.TOP);assertFalse("Should not be floating",scrollFloater.isFloating());goog.events.listen(scrollFloater,goog.ui.ScrollFloater.EventType.PIN,eventCanceller);scrollFloater.dock_();assertFalse("Should not be pinned",scrollFloater.isPinned());goog.events.unlisten(scrollFloater,goog.ui.ScrollFloater.EventType.FLOAT,eventCanceller);scrollFloater.float_(goog.ui.ScrollFloater.FloatMode_.TOP);goog.events.listen(scrollFloater,goog.ui.ScrollFloater.EventType.DOCK,eventCanceller);scrollFloater.dock_();assertTrue("Should still be floating",scrollFloater.isFloating());scrollFloater.dispose()}function testScrollFloaterUpdateStyleOnFloatEvent(){var scrollFloater=new goog.ui.ScrollFloater,floater=goog.dom.getElement("floater");scrollFloater.decorate(floater);var updateStyle=function(e){goog.style.setStyle(e.target.getElement(),"font-size","20px")};goog.style.setStyle(scrollFloater.getElement(),"font-size","10px");goog.events.listen(scrollFloater,goog.ui.ScrollFloater.EventType.FLOAT,updateStyle);scrollFloater.float_(goog.ui.ScrollFloater.FloatMode_.BOTTOM);assertEquals("Font size should be 20px","20px",goog.style.getStyle(scrollFloater.getElement(),"font-size"));assertEquals("Top should be auto","auto",goog.style.getStyle(scrollFloater.getElement(),"top"));assertEquals("Bottom should be 0px",0,parseInt(goog.style.getStyle(scrollFloater.getElement(),"bottom")));scrollFloater.dispose()}function testScrollFloaterHandlesHorizontalScrolling(){var scrollFloater=new goog.ui.ScrollFloater,floater=goog.dom.getElement("floater");scrollFloater.decorate(floater);scrollFloater.float_(goog.ui.ScrollFloater.FloatMode_.TOP);assertEquals("Element should be left aligned","16px",goog.style.getStyle(scrollFloater.getElement(),"left"));var propReplacer=new goog.testing.PropertyReplacer;propReplacer.set(goog.dom,"getDocumentScroll",function(){return{x:20}});scrollFloater.float_(goog.ui.ScrollFloater.FloatMode_.TOP);assertEquals("Element should be scrolled to the left","-4px",goog.style.getStyle(scrollFloater.getElement(),"left"));propReplacer.reset();scrollFloater.dispose()}