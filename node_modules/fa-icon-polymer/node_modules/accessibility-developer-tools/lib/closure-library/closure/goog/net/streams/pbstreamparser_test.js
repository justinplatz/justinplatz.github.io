goog.provide("goog.net.streams.PbStreamParserTest");goog.setTestOnly("goog.net.streams.PbStreamParserTest");goog.require("goog.net.streams.PbStreamParser");goog.require("goog.object");goog.require("goog.testing.asserts");goog.require("goog.testing.jsunit");var testMessage1={data:[10,0,10,7,97,98,99,100,101,102,103,122,4,112,97,100,49,10,8,0,1,2,3,10,255,254,253,122,0,18,23,8,200,1,18,18,115,111,109,101,116,104,105,110,103,45,105,115,45,119,114,111,110,103,122,2,0,0],parsed:[{1:[]},{1:[97,98,99,100,101,102,103]},{1:[0,1,2,3,10,255,254,253]},{2:[8,200,1,18,18,115,111,109,101,116,104,105,110,103,45,105,115,45,119,114,111,110,103]}]};function getInput(bytes){if("undefined"!==typeof Uint8Array){return new Uint8Array(bytes).buffer}return bytes}function testSingleMessage(){var parser=new goog.net.streams.PbStreamParser,input=getInput([10,5,255,254,0,1,119]),result=parser.parse(input);assertEquals(1,result.length);assertElementsEquals(["1"],goog.object.getKeys(result[0]));assertElementsEquals([255,254,0,1,119],result[0][1]);result=parser.parse(getInput([]));assertNull(result)}function testMultipleMessagesWithPadding(){var parser=new goog.net.streams.PbStreamParser,result=parser.parse(getInput(testMessage1.data)),expected=testMessage1.parsed;assertEquals(expected.length,result.length);for(var i=0;i<expected.length;i++){keys=goog.object.getKeys(result[i]);assertElementsEquals(goog.object.getKeys(expected[i]),keys);assertEquals(1,keys.length);assertElementsEquals(expected[i][keys[0]],result[i][keys[0]]);if("undefined"!==typeof Uint8Array){assertTrue(result[i][keys[0]]instanceof Uint8Array)}else{assertTrue(result[i][keys[0]]instanceof Array)}}}function testMessagesInChunks(){var data=[10,3,97,98,99,10,3,100,101,102,18,3,103,104,105],parser=new goog.net.streams.PbStreamParser,result=parser.parse(getInput(data.slice(0,3)));assertNull(result);result=parser.parse(getInput(data.slice(3,8)));assertEquals(1,result.length);assertElementsEquals(["1"],goog.object.getKeys(result[0]));assertElementsEquals([97,98,99],result[0][1]);result=parser.parse(getInput(data.slice(8,10)));assertEquals(1,result.length);assertElementsEquals(["1"],goog.object.getKeys(result[0]));assertElementsEquals([100,101,102],result[0][1]);result=parser.parse(getInput(data.slice(10)));assertEquals(1,result.length);assertElementsEquals(["2"],goog.object.getKeys(result[0]));assertElementsEquals([103,104,105],result[0][2])}function testInvalidInputs(){var parser;parser=new goog.net.streams.PbStreamParser;assertThrows(function(){parser.parse(getInput([11]))});assertThrows(function(){parser.parse(getInput([10]))});parser=new goog.net.streams.PbStreamParser;assertThrows(function(){parser.parse([26])});parser=new goog.net.streams.PbStreamParser;assertThrows(function(){parser.parse(getInput([10,255,255,255,255,16]))});parser=new goog.net.streams.PbStreamParser;assertThrows(function(){parser.parse(getInput([10,255,255,255,255,128]))})}