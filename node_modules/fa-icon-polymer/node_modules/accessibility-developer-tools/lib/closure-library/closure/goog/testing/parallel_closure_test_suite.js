goog.module("goog.testing.parallelClosureTestSuite");goog.setTestOnly("goog.testing.parallelClosureTestSuite");var Promise=goog.require("goog.Promise"),events=goog.require("goog.events"),MultiTestRunner=goog.require("goog.testing.MultiTestRunner"),TestCase=goog.require("goog.testing.TestCase"),jsunit=goog.require("goog.testing.jsunit"),testSuite=goog.require("goog.testing.testSuite"),testRunner,ParallelTestResults;function processAllTestResults(testResults){for(var totalTests=0,totalFailed=0,allResults={},failureReports="",i=0,result;i<testResults.length;i++){result=testResults[i];for(var testName in result){totalTests++;allResults[testName]=result[testName];var failures=result[testName];if(failures.length){totalFailed++;for(var j=0;j<failures.length;j++){failureReports+=failures[j]+"\n"}}}}return{totalTests:totalTests,totalFailures:totalFailed,failureReports:failureReports,allResults:allResults}}var testObj={setUpPage:function(){var timeout=goog.global.G_parallelTestRunner.testTimeout,allTests=goog.global.G_parallelTestRunner.allTests,parallelFrames=goog.global.G_parallelTestRunner.parallelFrames,parallelTimeout=goog.global.G_parallelTestRunner.parallelTimeout;testRunner=new MultiTestRunner().setName(document.title).setBasePath("/google3/").setPoolSize(parallelFrames).setStatsBucketSizes(5,500).setTimeout(1e3*timeout).addTests(allTests);testRunner.render(document.getElementById("runner"));TestCase.getActiveTestCase().promiseTimeout=1e3*parallelTimeout;return testRunner},testRunAllTests:function(){var failurePromise=new Promise(function(resolve,reject){events.listen(testRunner,"testsFinished",resolve)});testRunner.start();var allResults={};window.G_testRunner.getTestResults=function(){return allResults};return failurePromise.then(function(failures){var testResults=processAllTestResults(failures.allTestResults);allResults=testResults.allResults;if(testResults.totalFailures){fail(testResults.totalFailures+" of "+testResults.totalTests+" test(s) failed!\n\n"+testResults.failureReports)}})}};if(goog.global.G_parallelTestRunner){testSuite(testObj)}testObj.processAllTestResults=processAllTestResults;exports=testObj;