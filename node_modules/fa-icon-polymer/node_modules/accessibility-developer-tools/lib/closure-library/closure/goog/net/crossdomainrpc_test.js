goog.provide("goog.net.CrossDomainRpcTest");goog.setTestOnly("goog.net.CrossDomainRpcTest");goog.require("goog.Promise");goog.require("goog.log");goog.require("goog.net.CrossDomainRpc");goog.require("goog.testing.TestCase");goog.require("goog.testing.jsunit");goog.require("goog.userAgent");goog.require("goog.userAgent.product");function setUpPage(){goog.testing.TestCase.getActiveTestCase().promiseTimeout=2e4}function print(o){if(Object.prototype.toSource){return o.toSource()}else{var fragments=["{"],first=!0;for(var p in o){if(!first)fragments.push(",");fragments.push(p);fragments.push(":\"");fragments.push(o[p]);fragments.push("\"");first=!1}return fragments.join("")}}function testNormalRequest(){var start=goog.now();return new goog.Promise(function(resolve,reject){goog.net.CrossDomainRpc.send("crossdomainrpc_test_response.html",resolve,"POST",{xyz:"01234567891123456789"})}).then(function(e){if(300>e.target.status){var elapsed=goog.now()-start,responseData=eval(e.target.responseText);goog.log.fine(goog.net.CrossDomainRpc.logger_,elapsed+"ms: ["+responseData.result.length+"] "+print(responseData));assertEquals(1024*16,responseData.result.length);assertEquals(123,e.target.status);assertEquals(1,e.target.responseHeaders.a);assertEquals("2",e.target.responseHeaders.b)}else{goog.log.fine(goog.net.CrossDomainRpc.logger_,print(e));fail()}})}function testErrorRequest(){if(goog.userAgent.GECKO||goog.userAgent.product.SAFARI){return}return new goog.Promise(function(resolve,reject){goog.net.CrossDomainRpc.send("http://hoodjimcwaadji.google.com/index.html",resolve,"POST",{xyz:"01234567891123456789"});setTimeout(function(){reject("CrossDomainRpc.send did not complete within 4000ms")},4e3)}).then(function(e){if(300>e.target.status){fail("should have failed requesting a non-existent URI")}else{goog.log.fine(goog.net.CrossDomainRpc.logger_,"expected error seen; event="+print(e))}})}function testGetDummyResourceUri(){var url=goog.net.CrossDomainRpc.getDummyResourceUri_();assertTrue("dummy resource URL should not contain \"?\"",0>url.indexOf("?"));assertTrue("dummy resource URL should not contain \"#\"",0>url.indexOf("#"))}function testRemoveHash(){assertEquals("abc",goog.net.CrossDomainRpc.removeHash_("abc#123"));assertEquals("abc",goog.net.CrossDomainRpc.removeHash_("abc#12#3"))}