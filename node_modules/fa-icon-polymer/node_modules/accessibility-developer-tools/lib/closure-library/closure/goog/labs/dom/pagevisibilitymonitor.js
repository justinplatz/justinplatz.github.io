goog.provide("goog.labs.dom.PageVisibilityEvent");goog.provide("goog.labs.dom.PageVisibilityMonitor");goog.provide("goog.labs.dom.PageVisibilityState");goog.require("goog.dom");goog.require("goog.dom.vendor");goog.require("goog.events");goog.require("goog.events.Event");goog.require("goog.events.EventTarget");goog.require("goog.events.EventType");goog.require("goog.memoize");goog.labs.dom.PageVisibilityState={HIDDEN:"hidden",VISIBLE:"visible",PRERENDER:"prerender",UNLOADED:"unloaded"};goog.labs.dom.PageVisibilityMonitor=function(opt_domHelper){goog.labs.dom.PageVisibilityMonitor.base(this,"constructor");this.domHelper_=opt_domHelper||goog.dom.getDomHelper();this.eventType_=this.getBrowserEventType_();if(this.eventType_){this.eventKey_=goog.events.listen(this.domHelper_.getDocument(),this.eventType_,goog.bind(this.handleChange_,this))}};goog.inherits(goog.labs.dom.PageVisibilityMonitor,goog.events.EventTarget);goog.labs.dom.PageVisibilityMonitor.prototype.getBrowserEventType_=goog.memoize(function(){var isSupported=this.isSupported(),isPrefixed=this.isPrefixed_();if(isSupported){return isPrefixed?goog.dom.vendor.getPrefixedEventType(goog.events.EventType.VISIBILITYCHANGE):goog.events.EventType.VISIBILITYCHANGE}else{return null}});goog.labs.dom.PageVisibilityMonitor.prototype.getHiddenPropertyName_=goog.memoize(function(){return goog.dom.vendor.getPrefixedPropertyName("hidden",this.domHelper_.getDocument())});goog.labs.dom.PageVisibilityMonitor.prototype.isPrefixed_=function(){return"hidden"!=this.getHiddenPropertyName_()};goog.labs.dom.PageVisibilityMonitor.prototype.getVisibilityStatePropertyName_=goog.memoize(function(){return goog.dom.vendor.getPrefixedPropertyName("visibilityState",this.domHelper_.getDocument())});goog.labs.dom.PageVisibilityMonitor.prototype.isSupported=function(){return!!this.getHiddenPropertyName_()};goog.labs.dom.PageVisibilityMonitor.prototype.isHidden=function(){return!!this.domHelper_.getDocument()[this.getHiddenPropertyName_()]};goog.labs.dom.PageVisibilityMonitor.prototype.getVisibilityState=function(){if(!this.isSupported()){return null}return this.domHelper_.getDocument()[this.getVisibilityStatePropertyName_()]};goog.labs.dom.PageVisibilityMonitor.prototype.handleChange_=function(e){var state=this.getVisibilityState(),visibilityEvent=new goog.labs.dom.PageVisibilityEvent(this.isHidden(),state);this.dispatchEvent(visibilityEvent)};goog.labs.dom.PageVisibilityMonitor.prototype.disposeInternal=function(){goog.events.unlistenByKey(this.eventKey_);goog.labs.dom.PageVisibilityMonitor.base(this,"disposeInternal")};goog.labs.dom.PageVisibilityEvent=function(hidden,visibilityState){goog.labs.dom.PageVisibilityEvent.base(this,"constructor",goog.events.EventType.VISIBILITYCHANGE);this.hidden=hidden;this.visibilityState=visibilityState};goog.inherits(goog.labs.dom.PageVisibilityEvent,goog.events.Event);