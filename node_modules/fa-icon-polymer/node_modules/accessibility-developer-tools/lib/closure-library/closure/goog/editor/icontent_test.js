goog.provide("goog.editor.icontentTest");goog.setTestOnly("goog.editor.icontentTest");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.editor.BrowserFeature");goog.require("goog.editor.icontent");goog.require("goog.editor.icontent.FieldFormatInfo");goog.require("goog.editor.icontent.FieldStyleInfo");goog.require("goog.testing.PropertyReplacer");goog.require("goog.testing.jsunit");goog.require("goog.userAgent");var wrapperDiv,realIframe,realIframeDoc,propertyReplacer;function setUp(){wrapperDiv=goog.dom.createDom(goog.dom.TagName.DIV,null,realIframe=goog.dom.createDom(goog.dom.TagName.IFRAME));goog.dom.appendChild(document.body,wrapperDiv);realIframeDoc=realIframe.contentWindow.document;propertyReplacer=new goog.testing.PropertyReplacer}function tearDown(){goog.dom.removeNode(wrapperDiv);propertyReplacer.reset()}function testWriteHttpsInitialIframeContent(){var info=new goog.editor.icontent.FieldFormatInfo("id",!1,!1,!1),doc=createMockDocument();goog.editor.icontent.writeHttpsInitialIframe(info,doc,"some html");assertBodyCorrect(doc.body,"id","some html")}function testWriteHttpsInitialIframeContentRtl(){var info=new goog.editor.icontent.FieldFormatInfo("id",!1,!1,!0),doc=createMockDocument();goog.editor.icontent.writeHttpsInitialIframe(info,doc,"some html");assertBodyCorrect(doc.body,"id","some html",!0)}function testWriteInitialIframeContentBlendedStandardsGrowing(){if(goog.editor.BrowserFeature.HAS_CONTENT_EDITABLE){return}var info=new goog.editor.icontent.FieldFormatInfo("id",!0,!0,!1),styleInfo=new goog.editor.icontent.FieldStyleInfo(wrapperDiv,".MyClass { position: absolute; top: 500px; }"),doc=realIframeDoc,html="<div class=\"MyClass\">Some Html</div>";goog.editor.icontent.writeNormalInitialBlendedIframe(info,html,styleInfo,realIframe);assertBodyCorrect(doc.body,"id",html);assertEquals("CSS1Compat",doc.compatMode);assertEquals("auto",doc.documentElement.style.height);assertEquals("100%",doc.body.style.height);assertEquals("hidden",doc.body.style.overflowY);assertEquals("",realIframe.style.position);assertEquals(500,doc.body.firstChild.offsetTop);assert(-1!=goog.dom.getElementsByTagName(goog.dom.TagName.STYLE,doc)[0].innerHTML.indexOf("-moz-force-broken-image-icon"))}function testWriteInitialIframeContentBlendedQuirksFixedRtl(){if(goog.editor.BrowserFeature.HAS_CONTENT_EDITABLE){return}var info=new goog.editor.icontent.FieldFormatInfo("id",!1,!0,!0),styleInfo=new goog.editor.icontent.FieldStyleInfo(wrapperDiv,"");wrapperDiv.style.padding="2px 5px";var doc=realIframeDoc,html="Some Html";goog.editor.icontent.writeNormalInitialBlendedIframe(info,html,styleInfo,realIframe);assertBodyCorrect(doc.body,"id",html,!0);assertEquals("BackCompat",doc.compatMode);assertEquals("100%",doc.documentElement.style.height);assertEquals("auto",doc.body.style.height);assertEquals("auto",doc.body.style.overflow);assertEquals("-2px",realIframe.style.marginTop);assertEquals("-5px",realIframe.style.marginLeft);assert(-1==goog.dom.getElementsByTagName(goog.dom.TagName.STYLE,doc)[0].innerHTML.indexOf("-moz-force-broken-image-icon"))}function testWhiteboxStandardsFixedRtl(){var info=new goog.editor.icontent.FieldFormatInfo("id",!0,!1,!0),styleInfo=null,doc=realIframeDoc,html="Some Html";goog.editor.icontent.writeNormalInitialBlendedIframe(info,html,styleInfo,realIframe);assertBodyCorrect(doc.body,"id",html,!0);if(!goog.userAgent.WEBKIT){assertEquals("BackCompat",doc.compatMode)}}function testGetInitialIframeContent(){var info=new goog.editor.icontent.FieldFormatInfo("id",!0,!1,!1),styleInfo=null,html="Some Html";propertyReplacer.set(goog.editor.BrowserFeature,"HAS_CONTENT_EDITABLE",!1);var htmlOut=goog.editor.icontent.getInitialIframeContent_(info,html,styleInfo);assertEquals(/contentEditable/i.test(htmlOut),!1);propertyReplacer.set(goog.editor.BrowserFeature,"HAS_CONTENT_EDITABLE",!0);htmlOut=goog.editor.icontent.getInitialIframeContent_(info,html,styleInfo);assertEquals(/<body[^>]+?contentEditable/i.test(htmlOut),!0);assertEquals(/<html[^>]+?style="[^>"]*min-width:\s*0/i.test(htmlOut),!0);assertEquals(/<body[^>]+?style="[^>"]*min-width:\s*0/i.test(htmlOut),!0)}function testIframeMinWidthOverride(){if(goog.editor.BrowserFeature.HAS_CONTENT_EDITABLE){return}var info=new goog.editor.icontent.FieldFormatInfo("id",!0,!0,!1),styleInfo=new goog.editor.icontent.FieldStyleInfo(wrapperDiv,".MyClass { position: absolute; top: 500px; }"),doc=realIframeDoc,html="<div class=\"MyClass\">Some Html</div>";goog.editor.icontent.writeNormalInitialBlendedIframe(info,html,styleInfo,realIframe);assertTrue(700>doc.body.offsetWidth)}function testBlendedStandardsGrowingMatchesComparisonDiv(){}function assertBodyCorrect(body,id,bodyHTML,opt_rtl){assertEquals(bodyHTML,body.innerHTML);if(goog.editor.BrowserFeature.HAS_CONTENT_EDITABLE){assertEquals("true",body.contentEditable+"")}else{assertNotEquals("true",body.contentEditable+"")}assertContains("editable",body.className.match(/\S+/g));assertEquals("true",body.getAttribute("g_editable")+"");assertEquals("true",(goog.userAgent.IE?body.hideFocus:body.getAttribute("hideFocus"))+"");assertEquals(id,body.id)}function createMockDocument(){return{body:{setAttribute:function(key,val){this[key]=val},getAttribute:function(key){return this[key]},style:{direction:""}}}}