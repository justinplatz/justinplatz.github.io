goog.provide("goog.ui.DrilldownRow");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.dom.classlist");goog.require("goog.dom.safe");goog.require("goog.html.SafeHtml");goog.require("goog.string.Unicode");goog.require("goog.ui.Component");goog.ui.DrilldownRow=function(opt_properties,opt_domHelper){goog.ui.Component.call(this,opt_domHelper);var properties=opt_properties||{},html;if(!goog.isDefAndNotNull(properties.html)){html=goog.html.SafeHtml.EMPTY}else{goog.asserts.assert(properties.html instanceof goog.html.SafeHtml);html=properties.html}this.html_=html;this.expanded_="undefined"!=typeof properties.expanded?properties.expanded:!0;this.decoratorFn_=properties.decorator||goog.ui.DrilldownRow.decorate;this.displayed_=!0};goog.inherits(goog.ui.DrilldownRow,goog.ui.Component);goog.ui.DrilldownRow.DrilldownRowProperties;goog.ui.DrilldownRow.sampleProperties={html:goog.html.SafeHtml.create(goog.dom.TagName.TR,{},goog.html.SafeHtml.concat(goog.html.SafeHtml.create(goog.dom.TagName.TD,{},"Sample"),goog.html.SafeHtml.create(goog.dom.TagName.TD,{},"Sample"))),loaded:!0,decorator:function(selfObj,handler){goog.ui.DrilldownRow.decorate(selfObj);var row=selfObj.getElement();handler.listen(row,"mouseover",function(){goog.dom.classlist.add(row,goog.getCssName("goog-drilldown-hover"))});handler.listen(row,"mouseout",function(){goog.dom.classlist.remove(row,goog.getCssName("goog-drilldown-hover"))})}};goog.ui.DrilldownRow.prototype.enterDocument=function(){goog.ui.DrilldownRow.superClass_.enterDocument.call(this);this.decoratorFn_(this,this.getHandler())};goog.ui.DrilldownRow.prototype.createDom=function(){this.setElementInternal(goog.ui.DrilldownRow.createRowNode_(this.html_,this.getDomHelper()))};goog.ui.DrilldownRow.prototype.canDecorate=function(node){return node.tagName==goog.dom.TagName.TR};goog.ui.DrilldownRow.prototype.addChildAt=function(child,index,opt_render){goog.asserts.assertInstanceof(child,goog.ui.DrilldownRow);goog.ui.DrilldownRow.superClass_.addChildAt.call(this,child,index,!1);child.setDisplayable_(this.isVisible_()&&this.isExpanded());if(opt_render&&!child.isInDocument()){child.render()}};goog.ui.DrilldownRow.prototype.removeChild=function(child){goog.dom.removeNode(child.getElement());return goog.ui.DrilldownRow.superClass_.removeChild.call(this,child)};goog.ui.DrilldownRow.prototype.render=function(){if(arguments.length){throw Error("A DrilldownRow cannot be placed under a specific parent.")}else{var parent=this.getParent();if(!parent.isInDocument()){throw Error("Cannot render child of un-rendered parent")}goog.asserts.assertInstanceof(parent,goog.ui.DrilldownRow);var previous=parent.previousRenderedChild_(this),row;if(previous){goog.asserts.assertInstanceof(previous,goog.ui.DrilldownRow);row=previous.lastRenderedLeaf_().getElement()}else{row=parent.getElement()}row=row.nextSibling;if(row){this.renderBefore(row)}else{var tbody=parent.getElement().parentNode;goog.ui.DrilldownRow.superClass_.render.call(this,tbody)}}};goog.ui.DrilldownRow.prototype.findIndex=function(){var parent=this.getParent();if(!parent){throw Error("Component has no parent")}return parent.indexOfChild(this)};goog.ui.DrilldownRow.prototype.isExpanded=function(){return this.expanded_};goog.ui.DrilldownRow.prototype.setExpanded=function(expanded){if(expanded!=this.expanded_){this.expanded_=expanded;var elem=this.getElement();goog.asserts.assert(elem);goog.dom.classlist.toggle(elem,goog.getCssName("goog-drilldown-expanded"));goog.dom.classlist.toggle(elem,goog.getCssName("goog-drilldown-collapsed"));if(this.isVisible_()){this.forEachChild(function(child){child.setDisplayable_(expanded)})}}};goog.ui.DrilldownRow.prototype.getDepth=function(){for(var component=this,depth=0;component instanceof goog.ui.DrilldownRow;component=component.getParent(),depth++){}return depth};goog.ui.DrilldownRow.decorate=function(selfObj){var depth=selfObj.getDepth(),row=selfObj.getElement();goog.asserts.assert(row);if(!row.cells){throw Error("No cells")}var cell=row.cells[0],dom=selfObj.getDomHelper(),fragment=dom.createDom(goog.dom.TagName.DIV,{style:"float: left; width: "+depth+"em;"},dom.createDom(goog.dom.TagName.DIV,{class:"toggle",style:"width: 1em; float: right;"},goog.string.Unicode.NBSP));cell.insertBefore(fragment,cell.firstChild);goog.dom.classlist.add(row,selfObj.isExpanded()?goog.getCssName("goog-drilldown-expanded"):goog.getCssName("goog-drilldown-collapsed"));var toggler=goog.dom.getElementsByTagName(goog.dom.TagName.DIV,fragment)[0],key=selfObj.getHandler().listen(toggler,"click",function(event){selfObj.setExpanded(!selfObj.isExpanded())})};goog.ui.DrilldownRow.prototype.setDisplayable_=function(display){if(display&&!this.isInDocument()){this.render()}if(this.displayed_==display){return}this.displayed_=display;if(this.isInDocument()){this.getElement().style.display=display?"":"none"}var selfObj=this;this.forEachChild(function(child){child.setDisplayable_(display&&selfObj.expanded_)})};goog.ui.DrilldownRow.prototype.isVisible_=function(){for(var component=this;component instanceof goog.ui.DrilldownRow;component=component.getParent()){if(!component.displayed_)return!1}return!0};goog.ui.DrilldownRow.createRowNode_=function(html,dom){var tableHtml=goog.html.SafeHtml.create(goog.dom.TagName.TABLE,{},html),div=dom.createElement(goog.dom.TagName.DIV);goog.dom.safe.setInnerHtml(div,tableHtml);return div.firstChild.rows[0]};goog.ui.DrilldownRow.prototype.lastRenderedLeaf_=function(){for(var leaf=null,node=this;node&&node.isInDocument();node=node.getChildAt(node.getChildCount()-1)){leaf=node}return leaf};goog.ui.DrilldownRow.prototype.previousRenderedChild_=function(child){for(var i=this.getChildCount()-1;0<=i;i--){if(this.getChildAt(i)==child){for(var j=i-1,prev;0<=j;j--){prev=this.getChildAt(j);if(prev.isInDocument()){return prev}}}}return null};