goog.provide("goog.events.FileDropHandlerTest");goog.setTestOnly("goog.events.FileDropHandlerTest");goog.require("goog.events");goog.require("goog.events.BrowserEvent");goog.require("goog.events.EventTarget");goog.require("goog.events.EventType");goog.require("goog.events.FileDropHandler");goog.require("goog.testing.jsunit");goog.require("goog.userAgent");var textarea,doc,handler,dnd,files;function setUp(){textarea=new goog.events.EventTarget;doc=new goog.events.EventTarget;textarea.ownerDocument=doc;handler=new goog.events.FileDropHandler(textarea);dnd=!1;files=null;goog.events.listen(handler,goog.events.FileDropHandler.EventType.DROP,function(e){dnd=!0;files=e.getBrowserEvent().dataTransfer.files})}function tearDown(){textarea.dispose();doc.dispose();handler.dispose()}function testOneFile(){var preventDefault=!1,expectedfiles=[{fileName:"file1.jpg"}],dt={types:["Files"],files:expectedfiles};textarea.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGENTER,dataTransfer:dt}));assertTrue(preventDefault);preventDefault=!1;textarea.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGOVER,dataTransfer:dt}));assertTrue(preventDefault);preventDefault=!1;assertEquals("copy",dt.dropEffect);textarea.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DROP,dataTransfer:dt}));assertTrue(preventDefault);assertTrue(dnd);assertEquals(1,files.length);assertEquals(expectedfiles[0].fileName,files[0].fileName)}function testMultipleFiles(){var preventDefault=!1,expectedfiles=[{fileName:"file1.jpg"},{fileName:"file2.jpg"}],dt={types:["Files","text"],files:expectedfiles};textarea.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGENTER,dataTransfer:dt}));assertTrue(preventDefault);preventDefault=!1;textarea.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGOVER,dataTransfer:dt}));assertTrue(preventDefault);preventDefault=!1;assertEquals("copy",dt.dropEffect);textarea.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DROP,dataTransfer:dt}));assertTrue(preventDefault);assertTrue(dnd);assertEquals(2,files.length);assertEquals(expectedfiles[0].fileName,files[0].fileName);assertEquals(expectedfiles[1].fileName,files[1].fileName)}function testNoFiles(){var preventDefault=!1,dt={types:["text"]};textarea.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGENTER,dataTransfer:dt}));assertFalse(preventDefault);preventDefault=!1;textarea.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGOVER,dataTransfer:dt}));assertFalse(preventDefault);preventDefault=!1;textarea.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DROP,dataTransfer:dt}));assertFalse(preventDefault);assertFalse(dnd);assertNull(files)}function testDragEnter(){var preventDefault=!1;textarea.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGENTER,dataTransfer:{types:["Files"],files:[]}}));assertTrue(preventDefault);preventDefault=!1;textarea.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGENTER,dataTransfer:{types:["public.file-url"],files:[]}}));assertTrue(preventDefault);preventDefault=!1;textarea.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGENTER,dataTransfer:{types:["text"],files:[]}}));assertFalse(preventDefault)}function testPreventDropOutside(){var preventDefault=!1,dt={types:["Files"],files:[{fileName:"file1.jpg"}]};doc.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGENTER,dataTransfer:dt}));assertFalse(preventDefault);preventDefault=!1;doc.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGOVER,dataTransfer:dt}));assertFalse(preventDefault);preventDefault=!1;handler.dispose();handler=new goog.events.FileDropHandler(textarea,!0);doc.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGENTER,dataTransfer:dt}));assertTrue(preventDefault);preventDefault=!1;doc.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGOVER,dataTransfer:dt}));assertTrue(preventDefault);preventDefault=!1;assertEquals("none",dt.dropEffect)}function testEffectAllowedExceptionIsCaught(){if(!goog.userAgent.IE||!goog.userAgent.isVersionOrHigher(10)){return}var preventDefault=!1,expectedfiles=[{fileName:"file1.jpg"}],dt={types:["Files"],files:expectedfiles};Object.defineProperty(dt,"effectAllowed",{set:function(v){throw new Error("SCRIPT65535")}});textarea.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGENTER,dataTransfer:dt}));assertTrue(preventDefault);preventDefault=!1;textarea.dispatchEvent(new goog.events.BrowserEvent({preventDefault:function(){preventDefault=!0},type:goog.events.EventType.DRAGOVER,dataTransfer:dt}));assertTrue(preventDefault)}