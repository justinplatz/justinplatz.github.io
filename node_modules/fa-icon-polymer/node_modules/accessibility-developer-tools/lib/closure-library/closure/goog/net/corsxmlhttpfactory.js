goog.provide("goog.net.CorsXmlHttpFactory");goog.provide("goog.net.IeCorsXhrAdapter");goog.require("goog.net.HttpStatus");goog.require("goog.net.XhrLike");goog.require("goog.net.XmlHttp");goog.require("goog.net.XmlHttpFactory");goog.net.CorsXmlHttpFactory=function(){goog.net.XmlHttpFactory.call(this)};goog.inherits(goog.net.CorsXmlHttpFactory,goog.net.XmlHttpFactory);goog.net.CorsXmlHttpFactory.prototype.createInstance=function(){var xhr=new XMLHttpRequest;if("withCredentials"in xhr){return xhr}else if("undefined"!=typeof XDomainRequest){return new goog.net.IeCorsXhrAdapter}else{throw Error("Unsupported browser")}};goog.net.CorsXmlHttpFactory.prototype.internalGetOptions=function(){return{}};goog.net.IeCorsXhrAdapter=function(){this.xdr_=new XDomainRequest;this.readyState=goog.net.XmlHttp.ReadyState.UNINITIALIZED;this.onreadystatechange=null;this.responseText="";this.status=-1;this.responseXML=null;this.statusText=null;this.xdr_.onload=goog.bind(this.handleLoad_,this);this.xdr_.onerror=goog.bind(this.handleError_,this);this.xdr_.onprogress=goog.bind(this.handleProgress_,this);this.xdr_.ontimeout=goog.bind(this.handleTimeout_,this)};goog.net.IeCorsXhrAdapter.prototype.open=function(method,url,opt_async){if(goog.isDefAndNotNull(opt_async)&&!opt_async){throw new Error("Only async requests are supported.")}this.xdr_.open(method,url)};goog.net.IeCorsXhrAdapter.prototype.send=function(opt_content){if(opt_content){if("string"==typeof opt_content){this.xdr_.send(opt_content)}else{throw new Error("Only string data is supported")}}else{this.xdr_.send()}};goog.net.IeCorsXhrAdapter.prototype.abort=function(){this.xdr_.abort()};goog.net.IeCorsXhrAdapter.prototype.setRequestHeader=function(key,value){};goog.net.IeCorsXhrAdapter.prototype.getResponseHeader=function(key){if("content-type"==key.toLowerCase()){return this.xdr_.contentType}return""};goog.net.IeCorsXhrAdapter.prototype.handleLoad_=function(){this.status=goog.net.HttpStatus.OK;this.responseText=this.xdr_.responseText;this.setReadyState_(goog.net.XmlHttp.ReadyState.COMPLETE)};goog.net.IeCorsXhrAdapter.prototype.handleError_=function(){this.status=goog.net.HttpStatus.INTERNAL_SERVER_ERROR;this.responseText="";this.setReadyState_(goog.net.XmlHttp.ReadyState.COMPLETE)};goog.net.IeCorsXhrAdapter.prototype.handleTimeout_=function(){this.handleError_()};goog.net.IeCorsXhrAdapter.prototype.handleProgress_=function(){this.status=goog.net.HttpStatus.OK;this.setReadyState_(goog.net.XmlHttp.ReadyState.LOADING)};goog.net.IeCorsXhrAdapter.prototype.setReadyState_=function(readyState){this.readyState=readyState;if(this.onreadystatechange){this.onreadystatechange()}};goog.net.IeCorsXhrAdapter.prototype.getAllResponseHeaders=function(){return"content-type: "+this.xdr_.contentType};