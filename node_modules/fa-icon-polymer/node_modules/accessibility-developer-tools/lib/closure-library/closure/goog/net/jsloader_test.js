goog.provide("goog.net.jsloaderTest");goog.setTestOnly("goog.net.jsloaderTest");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.dom.TagName");goog.require("goog.html.TrustedResourceUrl");goog.require("goog.net.jsloader");goog.require("goog.net.jsloader.ErrorCode");goog.require("goog.string.Const");goog.require("goog.testing.jsunit");function setUp(){goog.provide=goog.nullFunction}function tearDown(){for(var scripts=goog.array.clone(goog.dom.getElementsByTagName(goog.dom.TagName.SCRIPT)),i=0;i<scripts.length;i++){if(-1!=scripts[i].src.indexOf("testdata")){goog.dom.removeNode(scripts[i])}}}function testSafeLoad(){window.test1=null;var testUrl=goog.html.TrustedResourceUrl.fromConstant(goog.string.Const.from("testdata/jsloader_test1.js")),testUrlValue=goog.html.TrustedResourceUrl.unwrap(testUrl),result=goog.net.jsloader.safeLoad(testUrl);return result.then(function(){var script=result.defaultScope_.script_;assertNotNull("script created",script);assertEquals("encoding is utf-8","UTF-8",script.charset);assertTrue("server URI",0<=script.src.indexOf(testUrlValue));assertEquals("verification object","Test #1 loaded",window.test1)})}function testLoad(){window.test1=null;var testUrl="testdata/jsloader_test1.js",result=goog.net.jsloader.load(testUrl);return result.then(function(){var script=result.defaultScope_.script_;assertNotNull("script created",script);assertEquals("encoding is utf-8","UTF-8",script.charset);assertTrue("server URI",0<=script.src.indexOf(testUrl));assertEquals("verification object","Test #1 loaded",window.test1)})}function testLoadAndVerify(){var testUrl=goog.html.TrustedResourceUrl.fromConstant(goog.string.Const.from("testdata/jsloader_test2.js")),result=goog.net.jsloader.safeLoadAndVerify(testUrl,"test2");return result.then(function(verifyObj){assertEquals("verification object","Test #2 loaded",verifyObj)})}function testLoadAndVerifyError(){var testUrl=goog.html.TrustedResourceUrl.fromConstant(goog.string.Const.from("testdata/jsloader_test2.js")),result=goog.net.jsloader.safeLoadAndVerify(testUrl,"fake");return result.then(fail,function(error){assertEquals("verification error",goog.net.jsloader.ErrorCode.VERIFY_ERROR,error.code)})}function testLoadAndVerifyCanceled(){var testUrl=goog.html.TrustedResourceUrl.fromConstant(goog.string.Const.from("testdata/jsloader_test2.js")),result=goog.net.jsloader.safeLoadAndVerify(testUrl,"test2");result.cancel()}function testLoadMany(){window.test1=null;window.test4=null;var testUrls1=[goog.html.TrustedResourceUrl.fromConstant(goog.string.Const.from("testdata/jsloader_test3.js")),goog.html.TrustedResourceUrl.fromConstant(goog.string.Const.from("testdata/jsloader_test1.js"))],result=goog.net.jsloader.safeLoadMany(testUrls1);window.test3Callback=function(msg){assertEquals("verification object",null,window.test1);var testUrls2=[goog.html.TrustedResourceUrl.fromConstant(goog.string.Const.from("testdata/jsloader_test4.js"))];goog.net.jsloader.safeLoadMany(testUrls2)};window.test4Callback=function(msg){assertEquals("verification object","Test #1 loaded",window.test1);window.test4=msg};return result.then(function(){assertEquals("verification object","Test #4 loaded",window.test4)})}function testLoadWithOptions(){var testUrl=goog.html.TrustedResourceUrl.fromConstant(goog.string.Const.from("testdata/jsloader_test1.js")),testUrlValue=goog.html.TrustedResourceUrl.unwrap(testUrl),options={attributes:{"data-attr1":"enabled","data-attr2":"disabled"},timeout:void 0,cleanupWhenDone:void 0,document:void 0},result=goog.net.jsloader.safeLoad(testUrl,options);return result.then(function(){var script=result.defaultScope_.script_;assertTrue("server URI",0<=script.src.indexOf(testUrlValue));assertEquals("attribute option not applied for attr1","enabled",script.getAttribute("data-attr1"));assertEquals("attribute option not applied for attr2","disabled",script.getAttribute("data-attr2"))})}