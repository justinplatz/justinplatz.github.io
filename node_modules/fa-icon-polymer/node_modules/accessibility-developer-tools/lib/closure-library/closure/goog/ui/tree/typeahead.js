goog.provide("goog.ui.tree.TypeAhead");goog.provide("goog.ui.tree.TypeAhead.Offset");goog.require("goog.array");goog.require("goog.events.KeyCodes");goog.require("goog.string");goog.require("goog.structs.Trie");goog.ui.tree.TypeAhead=function(){this.nodeMap_=new goog.structs.Trie;this.buffer_="";this.matchingLabels_=null;this.matchingNodes_=null;this.matchingLabelIndex_=0;this.matchingNodeIndex_=0};goog.ui.tree.TypeAhead.Offset={DOWN:1,UP:-1};goog.ui.tree.TypeAhead.prototype.handleNavigation=function(e){var handled=!1;switch(e.keyCode){case goog.events.KeyCodes.DOWN:case goog.events.KeyCodes.UP:if(e.ctrlKey){this.jumpTo_(e.keyCode==goog.events.KeyCodes.DOWN?goog.ui.tree.TypeAhead.Offset.DOWN:goog.ui.tree.TypeAhead.Offset.UP);handled=!0}break;case goog.events.KeyCodes.BACKSPACE:var length=this.buffer_.length-1;handled=!0;if(0<length){this.buffer_=this.buffer_.substring(0,length);this.jumpToLabel_(this.buffer_)}else if(0==length){this.buffer_=""}else{handled=!1}break;case goog.events.KeyCodes.ESC:this.buffer_="";handled=!0;break;}return handled};goog.ui.tree.TypeAhead.prototype.handleTypeAheadChar=function(e){var handled=!1;if(!e.ctrlKey&&!e.altKey){var ch=String.fromCharCode(e.charCode||e.keyCode).toLowerCase();if(goog.string.isUnicodeChar(ch)&&(" "!=ch||this.buffer_)){this.buffer_+=ch;handled=this.jumpToLabel_(this.buffer_)}}return handled};goog.ui.tree.TypeAhead.prototype.setNodeInMap=function(node){var labelText=node.getText();if(labelText&&!goog.string.isEmptyOrWhitespace(goog.string.makeSafe(labelText))){labelText=labelText.toLowerCase();var previousValue=this.nodeMap_.get(labelText);if(previousValue){previousValue.push(node)}else{var nodeList=[node];this.nodeMap_.set(labelText,nodeList)}}};goog.ui.tree.TypeAhead.prototype.removeNodeFromMap=function(node){var labelText=node.getText();if(labelText&&!goog.string.isEmptyOrWhitespace(goog.string.makeSafe(labelText))){labelText=labelText.toLowerCase();var nodeList=this.nodeMap_.get(labelText);if(nodeList){for(var count=node.getChildCount(),i=0;i<count;i++){this.removeNodeFromMap(node.getChildAt(i))}goog.array.remove(nodeList,node);if(!nodeList.length){this.nodeMap_.remove(labelText)}}}};goog.ui.tree.TypeAhead.prototype.jumpToLabel_=function(typeAhead){var handled=!1,labels=this.nodeMap_.getKeys(typeAhead);if(labels&&labels.length){this.matchingNodeIndex_=0;this.matchingLabelIndex_=0;var nodes=this.nodeMap_.get(labels[0]);if(handled=this.selectMatchingNode_(nodes)){this.matchingLabels_=labels}}return handled};goog.ui.tree.TypeAhead.prototype.jumpTo_=function(offset){var handled=!1,labels=this.matchingLabels_;if(labels){var nodes=null,nodeIndexOutOfRange=!1;if(this.matchingNodes_){var newNodeIndex=this.matchingNodeIndex_+offset;if(0<=newNodeIndex&&newNodeIndex<this.matchingNodes_.length){this.matchingNodeIndex_=newNodeIndex;nodes=this.matchingNodes_}else{nodeIndexOutOfRange=!0}}if(!nodes){var newLabelIndex=this.matchingLabelIndex_+offset;if(0<=newLabelIndex&&newLabelIndex<labels.length){this.matchingLabelIndex_=newLabelIndex}if(labels.length>this.matchingLabelIndex_){nodes=this.nodeMap_.get(labels[this.matchingLabelIndex_])}if(nodes&&nodes.length&&nodeIndexOutOfRange){this.matchingNodeIndex_=offset==goog.ui.tree.TypeAhead.Offset.UP?nodes.length-1:0}}if(handled=this.selectMatchingNode_(nodes)){this.matchingLabels_=labels}}return handled};goog.ui.tree.TypeAhead.prototype.selectMatchingNode_=function(nodes){var node;if(nodes){if(this.matchingNodeIndex_<nodes.length){node=nodes[this.matchingNodeIndex_];this.matchingNodes_=nodes}if(node){node.reveal();node.select()}}return!!node};goog.ui.tree.TypeAhead.prototype.clear=function(){this.buffer_=""};