goog.module("goog.testing.parallelClosureTestSuiteTest");goog.setTestOnly("goog.testing.parallelClosureTestSuiteTest");var ArgumentMatcher=goog.require("goog.testing.mockmatchers.ArgumentMatcher"),MockControl=goog.require("goog.testing.MockControl"),MultiTestRunner=goog.require("goog.testing.MultiTestRunner"),PropertyReplacer=goog.require("goog.testing.PropertyReplacer"),TestCase=goog.require("goog.testing.TestCase"),dom=goog.require("goog.dom"),jsunit=goog.require("goog.testing.jsunit"),mockmatchers=goog.require("goog.testing.mockmatchers"),parallelClosureTestSuite=goog.require("goog.testing.parallelClosureTestSuite"),testSuite=goog.require("goog.testing.testSuite"),mocks=new MockControl,stubs=new PropertyReplacer;function setTestRunnerGlobals(testTimeout,allTests,parallelFrames,parallelTimeout){var tr=goog.global.G_parallelTestRunner={};tr.testTimeout=testTimeout;tr.allTests=allTests;tr.parallelFrames=parallelFrames;tr.parallelTimeout=parallelTimeout}testSuite({tearDown:function(){goog.global.G_parallelTestRunner=void 0;mocks.$tearDown();stubs.reset()},testProcessAllTestResultsEmptyResults:function(){var testResults=[],allResults=parallelClosureTestSuite.processAllTestResults(testResults);assertEquals(0,allResults.totalTests);assertEquals(0,allResults.totalFailures);assertEquals("",allResults.failureReports);assertObjectEquals({},allResults.allResults)},testProcessAllTestResultsNoFailures:function(){var testResults=[{testA:[]},{testB:[]}],allResults=parallelClosureTestSuite.processAllTestResults(testResults);assertEquals(2,allResults.totalTests);assertEquals(0,allResults.totalFailures);assertEquals("",allResults.failureReports);assertObjectEquals({testA:[],testB:[]},allResults.allResults)},testProcessAllTestResultsWithFailures:function(){var testResults=[{testA:[]},{testB:["testB Failed!"]}],allResults=parallelClosureTestSuite.processAllTestResults(testResults);assertEquals(2,allResults.totalTests);assertEquals(1,allResults.totalFailures);assertEquals("testB Failed!\n",allResults.failureReports);assertObjectEquals({testA:[],testB:["testB Failed!"]},allResults.allResults);var testResults=[{testA:["testA Failed!"]},{testB:["testB Failed!"]}],allResults=parallelClosureTestSuite.processAllTestResults(testResults);assertEquals(2,allResults.totalTests);assertEquals(2,allResults.totalFailures);assertContains("testB Failed!\n",allResults.failureReports);assertContains("testA Failed!\n",allResults.failureReports);assertObjectEquals({testA:["testA Failed!"],testB:["testB Failed!"]},allResults.allResults)},testSetUpPageTestRunnerInitializedProperly:function(){setTestRunnerGlobals(100,["foo.html"],8,360);var mockRender=mocks.createMethodMock(MultiTestRunner.prototype,"render"),elementMatcher=new ArgumentMatcher(function(container){return dom.isElement(container)}),testCaseObj={promiseTimeout:-1};stubs.set(TestCase,"getActiveTestCase",function(){return testCaseObj});mockRender(elementMatcher);mocks.$replayAll();var testRunner=parallelClosureTestSuite.setUpPage();assertArrayEquals(["foo.html"],testRunner.getAllTests());assertEquals(8,testRunner.getPoolSize());assertEquals(1e5,testRunner.getTimeout());assertEquals(36e4,testCaseObj.promiseTimeout);mocks.$verifyAll();testRunner.dispose()},testRunAllTestsFailures:function(){setTestRunnerGlobals(100,["foo.html","bar.html"],8,360);var mockStart=mocks.createMethodMock(MultiTestRunner.prototype,"start"),mockFail=mocks.createMethodMock(goog.global,"fail"),failureMatcher=new ArgumentMatcher(function(failMsg){return /testA Failed!/.test(failMsg)&&/1 of 2 test\(s\) failed/.test(failMsg)});stubs.set(TestCase,"getActiveTestCase",function(){return{timeout:100}});mockStart();fail(failureMatcher);mocks.$replayAll();var testRunner=parallelClosureTestSuite.setUpPage(),testPromise=parallelClosureTestSuite.testRunAllTests();testRunner.dispatchEvent({type:MultiTestRunner.TESTS_FINISHED,allTestResults:[{testA:["testA Failed!"]},{testB:[]}]});return testPromise.then(function(){mocks.$verifyAll();testRunner.dispose()})},testRunAllTestsSuccess:function(){setTestRunnerGlobals(100,["foo.html","bar.html"],8,360);var mockStart=mocks.createMethodMock(MultiTestRunner.prototype,"start"),mockFail=mocks.createMethodMock(goog.global,"fail"),failureMatcher=new ArgumentMatcher(function(failMsg){return /testA Failed!/.test(failMsg)&&/1 of 2 test\(s\) failed/.test(failMsg)});stubs.set(TestCase,"getActiveTestCase",function(){return{timeout:100}});mockStart();fail(mockmatchers.ignoreArgument).$times(0);mocks.$replayAll();var testRunner=parallelClosureTestSuite.setUpPage(),testPromise=parallelClosureTestSuite.testRunAllTests();testRunner.dispatchEvent({type:MultiTestRunner.TESTS_FINISHED,allTestResults:[{testA:[]},{testB:[]}]});return testPromise.then(function(){mocks.$verifyAll();testRunner.dispose()})}});