goog.provide("goog.ui.Palette");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.events");goog.require("goog.events.EventType");goog.require("goog.events.KeyCodes");goog.require("goog.math.Size");goog.require("goog.ui.Component");goog.require("goog.ui.Control");goog.require("goog.ui.PaletteRenderer");goog.require("goog.ui.SelectionModel");goog.ui.Palette=function(items,opt_renderer,opt_domHelper){goog.ui.Palette.base(this,"constructor",items,opt_renderer||goog.ui.PaletteRenderer.getInstance(),opt_domHelper);this.setAutoStates(goog.ui.Component.State.CHECKED|goog.ui.Component.State.SELECTED|goog.ui.Component.State.OPENED,!1);this.currentCellControl_=new goog.ui.Palette.CurrentCell_;this.currentCellControl_.setParentEventTarget(this);this.lastHighlightedIndex_=-1};goog.inherits(goog.ui.Palette,goog.ui.Control);goog.tagUnsealableClass(goog.ui.Palette);goog.ui.Palette.EventType={AFTER_HIGHLIGHT:goog.events.getUniqueId("afterhighlight")};goog.ui.Palette.prototype.size_=null;goog.ui.Palette.prototype.highlightedIndex_=-1;goog.ui.Palette.prototype.selectionModel_=null;goog.ui.Palette.prototype.disposeInternal=function(){goog.ui.Palette.superClass_.disposeInternal.call(this);if(this.selectionModel_){this.selectionModel_.dispose();this.selectionModel_=null}this.size_=null;this.currentCellControl_.dispose()};goog.ui.Palette.prototype.setContentInternal=function(content){var items=content;goog.ui.Palette.superClass_.setContentInternal.call(this,items);this.adjustSize_();if(this.selectionModel_){this.selectionModel_.clear();this.selectionModel_.addItems(items)}else{this.selectionModel_=new goog.ui.SelectionModel(items);this.selectionModel_.setSelectionHandler(goog.bind(this.selectItem_,this));this.getHandler().listen(this.selectionModel_,goog.events.EventType.SELECT,this.handleSelectionChange)}this.highlightedIndex_=-1};goog.ui.Palette.prototype.getCaption=function(){return""};goog.ui.Palette.prototype.setCaption=function(caption){};goog.ui.Palette.prototype.handleMouseOver=function(e){goog.ui.Palette.superClass_.handleMouseOver.call(this,e);var item=this.getRenderer().getContainingItem(this,e.target);if(item&&e.relatedTarget&&goog.dom.contains(item,e.relatedTarget)){return}if(item!=this.getHighlightedItem()){this.setHighlightedItem(item)}};goog.ui.Palette.prototype.handleMouseDown=function(e){goog.ui.Palette.superClass_.handleMouseDown.call(this,e);if(this.isActive()){var item=this.getRenderer().getContainingItem(this,e.target);if(item!=this.getHighlightedItem()){this.setHighlightedItem(item)}}};goog.ui.Palette.prototype.performActionInternal=function(e){var highlightedItem=this.getHighlightedItem();if(highlightedItem){if(e&&this.shouldSelectHighlightedItem_(e)){this.setSelectedItem(highlightedItem)}return goog.ui.Palette.base(this,"performActionInternal",e)}return!1};goog.ui.Palette.prototype.shouldSelectHighlightedItem_=function(e){if(!this.getSelectedItem()){return!0}else if("mouseup"!=e.type){return!0}else{return!!this.getRenderer().getContainingItem(this,e.target)}};goog.ui.Palette.prototype.handleKeyEvent=function(e){var items=this.getContent(),numItems=items?items.length:0,numColumns=this.size_.width;if(0==numItems||!this.isEnabled()){return!1}if(e.keyCode==goog.events.KeyCodes.ENTER||e.keyCode==goog.events.KeyCodes.SPACE){return this.performActionInternal(e)}if(e.keyCode==goog.events.KeyCodes.HOME){this.setHighlightedIndex(0);return!0}else if(e.keyCode==goog.events.KeyCodes.END){this.setHighlightedIndex(numItems-1);return!0}var highlightedIndex=0>this.highlightedIndex_?this.getSelectedIndex():this.highlightedIndex_;switch(e.keyCode){case goog.events.KeyCodes.LEFT:if(-1==highlightedIndex||0==highlightedIndex){highlightedIndex=numItems}this.setHighlightedIndex(highlightedIndex-1);e.preventDefault();return!0;break;case goog.events.KeyCodes.RIGHT:if(highlightedIndex==numItems-1){highlightedIndex=-1}this.setHighlightedIndex(highlightedIndex+1);e.preventDefault();return!0;break;case goog.events.KeyCodes.UP:if(-1==highlightedIndex){highlightedIndex=numItems+numColumns-1}if(highlightedIndex>=numColumns){this.setHighlightedIndex(highlightedIndex-numColumns);e.preventDefault();return!0}break;case goog.events.KeyCodes.DOWN:if(-1==highlightedIndex){highlightedIndex=-numColumns}if(highlightedIndex<numItems-numColumns){this.setHighlightedIndex(highlightedIndex+numColumns);e.preventDefault();return!0}break;}return!1};goog.ui.Palette.prototype.handleSelectionChange=function(e){};goog.ui.Palette.prototype.getSize=function(){return this.size_};goog.ui.Palette.prototype.setSize=function(size,opt_rows){if(this.getElement()){throw Error(goog.ui.Component.Error.ALREADY_RENDERED)}this.size_=goog.isNumber(size)?new goog.math.Size(size,opt_rows):size;this.adjustSize_()};goog.ui.Palette.prototype.getHighlightedIndex=function(){return this.highlightedIndex_};goog.ui.Palette.prototype.getHighlightedItem=function(){var items=this.getContent();return items&&items[this.highlightedIndex_]};goog.ui.Palette.prototype.getHighlightedCellElement_=function(){return this.getRenderer().getCellForItem(this.getHighlightedItem())};goog.ui.Palette.prototype.setHighlightedIndex=function(index){if(index!=this.highlightedIndex_){this.highlightIndex_(this.highlightedIndex_,!1);this.lastHighlightedIndex_=this.highlightedIndex_;this.highlightedIndex_=index;this.highlightIndex_(index,!0);this.dispatchEvent(goog.ui.Palette.EventType.AFTER_HIGHLIGHT)}};goog.ui.Palette.prototype.setHighlightedItem=function(item){var items=this.getContent();this.setHighlightedIndex(items&&item?goog.array.indexOf(items,item):-1)};goog.ui.Palette.prototype.getSelectedIndex=function(){return this.selectionModel_?this.selectionModel_.getSelectedIndex():-1};goog.ui.Palette.prototype.getSelectedItem=function(){return this.selectionModel_?this.selectionModel_.getSelectedItem():null};goog.ui.Palette.prototype.setSelectedIndex=function(index){if(this.selectionModel_){this.selectionModel_.setSelectedIndex(index)}};goog.ui.Palette.prototype.setSelectedItem=function(item){if(this.selectionModel_){this.selectionModel_.setSelectedItem(item)}};goog.ui.Palette.prototype.highlightIndex_=function(index,highlight){if(this.getElement()){var items=this.getContent();if(items&&0<=index&&index<items.length){var cellEl=this.getHighlightedCellElement_();if(this.currentCellControl_.getElement()!=cellEl){this.currentCellControl_.setElementInternal(cellEl)}if(this.currentCellControl_.tryHighlight(highlight)){this.getRenderer().highlightCell(this,items[index],highlight)}}}};goog.ui.Palette.prototype.setHighlighted=function(highlight){if(highlight&&-1==this.highlightedIndex_){this.setHighlightedIndex(-1<this.lastHighlightedIndex_?this.lastHighlightedIndex_:0)}else if(!highlight){this.setHighlightedIndex(-1)}goog.ui.Palette.base(this,"setHighlighted",highlight)};goog.ui.Palette.prototype.selectItem_=function(item,select){if(this.getElement()){this.getRenderer().selectCell(this,item,select)}};goog.ui.Palette.prototype.adjustSize_=function(){var _Mathceil=Math.ceil,items=this.getContent();if(items){if(this.size_&&this.size_.width){var minRows=_Mathceil(items.length/this.size_.width);if(!goog.isNumber(this.size_.height)||this.size_.height<minRows){this.size_.height=minRows}}else{var length=_Mathceil(Math.sqrt(items.length));this.size_=new goog.math.Size(length,length)}}else{this.size_=new goog.math.Size(0,0)}};goog.ui.Palette.CurrentCell_=function(){goog.ui.Palette.CurrentCell_.base(this,"constructor",null);this.setDispatchTransitionEvents(goog.ui.Component.State.HOVER,!0)};goog.inherits(goog.ui.Palette.CurrentCell_,goog.ui.Control);goog.ui.Palette.CurrentCell_.prototype.tryHighlight=function(highlight){this.setHighlighted(highlight);return this.isHighlighted()==highlight};