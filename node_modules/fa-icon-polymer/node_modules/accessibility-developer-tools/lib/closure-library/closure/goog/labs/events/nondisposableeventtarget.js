goog.provide("goog.labs.events.NonDisposableEventTarget");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.events.Event");goog.require("goog.events.Listenable");goog.require("goog.events.ListenerMap");goog.require("goog.object");goog.labs.events.NonDisposableEventTarget=function(){this.eventTargetListeners_=new goog.events.ListenerMap(this)};goog.events.Listenable.addImplementation(goog.labs.events.NonDisposableEventTarget);goog.labs.events.NonDisposableEventTarget.MAX_ANCESTORS_=1e3;goog.labs.events.NonDisposableEventTarget.prototype.parentEventTarget_=null;goog.labs.events.NonDisposableEventTarget.prototype.getParentEventTarget=function(){return this.parentEventTarget_};goog.labs.events.NonDisposableEventTarget.prototype.setParentEventTarget=function(parent){this.parentEventTarget_=parent};goog.labs.events.NonDisposableEventTarget.prototype.dispatchEvent=function(e){this.assertInitialized_();var ancestorsTree,ancestor=this.getParentEventTarget();if(ancestor){ancestorsTree=[];var ancestorCount=1;for(;ancestor;ancestor=ancestor.getParentEventTarget()){ancestorsTree.push(ancestor);goog.asserts.assert(++ancestorCount<goog.labs.events.NonDisposableEventTarget.MAX_ANCESTORS_,"infinite loop")}}return goog.labs.events.NonDisposableEventTarget.dispatchEventInternal_(this,e,ancestorsTree)};goog.labs.events.NonDisposableEventTarget.prototype.listen=function(type,listener,opt_useCapture,opt_listenerScope){this.assertInitialized_();return this.eventTargetListeners_.add(type+"",listener,!1,opt_useCapture,opt_listenerScope)};goog.labs.events.NonDisposableEventTarget.prototype.listenOnce=function(type,listener,opt_useCapture,opt_listenerScope){return this.eventTargetListeners_.add(type+"",listener,!0,opt_useCapture,opt_listenerScope)};goog.labs.events.NonDisposableEventTarget.prototype.unlisten=function(type,listener,opt_useCapture,opt_listenerScope){return this.eventTargetListeners_.remove(type+"",listener,opt_useCapture,opt_listenerScope)};goog.labs.events.NonDisposableEventTarget.prototype.unlistenByKey=function(key){return this.eventTargetListeners_.removeByKey(key)};goog.labs.events.NonDisposableEventTarget.prototype.removeAllListeners=function(opt_type){return this.eventTargetListeners_.removeAll(opt_type)};goog.labs.events.NonDisposableEventTarget.prototype.fireListeners=function(type,capture,eventObject){var listenerArray=this.eventTargetListeners_.listeners[type+""];if(!listenerArray){return!0}listenerArray=goog.array.clone(listenerArray);for(var rv=!0,i=0,listener;i<listenerArray.length;++i){listener=listenerArray[i];if(listener&&!listener.removed&&listener.capture==capture){var listenerFn=listener.listener,listenerHandler=listener.handler||listener.src;if(listener.callOnce){this.unlistenByKey(listener)}rv=!1!==listenerFn.call(listenerHandler,eventObject)&&rv}}return rv&&!1!=eventObject.returnValue_};goog.labs.events.NonDisposableEventTarget.prototype.getListeners=function(type,capture){return this.eventTargetListeners_.getListeners(type+"",capture)};goog.labs.events.NonDisposableEventTarget.prototype.getListener=function(type,listener,capture,opt_listenerScope){return this.eventTargetListeners_.getListener(type+"",listener,capture,opt_listenerScope)};goog.labs.events.NonDisposableEventTarget.prototype.hasListener=function(opt_type,opt_capture){var id=goog.isDef(opt_type)?opt_type+"":void 0;return this.eventTargetListeners_.hasListener(id,opt_capture)};goog.labs.events.NonDisposableEventTarget.prototype.assertInitialized_=function(){goog.asserts.assert(this.eventTargetListeners_,"Event target is not initialized. Did you call the superclass "+"(goog.labs.events.NonDisposableEventTarget) constructor?")};goog.labs.events.NonDisposableEventTarget.dispatchEventInternal_=function(target,e,opt_ancestorsTree){var type=e.type||e;if(goog.isString(e)){e=new goog.events.Event(e,target)}else if(!(e instanceof goog.events.Event)){var oldEvent=e;e=new goog.events.Event(type,target);goog.object.extend(e,oldEvent)}else{e.target=e.target||target}var rv=!0,currentTarget;if(opt_ancestorsTree){for(var i=opt_ancestorsTree.length-1;!e.propagationStopped_&&0<=i;i--){currentTarget=e.currentTarget=opt_ancestorsTree[i];rv=currentTarget.fireListeners(type,!0,e)&&rv}}if(!e.propagationStopped_){currentTarget=e.currentTarget=target;rv=currentTarget.fireListeners(type,!0,e)&&rv;if(!e.propagationStopped_){rv=currentTarget.fireListeners(type,!1,e)&&rv}}if(opt_ancestorsTree){for(i=0;!e.propagationStopped_&&i<opt_ancestorsTree.length;i++){currentTarget=e.currentTarget=opt_ancestorsTree[i];rv=currentTarget.fireListeners(type,!1,e)&&rv}}return rv};