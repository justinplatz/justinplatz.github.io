goog.provide("goog.ui.SubMenu");goog.require("goog.Timer");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.classlist");goog.require("goog.events.KeyCodes");goog.require("goog.positioning.AnchoredViewportPosition");goog.require("goog.positioning.Corner");goog.require("goog.style");goog.require("goog.ui.Component");goog.require("goog.ui.Menu");goog.require("goog.ui.MenuItem");goog.require("goog.ui.SubMenuRenderer");goog.require("goog.ui.registry");goog.ui.SubMenu=function(content,opt_model,opt_domHelper,opt_renderer){goog.ui.MenuItem.call(this,content,opt_model,opt_domHelper,opt_renderer||goog.ui.SubMenuRenderer.getInstance())};goog.inherits(goog.ui.SubMenu,goog.ui.MenuItem);goog.tagUnsealableClass(goog.ui.SubMenu);goog.ui.SubMenu.MENU_DELAY_MS=218;goog.ui.SubMenu.prototype.dismissTimer_=null;goog.ui.SubMenu.prototype.showTimer_=null;goog.ui.SubMenu.prototype.menuIsVisible_=!1;goog.ui.SubMenu.prototype.subMenu_=null;goog.ui.SubMenu.prototype.externalSubMenu_=!1;goog.ui.SubMenu.prototype.alignToEnd_=!0;goog.ui.SubMenu.prototype.isPositionAdjustable_=!1;goog.ui.SubMenu.prototype.enterDocument=function(){goog.ui.SubMenu.superClass_.enterDocument.call(this);this.getHandler().listen(this.getParent(),goog.ui.Component.EventType.HIDE,this.onParentHidden_);if(this.subMenu_){this.setMenuListenersEnabled_(this.subMenu_,!0)}};goog.ui.SubMenu.prototype.exitDocument=function(){this.getHandler().unlisten(this.getParent(),goog.ui.Component.EventType.HIDE,this.onParentHidden_);if(this.subMenu_){this.setMenuListenersEnabled_(this.subMenu_,!1);if(!this.externalSubMenu_){this.subMenu_.exitDocument();goog.dom.removeNode(this.subMenu_.getElement())}}goog.ui.SubMenu.superClass_.exitDocument.call(this)};goog.ui.SubMenu.prototype.disposeInternal=function(){if(this.subMenu_&&!this.externalSubMenu_){this.subMenu_.dispose()}this.subMenu_=null;goog.ui.SubMenu.superClass_.disposeInternal.call(this)};goog.ui.SubMenu.prototype.setHighlighted=function(highlight,opt_btnPressed){goog.ui.SubMenu.superClass_.setHighlighted.call(this,highlight);if(opt_btnPressed){this.getMenu().setMouseButtonPressed(!0)}if(!highlight){if(this.dismissTimer_){goog.Timer.clear(this.dismissTimer_)}this.dismissTimer_=goog.Timer.callOnce(this.dismissSubMenu,goog.ui.SubMenu.MENU_DELAY_MS,this)}};goog.ui.SubMenu.prototype.showSubMenu=function(){var parent=this.getParent();if(parent&&parent.getHighlighted()==this){this.setSubMenuVisible_(!0);this.dismissSiblings_()}};goog.ui.SubMenu.prototype.dismissSubMenu=function(){var subMenu=this.subMenu_;if(subMenu&&subMenu.getParent()==this){this.setSubMenuVisible_(!1);subMenu.forEachChild(function(child){if("function"==typeof child.dismissSubMenu){child.dismissSubMenu()}})}};goog.ui.SubMenu.prototype.clearTimers=function(){if(this.dismissTimer_){goog.Timer.clear(this.dismissTimer_)}if(this.showTimer_){goog.Timer.clear(this.showTimer_)}};goog.ui.SubMenu.prototype.setVisible=function(visible,opt_force){var visibilityChanged=goog.ui.SubMenu.superClass_.setVisible.call(this,visible,opt_force);if(visibilityChanged&&!this.isVisible()){this.dismissSubMenu()}return visibilityChanged};goog.ui.SubMenu.prototype.dismissSiblings_=function(){this.getParent().forEachChild(function(child){if(child!=this&&"function"==typeof child.dismissSubMenu){child.dismissSubMenu();child.clearTimers()}},this)};goog.ui.SubMenu.prototype.handleKeyEvent=function(e){var keyCode=e.keyCode,openKeyCode=this.isRightToLeft()?goog.events.KeyCodes.LEFT:goog.events.KeyCodes.RIGHT,closeKeyCode=this.isRightToLeft()?goog.events.KeyCodes.RIGHT:goog.events.KeyCodes.LEFT;if(!this.menuIsVisible_){if(this.isEnabled()&&(keyCode==openKeyCode||keyCode==this.getMnemonic())){this.showSubMenu();this.getMenu().highlightFirst();this.clearTimers()}else{return!1}}else if(this.getMenu().handleKeyEvent(e)){}else if(keyCode==closeKeyCode){this.dismissSubMenu()}else{return!1}e.preventDefault();return!0};goog.ui.SubMenu.prototype.onChildEnter_=function(e){if(this.subMenu_.getParent()==this){this.clearTimers();this.getParentEventTarget().setHighlighted(this);this.dismissSiblings_()}};goog.ui.SubMenu.prototype.onParentHidden_=function(e){if(e.target==this.getParentEventTarget()){this.dismissSubMenu();this.clearTimers()}};goog.ui.SubMenu.prototype.handleMouseOver=function(e){if(this.isEnabled()){this.clearTimers();this.showTimer_=goog.Timer.callOnce(this.showSubMenu,goog.ui.SubMenu.MENU_DELAY_MS,this)}goog.ui.SubMenu.superClass_.handleMouseOver.call(this,e)};goog.ui.SubMenu.prototype.performActionInternal=function(e){this.clearTimers();var shouldHandleClick=this.isSupportedState(goog.ui.Component.State.SELECTED)||this.isSupportedState(goog.ui.Component.State.CHECKED);if(shouldHandleClick){return goog.ui.SubMenu.superClass_.performActionInternal.call(this,e)}else{this.showSubMenu();return!0}};goog.ui.SubMenu.prototype.setSubMenuVisible_=function(visible){if(!visible&&this.getMenu()){this.getMenu().setHighlightedIndex(-1)}this.dispatchEvent(goog.ui.Component.getStateTransitionEvent(goog.ui.Component.State.OPENED,visible));var subMenu=this.getMenu();if(visible!=this.menuIsVisible_){goog.dom.classlist.enable(goog.asserts.assert(this.getElement()),goog.getCssName("goog-submenu-open"),visible)}if(visible!=subMenu.isVisible()){if(visible){if(!subMenu.isInDocument()){subMenu.render()}subMenu.setHighlightedIndex(-1)}subMenu.setVisible(visible);if(visible){this.positionSubMenu()}}this.menuIsVisible_=visible};goog.ui.SubMenu.prototype.setMenuListenersEnabled_=function(menu,attach){var handler=this.getHandler(),method=attach?handler.listen:handler.unlisten;method.call(handler,menu,goog.ui.Component.EventType.ENTER,this.onChildEnter_)};goog.ui.SubMenu.prototype.setAlignToEnd=function(alignToEnd){if(alignToEnd!=this.alignToEnd_){this.alignToEnd_=alignToEnd;if(this.isInDocument()){var oldElement=this.getElement();this.exitDocument();if(oldElement.nextSibling){this.renderBefore(oldElement.nextSibling)}else{this.render(oldElement.parentNode)}}}};goog.ui.SubMenu.prototype.isAlignedToEnd=function(){return this.alignToEnd_};goog.ui.SubMenu.prototype.positionSubMenu=function(){var position=new goog.positioning.AnchoredViewportPosition(this.getElement(),this.isAlignedToEnd()?goog.positioning.Corner.TOP_END:goog.positioning.Corner.TOP_START,this.isPositionAdjustable_),subMenu=this.getMenu(),el=subMenu.getElement();if(!subMenu.isVisible()){el.style.visibility="hidden";goog.style.setElementShown(el,!0)}position.reposition(el,this.isAlignedToEnd()?goog.positioning.Corner.TOP_START:goog.positioning.Corner.TOP_END);if(!subMenu.isVisible()){goog.style.setElementShown(el,!1);el.style.visibility="visible"}};goog.ui.SubMenu.prototype.addItem=function(item){this.getMenu().addChild(item,!0)};goog.ui.SubMenu.prototype.addItemAt=function(item,n){this.getMenu().addChildAt(item,n,!0)};goog.ui.SubMenu.prototype.removeItem=function(item){var child=this.getMenu().removeChild(item,!0);if(child){child.dispose()}};goog.ui.SubMenu.prototype.removeItemAt=function(n){var child=this.getMenu().removeChildAt(n,!0);if(child){child.dispose()}};goog.ui.SubMenu.prototype.getItemAt=function(n){return this.getMenu().getChildAt(n)};goog.ui.SubMenu.prototype.getItemCount=function(){return this.getMenu().getChildCount()};goog.ui.SubMenu.prototype.getItems=function(){return this.getMenu().getItems()};goog.ui.SubMenu.prototype.getMenu=function(){if(!this.subMenu_){this.setMenu(new goog.ui.Menu(this.getDomHelper()),!0)}else if(this.externalSubMenu_&&this.subMenu_.getParent()!=this){this.subMenu_.setParent(this)}if(!this.subMenu_.getElement()){this.subMenu_.createDom()}return this.subMenu_};goog.ui.SubMenu.prototype.setMenu=function(menu,opt_internal){var oldMenu=this.subMenu_;if(menu!=oldMenu){if(oldMenu){this.dismissSubMenu();if(this.isInDocument()){this.setMenuListenersEnabled_(oldMenu,!1)}}this.subMenu_=menu;this.externalSubMenu_=!opt_internal;if(menu){menu.setParent(this);menu.setVisible(!1,!0);menu.setAllowAutoFocus(!1);menu.setFocusable(!1);if(this.isInDocument()){this.setMenuListenersEnabled_(menu,!0)}}}};goog.ui.SubMenu.prototype.containsElement=function(element){return this.getMenu().containsElement(element)};goog.ui.SubMenu.prototype.setPositionAdjustable=function(isAdjustable){this.isPositionAdjustable_=!!isAdjustable};goog.ui.SubMenu.prototype.isPositionAdjustable=function(){return this.isPositionAdjustable_};goog.ui.registry.setDecoratorByClassName(goog.getCssName("goog-submenu"),function(){return new goog.ui.SubMenu(null)});