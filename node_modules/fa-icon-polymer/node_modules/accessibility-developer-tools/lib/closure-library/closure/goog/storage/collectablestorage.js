goog.provide("goog.storage.CollectableStorage");goog.require("goog.array");goog.require("goog.iter");goog.require("goog.storage.ErrorCode");goog.require("goog.storage.ExpiringStorage");goog.require("goog.storage.RichStorage");goog.storage.CollectableStorage=function(mechanism){goog.storage.CollectableStorage.base(this,"constructor",mechanism)};goog.inherits(goog.storage.CollectableStorage,goog.storage.ExpiringStorage);goog.storage.CollectableStorage.prototype.getExpiredKeys_=function(keys,opt_strict){var keysToRemove=[];goog.iter.forEach(keys,function(key){var wrapper;try{wrapper=goog.storage.CollectableStorage.prototype.getWrapper.call(this,key,!0)}catch(ex){if(ex==goog.storage.ErrorCode.INVALID_VALUE){if(opt_strict){keysToRemove.push(key)}return}throw ex}if(!goog.isDef(wrapper)){keysToRemove.push(key);return}if(goog.storage.ExpiringStorage.isExpired(wrapper)){keysToRemove.push(key);return}if(opt_strict){try{goog.storage.RichStorage.Wrapper.unwrap(wrapper)}catch(ex){if(ex==goog.storage.ErrorCode.INVALID_VALUE){keysToRemove.push(key);return}throw ex}}},this);return keysToRemove};goog.storage.CollectableStorage.prototype.collectInternal=function(keys,opt_strict){var keysToRemove=this.getExpiredKeys_(keys,opt_strict);goog.array.forEach(keysToRemove,function(key){goog.storage.CollectableStorage.prototype.remove.call(this,key)},this);return keysToRemove};goog.storage.CollectableStorage.prototype.collect=function(opt_strict){this.collectInternal(this.mechanism.__iterator__(!0),opt_strict)};