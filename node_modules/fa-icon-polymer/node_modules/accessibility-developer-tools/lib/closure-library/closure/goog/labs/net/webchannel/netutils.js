goog.provide("goog.labs.net.webChannel.netUtils");goog.require("goog.Uri");goog.require("goog.labs.net.webChannel.WebChannelDebug");goog.scope(function(){var netUtils=goog.labs.net.webChannel.netUtils,WebChannelDebug=goog.labs.net.webChannel.WebChannelDebug;netUtils.NETWORK_TIMEOUT=1e4;netUtils.testNetwork=function(callback,opt_imageUri){var uri=opt_imageUri;if(!uri){uri=new goog.Uri("//www.google.com/images/cleardot.gif");if(!(goog.global.location&&"http"==goog.global.location.protocol)){uri.setScheme("https")}uri.makeUnique()}netUtils.testLoadImage(uri.toString(),netUtils.NETWORK_TIMEOUT,callback)};netUtils.testLoadImageWithRetries=function(url,timeout,callback,retries,opt_pauseBetweenRetriesMS){var channelDebug=new WebChannelDebug;channelDebug.debug("TestLoadImageWithRetries: "+opt_pauseBetweenRetriesMS);if(0==retries){callback(!1);return}var pauseBetweenRetries=opt_pauseBetweenRetriesMS||0;retries--;netUtils.testLoadImage(url,timeout,function(succeeded){if(succeeded){callback(!0)}else{goog.global.setTimeout(function(){netUtils.testLoadImageWithRetries(url,timeout,callback,retries,pauseBetweenRetries)},pauseBetweenRetries)}})};netUtils.testLoadImage=function(url,timeout,callback){var channelDebug=new WebChannelDebug;channelDebug.debug("TestLoadImage: loading "+url);var img=new Image;img.onload=goog.partial(netUtils.imageCallback_,channelDebug,img,"TestLoadImage: loaded",!0,callback);img.onerror=goog.partial(netUtils.imageCallback_,channelDebug,img,"TestLoadImage: error",!1,callback);img.onabort=goog.partial(netUtils.imageCallback_,channelDebug,img,"TestLoadImage: abort",!1,callback);img.ontimeout=goog.partial(netUtils.imageCallback_,channelDebug,img,"TestLoadImage: timeout",!1,callback);goog.global.setTimeout(function(){if(img.ontimeout){img.ontimeout()}},timeout);img.src=url};netUtils.imageCallback_=function(channelDebug,img,debugText,result,callback){try{channelDebug.debug(debugText);netUtils.clearImageCallbacks_(img);callback(result)}catch(e){channelDebug.dumpException(e)}};netUtils.clearImageCallbacks_=function(img){img.onload=null;img.onerror=null;img.onabort=null;img.ontimeout=null}});