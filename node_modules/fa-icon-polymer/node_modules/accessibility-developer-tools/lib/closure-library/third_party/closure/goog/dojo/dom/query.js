goog.provide("goog.dom.query");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.functions");goog.require("goog.string");goog.require("goog.userAgent");goog.dom.query=function(){var cssCaseBug=goog.userAgent.WEBKIT&&"BackCompat"==goog.dom.getDocument().compatMode,legacyIE=goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),childNodesName=goog.dom.getDocument().firstChild.children?"children":"childNodes",specials=">~+",caseSensitive=!1,getQueryParts=function(query){if(0<=specials.indexOf(query.slice(-1))){query+=" * "}else{query+=" "}var ts=function(s,e){return goog.string.trim(query.slice(s,e))},queryParts=[],inBrackets=-1,inParens=-1,inMatchFor=-1,inPseudo=-1,inClass=-1,inId=-1,inTag=-1,lc="",cc="",pStart,x=0,ql=query.length,currentPart=null,cp=null,endTag=function(){if(0<=inTag){var tv=inTag==x?null:ts(inTag,x);if(0>specials.indexOf(tv)){currentPart.tag=tv}else{currentPart.oper=tv}inTag=-1}},endId=function(){if(0<=inId){currentPart.id=ts(inId,x).replace(/\\/g,"");inId=-1}},endClass=function(){if(0<=inClass){currentPart.classes.push(ts(inClass+1,x).replace(/\\/g,""));inClass=-1}},endAll=function(){endId();endTag();endClass()},endPart=function(){endAll();if(0<=inPseudo){currentPart.pseudos.push({name:ts(inPseudo+1,x)})}currentPart.loops=currentPart.pseudos.length||currentPart.attrs.length||currentPart.classes.length;currentPart.oquery=currentPart.query=ts(pStart,x);currentPart.otag=currentPart.tag=currentPart.oper?null:currentPart.tag||"*";if(currentPart.tag){currentPart.tag=currentPart.tag.toUpperCase()}if(queryParts.length&&queryParts[queryParts.length-1].oper){currentPart.infixOper=queryParts.pop();currentPart.query=currentPart.infixOper.query+" "+currentPart.query}queryParts.push(currentPart);currentPart=null};for(;lc=cc,cc=query.charAt(x),x<ql;x++){if("\\"==lc){continue}if(!currentPart){pStart=x;currentPart={query:null,pseudos:[],attrs:[],classes:[],tag:null,oper:null,id:null,getTag:function(){return caseSensitive?this.otag:this.tag}};inTag=x}if(0<=inBrackets){if("]"==cc){if(!cp.attr){cp.attr=ts(inBrackets+1,x)}else{cp.matchFor=ts(inMatchFor||inBrackets+1,x)}var cmf=cp.matchFor;if(cmf){if("\""==cmf.charAt(0)||"'"==cmf.charAt(0)){cp.matchFor=cmf.slice(1,-1)}}currentPart.attrs.push(cp);cp=null;inBrackets=inMatchFor=-1}else if("="==cc){var addToCc=0<="|~^$*".indexOf(lc)?lc:"";cp.type=addToCc+cc;cp.attr=ts(inBrackets+1,x-addToCc.length);inMatchFor=x+1}}else if(0<=inParens){if(")"==cc){if(0<=inPseudo){cp.value=ts(inParens+1,x)}inPseudo=inParens=-1}}else if("#"==cc){endAll();inId=x+1}else if("."==cc){endAll();inClass=x}else if(":"==cc){endAll();inPseudo=x}else if("["==cc){endAll();inBrackets=x;cp={}}else if("("==cc){if(0<=inPseudo){cp={name:ts(inPseudo+1,x),value:null};currentPart.pseudos.push(cp)}inParens=x}else if(" "==cc&&lc!=cc){endPart()}}return queryParts},agree=function(first,second){if(!first){return second}if(!second){return first}return function(){return first.apply(window,arguments)&&second.apply(window,arguments)}};function getArr(i,opt_arr){var r=opt_arr||[];if(i){r.push(i)}return r}var isElement=function(n){return 1==n.nodeType},blank="",getAttr=function(elem,attr){if(!elem){return blank}if("class"==attr){return elem.className||blank}if("for"==attr){return elem.htmlFor||blank}if("style"==attr){return elem.style.cssText||blank}return(caseSensitive?elem.getAttribute(attr):elem.getAttribute(attr,2))||blank},attrs={"*=":function(attr,value){return function(elem){return 0<=getAttr(elem,attr).indexOf(value)}},"^=":function(attr,value){return function(elem){return 0==getAttr(elem,attr).indexOf(value)}},"$=":function(attr,value){var tval=" "+value;return function(elem){var ea=" "+getAttr(elem,attr);return ea.lastIndexOf(tval)==ea.length-tval.length}},"~=":function(attr,value){var tval=" "+value+" ";return function(elem){var ea=" "+getAttr(elem,attr)+" ";return 0<=ea.indexOf(tval)}},"|=":function(attr,value){value=" "+value;return function(elem){var ea=" "+getAttr(elem,attr);return ea==value||0==ea.indexOf(value+"-")}},"=":function(attr,value){return function(elem){return getAttr(elem,attr)==value}}},noNextElementSibling="undefined"==typeof goog.dom.getDocument().firstChild.nextElementSibling,nSibling=!noNextElementSibling?"nextElementSibling":"nextSibling",pSibling=!noNextElementSibling?"previousElementSibling":"previousSibling",simpleNodeTest=noNextElementSibling?isElement:goog.functions.TRUE,_lookLeft=function(node){while(node=node[pSibling]){if(simpleNodeTest(node)){return!1}}return!0},_lookRight=function(node){while(node=node[nSibling]){if(simpleNodeTest(node)){return!1}}return!0},getNodeIndex=function(node){var root=node.parentNode,i=0,tret=root[childNodesName],ci=node._i||-1,cl=root._l||-1;if(!tret){return-1}var l=tret.length;if(cl==l&&0<=ci&&0<=cl){return ci}root._l=l;ci=-1;var te=root.firstElementChild||root.firstChild;for(;te;te=te[nSibling]){if(simpleNodeTest(te)){te._i=++i;if(node===te){ci=i}}}return ci},isEven=function(elem){return!(getNodeIndex(elem)%2)},isOdd=function(elem){return getNodeIndex(elem)%2},pseudos={checked:function(name,condition){return function(elem){return elem.checked||elem.attributes.checked}},"first-child":function(){return _lookLeft},"last-child":function(){return _lookRight},"only-child":function(name,condition){return function(node){if(!_lookLeft(node)){return!1}if(!_lookRight(node)){return!1}return!0}},empty:function(name,condition){return function(elem){for(var cn=elem.childNodes,cnl=elem.childNodes.length,x=cnl-1,nt;0<=x;x--){nt=cn[x].nodeType;if(1===nt||3==nt){return!1}}return!0}},contains:function(name,condition){var cz=condition.charAt(0);if("\""==cz||"'"==cz){condition=condition.slice(1,-1)}return function(elem){return 0<=elem.innerHTML.indexOf(condition)}},not:function(name,condition){var p=getQueryParts(condition)[0],ignores={el:1};if("*"!=p.tag){ignores.tag=1}if(!p.classes.length){ignores.classes=1}var ntf=getSimpleFilterFunc(p,ignores);return function(elem){return!ntf(elem)}},"nth-child":function(name,condition){function pi(n){return parseInt(n,10)}if("odd"==condition){return isOdd}else if("even"==condition){return isEven}if(-1!=condition.indexOf("n")){var tparts=condition.split("n",2),pred=tparts[0]?"-"==tparts[0]?-1:pi(tparts[0]):1,idx=tparts[1]?pi(tparts[1]):0,lb=0,ub=-1;if(0<pred){if(0>idx){idx=idx%pred&&pred+idx%pred}else if(0<idx){if(idx>=pred){lb=idx-idx%pred}idx=idx%pred}}else if(0>pred){pred*=-1;if(0<idx){ub=idx;idx=idx%pred}}if(0<pred){return function(elem){var i=getNodeIndex(elem);return i>=lb&&(0>ub||i<=ub)&&i%pred==idx}}else{condition=idx}}var ncount=pi(condition);return function(elem){return getNodeIndex(elem)==ncount}}},defaultGetter=legacyIE?function(cond){var clc=cond.toLowerCase();if("class"==clc){cond="className"}return function(elem){return caseSensitive?elem.getAttribute(cond):elem[cond]||elem[clc]}}:function(cond){return function(elem){return elem&&elem.getAttribute&&elem.hasAttribute(cond)}},getSimpleFilterFunc=function(query,ignores){if(!query){return goog.functions.TRUE}ignores=ignores||{};var ff=null;if(!ignores.el){ff=agree(ff,isElement)}if(!ignores.tag){if("*"!=query.tag){ff=agree(ff,function(elem){return elem&&elem.tagName==query.getTag()})}}if(!ignores.classes){goog.array.forEach(query.classes,function(cname,idx,arr){var re=new RegExp("(?:^|\\s)"+cname+"(?:\\s|$)");ff=agree(ff,function(elem){return re.test(elem.className)});ff.count=idx})}if(!ignores.pseudos){goog.array.forEach(query.pseudos,function(pseudo){var pn=pseudo.name;if(pseudos[pn]){ff=agree(ff,pseudos[pn](pn,pseudo.value))}})}if(!ignores.attrs){goog.array.forEach(query.attrs,function(attr){var matcher,a=attr.attr;if(attr.type&&attrs[attr.type]){matcher=attrs[attr.type](a,attr.matchFor)}else if(a.length){matcher=defaultGetter(a)}if(matcher){ff=agree(ff,matcher)}})}if(!ignores.id){if(query.id){ff=agree(ff,function(elem){return!!elem&&elem.id==query.id})}}if(!ff){if(!("default"in ignores)){ff=goog.functions.TRUE}}return ff},nextSiblingIterator=function(filterFunc){return function(node,ret,bag){while(node=node[nSibling]){if(noNextElementSibling&&!isElement(node)){continue}if((!bag||_isUnique(node,bag))&&filterFunc(node)){ret.push(node)}break}return ret}},nextSiblingsIterator=function(filterFunc){return function(root,ret,bag){var te=root[nSibling];while(te){if(simpleNodeTest(te)){if(bag&&!_isUnique(te,bag)){break}if(filterFunc(te)){ret.push(te)}}te=te[nSibling]}return ret}},_childElements=function(filterFunc){filterFunc=filterFunc||goog.functions.TRUE;return function(root,ret,bag){var te,x=0,tret=root[childNodesName];while(te=tret[x++]){if(simpleNodeTest(te)&&(!bag||_isUnique(te,bag))&&filterFunc(te,x)){ret.push(te)}}return ret}},_isDescendant=function(node,root){var pn=node.parentNode;while(pn){if(pn==root){break}pn=pn.parentNode}return!!pn},_getElementsFuncCache={},getElementsFunc=function(query){var retFunc=_getElementsFuncCache[query.query];if(retFunc){return retFunc}var io=query.infixOper,oper=io?io.oper:"",filterFunc=getSimpleFilterFunc(query,{el:1}),qt=query.tag,wildcardTag="*"==qt,ecs=goog.dom.getDocument().getElementsByClassName;if(!oper){if(query.id){filterFunc=!query.loops&&wildcardTag?goog.functions.TRUE:getSimpleFilterFunc(query,{el:1,id:1});retFunc=function(root,arr){var te=goog.dom.getDomHelper(root).getElement(query.id);if(!te||!filterFunc(te)){return}if(9==root.nodeType){return getArr(te,arr)}else{if(_isDescendant(te,root)){return getArr(te,arr)}}}}else if(ecs&&/\{\s*\[native code\]\s*\}/.test(ecs+"")&&query.classes.length&&!cssCaseBug){filterFunc=getSimpleFilterFunc(query,{el:1,classes:1,id:1});var classesString=query.classes.join(" ");retFunc=function(root,arr){var ret=getArr(0,arr),te,x=0,tret=root.getElementsByClassName(classesString);while(te=tret[x++]){if(filterFunc(te,root)){ret.push(te)}}return ret}}else if(!wildcardTag&&!query.loops){retFunc=function(root,arr){var ret=getArr(0,arr),te,x=0,tret=root.getElementsByTagName(query.getTag());while(te=tret[x++]){ret.push(te)}return ret}}else{filterFunc=getSimpleFilterFunc(query,{el:1,tag:1,id:1});retFunc=function(root,arr){var ret=getArr(0,arr),te,x=0,tret=root.getElementsByTagName(query.getTag());while(te=tret[x++]){if(filterFunc(te,root)){ret.push(te)}}return ret}}}else{var skipFilters={el:1};if(wildcardTag){skipFilters.tag=1}filterFunc=getSimpleFilterFunc(query,skipFilters);if("+"==oper){retFunc=nextSiblingIterator(filterFunc)}else if("~"==oper){retFunc=nextSiblingsIterator(filterFunc)}else if(">"==oper){retFunc=_childElements(filterFunc)}}return _getElementsFuncCache[query.query]=retFunc},filterDown=function(root,queryParts){for(var candidates=getArr(root),qp,x,te,qpl=queryParts.length,bag,ret,i=0;i<qpl;i++){ret=[];qp=queryParts[i];x=candidates.length-1;if(0<x){bag={};ret.nozip=!0}for(var gef=getElementsFunc(qp),j=0;te=candidates[j];j++){gef(te,ret,bag)}if(!ret.length){break}candidates=ret}return ret},_queryFuncCacheDOM={},_queryFuncCacheQSA={},getStepQueryFunc=function(query){var qparts=getQueryParts(goog.string.trim(query));if(1==qparts.length){var tef=getElementsFunc(qparts[0]);return function(root){var r=tef(root,[]);if(r){r.nozip=!0}return r}}return function(root){return filterDown(root,qparts)}},qsa="querySelectorAll",qsaAvail=!!goog.dom.getDocument()[qsa]&&(!goog.userAgent.WEBKIT||goog.userAgent.isVersionOrHigher("526")),getQueryFunc=function(query,opt_forceDOM){if(qsaAvail){var qsaCached=_queryFuncCacheQSA[query];if(qsaCached&&!opt_forceDOM){return qsaCached}}var domCached=_queryFuncCacheDOM[query];if(domCached){return domCached}var qcz=query.charAt(0),nospace=-1==query.indexOf(" ");if(0<=query.indexOf("#")&&nospace){opt_forceDOM=!0}var useQSA=qsaAvail&&!opt_forceDOM&&-1==specials.indexOf(qcz)&&(!legacyIE||-1==query.indexOf(":"))&&!(cssCaseBug&&0<=query.indexOf("."))&&-1==query.indexOf(":contains")&&-1==query.indexOf("|=");if(useQSA){var tq=0<=specials.indexOf(query.charAt(query.length-1))?query+" *":query;return _queryFuncCacheQSA[query]=function(root){try{if(!(9==root.nodeType||nospace)){throw new Error("")}var r=root[qsa](tq);if(legacyIE){r.commentStrip=!0}else{r.nozip=!0}return r}catch(e){return getQueryFunc(query,!0)(root)}}}else{var parts=query.split(/\s*,\s*/);return _queryFuncCacheDOM[query]=2>parts.length?getStepQueryFunc(query):function(root){var pindex=0,ret=[],tp;while(tp=parts[pindex++]){ret=ret.concat(getStepQueryFunc(tp)(root))}return ret}}},_zipIdx=0,_nodeUID=legacyIE?function(node){if(caseSensitive){return node.getAttribute("_uid")||node.setAttribute("_uid",++_zipIdx)||_zipIdx}else{return node.uniqueID}}:function(node){return node._uid||(node._uid=++_zipIdx)},_isUnique=function(node,bag){if(!bag){return 1}var id=_nodeUID(node);if(!bag[id]){return bag[id]=1}return 0},_zipIdxName="_zipIdx",_zip=function(arr){if(arr&&arr.nozip){return arr}var ret=[];if(!arr||!arr.length){return ret}if(arr[0]){ret.push(arr[0])}if(2>arr.length){return ret}_zipIdx++;if(legacyIE&&caseSensitive){var szidx=_zipIdx+"";arr[0].setAttribute(_zipIdxName,szidx);for(var x=1,te;te=arr[x];x++){if(arr[x].getAttribute(_zipIdxName)!=szidx){ret.push(te)}te.setAttribute(_zipIdxName,szidx)}}else if(legacyIE&&arr.commentStrip){try{for(var x=1,te;te=arr[x];x++){if(isElement(te)){ret.push(te)}}}catch(e){}}else{if(arr[0]){arr[0][_zipIdxName]=_zipIdx}for(var x=1,te;te=arr[x];x++){if(arr[x][_zipIdxName]!=_zipIdx){ret.push(te)}te[_zipIdxName]=_zipIdx}}return ret},query=function(query,opt_root){if(!query){return[]}if(query.constructor==Array){return query}if(!goog.isString(query)){return[query]}var root=opt_root;if(goog.isString(root)){root=goog.dom.getElement(root);if(!root){return[]}}root=root||goog.dom.getDocument();var od=root.ownerDocument||root.documentElement;caseSensitive=root.contentType&&"application/xml"==root.contentType||goog.userAgent.OPERA&&(root.doctype||"[object XMLDocument]"==od.toString())||!!od&&(legacyIE?od.xml:root.xmlVersion||od.xmlVersion);var r=getQueryFunc(query)(root);if(r&&r.nozip){return r}return _zip(r)};query.pseudos=pseudos;return query}();goog.exportSymbol("goog.dom.query",goog.dom.query);goog.exportSymbol("goog.dom.query.pseudos",goog.dom.query.pseudos);