goog.require("axs.AuditResults");goog.require("axs.AuditRules");goog.require("axs.utils");goog.provide("axs.Audit");goog.provide("axs.AuditConfiguration");axs.AuditConfiguration=function(config){if(null==config){config={}}this.rules_={};this.scope=null;this.auditRulesToRun=null;this.auditRulesToIgnore=null;this.maxResults=null;this.withConsoleApi=!1;this.walkDom=!0;this.showUnsupportedRulesWarning=!0;for(var prop in this){if(this.hasOwnProperty(prop)&&prop in config){this[prop]=config[prop]}}goog.exportProperty(this,"scope",this.scope);goog.exportProperty(this,"auditRulesToRun",this.auditRulesToRun);goog.exportProperty(this,"auditRulesToIgnore",this.auditRulesToIgnore);goog.exportProperty(this,"withConsoleApi",this.withConsoleApi);goog.exportProperty(this,"walkDom",this.walkDom);goog.exportProperty(this,"showUnsupportedRulesWarning",this.showUnsupportedRulesWarning)};goog.exportSymbol("axs.AuditConfiguration",axs.AuditConfiguration);axs.AuditConfiguration.prototype={ignoreSelectors:function(auditRuleName,selectors){if(!(auditRuleName in this.rules_))this.rules_[auditRuleName]={};if(!("ignore"in this.rules_[auditRuleName]))this.rules_[auditRuleName].ignore=[];Array.prototype.push.call(this.rules_[auditRuleName].ignore,selectors)},getIgnoreSelectors:function(auditRuleName){if(auditRuleName in this.rules_&&"ignore"in this.rules_[auditRuleName]){return this.rules_[auditRuleName].ignore}return[]},setSeverity:function(auditRuleName,severity){if(!(auditRuleName in this.rules_))this.rules_[auditRuleName]={};this.rules_[auditRuleName].severity=severity},getSeverity:function(auditRuleName){if(!(auditRuleName in this.rules_))return null;if(!("severity"in this.rules_[auditRuleName]))return null;return this.rules_[auditRuleName].severity},setRuleConfig:function(auditRuleName,config){if(!(auditRuleName in this.rules_))this.rules_[auditRuleName]={};this.rules_[auditRuleName].config=config},getRuleConfig:function(auditRuleName){if(!(auditRuleName in this.rules_))return null;if(!("config"in this.rules_[auditRuleName]))return null;return this.rules_[auditRuleName].config}};goog.exportProperty(axs.AuditConfiguration.prototype,"ignoreSelectors",axs.AuditConfiguration.prototype.ignoreSelectors);goog.exportProperty(axs.AuditConfiguration.prototype,"getIgnoreSelectors",axs.AuditConfiguration.prototype.getIgnoreSelectors);axs.Audit.unsupportedRulesWarningShown=!1;axs.Audit.getRulesCannotRun=function(opt_configuration){if(opt_configuration.withConsoleApi){return[]}return axs.AuditRules.getRules().filter(function(rule){return rule.requiresConsoleAPI}).map(function(rule){return rule.code})};axs.Audit.run=function(opt_configuration){var configuration=opt_configuration||new axs.AuditConfiguration;if(!axs.Audit.unsupportedRulesWarningShown&&configuration.showUnsupportedRulesWarning){var unsupportedRules=axs.Audit.getRulesCannotRun(configuration);if(0<unsupportedRules.length){console.warn("Some rules cannot be checked using the axs.Audit.run() method call. Use the Chrome plugin to check these rules: "+unsupportedRules.join(", "));console.warn("To remove this message, pass an AuditConfiguration object to axs.Audit.run() and set configuration.showUnsupportedRulesWarning = false.")}axs.Audit.unsupportedRulesWarningShown=!0}var auditRules=axs.AuditRules.getActiveRules(configuration);configuration.collectIdRefs=auditRules.some(function(auditRule){return auditRule.collectIdRefs});if(!configuration.scope){configuration.scope=document.documentElement}axs.Audit.collectMatchingElements(configuration,auditRules);for(var results=[],i=0,auditRule;i<auditRules.length;i++){auditRule=auditRules[i];if(!auditRule.canRun(configuration))continue;results.push(auditRule.run(configuration))}return results};goog.exportSymbol("axs.Audit.run",axs.Audit.run);(function(){axs.Audit.collectMatchingElements=function(configuration,auditRules){var rootFlags={walkDom:configuration.walkDom,collectIdRefs:configuration.collectIdRefs,level:0,ignoring:{},disabled:!1,hidden:!1},root=configuration.walkDom?document.documentElement:configuration.scope;axs.dom.composedTreeSearch(root,null,{preorder:function(element,flags){if(!flags.inScope)flags.inScope=element===configuration.scope;for(var i=0,auditRule;i<auditRules.length;i++){auditRule=auditRules[i];if(!auditRule.canRun(configuration))continue;auditRule._options=new AuditOptions(configuration,auditRule);var ignore=flags.ignoring[auditRule.name]||(flags.ignoring[auditRule.name]=auditRule._options.shouldIgnore(element));if(!ignore){auditRule.collectMatchingElement(element,flags)}}return!0}},rootFlags)};function AuditOptions(configuration,auditRule){var ignoreSelectors=configuration.getIgnoreSelectors(auditRule.name);if(0<ignoreSelectors.length||configuration.scope)this.ignoreSelectors=ignoreSelectors;var ruleConfig=configuration.getRuleConfig(auditRule.name);if(ruleConfig)this.config=ruleConfig}AuditOptions.prototype.shouldIgnore=function(element){var ignoreSelectors=this.ignoreSelectors;if(ignoreSelectors){for(var i=0;i<ignoreSelectors.length;i++){if(axs.browserUtils.matchSelector(element,ignoreSelectors[i]))return!0}}return!1}})();axs.Audit.auditResults=function(results){for(var auditResults=new axs.AuditResults,i=0,result;i<results.length;i++){result=results[i];if(result.result!=axs.constants.AuditResult.FAIL)continue;if(result.rule.severity==axs.constants.Severity.SEVERE){auditResults.addError(axs.Audit.accessibilityErrorMessage(result))}else{auditResults.addWarning(axs.Audit.accessibilityErrorMessage(result))}}return auditResults};goog.exportSymbol("axs.Audit.auditResults",axs.Audit.auditResults);axs.Audit.createReport=function(results,opt_url){var message="*** Begin accessibility audit results ***";message+="\nAn accessibility audit found ";message+=axs.Audit.auditResults(results).toString();if(opt_url){message+="\nFor more information, please see ";message+=opt_url}message+="\n*** End accessibility audit results ***";return message};goog.exportSymbol("axs.Audit.createReport",axs.Audit.createReport);axs.Audit.accessibilityErrorMessage=function(result){var _Mathmin=Math.min;if(result.rule.severity==axs.constants.Severity.SEVERE)var message="Error: ";else var message="Warning: ";message+=result.rule.code+" ("+result.rule.heading+") failed on the following "+(1==result.elements.length?"element":"elements");if(1==result.elements.length)message+=":";else{message+=" (1 - "+_Mathmin(5,result.elements.length)+" of "+result.elements.length+"):"}for(var maxElements=_Mathmin(result.elements.length,5),i=0,element;i<maxElements;i++){element=result.elements[i];message+="\n";try{message+=axs.utils.getQuerySelectorText(element)}catch(err){message+=" tagName:"+element.tagName;message+=" id:"+element.id}}if(""!=result.rule.url)message+="\nSee "+result.rule.url+" for more information.";return message};goog.exportSymbol("axs.Audit.accessibilityErrorMessage",axs.Audit.accessibilityErrorMessage);