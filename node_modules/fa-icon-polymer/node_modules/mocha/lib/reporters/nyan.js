'use strict';var Base=require("./base"),inherits=require("../utils").inherits;exports=module.exports=NyanCat;function NyanCat(runner){Base.call(this,runner);var self=this,width=0|.75*Base.window.width,nyanCatWidth=this.nyanCatWidth=11;this.colorIndex=0;this.numberOfLines=4;this.rainbowColors=self.generateColors();this.scoreboardWidth=5;this.tick=0;this.trajectories=[[],[],[],[]];this.trajectoryWidthMax=width-nyanCatWidth;runner.on("start",function(){Base.cursor.hide();self.draw()});runner.on("pending",function(){self.draw()});runner.on("pass",function(){self.draw()});runner.on("fail",function(){self.draw()});runner.on("end",function(){Base.cursor.show();for(var i=0;i<self.numberOfLines;i++){write("\n")}self.epilogue()})}inherits(NyanCat,Base);NyanCat.prototype.draw=function(){this.appendRainbow();this.drawScoreboard();this.drawRainbow();this.drawNyanCat();this.tick=!this.tick};NyanCat.prototype.drawScoreboard=function(){var stats=this.stats;function draw(type,n){write(" ");write(Base.color(type,n));write("\n")}draw("green",stats.passes);draw("fail",stats.failures);draw("pending",stats.pending);write("\n");this.cursorUp(this.numberOfLines)};NyanCat.prototype.appendRainbow=function(){for(var segment=this.tick?"_":"-",rainbowified=this.rainbowify(segment),index=0,trajectory;index<this.numberOfLines;index++){trajectory=this.trajectories[index];if(trajectory.length>=this.trajectoryWidthMax){trajectory.shift()}trajectory.push(rainbowified)}};NyanCat.prototype.drawRainbow=function(){var self=this;this.trajectories.forEach(function(line){write("\x1B["+self.scoreboardWidth+"C");write(line.join(""));write("\n")});this.cursorUp(this.numberOfLines)};NyanCat.prototype.drawNyanCat=function(){var self=this,startWidth=this.scoreboardWidth+this.trajectories[0].length,dist="\x1B["+startWidth+"C",padding="";write(dist);write("_,------,");write("\n");write(dist);padding=self.tick?"  ":"   ";write("_|"+padding+"/\\_/\\ ");write("\n");write(dist);padding=self.tick?"_":"__";var tail=self.tick?"~":"^";write(tail+"|"+padding+this.face()+" ");write("\n");write(dist);padding=self.tick?" ":"  ";write(padding+"\"\"  \"\" ");write("\n");this.cursorUp(this.numberOfLines)};NyanCat.prototype.face=function(){var stats=this.stats;if(stats.failures){return"( x .x)"}else if(stats.pending){return"( o .o)"}else if(stats.passes){return"( ^ .^)"}return"( - .-)"};NyanCat.prototype.cursorUp=function(n){write("\x1B["+n+"A")};NyanCat.prototype.cursorDown=function(n){write("\x1B["+n+"B")};NyanCat.prototype.generateColors=function(){for(var _Mathsin=Math.sin,_Mathfloor=Math.floor,colors=[],i=0;i<7*6;i++){var pi3=_Mathfloor(Math.PI/3),n=i*(1/6),r=_Mathfloor(3*_Mathsin(n)+3),g=_Mathfloor(3*_Mathsin(n+2*pi3)+3),b=_Mathfloor(3*_Mathsin(n+4*pi3)+3);colors.push(36*r+6*g+b+16)}return colors};NyanCat.prototype.rainbowify=function(str){if(!Base.useColors){return str}var color=this.rainbowColors[this.colorIndex%this.rainbowColors.length];this.colorIndex+=1;return"\x1B[38;5;"+color+"m"+str+"\x1B[0m"};function write(string){process.stdout.write(string)}