'use strict';var EventEmitter=require("events").EventEmitter,Hook=require("./hook"),utils=require("./utils"),inherits=utils.inherits,debug=require("debug")("mocha:suite"),milliseconds=require("./ms");exports=module.exports=Suite;exports.create=function(parent,title){var suite=new Suite(title,parent.ctx);suite.parent=parent;title=suite.fullTitle();parent.addSuite(suite);return suite};function Suite(title,parentContext){if(!utils.isString(title)){throw new Error("Suite `title` should be a \"string\" but \""+typeof title+"\" was given instead.")}this.title=title;function Context(){}Context.prototype=parentContext;this.ctx=new Context;this.suites=[];this.tests=[];this.pending=!1;this._beforeEach=[];this._beforeAll=[];this._afterEach=[];this._afterAll=[];this.root=!title;this._timeout=2e3;this._enableTimeouts=!0;this._slow=75;this._bail=!1;this._retries=-1;this._onlyTests=[];this._onlySuites=[];this.delayed=!1}inherits(Suite,EventEmitter);Suite.prototype.clone=function(){var suite=new Suite(this.title);debug("clone");suite.ctx=this.ctx;suite.timeout(this.timeout());suite.retries(this.retries());suite.enableTimeouts(this.enableTimeouts());suite.slow(this.slow());suite.bail(this.bail());return suite};Suite.prototype.timeout=function(ms){if(!arguments.length){return this._timeout}if("0"===ms.toString()){this._enableTimeouts=!1}if("string"===typeof ms){ms=milliseconds(ms)}debug("timeout %d",ms);this._timeout=parseInt(ms,10);return this};Suite.prototype.retries=function(n){if(!arguments.length){return this._retries}debug("retries %d",n);this._retries=parseInt(n,10)||0;return this};Suite.prototype.enableTimeouts=function(enabled){if(!arguments.length){return this._enableTimeouts}debug("enableTimeouts %s",enabled);this._enableTimeouts=enabled;return this};Suite.prototype.slow=function(ms){if(!arguments.length){return this._slow}if("string"===typeof ms){ms=milliseconds(ms)}debug("slow %d",ms);this._slow=ms;return this};Suite.prototype.bail=function(bail){if(!arguments.length){return this._bail}debug("bail %s",bail);this._bail=bail;return this};Suite.prototype.isPending=function(){return this.pending||this.parent&&this.parent.isPending()};Suite.prototype.beforeAll=function(title,fn){if(this.isPending()){return this}if("function"===typeof title){fn=title;title=fn.name}title="\"before all\" hook"+(title?": "+title:"");var hook=new Hook(title,fn);hook.parent=this;hook.timeout(this.timeout());hook.retries(this.retries());hook.enableTimeouts(this.enableTimeouts());hook.slow(this.slow());hook.ctx=this.ctx;this._beforeAll.push(hook);this.emit("beforeAll",hook);return this};Suite.prototype.afterAll=function(title,fn){if(this.isPending()){return this}if("function"===typeof title){fn=title;title=fn.name}title="\"after all\" hook"+(title?": "+title:"");var hook=new Hook(title,fn);hook.parent=this;hook.timeout(this.timeout());hook.retries(this.retries());hook.enableTimeouts(this.enableTimeouts());hook.slow(this.slow());hook.ctx=this.ctx;this._afterAll.push(hook);this.emit("afterAll",hook);return this};Suite.prototype.beforeEach=function(title,fn){if(this.isPending()){return this}if("function"===typeof title){fn=title;title=fn.name}title="\"before each\" hook"+(title?": "+title:"");var hook=new Hook(title,fn);hook.parent=this;hook.timeout(this.timeout());hook.retries(this.retries());hook.enableTimeouts(this.enableTimeouts());hook.slow(this.slow());hook.ctx=this.ctx;this._beforeEach.push(hook);this.emit("beforeEach",hook);return this};Suite.prototype.afterEach=function(title,fn){if(this.isPending()){return this}if("function"===typeof title){fn=title;title=fn.name}title="\"after each\" hook"+(title?": "+title:"");var hook=new Hook(title,fn);hook.parent=this;hook.timeout(this.timeout());hook.retries(this.retries());hook.enableTimeouts(this.enableTimeouts());hook.slow(this.slow());hook.ctx=this.ctx;this._afterEach.push(hook);this.emit("afterEach",hook);return this};Suite.prototype.addSuite=function(suite){suite.parent=this;suite.timeout(this.timeout());suite.retries(this.retries());suite.enableTimeouts(this.enableTimeouts());suite.slow(this.slow());suite.bail(this.bail());this.suites.push(suite);this.emit("suite",suite);return this};Suite.prototype.addTest=function(test){test.parent=this;test.timeout(this.timeout());test.retries(this.retries());test.enableTimeouts(this.enableTimeouts());test.slow(this.slow());test.ctx=this.ctx;this.tests.push(test);this.emit("test",test);return this};Suite.prototype.fullTitle=function(){if(this.parent){var full=this.parent.fullTitle();if(full){return full+" "+this.title}}return this.title};Suite.prototype.total=function(){return utils.reduce(this.suites,function(sum,suite){return sum+suite.total()},0)+this.tests.length};Suite.prototype.eachTest=function(fn){utils.forEach(this.tests,fn);utils.forEach(this.suites,function(suite){suite.eachTest(fn)});return this};Suite.prototype.run=function run(){if(this.root){this.emit("run")}};