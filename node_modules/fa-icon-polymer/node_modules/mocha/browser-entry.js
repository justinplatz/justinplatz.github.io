'use strict';process.stdout=require("browser-stdout")();var Mocha=require("./lib/mocha"),mocha=new Mocha({reporter:"html"}),Date=global.Date,setTimeout=global.setTimeout,setInterval=global.setInterval,clearTimeout=global.clearTimeout,clearInterval=global.clearInterval,uncaughtExceptionHandlers=[],originalOnerrorHandler=global.onerror;process.removeListener=function(e,fn){if("uncaughtException"===e){if(originalOnerrorHandler){global.onerror=originalOnerrorHandler}else{global.onerror=function(){}}var i=Mocha.utils.indexOf(uncaughtExceptionHandlers,fn);if(-1!==i){uncaughtExceptionHandlers.splice(i,1)}}};process.on=function(e,fn){if("uncaughtException"===e){global.onerror=function(err,url,line){fn(new Error(err+" ("+url+":"+line+")"));return!mocha.allowUncaught};uncaughtExceptionHandlers.push(fn)}};mocha.suite.removeAllListeners("pre-require");var immediateQueue=[],immediateTimeout;function timeslice(){var immediateStart=new Date().getTime();while(immediateQueue.length&&100>new Date().getTime()-immediateStart){immediateQueue.shift()()}if(immediateQueue.length){immediateTimeout=setTimeout(timeslice,0)}else{immediateTimeout=null}}Mocha.Runner.immediately=function(callback){immediateQueue.push(callback);if(!immediateTimeout){immediateTimeout=setTimeout(timeslice,0)}};mocha.throwError=function(err){Mocha.utils.forEach(uncaughtExceptionHandlers,function(fn){fn(err)});throw err};mocha.ui=function(ui){Mocha.prototype.ui.call(this,ui);this.suite.emit("pre-require",global,null,this);return this};mocha.setup=function(opts){if("string"===typeof opts){opts={ui:opts}}for(var opt in opts){if(opts.hasOwnProperty(opt)){this[opt](opts[opt])}}return this};mocha.run=function(fn){var options=mocha.options;mocha.globals("location");var query=Mocha.utils.parseQuery(global.location.search||"");if(query.grep){mocha.grep(query.grep)}if(query.fgrep){mocha.fgrep(query.fgrep)}if(query.invert){mocha.invert()}return Mocha.prototype.run.call(mocha,function(err){var document=global.document;if(document&&document.getElementById("mocha")&&!0!==options.noHighlighting){Mocha.utils.highlightTags("code")}if(fn){fn(err)}})};Mocha.process=process;global.Mocha=Mocha;global.mocha=mocha;module.exports=global;